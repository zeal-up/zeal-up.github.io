<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zeal-up.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.15.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
<meta property="og:type" content="website">
<meta property="og:title" content="Zeal&#39;s Blog">
<meta property="og:url" content="https://zeal-up.github.io/archives/index.html">
<meta property="og:site_name" content="Zeal&#39;s Blog">
<meta property="og:description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zeal">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zeal-up.github.io/archives/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"archives/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zeal's Blog</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?41fc030db57d5570dd22f78997dc4a7e"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zeal's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">å¥½å¥½å­¦ä¹ ï½å¤©å¤©å‘ä¸Šï½</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zeal</p>
  <div class="site-description" itemprop="description">å­¦ä¹ è®°å½•åŠåˆ†äº«</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/27/lio_sam/gtsam-quickstart/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”GTSAMå¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-27 21:28:48" itemprop="dateCreated datePublished" datetime="2023-03-27T21:28:48+08:00">2023-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-29 19:16:46" itemprop="dateModified" datetime="2023-03-29T19:16:46+08:00">2023-03-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”GTSAMå¿«é€Ÿå…¥é—¨" href="/2023/03/27/lio_sam/gtsam-quickstart/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::0d35c30bd7aedf439c2d1184605769ac" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>å…¶ä¸­çš„ä¸¤å¤§æ¨¡å—<code>imuPreintegration</code>å’Œ<code>mapOptimization</code>éƒ½ä¾èµ–äº†å› å­å›¾ä¼˜åŒ–æ¡†æ¶â€”â€”<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>ã€‚ ä¸ºäº†ç¡®ä¿æœ¬é¡¹ç›®çš„è‡ªæ´½æ€§ä»¥åŠåé¢ç« èŠ‚è®²è§£çš„å±•å¼€ï¼Œä¸ä»‹ç»ä¸€ä¸‹å› å­å›¾åç«¯ä¼˜åŒ–ç®—æ³•ä¼¼ä¹è¯´ä¸è¿‡å»ã€‚ä½†æ˜¯ç¬”è€…ç›®å‰å¯¹å› å­å›¾çš„åŸç†è¿˜æ²¡æœ‰è¿›è¡Œéå¸¸è¯¦ç»†çš„æ¨å¯¼ï¼Œå› æ­¤è¿™éƒ¨åˆ† å†…å®¹ä¼šåå‘å¦‚ä½•å¯¹<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>å¿«é€Ÿå…¥é—¨ã€‚å½“ç„¶ï¼Œæœ€å¿«é€Ÿçš„å…¥é—¨æ–¹å¼å°±æ˜¯å®Œæ•´åœ°é˜…è¯»ä¸€é<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>çš„å®˜æ–¹æ•™ç¨‹ã€‚è¿™éƒ¨åˆ†ç« èŠ‚åªæ˜¯æ‹™åŠ£åœ°è¿›è¡ŒçŸ¥è¯†çš„æ¬è¿ï¼Œå½“ç„¶ä¸æ˜¯ç›´æ¥å°† <a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>çš„æ•™ç¨‹ç›´æ¥ç¿»è¯‘è¿‡æ¥ã€‚æœ¬ç« èŠ‚ä¼šä»‹ç»<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>å¿«é€Ÿå…¥é—¨çš„çŸ¥è¯†ï¼ŒåŒæ—¶è®²è§£<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>æä¾›çš„<code>examples</code>ä¸­è·Ÿ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>è”ç³»è¾ƒä¸ºç´§å¯†çš„ä¸€ä¸¤ä¸ªï¼ŒåŒæ—¶æŒ‡æ˜<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­çš„ç”¨æ³•å‡ºå¤„ã€‚ è‡³å°‘é˜…è¯»å®Œæœ¬ç« èŠ‚ååº”è¯¥èƒ½å¤Ÿå¯¹å› å­å›¾æœ‰åŸºæœ¬çš„è®¤è¯†ï¼Œå¹¶ä¸”èƒ½å¤Ÿçœ‹æ‡‚<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­å¯¹<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>çš„ä½¿ç”¨</p>
<h2 id="slamåç«¯å›¾ä¼˜åŒ–">SLAMåç«¯â€”â€”å›¾ä¼˜åŒ–</h2>
<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>è®©æˆ‘ä»¬å…ˆå›å½’é—®é¢˜æœ¬èº«ã€‚åœ¨SLAMä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰å¤šä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯è·å–ä¸€æ¡æœ€å‡†ç¡®çš„è½¨è¿¹ï¼Œç„¶åä½¿ç”¨è¿™æ¡å‡†ç¡®çš„è½¨è¿¹å®æ—¶æ„å»ºåœ°å›¾ã€‚åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹è¾“å…¥ï¼š 1. IMUæ•°æ®ï¼› 2. ç‚¹äº‘æ•°æ®ï¼› 3. GPSæ•°æ®ï¼ˆå¯é€‰ï¼‰ï¼› 4. å›ç¯æ£€æµ‹ï¼›</p>
<p>æˆ‘ä»¬çš„é—®é¢˜æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›æ•°æ®è®¡ç®—å‡ºä¸€æ¡æœ€å‡†ç¡®çš„å†å²è½¨è¿¹ï¼Œä½¿ç”¨è¯¥è½¨è¿¹å°±å¯ä»¥å°†å¯¹åº”çš„ç‚¹äº‘æŠ•å½±åˆ°åœ°å›¾åæ ‡ç³»ï¼Œä»¥æ­¤æ¥å»ºç«‹ä¸€ä¸ªç‚¹äº‘æ ¼å¼åœ°å›¾ã€‚ PSï¼šè¿™åªæ˜¯SLAMçš„ä¸€ä¸ªå½¢å¼ï¼Œå°±æ˜¯ä¼˜åŒ–å‡ºä¸€æ¡å…‰æ»‘å‡†ç¡®çš„è½¨è¿¹ï¼Œè¿™ä¹Ÿæ˜¯åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œå› æ­¤æœ¬æ–‡ä»¥è¿™ç§ç±»å‹ä½œä¸ºè®²è§£ã€‚</p>
<h3 id="éçº¿æ€§ä¼˜åŒ–">éçº¿æ€§ä¼˜åŒ–</h3>
<p>åœ¨SLAMé¢†åŸŸåç«¯ä¼˜åŒ–çš„ä¸€ä¸ªåˆ†æ”¯æ˜¯<code>æ»¤æ³¢å™¨æ–¹æ³•</code>ï¼Œä¸»è¦ä»¥æ‰©å±•å¡å°”æ›¼æ»¤æ³¢æ–¹æ³•ä¸ºä¸»ï¼Œé‡‡ç”¨éšé©¬å°”ç§‘å¤«å‡è®¾ï¼Œåªä¿å­˜ä¸Šä¸€æ¬¡çŠ¶æ€ï¼Œå¹¶é€šè¿‡å½“å‰è¾“å…¥é¢„æµ‹å½“å‰çŠ¶æ€ï¼Œå¶å°”é€šè¿‡è§‚æµ‹ä¿®æ­£çŠ¶æ€ã€‚å…·ä½“å¯è§æœ¬åšå®¢çš„å¡å°”æ›¼æ»¤æ³¢ç›¸å…³æ–‡ç« ã€‚</p>
<p>ç›®å‰çš„åç«¯ä¼˜åŒ–ä¸»è¦ä»¥å„ç§éçº¿æ€§ä¼˜åŒ–æ–¹æ³•ä¸ºä¸»ï¼ŒæŠŠæ‰¹é‡çš„ä½å§¿åŠ å…¥ç›®æ ‡æ–¹ç¨‹ï¼ˆprojective functionï¼‰ä¸€èµ·ä¼˜åŒ–ï¼Œå¾—åˆ°å…·æœ‰æ›´å¥½çš„å…¨å±€æ€§è´¨çš„è§£ã€‚ <span class="math display">\[
\mathbf{x}^* = \argmin_{\mathbf{x}}\mathbb{F}(\mathbf{x})
\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(\mathbb{F}\)</span>æ˜¯å†å²è½¨è¿¹å¼•å…¥çš„å„ä¸ªè¯¯å·®ä¹‹å’Œ <span class="math display">\[
\mathbb{F}(\mathbf{x}) = \sum\mathbf{e}(x_i,c_{ij},x_j)
\]</span> <span class="math inline">\(x_i,x_j\)</span>æ˜¯å†å²æ—¶åˆ»çš„ä½å§¿ï¼Œ<span class="math inline">\(c_{ij}\)</span>æ˜¯ä¸¤è€…ä¹‹é—´çš„çº¦æŸï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯è§‚æµ‹æˆ–è€…è¾“å…¥ï¼‰</p>
<p><strong>PSï¼šå†é‡ç”³ä¸€å¥ï¼ŒSLAMåç«¯ä½“ç³»å¾ˆåºå¤§ï¼Œä¸æ˜¯ä¸€ç¯‡æ–‡ç« èƒ½è¯´æ¸…æ¥šçš„ï¼Œç¬”è€…ç›®å‰ä¹Ÿè¿˜æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ã€‚ç›®å‰åªæ±‚èƒ½å¤Ÿç¨å¾®è®²æ¸…æ¥š<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­æ˜¯æ€ä¹ˆè¢«ä½¿ç”¨çš„å³å¯ã€‚</strong></p>
<p>ä¸ºäº†æ±‚è§£éçº¿æ€§æ–¹ç¨‹åœ¨ä¸åŒçš„SLAMä»»åŠ¡ä¸­çš„ç‰¹ç‚¹ï¼Œåˆå‘å±•å‡ºå„ç§ä¸åŒçš„ä¼˜åŒ–æ–¹å¼ï¼Œæ¯”å¦‚VIOä¸­æœ‰Bundle Adjustmentï¼Œæœ‰å…¶ä»–å«PoseGraphçš„ï¼Œè¿˜æœ‰<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>ä¸­ä½¿ç”¨çš„FactorGraphã€‚ ç®€å•ç†è§£å°±æ˜¯è¿™äº›éƒ½æ˜¯éçº¿æ€§æ–¹ç¨‹å’Œæ±‚è§£åœ¨ä¸åŒçš„ä»»åŠ¡åœºæ™¯ä¸­çš„ç»†åˆ†ã€‚åé¢æœ‰æœºä¼šå†å•ç‹¬åˆ—ä¸€ç¯‡æ–‡ç« è®²è§£è¿™äº›åç«¯ä¼˜åŒ–æ–¹æ³•æŠŠã€‚ <img src="./imgs/introToBA.png" alt="ä¸€å›¾è¯´æ˜BA" /></p>
<h3 id="å›¾ä¼˜åŒ–">å›¾ä¼˜åŒ–</h3>
<p><strong>ä»¥ä¸‹å†…å®¹å¤§é‡å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-repo/doc/gtsam.pdf</a></strong></p>
<p>ä¸ºäº†æ‰¹é‡ä¼˜åŒ–å†å²ä½å§¿<span class="math inline">\(\mathbf{x} = \{x_0, x_1, x_2, ... x_i\}\)</span>ï¼Œç ”ç©¶è€…å°†å›¾è®ºå¼•å…¥SLAMåç«¯ä¼˜åŒ–ã€‚æ¯ä¸€ä¸ªæœºå™¨çš„ä½å§¿<span class="math inline">\(x_i\)</span>æ˜¯å›¾ä¸­çš„é¡¶ç‚¹ï¼›é€šè¿‡å„ç§é‡Œç¨‹è®¡è®¡ç®—ï¼Œæ¯”å¦‚è¿ç»­ä½å§¿é—´çš„IMUç§¯åˆ†ç»“æœæˆ–è€…ç‚¹äº‘åŒ¹é…ç»“æœï¼Œæˆä¸ºä¸¤ä¸ªä½å§¿<span class="math inline">\(x_i,x_j\)</span>ä¹‹é—´çš„è¾¹ï¼›å¯¹äºä¸€äº›é¢å¤–çš„è§‚æµ‹ï¼Œæ¯”å¦‚GPSæ•°æ®ï¼Œæˆä¸ºè¿æ¥é¡¶ç‚¹çš„ä¸€å…ƒè¾¹ï¼ˆåªæœ‰ä¸€ç«¯è¿æ¥åˆ°é¡¶ç‚¹ï¼‰ã€‚æ¯”å¦‚ä¸‹å›¾(å¼•ç”¨è‡ªï¼š<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-Hands-on Introduction</a>) <img src="./imgs/egForFactorGraph.png" alt="FactorGraph" /></p>
<h2 id="gtsam">GTSAM</h2>
<p>GTSAMä½¿ç”¨å› å­å›¾ï¼ˆFactorGraphï¼‰ä½œä¸ºé€šç”¨çš„å›¾é—®é¢˜æè¿°æ¡†æ¶ï¼Œå¹¶ä¸ºå„ç§æœºå™¨äººä»»åŠ¡æä¾›å®ç°å¥½çš„ä¼˜åŒ–ç®—æ³•APIï¼Œä½¿å¾—ç ”ç©¶è€…å¿«é€Ÿå¼€å‘åç«¯ä¼˜åŒ–æ¡†æ¶ã€‚</p>
<p><strong>å›¾ä¼˜åŒ–ï¼ˆGraphOptimizationï¼‰vs. <a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>ä¸­ä½¿ç”¨çš„å› å­å›¾ä¼˜åŒ–ï¼ˆFactorGraph Optimizationï¼‰åŒºåˆ« vs. BA</strong></p>
<ol type="1">
<li><strong>å›¾ä¼˜åŒ–</strong>ä¼¼ä¹ä¸€èˆ¬æŒ‡ä½å§¿å›¾ï¼ˆPoseGraphï¼‰çš„ä¼˜åŒ–ï¼Œå›¾ä¸­çš„é¡¶ç‚¹éƒ½æ˜¯æœºå™¨äººçš„ä½å§¿</li>
<li><strong>BA</strong>(Bundle Adjustment)ä¼¼ä¹ä¸€èˆ¬æŒ‡åœ¨è§†è§‰SLAMä¸­å¯¹åœ°æ ‡ï¼ˆLandmarksï¼‰å’Œä½å§¿åŒæ—¶ä¼˜åŒ–çš„æ–¹æ³•</li>
<li><strong>GTSAM</strong>çš„å› å­å›¾é™¤äº†èƒ½å¤Ÿæ„å»ºä½å§¿å›¾ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å°†é€Ÿåº¦ã€åå·®ã€IMUé¢„ç§¯åˆ†ç­‰å½“ä½œé¡¶ç‚¹å’Œè¾¹åŠ å…¥å›¾ä¸­ã€‚å¦å¤–ï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>æ¡†æ¶å®ç°äº†iSAMå’ŒiSAM2ä¸¤ä¸ªé€’å¢å¼ä¼˜åŒ–å™¨</li>
</ol>
<h3 id="é‡è¦æ¦‚å¿µ">é‡è¦æ¦‚å¿µ</h3>
<p><strong>å˜é‡ï¼ˆvariablesï¼‰</strong>ï¼šå› å­å›¾ä¸­çš„æ¯ä¸€ä¸ªé¡¶ç‚¹æ˜¯ä¸€ä¸ªä»£æ±‚çš„å˜é‡ã€‚å‡è®¾æˆ‘ä»¬åªéœ€è¦æ±‚è§£æ¯ä¸€ä¸ªæ—¶åˆ»çš„æœºå™¨äººå§¿æ€ï¼Œé‚£ä¹ˆæ¯ä¸ªé¡¶ç‚¹å°±æ˜¯è¯¥æ—¶åˆ»çš„æœºå™¨äººä½å§¿ï¼Œå¦‚ä¸Šå›¾ä¸­çš„<span class="math inline">\({X_1,X_2,X_3}\)</span></p>
<p><strong>å€¼ï¼ˆvaluesï¼‰</strong>ï¼šå€¼æ˜¯æ¯ä¸ªå˜é‡æ•°å€¼ã€‚åœ¨è°ƒç”¨ä¼˜åŒ–å™¨å¯¹å› å­å›¾åšä¼˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆä¸ºæ¯ä¸ªå˜é‡è®¾ç½®åˆå§‹å€¼ï¼Œä¼˜åŒ–ç»“æŸåå†ä»ä¼˜åŒ–å™¨ä¸­æ‹¿å‡ºæ¯ä¸ªå˜é‡ä¼˜åŒ–åçš„å€¼ã€‚</p>
<p><strong>å› å­ï¼ˆfactorsï¼‰</strong>ï¼šå› å­æ˜¯å› å­å›¾ä¸­çš„è¾¹ï¼Œæ¯æ¡è¾¹éƒ½å¯ä»¥è§†ä¸ºä¸€ä¸ªå› å­ï¼Œæ¯ä¸ªå› å­åˆå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¦æŸã€‚æ¯”å¦‚è¿ç»­ä¸¤ä¸ªä½å§¿ä¹‹é—´å¯ä»¥ç”±IMUè®¡ç®—å‡ºä¸¤ä¸ªä½å§¿çš„å˜æ¢ï¼Œè¯¥å˜æ¢ä½œä¸ºä¸€æ¡è¾¹åŠ å…¥å› å­å›¾è¿æ¥ä¸¤ä¸ªå˜é‡ï¼ˆ<code>äºŒå…ƒå› å­ï¼šbinary factor</code>ï¼‰ï¼›åˆæˆ–è€…åœ¨æŸä¸ªæ—¶åˆ»æœ‰GPSæ•°æ®è¾“å…¥ï¼ŒGPSæ•°æ®æ˜¯ä¸€ä¸ªè§‚æµ‹ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå› å­åŠ å…¥å› å­å›¾ï¼Œè¿™æ—¶å€™GPSçš„è¾¹åªæœ‰ä¸€ç«¯è¿æ¥åˆ°å˜é‡ï¼ˆ<code>ä¸€å…ƒå› å­ï¼šunary factor</code>ï¼‰ã€‚</p>
<p><strong>å› å­å›¾ï¼ˆfactor graphï¼‰</strong>ï¼šå› å­å›¾ç”±é¡¶ç‚¹ï¼ˆå˜é‡ï¼‰å’Œå› å­ï¼ˆè¾¹ï¼‰æ„æˆã€‚</p>
<p><strong>ä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰</strong>ï¼šå› å­å›¾åªæ˜¯å»ºæ¨¡äº†SLAMçš„å†å²ä½å§¿å’Œè¾“å…¥ä¸è§‚æµ‹é—´çš„å…³ç³»ï¼Œå¦‚ä½•æ±‚è§£è¿™ä¸ªå› å­å›¾ä¹Ÿå°±æ˜¯å¦‚ä½•è®¾ç½®å˜é‡ä½¿å¾—æ•´ä¸ªå›¾æœ€ç¬¦åˆæ‰€æœ‰çš„çº¦æŸï¼ˆè¯¯å·®æœ€å°ï¼‰åˆ™éœ€è¦ç”¨åˆ°ä¼˜åŒ–å™¨ã€‚é™¤äº†æœ€å¸¸è§çš„æ±‚è§£éçº¿æ€§é—®é¢˜çš„<code>Gaussian-Newton</code>å’Œ<code>Levenberg-Marquardt</code>ä¼˜åŒ–å™¨ä¹‹å¤–ï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>è¿˜å®ç°äº†ä¸¤ä¸ªå¢é‡å¼ä¼˜åŒ–å™¨<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess08tro.pdf">iSAM</a>,<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess12ijrr.pdf">iSAM2</a></p>
<p><strong>é”®ï¼ˆKeysï¼‰</strong>ï¼šå¾€å› å­å›¾æ·»åŠ å› å­éœ€è¦æŒ‡å®šè¯¥å› å­è¿æ¥åˆ°å“ªäº›å˜é‡ã€‚GTSAMä¸­ä½¿ç”¨é”®æ¥æŒ‡æ˜ã€‚ä¸€å…ƒå› å­éœ€è¦æŒ‡æ˜å…¶è¿æ¥åˆ°ç¬¬å‡ ä¸ªå˜é‡ï¼›äºŒå…ƒå› å­éœ€è¦æŒ‡æ˜å…¶è¿æ¥åˆ°å“ªä¸¤ä¸ªå˜é‡ã€‚å› å­å›¾ä¸­æ¯ä¸ªå˜é‡çš„é”®éƒ½åº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚ä¸ºäº†æ–¹ä¾¿åœ¨å¤šç§å˜é‡ç±»å‹çš„æƒ…å†µä¸‹æŒ‡æ˜é”®ï¼ŒGTSAMæä¾›<code>Symbols</code>æ¥è®©ç”¨æˆ·æ–¹ä¾¿ç”Ÿæˆä¸åŒå˜é‡ç±»å‹çš„é”®å€¼ã€‚ï¼ˆé”®ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œä½†å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼‰</p>
<h3 id="gtsamä¾‹å­æœ€å°ä¾‹å­">GTSAMä¾‹å­â€”â€”æœ€å°ä¾‹å­</h3>
<p>æœ¬å°èŠ‚å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-Hands-on Introduction</a>â€”ç¬¬2ç«  ä»¥æ„å»ºå¹¶æ±‚è§£ä¸‹é¢å› å­å›¾ä¸ºä¾‹ <img src="./imgs/gtsam-minExample.png" alt="GTSAMæœ€å°ä¾‹å­" /> å›¾ä¸­<span class="math inline">\(x_1,x_2,x_3\)</span>ä¸ºæœºå™¨äººä¸‰ä¸ªæ—¶åˆ»çš„ä½å§¿ï¼›<span class="math inline">\(f_0\)</span>ä¸ºç¬¬ä¸€ä¸ªæ—¶åˆ»æœºå™¨äººä½å§¿çš„è§‚æµ‹ï¼›<span class="math inline">\(f_1,f_2\)</span>ä¸ºæ—¶åˆ»1-2å’Œæ—¶åˆ»2-3ä¹‹é—´çš„é‡Œç¨‹è®¡ä¼°è®¡ã€‚<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/examples/OdometryExample.cpp">ä»£ç </a> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„å»ºä¸€ä¸ªç©ºçš„éçº¿æ€§å› å­å›¾</span></span><br><span class="line">NonlinearFactorGraph graph;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºå…ˆéªŒå› å­ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„f_0</span></span><br><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨äºŒç»´å§¿æ€ï¼ˆx,y,thetaï¼‰ç®€åŒ–é—®é¢˜</span></span><br><span class="line"><span class="function">Pose2 <span class="title">priorMean</span><span class="params">(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line"><span class="comment">// é«˜æ–¯å™ªå£°ï¼Œä»£è¡¨æˆ‘ä»¬å¯¹è¯¥å› å­çš„ä¸ç¡®å®šæ€§</span></span><br><span class="line"><span class="keyword">auto</span> priorNoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(<span class="built_in">Vector3</span>(<span class="number">0.3</span>, <span class="number">0.3</span>, <span class="number">0.1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å…ˆéªŒå› å­åŠ å…¥å› å­å›¾</span></span><br><span class="line"><span class="comment">// å…¶ä¸­çš„1è¡¨ç¤ºè¯¥å› å­è¿æ¥åˆ°ç¬¬1ä¸ªå˜é‡</span></span><br><span class="line">graph.<span class="built_in">add</span>(<span class="built_in">PriorFactor</span>&lt;Pose2&gt;(<span class="number">1</span>, priorMean, priorNoise));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºé‡Œç¨‹è®¡å› å­ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„f_1,f_2</span></span><br><span class="line"><span class="comment">// å¾€å‰ç§»åŠ¨2ç±³ï¼Œyè½´ä¸ä¾¿ï¼Œthetaä¸å˜</span></span><br><span class="line"><span class="function">Pose2 <span class="title">odometry</span><span class="params">(<span class="number">2.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line"><span class="keyword">auto</span> odometryNoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(<span class="built_in">Vector3</span>(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†é‡Œç¨‹è®¡å› å­åŠ å…¥å› å­å›¾</span></span><br><span class="line"><span class="comment">// 1,2ä»£è¡¨è¯¥é‡Œç¨‹è®¡çº¦æŸæ˜¯ä»å˜é‡1åˆ°å˜é‡2</span></span><br><span class="line">graph.<span class="built_in">add</span>(<span class="built_in">BetweenFactor</span>&lt;Pose2&gt;(<span class="number">1</span>, <span class="number">2</span>, odometry, odometryNoise));</span><br><span class="line"><span class="comment">// æ·»åŠ ç›¸åŒçš„å› å­åˆ°å˜é‡2å’Œå˜é‡3ä¹‹é—´</span></span><br><span class="line">graph.<span class="built_in">add</span>(<span class="built_in">BetweenFactor</span>&lt;Pose2&gt;(<span class="number">2</span>, <span class="number">3</span>, odometry, odometryNoise));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å„ä¸ªå˜é‡çš„åˆå§‹å€¼</span></span><br><span class="line">Values initial;</span><br><span class="line">initial.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="built_in">Pose2</span>(<span class="number">0.5</span>, <span class="number">0.0</span>, <span class="number">0.2</span>));</span><br><span class="line">initial.<span class="built_in">insert</span>(<span class="number">2</span>, <span class="built_in">Pose2</span>(<span class="number">2.3</span>, <span class="number">0.1</span>, <span class="number">-0.2</span>));</span><br><span class="line">initial.<span class="built_in">insert</span>(<span class="number">3</span>, <span class="built_in">Pose2</span>(<span class="number">4.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ä¼˜åŒ–å™¨å¹¶ä½¿ç”¨è®¾å®šå¥½çš„åˆå§‹å€¼å¯¹å› å­å›¾ä¼˜åŒ–</span></span><br><span class="line">Values result = <span class="built_in">LevenberMarquardtOptimizer</span>(graph, initial).<span class="built_in">optimize</span>();</span><br></pre></td></tr></table></figure></p>
<h3 id="gtsamä¾‹å­imué¢„ç§¯åˆ†åŠimufactor">GTSAMä¾‹å­â€”â€”IMUé¢„ç§¯åˆ†åŠImuFactor</h3>
<p>åœ¨ç›®å‰çš„SLAMï¼Œæ— è®ºæ˜¯VIOè¿˜æ˜¯LIOï¼Œå‰ç«¯éƒ½éœ€è¦IMUåšç§¯åˆ†å¾—åˆ°ä¸€ä¸ªä½å§¿çš„åˆå§‹ä¼°è®¡ã€‚<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>ä¸­å®ç°äº†ä¸€ä¸ªIMUé¢„ç§¯åˆ†ç®—æ³•ï¼Œå¹¶å¯ä»¥å°†å…¶ç›´æ¥åŠ å…¥å› å­å›¾ä¸­åšä¼˜åŒ–ã€‚è¿™åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­ä¹Ÿè¢«ä½¿ç”¨åˆ°ã€‚ æœ¬ä¾‹å­å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/examples/ImuFactorsExample2.cpp">GTSAM-repo/examples/ImuFactorExample2.cpp</a>ï¼Œä¸ºäº†è¯´æ˜<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>ä¸­IMUé¢„ç§¯åˆ†å™¨åŠ<code>ImuFactor</code>çš„ç”¨æ³•ï¼Œå¯¹è¯¥ä¾‹å­è¿›è¡Œç®€åŒ–ã€‚æœ€åæ„å»ºå‡ºçš„å› å­å›¾å¦‚ä¸‹ï¼ˆä¸ºäº†å¯è§†åŒ–ï¼Œäººå·¥è°ƒæ•´äº†å¸ƒå±€ï¼‰ï¼š <img src="./imgs/ImuFactorGraph.png" alt="ImuFactorGraph" /> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç ï¼Œå®Œæ•´ä»£ç è§ä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IMU é¢„ç§¯åˆ†å™¨</span></span><br><span class="line"><span class="comment">// è®¾ç½®é¢„ç§¯åˆ†å™¨çš„å™ªå£°å‚æ•°ï¼Œè¿™äº›å™ªå£°å‚æ•°ä¸€èˆ¬æ¥è‡ªIMUçš„ç¦»çº¿æ ‡å®šç»“æœ</span></span><br><span class="line"><span class="keyword">auto</span> params = PreintegrationParams::<span class="built_in">MakeSharedU</span>(kGravity);</span><br><span class="line">params-&gt;<span class="built_in">setAccelerometerCovariance</span>(I_3x3 * <span class="number">0.1</span>);</span><br><span class="line">params-&gt;<span class="built_in">setGyroscopeCovariance</span>(I_3x3 * <span class="number">0.1</span>);</span><br><span class="line">params-&gt;<span class="built_in">setIntegrationCovariance</span>(I_3x3 * <span class="number">0.1</span>);</span><br><span class="line">params-&gt;<span class="built_in">setUse2ndOrderCoriolis</span>(<span class="literal">false</span>);</span><br><span class="line">params-&gt;<span class="built_in">setOmegaCoriolis</span>(<span class="built_in">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"><span class="comment">// è®¾ç½®IMUé¢„ç§¯åˆ†å™¨</span></span><br><span class="line"><span class="function">PreintegratedImuMeasurements <span class="title">accum</span><span class="params">(params)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ä¸€ä¸ªéçº¿æ€§å› å­å›¾</span></span><br><span class="line">NonlinearFactorGraph newgraph;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å› å­å›¾çš„åˆå§‹å€¼å’Œä¼˜åŒ–ç»“æœ</span></span><br><span class="line">Values initialEstimate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ä½å§¿çš„å…ˆéªŒå› å­</span></span><br><span class="line"><span class="comment">// å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡x0çš„ä¸€å…ƒå› å­</span></span><br><span class="line"><span class="comment">// å™ªå£°è®¾ç½®ä¸ºrollã€pitchã€yawæœ‰0.1radçš„æ ‡å‡†å·®ï¼Œxï¼Œyï¼Œzæœ‰30cmçš„æ ‡å‡†å·®</span></span><br><span class="line"><span class="keyword">auto</span> noise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(</span><br><span class="line">    (<span class="built_in">Vector</span>(<span class="number">6</span>) &lt;&lt; Vector3::<span class="built_in">Constant</span>(<span class="number">0.1</span>), Vector3::<span class="built_in">Constant</span>(<span class="number">0.3</span>)).<span class="built_in">finished</span>());</span><br><span class="line"><span class="comment">// å°†ä½å§¿çš„å…ˆéªŒå› å­åŠ å…¥å› å­å›¾ä¸­</span></span><br><span class="line">newgraph.<span class="built_in">addPrior</span>(<span class="built_in">X</span>(<span class="number">0</span>), pose_0, noise);</span><br><span class="line"><span class="comment">// å°†ä½å§¿0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">initialEstimate.<span class="built_in">insert</span>(<span class="built_in">X</span>(<span class="number">0</span>), pose_0);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®IMUåå·®çš„å…ˆéªŒå› å­</span></span><br><span class="line"><span class="comment">// å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡b0çš„ä¸€å…ƒå› å­</span></span><br><span class="line">Key biasKey = <span class="built_in">Symbol</span>(<span class="string">&#x27;b&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">auto</span> biasnoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(Vector6::<span class="built_in">Constant</span>(<span class="number">0.1</span>));</span><br><span class="line">newgraph.<span class="built_in">addPrior</span>(biasKey, imuBias::<span class="built_in">ConstantBias</span>(), biasnoise);</span><br><span class="line"><span class="comment">// å°†IMUåå·®b0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">initialEstimate.<span class="built_in">insert</span>(biasKey, imuBias::<span class="built_in">ConstantBias</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®é€Ÿåº¦çš„å…ˆéªŒå› å­</span></span><br><span class="line"><span class="comment">// å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡v0çš„ä¸€å…ƒå› å­</span></span><br><span class="line"><span class="comment">// è¿™é‡Œè®¾ç½®åˆå§‹é€Ÿåº¦ä¸º0ï¼šVector3(0,0,0)</span></span><br><span class="line"><span class="keyword">auto</span> velnoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(<span class="built_in">Vector3</span>(<span class="number">0.01</span>, <span class="number">0.01</span>, <span class="number">0.01</span>));</span><br><span class="line">newgraph.<span class="built_in">addPrior</span>(<span class="built_in">V</span>(<span class="number">0</span>), <span class="built_in">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>), velnoise);</span><br><span class="line"><span class="comment">// å°†é€Ÿåº¦v0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">initialEstimate.<span class="built_in">insert</span>(<span class="built_in">V</span>(<span class="number">0</span>), <span class="built_in">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äºæœºå™¨äººçš„æ‰€æœ‰ä½å§¿æ—¶åˆ»ï¼ˆå…³é”®å¸§ï¼‰</span></span><br><span class="line"><span class="keyword">for</span> (i in N_steps)</span><br><span class="line">&#123;</span><br><span class="line">  biasKey++;</span><br><span class="line">  Symbol b1 = biasKey - <span class="number">1</span>;</span><br><span class="line">  Symbol b2 = biasKey;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®iæ—¶åˆ»çš„ä½å§¿åˆå§‹å€¼</span></span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(<span class="built_in">X</span>(i), pose_i);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹äºä¸¤ä¸ªæ—¶åˆ»ä¹‹é—´çš„æ‰€æœ‰IMUæ•°æ®è¿›è¡Œç§¯åˆ†</span></span><br><span class="line">  <span class="keyword">for</span> (j in N_imu_queue)</span><br><span class="line">  &#123;</span><br><span class="line">    accum.<span class="built_in">integrateMeasurement</span>(measuredAcc, measuredOmega, <span class="type">delta_t</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨é¢„ç§¯åˆ†å™¨æ„å»ºIMUå› å­ï¼Œå¹¶åŠ å…¥å› å­å›¾ä¸­</span></span><br><span class="line">  <span class="comment">// IMUå› å­éœ€è¦æŒ‡å®šæœ¬æ¬¡ç§¯åˆ†çš„è¿‡ç¨‹è¿æ¥äº†å“ªä¸¤ä¸ªä½å§¿Xï¼Œé€Ÿåº¦Vä»¥åŠå½“å‰çš„åå·®ä¼°è®¡ï¼Œå› æ­¤ä¹Ÿå«`5-way factor`</span></span><br><span class="line">  <span class="function">ImuFactor <span class="title">imufac</span><span class="params">(X(i - <span class="number">1</span>), V(i - <span class="number">1</span>), X(i), V(i), biasKey, accum)</span></span>;</span><br><span class="line">  newgraph.<span class="built_in">add</span>(imufac);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ ä¸¤ä¸ªæ—¶åˆ»ä¹‹é—´IMUåå·®å› å­</span></span><br><span class="line">  <span class="keyword">auto</span> f = std::make_shared&lt;BetweenFactor&lt;imuBias::ConstantBias&gt; &gt;(</span><br><span class="line">            b1, b2, imuBias::<span class="built_in">ConstantBias</span>(), cov);</span><br><span class="line">  newgraph.<span class="built_in">add</span>(f);</span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(biasKey, imuBias::<span class="built_in">ConstantBias</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†é€Ÿåº¦çš„åˆå§‹å€¼åŠ å…¥åˆå§‹å€¼é›†åˆï¼Œæ³¨æ„ï¼Œè¿™é‡ŒåŠ å…¥çš„æ˜¯GroundTruthçš„é€Ÿåº¦ï¼Œåªæ˜¯ä¸ºäº†åšç¤ºä¾‹</span></span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(<span class="built_in">V</span>(i), linear_velocity_vector);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡å€¼IMUé¢„ç§¯åˆ†å™¨</span></span><br><span class="line">  accum.<span class="built_in">resetIntegration</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨LMä¼˜åŒ–å™¨å¯¹å› å­å›¾è¿›è¡Œä¼˜åŒ–å¹¶è·å–ä¼˜åŒ–ç»“æœ</span></span><br><span class="line">result = <span class="built_in">LevenbergMarquardtOptimizer</span>(newgraph, initialEstimate).<span class="built_in">optimize</span>();</span><br></pre></td></tr></table></figure></p>
<details class="note info no-icon"><summary><p>IMUé¢„ç§¯åˆ†åŠIMUå› å­å®Œæ•´ä»£ç </p>
</summary>
<figure class="highlight plaintext">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre>
</td>
<td class="code">
<pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @file ImuFactorExample2</span><br><span class="line"> * @brief Test example for using GTSAM ImuFactor and ImuCombinedFactor with ISAM2. Simplify and add graphviz by Zeal</span><br><span class="line"> * @author Robert Truax</span><br><span class="line"> * @author Zeal</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;gtsam/geometry/PinholeCamera.h&gt;</span><br><span class="line">#include &lt;gtsam/geometry/Cal3_S2.h&gt;</span><br><span class="line">#include &lt;gtsam/inference/Symbol.h&gt;</span><br><span class="line">#include &lt;gtsam/navigation/ImuBias.h&gt;</span><br><span class="line">#include &lt;gtsam/navigation/ImuFactor.h&gt;</span><br><span class="line">#include &lt;gtsam/navigation/Scenario.h&gt;</span><br><span class="line">#include &lt;gtsam/nonlinear/ISAM2.h&gt;</span><br><span class="line">#include &lt;gtsam/nonlinear/LevenbergMarquardtOptimizer.h&gt;</span><br><span class="line">#include &lt;gtsam/slam/BetweenFactor.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">using namespace gtsam;</span><br><span class="line"></span><br><span class="line">// Shorthand for velocity and pose variables</span><br><span class="line">using symbol_shorthand::V;</span><br><span class="line">using symbol_shorthand::X;</span><br><span class="line"></span><br><span class="line">const double kGravity = 9.81;</span><br><span class="line"></span><br><span class="line">/* ************************************************************************* */</span><br><span class="line">int main(int argc, char* argv[]) &#123;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  // èµ·ç‚¹</span><br><span class="line">  Pose3 pose_0(Rot3::Rodrigues(0, 0, 0), Point3(0,0,0));</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä¸€ä¸ªå§¿æ€ä»¿çœŸå™¨ï¼Œå§¿æ€æ²¿ç€yè½´ä»¥5m/sçš„é€Ÿåº¦å‰è¿›ï¼Œæ²¡æœ‰è§’åº¦å˜åŒ–</span><br><span class="line">  Vector3 angular_velocity_vector(0, 0, 0);</span><br><span class="line">  Vector3 linear_velocity_vector(0, 5, 0);</span><br><span class="line">  auto scenario = ConstantTwistScenario(angular_velocity_vector,</span><br><span class="line">                                        linear_velocity_vector, pose_0);</span><br><span class="line">  // è®¾ç½®ä»¿çœŸæ­¥é•¿ä¸º1s</span><br><span class="line">  double delta_t = 1.0;</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä¸€ä¸ªéçº¿æ€§å› å­å›¾</span><br><span class="line">  NonlinearFactorGraph newgraph;</span><br><span class="line"></span><br><span class="line">  // å£°æ˜å› å­å›¾çš„åˆå§‹å€¼å’Œä¼˜åŒ–ç»“æœ</span><br><span class="line">  Values initialEstimate, result;</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä½å§¿çš„å…ˆéªŒå› å­</span><br><span class="line">  // å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡x0çš„ä¸€å…ƒå› å­</span><br><span class="line">  // å™ªå£°è®¾ç½®ä¸ºrollã€pitchã€yawæœ‰0.1radçš„æ ‡å‡†å·®ï¼Œxï¼Œyï¼Œzæœ‰30cmçš„æ ‡å‡†å·®</span><br><span class="line">  auto noise = noiseModel::Diagonal::Sigmas(</span><br><span class="line">      (Vector(6) &lt;&lt; Vector3::Constant(0.1), Vector3::Constant(0.3)).finished());</span><br><span class="line">  // å°†ä½å§¿çš„å…ˆéªŒå› å­åŠ å…¥å› å­å›¾ä¸­</span><br><span class="line">  newgraph.addPrior(X(0), pose_0, noise);</span><br><span class="line">  // å°†ä½å§¿0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span><br><span class="line">  initialEstimate.insert(X(0), pose_0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // è®¾ç½®IMUåå·®çš„å…ˆéªŒå› å­</span><br><span class="line">  // å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡b0çš„ä¸€å…ƒå› å­</span><br><span class="line">  Key biasKey = Symbol(&#x27;b&#x27;, 0);</span><br><span class="line">  auto biasnoise = noiseModel::Diagonal::Sigmas(Vector6::Constant(0.1));</span><br><span class="line">  newgraph.addPrior(biasKey, imuBias::ConstantBias(), biasnoise);</span><br><span class="line">  // å°†IMUåå·®b0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span><br><span class="line">  initialEstimate.insert(biasKey, imuBias::ConstantBias());</span><br><span class="line">  </span><br><span class="line">  // è®¾ç½®é€Ÿåº¦çš„å…ˆéªŒå› å­</span><br><span class="line">  // å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡v0çš„ä¸€å…ƒå› å­</span><br><span class="line">  // è¿™é‡Œè®¾ç½®åˆå§‹é€Ÿåº¦ä¸º0ï¼šVector3(0,0,0)</span><br><span class="line">  auto velnoise = noiseModel::Diagonal::Sigmas(Vector3(0.01, 0.01, 0.01));</span><br><span class="line">  newgraph.addPrior(V(0), Vector3(0,0,0), velnoise);</span><br><span class="line">  // å°†é€Ÿåº¦v0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span><br><span class="line">  initialEstimate.insert(V(0), Vector3(0,0,0));</span><br><span class="line"></span><br><span class="line">  // IMU é¢„ç§¯åˆ†å™¨</span><br><span class="line">  // è®¾ç½®é¢„ç§¯åˆ†å™¨çš„å™ªå£°å‚æ•°ï¼Œè¿™äº›å™ªå£°å‚æ•°ä¸€èˆ¬æ¥è‡ªIMUçš„ç¦»çº¿æ ‡å®šç»“æœ</span><br><span class="line">  auto params = PreintegrationParams::MakeSharedU(kGravity);</span><br><span class="line">  params-&gt;setAccelerometerCovariance(I_3x3 * 0.1);</span><br><span class="line">  params-&gt;setGyroscopeCovariance(I_3x3 * 0.1);</span><br><span class="line">  params-&gt;setIntegrationCovariance(I_3x3 * 0.1);</span><br><span class="line">  params-&gt;setUse2ndOrderCoriolis(false);</span><br><span class="line">  params-&gt;setOmegaCoriolis(Vector3(0, 0, 0));</span><br><span class="line">  // è®¾ç½®IMUé¢„ç§¯åˆ†å™¨</span><br><span class="line">  PreintegratedImuMeasurements accum(params);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // æ¨¡ä»¿æœºå™¨äººåœ¨è¿åŠ¨ï¼Œè¿™é‡Œä¸€å…±æœ‰3ä¸ªä½å§¿èŠ‚ç‚¹0,1,2</span><br><span class="line">  // åœ¨è¿åŠ¨è¿‡ç¨‹ä¸­æ¨¡æ‹ŸIMUé¢„ç§¯åˆ†ï¼Œå¹¶å°†IMUå› å­ã€IMUåå·®å› å­åŠ å…¥å› å­å›¾ä¸­</span><br><span class="line">  for (size_t i = 0; i &lt; 3; ++i) &#123;</span><br><span class="line">    double t = i * delta_t;</span><br><span class="line">    if (i &gt; 0) &#123;  // è®¾ç½®ä½å§¿çš„åˆå§‹å€¼ï¼Œè¿™é‡Œæ˜¯é”™è¯¯ç¤ºèŒƒï¼Œä½¿ç”¨çœŸå€¼ä½œä¸ºåˆå§‹å€¼è®¾ç½®</span><br><span class="line">      auto pose_i = scenario.pose(t);</span><br><span class="line">      initialEstimate.insert(X(i), pose_i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ IMUå› å­å’ŒIMUåå·®å› å­</span><br><span class="line">    if (i &gt; 0) &#123;</span><br><span class="line">      // å‘¨æœŸæ€§æ·»åŠ IMUçš„åå·®å› å­ï¼›IMUçš„åå·®éœ€è¦ç”¨å…¶ä»–æ–¹å¼è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¦»çº¿æ ‡å®šçš„å‚æ•°ï¼ˆä¸€èˆ¬ä¸ä¼šï¼‰</span><br><span class="line">      if (i % 2 == 0) &#123;</span><br><span class="line">        // b1æ˜¯ä¸Šä¸€æ¬¡çš„IMUåå·®å˜é‡çš„é”®å€¼ï¼›b2æ˜¯æœ¬æ¬¡IMUåå·®çš„é”®å€¼</span><br><span class="line">        biasKey++;</span><br><span class="line">        Symbol b1 = biasKey - 1;</span><br><span class="line">        Symbol b2 = biasKey;</span><br><span class="line">        // æ·»åŠ ä¸¤ä¸ªIMUåå·®å˜é‡ä¹‹é—´çš„äºŒå…ƒå› å­</span><br><span class="line">        Vector6 covvec;</span><br><span class="line">        covvec &lt;&lt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1;</span><br><span class="line">        auto cov = noiseModel::Diagonal::Variances(covvec);</span><br><span class="line">        auto f = std::make_shared&lt;BetweenFactor&lt;imuBias::ConstantBias&gt; &gt;(</span><br><span class="line">            b1, b2, imuBias::ConstantBias(), cov);</span><br><span class="line">        newgraph.add(f);</span><br><span class="line">        // å°†å½“å‰çš„IMUåå·®å˜é‡çš„åˆå§‹ä¼°è®¡åŠ å…¥åˆå§‹å€¼é›†åˆ</span><br><span class="line">        initialEstimate.insert(biasKey, imuBias::ConstantBias());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // è¿™éƒ¨åˆ†æ‰æ˜¯é¢„ç§¯åˆ†å™¨è¿›è¡Œç§¯åˆ†çš„åœ°æ–¹</span><br><span class="line">      // æ¯æ¬¡ç§¯åˆ†æ¥æ”¶åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ä»¥åŠé—´éš”æ—¶é—´delta_t</span><br><span class="line">      Vector3 measuredAcc = scenario.acceleration_b(t);</span><br><span class="line">      Vector3 measuredOmega = scenario.omega_b(t);</span><br><span class="line">      accum.integrateMeasurement(measuredAcc, measuredOmega, delta_t);</span><br><span class="line"></span><br><span class="line">      // ä½¿ç”¨é¢„ç§¯åˆ†å™¨æ„å»ºIMUå› å­ï¼Œå¹¶åŠ å…¥å› å­å›¾ä¸­</span><br><span class="line">      // IMUå› å­éœ€è¦æŒ‡å®šæœ¬æ¬¡ç§¯åˆ†çš„è¿‡ç¨‹è¿æ¥äº†å“ªä¸¤ä¸ªä½å§¿Xï¼Œé€Ÿåº¦Vä»¥åŠå½“å‰çš„åå·®ä¼°è®¡ï¼Œå› æ­¤ä¹Ÿå«`5-way factor`</span><br><span class="line">      ImuFactor imufac(X(i - 1), V(i - 1), X(i), V(i), biasKey, accum);</span><br><span class="line">      newgraph.add(imufac);</span><br><span class="line"></span><br><span class="line">      // å°†é€Ÿåº¦çš„åˆå§‹å€¼åŠ å…¥åˆå§‹å€¼é›†åˆï¼Œæ³¨æ„ï¼Œè¿™é‡ŒåŠ å…¥çš„æ˜¯GroundTruthçš„é€Ÿåº¦ï¼Œåªæ˜¯ä¸ºäº†åšç¤ºä¾‹</span><br><span class="line">      initialEstimate.insert(V(i), linear_velocity_vector);</span><br><span class="line">      // é‡å€¼IMUé¢„ç§¯åˆ†å™¨</span><br><span class="line">      accum.resetIntegration();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // ä½¿ç”¨åˆå§‹å€¼ä¿å­˜å› å­å›¾</span><br><span class="line">  newgraph.saveGraph(&quot;ImuFactorsExample2_graphviz.dot&quot;, initialEstimate);</span><br><span class="line">  // æ‰“å°åˆ°å‘½ä»¤è¡Œ</span><br><span class="line">  newgraph.dot(cout, result);</span><br><span class="line"></span><br><span class="line">  // è°ƒç”¨LMä¼˜åŒ–å™¨å¯¹å› å­å›¾è¿›è¡Œä¼˜åŒ–å¹¶è·å–ä¼˜åŒ–ç»“æœ</span><br><span class="line">  result = LevenbergMarquardtOptimizer(newgraph, initialEstimate).optimize();</span><br><span class="line"></span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">/* ************************************************************************* */</span><br><span class="line"></span><br></pre>
</td>
</tr>
</table>
</figure>

</details>
<h3 id="gtsamä¾‹å­é€’å¢å¼ä¼˜åŒ–">GTSAMä¾‹å­â€”â€”é€’å¢å¼ä¼˜åŒ–</h3>
<p><a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>ä¸ä»…å†…ç½®äº†<code>Gaussian-Newton</code>å’Œ<code>Leverberg-Marquat</code>ä¸¤ä¸ªå¸¸è§çš„éçº¿æ€§ä¼˜åŒ–å™¨ï¼Œè¿˜æ˜¯å®ç°äº†<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess08tro.pdf">iSAM</a>å’Œ<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess12ijrr.pdf">iSAM2</a>ä¸¤ä¸ªé€’å¢å¼çš„ä¼˜åŒ–å™¨ã€‚ é€’å¢å¼ä¼˜åŒ–å™¨æ›´ç¬¦åˆSLAMä¸­å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŒç»­åŠ å…¥æ–°çš„ä½å§¿å’Œçº¦æŸï¼Œå¹¶æŒç»­è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-Hands-on Introduction</a>â€”â€”ç¬¬7ç« </p>
<p><a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/examples/VisualISAM2Example.cpp">example/VisualISAM2Example.cpp</a> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®iSAM2ä¼˜åŒ–å™¨</span></span><br><span class="line"><span class="function">ISAM2 <span class="title">isam</span><span class="params">(parameters)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å› å­å›¾å’Œåˆå§‹å€¼</span></span><br><span class="line">NonlinearFactorGraph graph;</span><br><span class="line">Values initialEstimate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">1</span>; i &lt; poses.<span class="built_in">size</span>(); ++i)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; relations.<span class="built_in">size</span>(); ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ å› å­</span></span><br><span class="line">    graph.<span class="built_in">add</span>(<span class="built_in">BetweenFactor</span>&lt;Pose3&gt;(i, j))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ åˆå§‹å€¼åˆ°åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(<span class="built_in">Symbol</span>(<span class="string">&#x27;x&#x27;</span>,i), initial_x[i]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å› å­å›¾åŠ å…¥ä¼˜åŒ–å™¨</span></span><br><span class="line">  isam.<span class="built_in">update</span>(graph, initialEstimate);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºå½“å‰å› å­å›¾å’Œåˆå§‹å€¼</span></span><br><span class="line">  <span class="comment">// å› å­å›¾å·²ç»åŠ å…¥ä¼˜åŒ–å™¨ï¼Œå› æ­¤éœ€è¦æ¸…ç©ºä¸ºä¸‹ä¸€æ¬¡å› å­å›¾åšå‡†å¤‡</span></span><br><span class="line">  graph.<span class="built_in">resize</span>(<span class="number">0</span>);</span><br><span class="line">  initialEstimate.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="gtsamå­¦ä¹ è·¯å¾„">GTSAMå­¦ä¹ è·¯å¾„</h2>
<p><a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>å¯¹æ•´ä¸ªSLAMåç«¯é—®é¢˜éƒ½å°è£…å¾—å¾ˆå¥½ï¼Œå› æ­¤å¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸äº†è§£ä¼˜åŒ–ç»†èŠ‚çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„ä¼˜åŒ–ç®—æ³•ã€‚é™¤äº†å¯¹åç«¯ä¼˜åŒ–å’Œå›¾ä¼˜åŒ–è¿™äº›çŸ¥è¯†æŒæ¡å¤–ï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/" title="gtsam.org">GTSAM</a>çš„å­¦ä¹ ä¸»è¦è¿˜æ˜¯è¦<code>å­¦ä»¥è‡´ç”¨</code>ï¼Œ è¿™é‡Œåªæ˜¯ç®€å•åˆ—å‡ºç¬”è€…è§‰å¾—æ¯”è¾ƒåˆé€‚çš„èµ„æ–™é˜…è¯»å’Œå­¦ä¹ é¡ºåºã€‚</p>
<ol type="1">
<li>æœ¬æ–‡</li>
<li>GTSAMä»“åº“ä¸‹<code>doc</code>æ–‡ä»¶å¤¹ä¸­çš„<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">gtsam.pdf</a></li>
<li>GTSAMä»“åº“ä¸‹<code>examples</code>æ–‡ä»¶å¤¹ä¸­çš„ä¸€äº›ä¾‹å­ï¼Œä¸»è¦æ˜¯å¯¹ç…§ä¸Šé¢çš„æ–‡æ¡£ä»¥åŠæœ¬æ–‡å‡ºç°çš„ä¾‹å­è¿›è¡Œé˜…è¯»è¿è¡Œ</li>
<li>æœ¬é¡¹ç›®åšå®¢ä¸­å…³äº<code>ImuPreintegration</code>å’Œ<code>MapOptimization</code>çš„è®²è§£</li>
<li>æœ¬é¡¹ç›®ä»£ç <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM" title="Simple LIO-SAM">spl</a>ä¸­<code>src/mapOptimization.cpp</code>å’Œ<code>src/imuPreintegration.cpp</code>ä»£ç </li>
</ol>
<h2 id="èµ„æ–™å‚è€ƒ">èµ„æ–™å‚è€ƒ</h2>
<ol type="1">
<li>å¯¹ç›®å‰å„ä¸ªå›¾ä¼˜åŒ–æ¡†æ¶ï¼ˆg2o,GTSAM,ceres,SE-Syncï¼‰ç­‰åšç»Ÿä¸€åˆ†æçš„ç»¼è¿°æ€§è®ºæ–‡ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://lamor.fer.hr/images/50036607/2021-ajuric-comparison-mipro.pdf">A Comparison of Graph OptimizationApproaches for Pose Estimation in SLAM</a></p>
<ol start="2" type="1">
<li>Introduction to Bundle Adjustment, ppt</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://vincentqin.gitee.io/blogresource-3/slam-summer-courses-CADCG-Lab/BA-haominLiu.pdf">Bundle Adjustment</a></p>
<ol start="3" type="1">
<li>å¯¹åŸºäºå›¾çš„SLAMåç«¯ä¼˜åŒ–ç®—æ³•çš„è®²è§£ï¼Œå¯¹SLAMçš„åç«¯é—®é¢˜åšæ¯”è¾ƒæ­£å¼çš„æè¿°ï¼Œæ¥è¿‘2000å¼•ç”¨</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://www2.informatik.uni-freiburg.de/~stachnis/pdf/grisetti10titsmag.pdf">A Tutorial on Graph-Based SLAM</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/22/lio_sam/featureExtraction-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ç‰¹å¾æå–æ¨¡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-22 20:03:12 / ä¿®æ”¹æ—¶é—´ï¼š21:32:33" itemprop="dateCreated datePublished" datetime="2023-03-22T20:03:12+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ç‰¹å¾æå–æ¨¡å—" href="/2023/03/22/lio_sam/featureExtraction-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::e84bd67344741c4da21c259e3e444c5d" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="æ€»è¿°">æ€»è¿°</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>æ²¿ç”¨<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>ã€<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>çš„åšæ³•ï¼Œä»åŸå§‹ç‚¹äº‘ä¸­æå–å‡ºè¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹ã€‚è¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹è¢«ä¸‹æ¸¸æ¨¡å—ç”¨æ¥åšç‚¹äº‘åŒ¹é…å’Œæ„å»ºåœ°å›¾ã€‚ ç‰¹å¾æå–æ¨¡å—æ˜¯æ¯”è¾ƒç®€å•çš„æ¨¡å—ï¼Œåªç›‘å¬æ¥è‡ª<code>imageProjection</code>å‘å¸ƒå‡ºæ¥çš„å»ç•¸å˜åç‚¹äº‘ï¼ŒåŒæ—¶å°†æå–ç‰¹å¾åçš„ç‚¹äº‘å‘å¸ƒå‡ºå»ã€‚è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ol type="1">
<li>ç‰¹å¾ç‚¹çš„æå–æ ¹æ®ç‚¹çš„å¹³æ»‘åº¦ï¼Œè€Œå¹³æ»‘åº¦åˆ™é€šè¿‡æ¯ä¸ªç‚¹ä¸å‘¨å›´ç‚¹è·ç¦»çš„å¹³å‡å€¼åšè¿‘ä¼¼</li>
<li>å®é™…ä¸Šåœ¨æå–å®Œè¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹ä¹‹åï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>åœ¨ä»£ç é‡ŒåˆæŠŠæ‰€æœ‰éè¾¹ç¼˜ç‚¹çš„ç‚¹éƒ½åŠ å…¥äº†å¹³é¢ç‚¹é›†åˆã€‚è¿™æ˜¯æ¯”è¾ƒå¥‡æ€ªçš„åœ°æ–¹ã€‚ä»è¿™é‡Œçœ‹å‡ºä¹Ÿè®¸ç‰¹å¾æå–ä¹Ÿä¸æ˜¯å¿…è¦çš„ï¼Œ å› ä¸ºå¹³é¢ç‚¹å·²ç»åŒ…å«äº†å¤§éƒ¨åˆ†çš„ç‚¹äº‘ã€‚äº‹å®ä¸Šï¼Œåœ¨Githubçš„ä¸€ä¸ªä»“åº“<a target="_blank" rel="noopener" href="https://github.com/YJZLuckyBoy/liorf" title="Based LIO-SAM, remove featureExtraction">liorf</a>ä¸­ï¼Œå°±å°†ç‰¹å¾æå–æ¨¡å—å»æ‰ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†è¯¥æ®µä¸­é™¤äº†è§’ç‚¹ä¹‹å¤–çš„ç‚¹åŠ å…¥å¹³é¢ç‚¹é›†åˆ</span></span><br><span class="line"><span class="comment">// ï¼ï¼ï¼ è¿™ç‚¹è®©æ­¥éª¤2æ„Ÿè§‰æ˜¯å¤šä½™çš„ï¼Œæœ€ç»ˆçš„ç»“æœå¯èƒ½åªæ˜¯åŸå§‹ç‚¹äº‘é™é‡‡æ ·ï¼Œå¯èƒ½ç‰¹å¾ç‚¹æå–ä¹Ÿæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼ï¼ï¼</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = sp; k &lt;= ep; k++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (cloudLabel[k] &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        surfaceCloudScan-&gt;<span class="built_in">push_back</span>(extractedCloud-&gt;points[k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <code>cloudLabel</code>æ ‡è¯†è¯¥ç‚¹çš„æ€§è´¨ï¼Œ-1ä¸ºå¹³é¢ç‚¹ï¼Œ0ä¸ºéç‰¹å¾ç‚¹ï¼Œ1ä¸ºè¾¹ç¼˜ç‚¹ã€‚</li>
</ol>
<h2 id="ç‰¹å¾ç‚¹æå–åŸç†">ç‰¹å¾ç‚¹æå–åŸç†</h2>
<p>å…³äºç‰¹å¾ç‚¹æå–éƒ¨åˆ†<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>çš„è®ºæ–‡åŸºæœ¬ç•¥è¿‡ï¼Œå› ä¸ºè·Ÿ<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>çš„åšæ³•åŸºæœ¬ç›¸åŒï¼Œè¿™é‡Œå»ºè®®è¿™éƒ¨åˆ†å¯ä»¥é˜…è¯»<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>è®ºæ–‡ã€‚</p>
<h3 id="è½¬æ¢åˆ°rangemat">è½¬æ¢åˆ°RangeMat</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>æ²¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>çš„åšæ³•ï¼Œå…ˆæŠŠä¸‰ç»´ç‚¹å…¨éƒ¨æŠ•å½±åˆ°äºŒç»´å›¾ç‰‡ï¼Œå›¾åƒåƒç´ ä¿å­˜æ¯ä¸ªç‚¹è·ç¦»åŸç‚¹çš„è·ç¦»ï¼Œç§°åš<code>RangeMat</code>ï¼Œ<code>RangeMat</code>æ˜¯è§„åˆ™çš„ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€æ¡æ¿€å…‰çº¿æŸæ‰«å°„360åº¦æ‰€äº§ç”Ÿçš„ç‚¹ï¼Œå› æ­¤åé¢ç”¨è¿™ä¸ª<code>RangeMat</code>åšç‰¹å¾æå–æ›´å¿«é€Ÿæ›´ç®€å•ã€‚ PSï¼šè¿™éƒ¨åˆ†æ˜¯åœ¨<code>ImageProjection</code>å°±å·²ç»å¤„ç†å¥½ï¼Œå¹¶ä¸”<code>RangeMat</code>ä¹Ÿè¢«å±•å¼€æˆä¸€ç»´å‘é‡å­˜å‚¨ã€‚</p>
<h3 id="å¹³æ»‘åº¦ä¼°è®¡">å¹³æ»‘åº¦ä¼°è®¡</h3>
<p>ç‰¹å¾ç‚¹æå–é€šè¿‡æ¯ä¸ªç‚¹çš„å¹³æ»‘åº¦æ¥æå–ï¼Œå¹³æ»‘åº¦é«˜äºæŸä¸ªé˜ˆå€¼çš„è®¤ä¸ºæ˜¯è¾¹ç¼˜ç‚¹ï¼›å¹³æ»‘åº¦å°äºæŸä¸ªé˜ˆå€¼çš„è®¤ä¸ºæ˜¯å¹³é¢ç‚¹ã€‚ è€Œå¹³æ»‘åº¦çš„ä¼°è®¡åˆ™é€šè¿‡æ¯ä¸€ä¸ªç‚¹åœ¨è¯¥æ¿€å…‰çº¿æˆåƒçš„å‰åå‡ ä¸ªç‚¹çš„å¹³å‡è·ç¦»ä»£æ›¿ã€‚ æˆ‘ä»¬å¦æ—¶é—´<span class="math inline">\(t\)</span>çš„ç‚¹äº‘ä¸º<span class="math inline">\(P_t = \{p_i, i \in |P_t|\}\)</span>ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥æ ¹æ®æ¯ä¸ªç‚¹çš„åæ ‡ç®—å‡ºæ¯ä¸ªç‚¹è·ç¦»åŸç‚¹çš„è·ç¦»<span class="math inline">\(r_i\)</span>ï¼Œå¯¹äºæ¯ä¸ªç‚¹ï¼Œæˆ‘ä»¬å–å…¶åŒä¸€æ¡æ¿€å…‰çº¿ä¸Šå‰å5ä¸ªç‚¹æ„æˆé›†åˆ<span class="math inline">\(S\)</span>ï¼Œåˆ™ï¼Œç‚¹<span class="math inline">\(p_i\)</span>çš„å¹³æ»‘åº¦å¯ä»¥è¿™æ ·è®¡ç®—ï¼š <span class="math display">\[
c = \frac{1}{|S|\cdot||r_i||}\left|\left|\sum_{j\in S,j\neq i}(r_j-r_i)\right|\right|
\]</span></p>
<h3 id="åˆ†æ®µæå–åŠç‰¹å¾ç‚¹æ•°é‡æ•°é‡é™åˆ¶">åˆ†æ®µæå–åŠç‰¹å¾ç‚¹æ•°é‡æ•°é‡é™åˆ¶</h3>
<p>ä¸ºäº†è®©ç‰¹å¾ç‚¹åˆ†å¸ƒæ›´å‡åŒ€ï¼Œé‡‡ç”¨ç±»ä¼¼<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>ï¼Œå°†æ•´ä¸ª360çš„å›¾åƒåœ¨æ°´å¹³æ–¹å‘åˆ†æˆ6ä¸ªå­å›¾åƒï¼Œåœ¨æ¯ä¸ªå­å›¾åƒä¸­è¿›è¡Œç‰¹å¾ç‚¹æå–ã€‚å¹¶ä¸”ï¼Œå¯¹äºæ¯ä¸€ä¸ªå­å›¾åƒä¸­çš„æ¯ä¸€æ¡æ¿€å…‰çº¿æŸï¼Œä¼šé™åˆ¶è¾¹ç¼˜ç‚¹æ•°é‡ä¸è¶…è¿‡20ä¸ªï¼Œå¹³é¢ç‚¹çš„æ•°é‡åˆ™æ²¡æœ‰é™åˆ¶ã€‚</p>
<h3 id="ç‰¹æ®Šæƒ…å†µ">ç‰¹æ®Šæƒ…å†µ</h3>
<p>æœ‰3ç§ç‰¹æ®Šæƒ…å†µä¸èƒ½å°†è¯¥ç‚¹è®¾ç½®ä¸ºè¾¹ç¼˜ç‚¹ã€‚ 1. å½“ä¸€ä¸ªç‚¹è¢«é€‰æ‹©ä¸ºç‰¹å¾ç‚¹ï¼Œåˆ™æŠŠè¯¥ç‚¹å·¦å³5ä¸ªç‚¹éƒ½æ’é™¤åœ¨ç‰¹å¾ç‚¹é€‰å–èŒƒå›´ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹è¯¥è§’ç‚¹å·¦å³å„5ä¸ªç‚¹ï¼Œå¦‚æœä¸¤ç‚¹ä¹‹é—´çš„åˆ—ç´¢å¼•å·®è·å°äº10ï¼Œåˆ™æŠ›å¼ƒå‘¨å›´çš„ç‚¹ï¼Œé¿å…é‡å¤å¯¹åŒä¸€å—åŒºåŸŸæå–è§’ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= <span class="number">5</span>; l++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> columnDiff = std::<span class="built_in">abs</span>(<span class="built_in">int</span>(cloudInfo.point_col_ind[ind + l] - cloudInfo.point_col_ind[ind + l - <span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">if</span> (columnDiff &gt; <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    cloudNeighborPicked[ind + l] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">-1</span>; l &gt;= <span class="number">-5</span>; l--)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> columnDiff = std::<span class="built_in">abs</span>(<span class="built_in">int</span>(cloudInfo.point_col_ind[ind + l] - cloudInfo.point_col_ind[ind + l + <span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">if</span> (columnDiff &gt; <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    cloudNeighborPicked[ind + l] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="2" type="1">
<li>å½“è¯¥ç‚¹å¯èƒ½æ˜¯ç”±äºé®æŒ¡å¯¼è‡´è¢«é€‰æ‹©ä¸ºè¾¹ç¼˜ç‚¹</li>
</ol>
<figure>
<img src="./imgs/illegal_feature_point.png" alt="" /><figcaption>ä¸åˆæ ¼çš„ç‰¹å¾ç‚¹(from LOAM)</figcaption>
</figure>
<p>å¦‚ä¸Šå›¾ï¼ˆbï¼‰æ‰€ç¤ºï¼Œç‚¹Aæ˜¯ç”±äºè¢«å¹³é¢é®æŒ¡è€Œäº§ç”Ÿçš„è¾¹ç¼˜ç‚¹ï¼Œå½“è§†è§’å˜åŒ–åï¼Œç‚¹Aå°±ä¸å†æ˜¯è¾¹ç¼˜ç‚¹ã€‚ è¿™ä¸ªé€»è¾‘çš„åˆ¤æ–­ä¹Ÿæ˜¯é€šè¿‡ç‚¹ä¸å…¶å‘¨å›´ç‚¹çš„rangeå·®è·åˆ¤æ–­ã€‚å¦‚æœæ˜¯ç”±äºé®æŒ¡äº§ç”Ÿçš„è¾¹ç¼˜ç‚¹ï¼Œåˆ™å…¶ä¸å·¦è¾¹æˆ–è€…å³è¾¹ä¼šå­˜åœ¨è·ç¦»çš„å›¾ç‰‡ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// featureExtraction.cpp&gt;markOccludedPoints</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">markOccludedPoints</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cloudSize = extractedCloud-&gt;points.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// æ ‡è®°è¢«é®æŒ¡çš„ç‚¹å’Œä¸æ¿€å…‰æŸå¹³è¡Œçš„ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">5</span>; i &lt; cloudSize - <span class="number">6</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ ‡è®°è¢«é®æŒ¡çš„ç‚¹</span></span><br><span class="line">        <span class="type">float</span> depth1 = cloudInfo.point_range[i];</span><br><span class="line">        <span class="type">float</span> depth2 = cloudInfo.point_range[i+<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> columnDiff = std::<span class="built_in">abs</span>(<span class="built_in">int</span>(cloudInfo.point_col_ind[i+<span class="number">1</span>] - cloudInfo.point_col_ind[i]));</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªç‚¹çš„åˆ—ç´¢å¼•ç›¸å·®10ä¸ªåƒç´ ä¹‹å†…ï¼Œè®¤ä¸ºæ˜¯åŒä¸€å—åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">if</span> (columnDiff &lt; <span class="number">10</span>)&#123;</span><br><span class="line">            <span class="comment">// å½“å‰ç‚¹è·ç¦»å¤§äºå³ç‚¹è·ç¦»0.3ç±³ï¼Œè®¤ä¸ºå½“å‰ç‚¹åŠå·¦è¾¹6ä¸ªç‚¹æ— æ•ˆ</span></span><br><span class="line">            <span class="keyword">if</span> (depth1 - depth2 &gt; <span class="number">0.3</span>)&#123;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">4</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i] = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// å½“å‰ç‚¹è·ç¦»å°äºå³è¾¹ç‚¹è·ç¦»0.3ç±³ï¼Œè®¤ä¸ºå³è¾¹6ä¸ªç‚¹æ— æ•ˆ</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (depth2 - depth1 &gt; <span class="number">0.3</span>)&#123;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">4</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ‡è®°å¹³è¡Œä¸æ¿€å…‰æŸçš„ç‚¹</span></span><br><span class="line">        <span class="type">float</span> diff1 = std::<span class="built_in">abs</span>(<span class="built_in">float</span>(cloudInfo.point_range[i<span class="number">-1</span>] - cloudInfo.point_range[i]));</span><br><span class="line">        <span class="type">float</span> diff2 = std::<span class="built_in">abs</span>(<span class="built_in">float</span>(cloudInfo.point_range[i+<span class="number">1</span>] - cloudInfo.point_range[i]));</span><br><span class="line">        <span class="comment">// å½“å‰ç‚¹ä¸å·¦å³ä¸¤ç‚¹çš„è·ç¦»å‡å¤§äºé˜ˆå€¼ï¼Œè®¤ä¸ºå½“å‰ç‚¹æ˜¯å¤„äºå¹³è¡Œé¢çš„ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (diff1 &gt; <span class="number">0.02</span> * cloudInfo.point_range[i] &amp;&amp; diff2 &gt; <span class="number">0.02</span> * cloudInfo.point_range[i])</span><br><span class="line">            cloudNeighborPicked[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3" type="1">
<li>å½“ç‚¹å¤„äºè·Ÿæ¿€å…‰çº¿å¹³è¡Œçš„å¹³é¢ä¸Šæ—¶ï¼Œä¹Ÿå¯èƒ½è¢«è®¤ä¸ºæ—¶è¾¹ç¼˜ç‚¹ï¼Œä¹Ÿéœ€è¦æ’é™¤ å¦‚ä¸Šå›¾ä¸­çš„(a)æ‰€ç¤ºï¼Œç‚¹Bä½äºä¸€ä¸ªè·Ÿæ¿€å…‰çº¿è¾ƒä¸ºå¹³è¡Œçš„é¢ä¸Šï¼Œæ¿€å…‰çº¿æ‰«è¿‡å»ï¼Œå‰åå‡ ä¸ªç‚¹çš„è·ç¦»å·®è·ä¼šå¾ˆå¤§ï¼Œå› æ­¤åœ¨å¤„ç†æ—¶å¯èƒ½ä¼šè¢«è®¤ä¸ºæ˜¯è¾¹ç¼˜ç‚¹ã€‚è¿™äº›ç‚¹ä¹Ÿéœ€è¦åšæ ‡è®°ï¼Œä¸è¦è®¾ç½®ä¸ºè¾¹ç¼˜ç‚¹ã€‚</li>
</ol>
<h2 id="ç‰¹å¾ç‚¹æå–æµç¨‹">ç‰¹å¾ç‚¹æå–æµç¨‹</h2>
<p>ç”±äºè¿™éƒ¨åˆ†ä»£ç å’ŒåŸç†éƒ½æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œåªè¯´ä¸€ä¸‹ç‰¹å¾æå–çš„æµç¨‹ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief</span></span><br><span class="line"><span class="comment">* cloudInfoè¯é¢˜çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½éƒ½æ˜¯é¡ºåºè¿›è¡Œ</span></span><br><span class="line"><span class="comment">* 1. æ¥æ”¶åˆ°ä»imageProjectionä¸­å‘å¸ƒå‡ºçš„ä¸€ä¸ªå»ç•¸å˜ç‚¹äº‘ä¿¡æ¯cloudInfo(è‡ªå®šä¹‰æ ¼å¼)</span></span><br><span class="line"><span class="comment">* 2. å¯¹æ¯ä¸ªç‚¹è®¡ç®—æ›²ç‡ã€‚è®¡ç®—æ—¶æ˜¯è®¡ç®—å‘¨å›´ç‚¹çš„å¹³å‡è·ç¦»ç”¨æ¥ä½œä¸ºæ›²ç‡çš„æ›¿ä»£</span></span><br><span class="line"><span class="comment">* 3. æ ‡è®°é®æŒ¡ç‚¹å’Œä¸æ¿€å…‰å¹³è¡Œçš„ç‚¹ï¼Œåç»­è¿™äº›ç‚¹ä¸èƒ½é‡‡çº³ä¸ºç‰¹å¾ç‚¹</span></span><br><span class="line"><span class="comment">* 4. ç‰¹å¾æå–ã€‚åˆ†åˆ«åšè§’ç‚¹ï¼ˆæ›²ç‡å¤§ï¼‰å’Œå¹³é¢ç‚¹ï¼ˆæ›²ç‡å°ï¼‰ç‰¹å¾ç‚¹æå–</span></span><br><span class="line"><span class="comment">* 5. æ•´åˆä¿¡æ¯ï¼Œå‘å¸ƒå®Œæ•´æ•°æ®åŒ…</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* @param msgIn ä»å»ç•¸å˜æ¨¡å—æ¥å—çš„æ•°æ®åŒ…</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">laserCloudInfoHandler</span><span class="params">(<span class="type">const</span> spl_lio_sam::msg::CloudInfo::SharedPtr msgIn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç¼“å­˜å…¨å±€å˜é‡ï¼Œåé¢çš„å‡½æ•°å¯ä»¥ç›´æ¥è¯»å–cloudInfoå’ŒcloudHeaderè¿›è¡Œå¤„ç†</span></span><br><span class="line">cloudInfo = *msgIn;</span><br><span class="line">cloudHeader = msgIn-&gt;header;</span><br><span class="line"><span class="comment">// æŠŠros2 PointCloud2è½¬æˆPCLæ ¼å¼ï¼Œæ–¹ä¾¿åé¢å¤„ç†</span></span><br><span class="line">pcl::<span class="built_in">fromROSMsg</span>(msgIn-&gt;cloud_deskewed, *extractedCloud);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—ç‚¹äº‘æ¯ä¸€ä¸ªç‚¹æ›²ç‡</span></span><br><span class="line"><span class="built_in">calculateSmoothness</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‡è®°é®æŒ¡ç‚¹å’Œä¸æ¿€å…‰å¹³è¡Œçš„ç‚¹ï¼Œåç»­è¿™äº›ç‚¹ä¸èƒ½é‡‡çº³ä¸ºç‰¹å¾ç‚¹</span></span><br><span class="line"><span class="built_in">markOccludedPoints</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹å¾æå–ã€‚åˆ†åˆ«åšè§’ç‚¹ï¼ˆæ›²ç‡å¤§ï¼‰å’Œå¹³é¢ç‚¹ï¼ˆæ›²ç‡å°ï¼‰ç‰¹å¾ç‚¹æå–</span></span><br><span class="line"><span class="built_in">extractFeatures</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´åˆä¿¡æ¯ï¼Œå‘å¸ƒå®Œæ•´æ•°æ®åŒ…</span></span><br><span class="line"><span class="built_in">publishFeatureCloud</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/22/lio_sam/imageProjection-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-22 15:55:36 / ä¿®æ”¹æ—¶é—´ï¼š21:32:29" itemprop="dateCreated datePublished" datetime="2023-03-22T15:55:36+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ç‚¹äº‘å»ç•¸å˜æ¨¡å—" href="/2023/03/22/lio_sam/imageProjection-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::92a09cadad63fefbcbc8404aeb27c1f1" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="æ€»è¿°">æ€»è¿°</h2>
<p>ç‚¹äº‘å»ç•¸å˜æ¨¡å—(imageProjection.cppæ–‡ä»¶ï¼Œæ–‡ä»¶å‘½ååº”è¯¥æ˜¯ç»§æ‰¿äº†<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>ï¼Œå…¶å®æˆ‘è§‰å¾—åº”è¯¥å«åšæ•°æ®é¢„å¤„ç†æ¨¡å—æ›´åˆé€‚ï¼‰ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨</p>
<ol type="1">
<li>å»é™¤æ¿€å…‰é›·è¾¾ç‚¹äº‘çš„è¿åŠ¨ç•¸å˜</li>
<li>æ£€ç´¢æ¯ä¸€å¸§ç‚¹äº‘å¯¹åº”çš„IMUè¾“å‡ºè§’åº¦ã€IMUé‡Œç¨‹è®¡ä½å§¿ï¼ˆå‘å¸ƒè‡ªImuPreintegrationï¼‰ï¼Œä»¥ä¾¿MapOptimizationæ¨¡å—ç”¨è¿™äº›ä¿¡æ¯ä½œä¸ºè¯¥å¸§ç‚¹äº‘çš„åˆå§‹ä½å§¿</li>
<li>è½¬æ¢ç‚¹äº‘æ ¼å¼ï¼Œè®¡ç®—<code>Range</code>å­—æ®µï¼Œæ–¹ä¾¿ç‰¹å¾æå–æ¨¡å—è¿›è¡Œè¾¹ç¼˜ç‚¹ã€å¹³é¢ç‚¹æå–</li>
</ol>
<p>æ€»ä½“çš„æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<figure>
<img src="./imgs/Design-imageProjection-pipeline.png" alt="" /><figcaption>pipeline</figcaption>
</figure>
<h2 id="æ¶ˆæ¯è®¢é˜…åŠå‘å¸ƒ">æ¶ˆæ¯è®¢é˜…åŠå‘å¸ƒ</h2>
<figure>
<img src="./imgs/Design-Node%26%26Topics-imageProjection.png" alt="" /><figcaption>æ¶ˆæ¯è®¢é˜…åŠå‘å¸ƒ</figcaption>
</figure>
<h2 id="cloudinfoæ•°æ®ç±»å‹">CloudInfoæ•°æ®ç±»å‹</h2>
<p>ç»è¿‡å»ç•¸å˜çš„ç‚¹äº‘é€šè¿‡<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>è‡ªå®šä¹‰çš„æ•°æ®æ ¼å¼<code>CloudInfo.msg</code>(Simple-LIO-SAM/msg/CloudInfo.msg)å‘å¸ƒï¼›ç‰¹å¾æå–æ¨¡å—ä¹Ÿæ˜¯å°†ç‰¹å¾ç‚¹æ”¾å…¥è¿™ä¸ªè‡ªå®šä¹‰æ•°æ®æ ¼å¼å‘å¸ƒã€‚ <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cloud Info</span></span><br><span class="line"><span class="string">std_msgs/Header</span> <span class="string">header</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è¿›è¡Œç‚¹äº‘å»ç•¸å˜æ—¶ï¼ŒæŠŠrangeæ•°æ®å±•å¼€æˆä¸€ç»´å‘é‡</span></span><br><span class="line"><span class="comment"># ringä»£è¡¨ç¬¬å‡ æ¡æ¿€å…‰çº¿æ•°ï¼Œæ¯”å¦‚16çº¿çš„æ¿€å…‰é›·è¾¾æœ‰16ä¸ªring</span></span><br><span class="line"><span class="comment"># start_ring_indexè®°å½•ç¬¬ä¸€ä¸ªringåœ¨ä¸€ç»´å‘é‡ä¸­çš„èµ·å§‹ç´¢å¼•</span></span><br><span class="line"><span class="comment"># end_ring_indexè®°å½•ç¬¬ä¸€ä¸ªringåœ¨ä¸€ç»´å‘é‡ä¸­çš„ç»“æŸç´¢å¼•</span></span><br><span class="line"><span class="string">int32[]</span> <span class="string">start_ring_index</span></span><br><span class="line"><span class="string">int32[]</span> <span class="string">end_ring_index</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•ä¸€ç»´çš„Rangeæ•°æ®ä¸­æ¯ä¸€ä¸ªç‚¹åœ¨åŸå§‹rangeå›¾ç‰‡ä¸­å±äºé‚£ä¸€ä¸ªåˆ—</span></span><br><span class="line"><span class="string">int32[]</span>  <span class="string">point_col_ind</span> <span class="comment"># point column index in range image</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰ç‚¹çš„rangeæ•°å€¼ï¼Œå±•å¼€ä¸ºä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="string">float32[]</span> <span class="string">point_range</span> <span class="comment"># point range </span></span><br><span class="line"></span><br><span class="line"><span class="string">int64</span> <span class="string">imu_available</span></span><br><span class="line"><span class="string">int64</span> <span class="string">odom_available</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Attitude for LOAM initialization</span></span><br><span class="line"><span class="comment"># ä»IMUåŸå§‹æ•°æ®è·å–çš„rollã€pitchã€yawè§’åˆå€¼</span></span><br><span class="line"><span class="comment"># å½“ä¸Šé¢çš„imu_avaliableä¸ºtrueï¼Œodom_availableä¸ºfalseçš„æ—¶å€™ï¼Œä¼šè¢«ç”¨æ¥</span></span><br><span class="line"><span class="comment"># å½“ä½œè¿™ä¸€å¸§ç‚¹äº‘çš„åˆå€¼</span></span><br><span class="line"><span class="string">float32</span> <span class="string">imu_roll_init</span></span><br><span class="line"><span class="string">float32</span> <span class="string">imu_pitch_init</span></span><br><span class="line"><span class="string">float32</span> <span class="string">imu_yaw_init</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initial guess from imu pre-integration</span></span><br><span class="line"><span class="comment"># ä»imuPreintegrationï¼ŒIMUé¢„ç§¯åˆ†æ¨¡å—è·å–çš„ä¸è¿™ä¸€å¸§é›·è¾¾æœ€æ¥è¿‘çš„åˆå§‹ä½å§¿</span></span><br><span class="line"><span class="comment"># å½“ä¸Šé¢çš„odom_availableæ ‡ç­¾è¢«ç½®ä¸ºtrueçš„æ—¶å€™ä¼šè¢«ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># ä¼˜å…ˆçº§æ¯”imu_xxx_inité«˜</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_x</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_y</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_z</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_roll</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_pitch</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_yaw</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Point cloud messages</span></span><br><span class="line"><span class="comment"># å»ç•¸å˜åçš„åŸå§‹ç‚¹äº‘</span></span><br><span class="line"><span class="comment"># åœ¨ç»è¿‡imageProjectionæ¨¡å—åï¼Œè¿™ä¸ªæ•°æ®å­—æ®µè¢«å¡«å……ã€‚åœ¨ç»è¿‡ç‰¹å¾æå–ä¹‹åè¿™ä¸ªå­—æ®µè¢«æ¸…ç©º</span></span><br><span class="line"><span class="string">sensor_msgs/PointCloud2</span> <span class="string">cloud_deskewed</span> </span><br><span class="line"><span class="comment"># featureExtractionæ¨¡å—æå–å‡ºçš„ç‚¹äº‘è¾¹ç¼˜ç‚¹</span></span><br><span class="line"><span class="string">sensor_msgs/PointCloud2</span> <span class="string">cloud_corner</span></span><br><span class="line"><span class="comment"># featureExtractionæ¨¡å—æå–å‡ºçš„ç‚¹äº‘å¹³é¢ç‚¹</span></span><br><span class="line"><span class="string">sensor_msgs/PointCloud2</span> <span class="string">cloud_surface</span></span><br></pre></td></tr></table></figure> è¿™é‡Œä¸»è¦æ˜¯å‰é¢å‡ ä¸ªæ•°ç»„ç±»å‹ä¼šæ¯”è¾ƒéš¾ç†è§£ï¼Œä¸»è¦æ˜¯è¦çŸ¥é“åœ¨å»ç•¸å˜æ¨¡å—ä¸­ï¼Œå°†æ‰€æœ‰ç‚¹çš„<code>range</code>ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯ç‚¹è·ç¦»é›·è¾¾çš„è·ç¦»ï¼‰æ‹‰æˆä¸€ä¸ªä¸€ç»´çš„æ•°ç»„ï¼Œå³<code>float32[] point_range</code>ã€‚ åŒæ—¶ï¼Œ<code>cloud_deskewed</code>é‡Œå­˜å‚¨çš„æ˜¯å»å®Œç•¸å˜åçš„ç‚¹äº‘ï¼Œé‡Œé¢ç‚¹çš„é¡ºåºä¸<code>point_range</code>çš„é¡ºåºæ˜¯ä¸€æ ·çš„ã€‚</p>
<p><code>cloud_corner</code>å’Œ<code>cloud_surface</code>ä¸¤ä¸ªå­—æ®µåœ¨<code>imageProjection</code>æ¨¡å—ä¸­æ²¡æœ‰è¢«æ”¾ç½®æ•°æ®ã€‚ç‰¹å¾æå–æ¨¡å—ä¼šå°†è¾¹ç¼˜ç‚¹ã€å¹³é¢ç‚¹æ”¾ç½®åœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­ï¼ŒåŒæ—¶å°†<code>cloud_deskewed</code>å­—æ®µæ¸…ç©ºã€‚</p>
<h2 id="åŠŸèƒ½è§£è¯»">åŠŸèƒ½è§£è¯»</h2>
<h3 id="imuåŠimué‡Œç¨‹è®¡å¤„ç†">IMUåŠIMUé‡Œç¨‹è®¡å¤„ç†</h3>
<p>ImageProjectionç›‘å¬IMUåŸå§‹æ•°æ®ä¸ä»ImuPreintegrationå‘å¸ƒå‡ºæ¥çš„IMUé‡Œç¨‹è®¡æ•°æ®ï¼Œåˆ†åˆ«ç”±ä¸¤ä¸ªå›è°ƒå‡½æ•°å¤„ç†ï¼Œå¯¹äºIMUåŸå§‹æ•°æ®ï¼Œåªæ˜¯ç®€å•åœ°å°†å…¶æ—‹è½¬åˆ°é›·è¾¾åæ ‡ç³»åå¡å…¥ç¼“å­˜é˜Ÿåˆ—ã€‚ å¯¹äºIMUå†ç¨‹è®¡ï¼Œåˆ™æ˜¯ç›´æ¥å¡å…¥ç¼“å­˜é˜Ÿåˆ—ã€‚</p>
<h3 id="å»ç•¸å˜æµç¨‹">å»ç•¸å˜æµç¨‹</h3>
<p>ä¸€å¥è¯è¯´æ˜ç‚¹äº‘è¿åŠ¨ç•¸å˜æ ¡æ­£ï¼šæ ¹æ®æ¯ä¸€å¸§ç‚¹äº‘ä¸­æ¯ä¸€ä¸ªç‚¹çš„æ—¶é—´æˆ³ï¼Œè®¡ç®—è¯¥ç‚¹åˆ°è¯¥å¸§ç‚¹äº‘èµ·å§‹ç‚¹çš„æ—‹è½¬å¹³ç§»å˜æ¢ï¼Œå°†æ¯ä¸€ä¸ªç‚¹å˜æ¢åˆ°èµ·å§‹ç‚¹çš„åæ ‡ç³»ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­å¯¹è¿åŠ¨ç•¸å˜æ ¡æ­£åªåšäº†æ—‹è½¬æ ¡æ­£ï¼Œæ²¡æœ‰åšå¹³ç§»æ ¡æ­£ã€‚</p>
<p>å»ç•¸å˜æµç¨‹å‘ç”Ÿåœ¨ç‚¹äº‘çš„å›è°ƒå‡½æ•°ä¸­ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imageProjection::cloudHandler</span></span><br><span class="line"><span class="comment">/** åŸå§‹é›·è¾¾ç‚¹äº‘è¯é¢˜çš„å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸ŠçœŸæ­£åšç‚¹äº‘å¤„ç†çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">    * å®é™…å¤„ç†æµç¨‹æ˜¯å•çº¿ç¨‹æµæ°´çº¿å¼å¤„ç†ï¼Œè¿™ä¸ªå‡½æ•°åé¢çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯ä¸ºè¿™ä¸ªå‡½æ•°æœåŠ¡ï¼Œå› æ­¤éœ€è¦äº†è§£</span></span><br><span class="line"><span class="comment">    * ç‚¹äº‘å»ç•¸å˜çš„æµç¨‹ã€‚</span></span><br><span class="line"><span class="comment">    * è®¢é˜…åŸå§‹lidaræ•°æ®</span></span><br><span class="line"><span class="comment">    * 1ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼ï¼Œæå–ç‚¹äº‘ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *   1ï¼‰æ·»åŠ ä¸€å¸§æ¿€å…‰ç‚¹äº‘åˆ°é˜Ÿåˆ—ï¼Œå–å‡ºæœ€æ—©ä¸€å¸§ä½œä¸ºå½“å‰å¸§</span></span><br><span class="line"><span class="comment">    *   2) è®¡ç®—èµ·æ­¢æ—¶é—´æˆ³ï¼Œæ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§</span></span><br><span class="line"><span class="comment">    * 2ã€ä»IMUæ•°æ®å’ŒIMUé‡Œç¨‹è®¡æ•°æ®ä¸­æå–å»ç•¸å˜ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *   imuæ•°æ®ï¼š</span></span><br><span class="line"><span class="comment">    *   1) éå†å½“å‰æ¿€å…‰å¸§èµ·æ­¢æ—¶åˆ»ä¹‹é—´çš„imuæ•°æ®ï¼Œåˆå§‹æ—¶åˆ»å¯¹åº”imuçš„å§¿æ€è§’RPYè®¾ä¸ºå½“å‰å¸§çš„åˆå§‹å§¿æ€è§’</span></span><br><span class="line"><span class="comment">    *   2) ç”¨è§’é€Ÿåº¦ã€æ—¶é—´ç§¯åˆ†ï¼Œè®¡ç®—æ¯ä¸€æ—¶åˆ»ç›¸å¯¹äºåˆå§‹æ—¶åˆ»çš„æ—‹è½¬é‡ï¼Œåˆå§‹æ—¶åˆ»æ—‹è½¬è®¾ä¸º0</span></span><br><span class="line"><span class="comment">    *   imué‡Œç¨‹è®¡æ•°æ®ï¼š</span></span><br><span class="line"><span class="comment">    *   1) éå†å½“å‰æ¿€å…‰å¸§èµ·æ­¢æ—¶åˆ»ä¹‹é—´çš„imué‡Œç¨‹è®¡æ•°æ®ï¼Œåˆå§‹æ—¶åˆ»å¯¹åº”imué‡Œç¨‹è®¡è®¾ä¸ºå½“å‰å¸§çš„åˆå§‹ä½å§¿</span></span><br><span class="line"><span class="comment">    *   2) ç”¨èµ·å§‹ã€ç»ˆæ­¢æ—¶åˆ»å¯¹åº”imué‡Œç¨‹è®¡ï¼Œè®¡ç®—ç›¸å¯¹ä½å§¿å˜æ¢ï¼Œä¿å­˜å¹³ç§»å¢é‡</span></span><br><span class="line"><span class="comment">    * 3ã€å½“å‰å¸§æ¿€å…‰ç‚¹äº‘è¿åŠ¨ç•¸å˜æ ¡æ­£</span></span><br><span class="line"><span class="comment">    *   1) æ£€æŸ¥æ¿€å…‰ç‚¹è·ç¦»ã€æ‰«æçº¿æ˜¯å¦åˆè§„</span></span><br><span class="line"><span class="comment">    *   2) æ¿€å…‰è¿åŠ¨ç•¸å˜æ ¡æ­£ï¼Œä¿å­˜æ¿€å…‰ç‚¹</span></span><br><span class="line"><span class="comment">    * 4ã€æå–æœ‰æ•ˆæ¿€å…‰ç‚¹ï¼Œé›†åˆä¿¡æ¯åˆ°å‡†å¤‡å‘å¸ƒçš„cloud_infoæ•°æ®åŒ…</span></span><br><span class="line"><span class="comment">    * 5ã€å‘å¸ƒå½“å‰å¸§æ ¡æ­£åç‚¹äº‘ï¼Œæœ‰æ•ˆç‚¹å’Œå…¶ä»–ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    * 6ã€é‡ç½®å‚æ•°ï¼Œæ¥æ”¶æ¯å¸§lidaræ•°æ®éƒ½è¦é‡ç½®è¿™äº›å‚æ•°</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cloudHandler</span><span class="params">(<span class="type">const</span> sensor_msgs::msg::PointCloud2::SharedPtr laserCloudMsg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€æå–ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">cachePointCloud</span>(laserCloudMsg))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ã€ä»IMUæ•°æ®å’ŒIMUé‡Œç¨‹è®¡æ•°æ®ä¸­æå–å»ç•¸å˜ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">deskewInfo</span>())</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3ã€å½“å‰å¸§æ¿€å…‰ç‚¹äº‘è¿åŠ¨ç•¸å˜æ ¡æ­£</span></span><br><span class="line">    <span class="built_in">projectPointCloud</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4ã€æå–æœ‰æ•ˆæ¿€å…‰ç‚¹ï¼Œé›†åˆä¿¡æ¯åˆ°å‡†å¤‡å‘å¸ƒçš„cloud_infoæ•°æ®åŒ…</span></span><br><span class="line">    <span class="built_in">cloudExtraction</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5ã€å‘å¸ƒå½“å‰å¸§æ ¡æ­£åç‚¹äº‘ï¼Œæœ‰æ•ˆç‚¹å’Œå…¶ä»–ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">publishClouds</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6ã€é‡ç½®å‚æ•°ï¼Œæ¥æ”¶æ¯å¸§lidaræ•°æ®éƒ½è¦é‡ç½®è¿™äº›å‚æ•°</span></span><br><span class="line">    <span class="built_in">resetParameters</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>æå–ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼ <img src="./imgs/Design-imageProjection-cachePointCloud.png" alt="æå–ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼" /></p></li>
<li><p>æå–å»ç•¸å˜ä¿¡æ¯ <img src="./imgs/Design-imageProjection-deskewInfo.png" alt="æå–å»ç•¸å˜ä¿¡æ¯" /></p></li>
</ul>
<p>è¿™é‡Œæœ‰å‡ ç‚¹è¦æ³¨æ„ 1. ä»IMUåŸå§‹æ•°æ®è®¡ç®—æ¯ä¸€æ—¶åˆ»çš„ä½å§¿å˜æ¢ç”¨çš„æ˜¯è¿‘ä¼¼ç®—æ³•ï¼ˆå› ä¸ºä¸€å¸§ç‚¹äº‘æˆåƒæ—¶é—´å¾ˆçŸ­ï¼Œä¸€èˆ¬å°ä¸100msï¼‰ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹è§’åº¦åšç§¯åˆ†</span></span><br><span class="line"><span class="comment">// å†æ¬¡å¼ºè°ƒï¼Œå¯¹è§’é€Ÿåº¦çš„ç§¯åˆ†ä¸æ˜¯ç®€å•çš„è§’é€Ÿåº¦ä¹˜ä»¥é—´éš”æ—¶é—´</span></span><br><span class="line"><span class="comment">// å…³äºè§’é€Ÿåº¦çš„ç§¯åˆ†å…¬å¼å¯ä»¥æŸ¥é˜…ï¼šhttps://zhuanlan.zhihu.com/p/591613108</span></span><br><span class="line"><span class="type">static</span> <span class="type">double</span> timeDiff;</span><br><span class="line">timeDiff = currentImuTime - imuTime[imuPointerCur<span class="number">-1</span>];</span><br><span class="line">imuRotX[imuPointerCur] = imuRotX[imuPointerCur<span class="number">-1</span>] + angular_x * timeDiff;</span><br><span class="line">imuRotY[imuPointerCur] = imuRotY[imuPointerCur<span class="number">-1</span>] + angular_y * timeDiff;</span><br><span class="line">imuRotZ[imuPointerCur] = imuRotZ[imuPointerCur<span class="number">-1</span>] + angular_z * timeDiff;</span><br><span class="line">imuTime[imuPointerCur] = currentImuTime;</span><br><span class="line">++imuPointerCur;</span><br></pre></td></tr></table></figure> 2. å¯¹äºé€Ÿåº¦è¾ƒä½ï¼Œè§’åº¦å˜åŒ–ä¸é‚£ä¹ˆå‰§çƒˆçš„è¡Œé©¶ç³»ç»Ÿï¼Œå³ä½¿ä¸åšç‚¹äº‘ç•¸å˜æ ¡æ­£ä¹Ÿæ²¡æœ‰é—®é¢˜</p>
<ul>
<li><p>å¯¹ç‚¹äº‘åšå»ç•¸å˜å¤„ç† <img src="./imgs/Design-imageProjection-projectPointCloud.png" alt="å¯¹ç‚¹äº‘åšå»ç•¸å˜å¤„ç†" /></p></li>
<li><p>æå–æœ‰æ•ˆç‚¹äº‘å¹¶é›†åˆå…¶ä»–ä¿¡æ¯ è¿™é‡Œä¸»è¦æ˜¯å°†ç»è¿‡å»ç•¸å˜å¤„ç†åè®°å½•ä¸‹æ¥çš„æœ‰æ•ˆç‚¹è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œå¹¶æŠŠå„ç§ä¿¡æ¯å¡«å…¥å‡†å¤‡å‘å¸ƒçš„<code>cloud_info</code>æ¶ˆæ¯ä¸­ã€‚</p></li>
<li><p>å‘å¸ƒç‚¹äº‘</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”utilityæ–‡ä»¶è§£è¯»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-22 11:18:09 / ä¿®æ”¹æ—¶é—´ï¼š21:32:22" itemprop="dateCreated datePublished" datetime="2023-03-22T11:18:09+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”utilityæ–‡ä»¶è§£è¯»" href="/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::6ed3eebc09d2237963daad43bab3bc96" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<p>è¿™æ˜¯<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>é‡Œä¸€ä¸ªæœ€åŸºç¡€çš„æ–‡ä»¶ï¼Œä¸»è¦æœ‰å‡ ä¸ªé‡è¦åŠŸèƒ½ï¼š 1. ä½œä¸ºæ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„åŸºç±»ï¼Œæ”¾ç½®æ‰€æœ‰ä»é…ç½®æ–‡ä»¶è¯»å–çš„é…ç½®å­— 2. æä¾›ä¸€äº›å®ç”¨å‡½æ•° 3. é…ç½®<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html" title="Ros2 QoS">QoS</a></p>
<h2 id="é…ç½®åŸºç±»">é…ç½®åŸºç±»</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸ºäº†æ–¹ä¾¿é…ç½®ï¼ŒæŠŠæ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®é¡¹éƒ½å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶<code>Simple-LIO-SAM/config/params.yaml</code>ï¼ŒåŒæ—¶æ„å»ºäº†ä¸€ä¸ªåŸºç±»<code>ParamServer</code>ç»Ÿä¸€è¯»å–è¯¥é…ç½®æ–‡ä»¶ï¼Œå…¶ä½™æ¨¡å—éƒ½ä»è¯¥åŸºç±»ç»§æ‰¿ã€‚ <img src="./imgs/Design-Class.png" alt="ç±»å›¾" /> è¿™å¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„æ–¹å¼ï¼Œä¸è¿‡ä»å®ç°ä¸Šæ¥è¯´çš„ç¡®æ˜¯æœ€ç®€å•çš„ã€‚</p>
<p>æ¯ä¸ªæ¨¡å—çš„å…·ä½“é…ç½®é¡¹åé¢å…·ä½“è®²è§£åˆ°ä¼šé€ä¸€è§£é‡Šï¼Œç›®å‰åªéœ€è¦çŸ¥é“æ˜¯åœ¨å“ªé‡Œé…ç½®å°±è¡Œã€‚ <details class="note info no-icon"><summary><p>é…ç½®éƒ¨åˆ†ä»£ç </p>
</summary>
<figure class="highlight plaintext">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre>
</td>
<td class="code">
<pre><span class="line">// Topics</span><br><span class="line">string pointCloudTopic;  // åŸå§‹ç‚¹äº‘æ•°æ®è¯é¢˜ï¼ˆ/points_rawï¼‰</span><br><span class="line">string imuTopic;         // åŸå§‹IMUæ•°æ®è¯é¢˜ï¼ˆ/imu_correctï¼‰</span><br><span class="line">string imuOdomTopic;     // IMUé‡Œç¨‹è®¡ï¼Œåœ¨imuPreintegrationä¸­å¯¹IMUåšé¢„ç§¯åˆ†å¾—åˆ°ï¼ˆ/lio_sam/imu/odometryï¼‰</span><br><span class="line">string lidarOdomTopic;   // é›·è¾¾é‡Œç¨‹è®¡ï¼Œåœ¨mapOptimizationä¸­å¾—åˆ°ï¼ˆ/lio_sam/mapping/odometryï¼‰</span><br><span class="line">string gpsTopic;         // åŸå§‹gpsç»è¿‡robot_localizationåŒ…è®¡ç®—å¾—åˆ°ï¼Œæš‚æœªä½¿ç”¨</span><br><span class="line"></span><br><span class="line">// Services</span><br><span class="line">string saveMapSrv;      // ä¿å­˜åœ°å›¾serviceåœ°å€</span><br><span class="line"></span><br><span class="line">// Frames</span><br><span class="line">string imuFrame;        // IMUæ•°æ®åæ ‡ç³»ï¼Œå¦‚æœIMUå’Œæ¿€å…‰é›·è¾¾åæ ‡ç³»ç¡¬ä»¶å¯¹é½ï¼Œå¯ä»¥è®¤ä¸ºIMUã€Lidarã€Chassisåæ ‡ç³»ç›¸åŒ</span><br><span class="line">string lidarFrame;      // æ¿€å…‰é›·è¾¾åæ ‡ç³»ï¼Œç‚¹äº‘æ•°æ®åæ ‡ç³»ï¼Œç”±æ¿€å…‰é›·è¾¾å‘å¸ƒçš„æ•°æ®æŒ‡å®šã€‚ä¸lidarFrameç›¸åŒï¼Œä½†æ˜¯ä¸åŒé›·è¾¾æœ‰ä¸åŒçš„åç§°</span><br><span class="line">string baseLinkFrame;   // è½¦è¾†åº•ç›˜åæ ‡ç³»</span><br><span class="line">string odomFrame;       // åœ°å›¾åæ ‡ç³»ï¼Œåœ¨SLAMä¸­ä¸€èˆ¬ä¹Ÿæ˜¯ä¸–ç•Œåæ ‡ç³»ï¼Œé€šå¸¸æ˜¯è½¦è¾†çš„èµ·å§‹åæ ‡ç³»</span><br><span class="line"></span><br><span class="line">// GPS Settings</span><br><span class="line">bool useImuHeadingInitialization;</span><br><span class="line">bool useGpsElevation;</span><br><span class="line">float gpsCovThreshold;</span><br><span class="line">float poseCovThreshold;</span><br><span class="line"></span><br><span class="line">// Save pcd</span><br><span class="line">bool savePCD;</span><br><span class="line">string savePCDDirectory;</span><br><span class="line"></span><br><span class="line">// Lidar Sensor Configuration</span><br><span class="line">SensorType sensor;</span><br><span class="line">int N_SCAN;</span><br><span class="line">int Horizon_SCAN;</span><br><span class="line">int downsampleRate;</span><br><span class="line">float lidarMinRange;</span><br><span class="line">float lidarMaxRange;</span><br><span class="line"></span><br><span class="line">// IMU</span><br><span class="line">float imuAccNoise;      // IMUåŠ é€Ÿåº¦å™ªå£°åæ–¹å·®ï¼Œå¯ä»¥ç”¨Allenæ–¹å·®æ ‡å®šï¼›è¿™é‡Œä¸‰ä¸ªè½´è®¾ä¸ºç›¸åŒçš„æ–¹å·®</span><br><span class="line">float imuGyrNoise;      // IMUè§’é€Ÿåº¦å™ªå£°åæ–¹å·®ï¼Œå¯ä»¥ç”¨Allenæ–¹å·®æ ‡å®šï¼›è¿™é‡Œä¸‰ä¸ªè½´è®¾ä¸ºç›¸åŒçš„æ–¹å·®</span><br><span class="line">float imuAccBiasN;      // IMUåŠ é€Ÿåº¦åå·®ï¼Œä¸‰è½´ç»Ÿä¸€</span><br><span class="line">float imuGyrBiasN;      // IMUè§’é€Ÿåº¦åå·®ï¼Œä¸‰è½´ç»Ÿä¸€</span><br><span class="line">float imuGravity;       // é‡åŠ›åŠ é€Ÿåº¦å€¼</span><br><span class="line">float imuRPYWeight;     // ç®—æ³•ä¸­ä½¿ç”¨IMUçš„rollã€pitchè§’å¯¹æ¿€å…‰é‡Œç¨‹è®¡çš„ç»“æœåŠ æƒèåˆ</span><br><span class="line">vector&lt;double&gt; extRotV;         // IMUåŠ é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">vector&lt;double&gt; extRPYV;         // IMUè§’é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">vector&lt;double&gt; extTransV;       // IMUå‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„å¹³ç§»ï¼šP_&#123;lidar&#125; = T * P_&#123;imu&#125;</span><br><span class="line">Eigen::Matrix3d extRot;         // IMUåŠ é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">Eigen::Matrix3d extRPY;         // IMUè§’é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">Eigen::Vector3d extTrans;       // IMUå‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„å¹³ç§»ï¼šP_&#123;lidar&#125; = T * P_&#123;imu&#125;</span><br><span class="line">Eigen::Quaterniond extQRPY;     // IMUè§’é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬ï¼ˆå››å…ƒæ•°å½¢å¼ï¼‰</span><br><span class="line"></span><br><span class="line">// LOAM</span><br><span class="line">float edgeThreshold;            // è¾¹ç¼˜ç‰¹å¾ç‚¹æå–é˜ˆå€¼</span><br><span class="line">float surfThreshold;            // å¹³é¢ç‰¹å¾ç‚¹æå–é˜ˆå€¼</span><br><span class="line">int edgeFeatureMinValidNum;     // è¾¹ç¼˜ç‰¹å¾ç‚¹æ•°é‡é˜ˆå€¼ï¼ˆdefault:10)</span><br><span class="line">int surfFeatureMinValidNum;     // å¹³é¢ç‰¹å¾ç‚¹æ•°é‡é˜ˆå€¼ï¼ˆdefault:100)</span><br><span class="line"></span><br><span class="line">// voxel filter paprams</span><br><span class="line">float odometrySurfLeafSize;</span><br><span class="line">float mappingCornerLeafSize;</span><br><span class="line">float mappingSurfLeafSize ;</span><br><span class="line"></span><br><span class="line">float z_tollerance;             // é™åˆ¶zè½´å¹³ç§»çš„å¤§å°</span><br><span class="line">float rotation_tollerance;      // é™åˆ¶rollã€pitchè§’çš„å¤§å°</span><br><span class="line"></span><br><span class="line">// CPU Params</span><br><span class="line">int numberOfCores;              // åœ¨ç‚¹äº‘åŒ¹é…ä¸­ä½¿ç”¨æŒ‡ä»¤é›†å¹¶è¡ŒåŠ é€Ÿï¼ˆdefault:4ï¼‰</span><br><span class="line">double mappingProcessInterval;  // ç‚¹äº‘å¸§å¤„ç†æ—¶é—´é—´éš”ï¼ˆdefault:0.15sï¼‰</span><br><span class="line"></span><br><span class="line">// Surrounding map</span><br><span class="line">float surroundingkeyframeAddingDistThreshold;   // å½“å‰å¸§éœ€è¦ä¸ä¸Šä¸€å¸§è·ç¦»å¤§äº1ç±³æˆ–è€…è§’åº¦å¤§äº0.2åº¦æ‰æœ‰å¯èƒ½é‡‡çº³ä¸ºå…³é”®å¸§</span><br><span class="line">float surroundingkeyframeAddingAngleThreshold;  // å½“å‰å¸§éœ€è¦ä¸ä¸Šä¸€å¸§è·ç¦»å¤§äº1ç±³æˆ–è€…è§’åº¦å¤§äº0.2åº¦æ‰æœ‰å¯èƒ½é‡‡çº³ä¸ºå…³é”®å¸§</span><br><span class="line">float surroundingKeyframeDensity;               // æ„å»ºå±€éƒ¨åœ°å›¾æ—¶å¯¹é‡‡ç”¨çš„å…³é”®å¸§æ•°é‡åšé™é‡‡æ ·</span><br><span class="line">float surroundingKeyframeSearchRadius;          // æ„å»ºå±€éƒ¨åœ°å›¾æ—¶å…³é”®å¸§çš„æ£€ç´¢åŠå¾„</span><br><span class="line"></span><br><span class="line">// Loop closure</span><br><span class="line">bool  loopClosureEnableFlag;</span><br><span class="line">float loopClosureFrequency;                     // å›ç¯æ£€æµ‹ç‹¬ç«‹çº¿ç¨‹çš„æ‰§è¡Œé¢‘ç‡</span><br><span class="line">int   surroundingKeyframeSize;                  // å›ç¯æ£€æµ‹æ„å»ºå±€éƒ¨åœ°å›¾çš„æœ€å¤§å…³é”®å¸§æ•°é‡</span><br><span class="line">float historyKeyframeSearchRadius;              // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶å…³é”®å¸§çš„æ£€ç´¢åŠå¾„</span><br><span class="line">float historyKeyframeSearchTimeDiff;            // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶å…³é”®å¸§çš„æ£€ç´¢æ—¶é—´èŒƒå›´</span><br><span class="line">int   historyKeyframeSearchNum;                 // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶èåˆå±€éƒ¨åœ°å›¾æ—¶å¯¹ç›®æ ‡å…³é”®å¸§æ‰§è¡Œ+-25å¸§çš„å…³é”®å¸§èåˆ</span><br><span class="line">float historyKeyframeFitnessScore;              // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶ä½¿ç”¨ICPåšç‚¹äº‘åŒ¹é…ï¼Œé˜ˆå€¼å¤§äº0.3è®¤ä¸ºåŒ¹é…å¤±è´¥ï¼Œä¸é‡‡çº³å½“å‰å›ç¯æ£€æµ‹</span><br><span class="line"></span><br><span class="line">// global map visualization radius</span><br><span class="line">float globalMapVisualizationSearchRadius;</span><br><span class="line">float globalMapVisualizationPoseDensity;</span><br><span class="line">float globalMapVisualizationLeafSize;</span><br></pre>
</td>
</tr>
</table>
</figure>

</details></p>
<h2 id="å®ç”¨å‡½æ•°">å®ç”¨å‡½æ•°</h2>
<p>è¿™é‡Œä¸»è¦è®²è§£å…¶ä¸­ä¸€ä¸ª<code>imuConverter</code>å‡½æ•°ã€‚è¯¥å‡½æ•°çš„åŠŸèƒ½ä¸»è¦æ˜¯å°†<code>IMU</code>çš„åŸå§‹æ•°æ®<strong>æ—‹è½¬åˆ°</strong><code>Lidar</code>åæ ‡ç³»ã€‚è¿™é‡Œè¦å…ˆçŸ¥é“ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­ï¼Œ é»˜è®¤å°†é›·è¾¾åæ ‡ç³»å’Œå°è½¦çš„åæ ‡ç³»ç­‰åŒä¸ºåŒä¸€ä¸ªåæ ‡ç³»ï¼ŒåŒæ—¶ï¼Œè¿™é‡Œåªåšäº†<strong>æ—‹è½¬</strong>æ“ä½œï¼Œæ²¡æœ‰åšå¹³ç§»æ“ä½œã€‚ä»£ç ä¸­æœ‰å¾ˆå¤šå¤„ä½ç½®éƒ½ç”¨åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤éœ€è¦ç†è§£è¿™ä¸ªå‡½æ•°åˆ°åº•åšäº†ä»€ä¹ˆã€‚ ç®€å•æ¥è¯´è¿™ä¸ªå‡½æ•°å°±æ˜¯åšäº†ä¸€ä¸ª<strong>å‘é‡åæ ‡å˜æ¢</strong>ã€‚æ—‹è½¬çŸ©é˜µæ“ä½œç©ºé—´ä¸­ä¸€ä¸ªç‚¹æœ‰ä¸¤ç§æ„ä¹‰ï¼š1ï¼‰ä¸‰ç»´æ—‹è½¬ï¼›2ï¼‰åæ ‡å˜æ¢ã€‚è¿™ä¸¤ç§ä¸åŒçš„æ“ä½œåœ¨åšè¿ç»­çš„æ“ä½œæ—¶ï¼Œå¯¹åº”æ—‹è½¬çŸ©é˜µçš„å·¦ä¹˜å’Œå³ä¹˜ã€‚ ç”±äºç¬”è€…ä»¥å‰çš„ç ”ç©¶æ–¹å‘æ˜¯å…­è‡ªç”±åº¦å§¿æ€ä¼°è®¡ï¼Œç”¨ä¸‰ç»´æ—‹è½¬æ“ä½œæ¯”è¾ƒå¤šï¼Œä¸€å¼€å§‹è¢«è¿™é‡Œçš„<code>çŸ©é˜µå³ä¹˜</code>æè’™äº†ã€‚å…³äºæ—‹è½¬çŸ©é˜µçš„å·¦ä¹˜å’Œå³ä¹˜ï¼Œå¯ä»¥çœ‹è¿™ç¯‡<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45632220/article/details/117735223">åšå®¢</a> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å°†åŸå§‹IMUæ•°æ®ï¼šä¸‰è½´åŠ é€Ÿåº¦ã€ä¸‰è½´è§’é€Ÿåº¦ã€ä¸‰è½´è§’åº¦ï¼Œä¸é›·è¾¾åæ ‡ç³»è¿›è¡Œæ—‹è½¬å¯¹é½</span></span><br><span class="line"><span class="comment">+ å¯¹é½ä¹‹åè¾“å‡ºçš„åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ã€è§’åº¦çš„xï¼Œyï¼Œzå°±å˜æˆé›·è¾¾åæ ‡ç³»çš„xï¼Œyï¼Œz</span></span><br><span class="line"><span class="comment">+ è¿™é‡Œçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå…è®¸IMUçš„åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ä¸è§’åº¦çš„è¾“å‡ºæ˜¯ä¸¤ä¸ªä¸åŒçš„åæ ‡ç³»ã€‚ä½†åœ¨ç®—æ³•ä¸­ï¼Œè§’åº¦çš„è¾“å‡ºé™¤äº†ç”¨æ¥åšç¬¬ä¸€å¸§çš„åˆå§‹åŒ–å’ŒåŠ æƒèåˆï¼Œä¼¼ä¹æ²¡æœ‰å…¶ä»–ä½œç”¨</span></span><br><span class="line"><span class="comment">+ è¿™é‡Œæ˜¯å°†IMUçš„ä¸‰ä¸ªè½´ä¸é›·è¾¾çš„ä¸‰ä¸ªè½´åœ¨æ—‹è½¬ä¸Šåšå¯¹é½ï¼Œä¸èƒ½åŠ ä¸Šå¹³ç§»</span></span><br><span class="line"><span class="comment">+ å¯¹å‘é‡åšåæ ‡ç³»å˜æ¢ï¼Œå¯¹å¤šä¸ªå˜æ¢çš„å¤åˆåº”è¯¥æ˜¯å³ä¹˜</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sensor_msgs::<span class="function">msg::Imu <span class="title">imuConverter</span><span class="params">(<span class="type">const</span> sensor_msgs::msg::Imu&amp; imu_in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    sensor_msgs::msg::Imu imu_out = imu_in;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹åŠ é€Ÿåº¦å‘é‡åšåæ ‡ç³»å˜æ¢ï¼Œæ³¨æ„è¿™é‡Œè¦ç†è§£æˆåæ ‡ç³»å˜æ¢ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªåŠ é€Ÿåº¦åœ¨IMUåæ ‡ç³»å’ŒLidaråæ ‡ç³»çš„ä¸åŒè¡¨è¾¾ã€‚ä¸èƒ½æƒ³è±¡æˆå¯¹åŠ é€Ÿåº¦åšæ—‹è½¬</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Eigen::Vector3d <span class="title">acc</span><span class="params">(imu_in.linear_acceleration.x, imu_in.linear_acceleration.y, imu_in.linear_acceleration.z)</span></span>;</span><br><span class="line">    acc = extRot * acc;</span><br><span class="line">    imu_out.linear_acceleration.x = acc.<span class="built_in">x</span>();</span><br><span class="line">    imu_out.linear_acceleration.y = acc.<span class="built_in">y</span>();</span><br><span class="line">    imu_out.linear_acceleration.z = acc.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹è§’é€Ÿåº¦åšåæ ‡ç³»å˜æ¢ã€‚å°†IMUåæ ‡ç³»ä¸‹çš„å‘é‡å˜æ¢åˆ°é›·è¾¾åæ ‡ç³»ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Eigen::Vector3d <span class="title">gyr</span><span class="params">(imu_in.angular_velocity.x, imu_in.angular_velocity.y, imu_in.angular_velocity.z)</span></span>;</span><br><span class="line">    gyr = extRot * gyr;</span><br><span class="line">    imu_out.angular_velocity.x = gyr.<span class="built_in">x</span>();</span><br><span class="line">    imu_out.angular_velocity.y = gyr.<span class="built_in">y</span>();</span><br><span class="line">    imu_out.angular_velocity.z = gyr.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹è§’åº¦åšåæ ‡ç³»å˜æ¢ã€‚</span></span><br><span class="line"><span class="comment">    + q_fromæ˜¯IMUåœ¨å…¨å±€åæ ‡ç³»ä¸‹çš„ä½å§¿ï¼Œq_from: transformation_from_map_to_imu</span></span><br><span class="line"><span class="comment">    + extQRPYå¦‚æœä¸extRotå¯¹åº”çš„è¯åº”è¯¥æ˜¯lidaråˆ°imuçš„å˜æ¢ï¼štransformation_from_lidar_to_imu</span></span><br><span class="line"><span class="comment">    + q_finalæ˜¯å°†é›·è¾¾ç‚¹äº‘ä»é›·è¾¾åæ ‡ç³»è½¬æ¢åˆ°mapåæ ‡ç³»çš„å˜æ¢ï¼Œä¹Ÿæ˜¯ï¼štransformation_from_map_to_lidar -&gt; pcd_in_map = q_final * pcd_in_lidar</span></span><br><span class="line"><span class="comment">    + è¿™é‡ŒåŸä»£ç æ˜¯q_final = q_from * extQRPYï¼›ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œè¿˜æ˜¯æŒ‰ç…§æˆ‘çš„æ¨å¯¼ä¿®æ”¹æˆq_final = q_from * extQRPT.inverse()ï¼›ç”±äºè¿™é‡Œçš„extQRPYæ˜¯</span></span><br><span class="line"><span class="comment">    + ç›´æ¥ä»é…ç½®æ–‡ä»¶é‡Œé¢è¯»å–çš„ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸åŠ é€†åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œæ”¹å°±è¡Œã€‚è®¤ä¸ºè¿™é‡Œæœ‰é—®é¢˜çš„å‡è®¾æ˜¯è®¤ä¸ºextQRPYå’ŒextRotçš„åæ ‡ç³»å…³ç³»çš„å®šä¹‰æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯</span></span><br><span class="line"><span class="comment">    + å°†imuåæ ‡ç³»ä¸‹çš„å‘é‡è½¬æ¢åˆ°é›·è¾¾åæ ‡ç³»ä¸‹ã€‚å¦‚æœä½œè€…å¯¹è¿™ä¸¤è€…çš„å®šä¹‰åˆšå¥½æ˜¯ç›¸åçš„ï¼Œé‚£è¿™é‡Œå°±æ²¡æœ‰é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Eigen::Quaterniond <span class="title">q_from</span><span class="params">(imu_in.orientation.w, imu_in.orientation.x, imu_in.orientation.y, imu_in.orientation.z)</span></span>;</span><br><span class="line">    Eigen::Quaterniond q_final = q_from * extQRPY.<span class="built_in">inverse</span>();</span><br><span class="line">    imu_out.orientation.x = q_final.<span class="built_in">x</span>();</span><br><span class="line">    imu_out.orientation.y = q_final.<span class="built_in">y</span>();</span><br><span class="line">    imu_out.orientation.z = q_final.<span class="built_in">z</span>();</span><br><span class="line">    imu_out.orientation.w = q_final.<span class="built_in">w</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sqrt</span>(q_final.<span class="built_in">x</span>()*q_final.<span class="built_in">x</span>() + q_final.<span class="built_in">y</span>()*q_final.<span class="built_in">y</span>() + q_final.<span class="built_in">z</span>()*q_final.<span class="built_in">z</span>() + q_final.<span class="built_in">w</span>()*q_final.<span class="built_in">w</span>()) &lt; <span class="number">0.1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Invalid quaternion, please use a 9-axis IMU!&quot;</span>);</span><br><span class="line">        rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> imu_out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="qosquality-of-service">QoS:Quality of Service</h2>
<p>å…³äºROS2ä¸­<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html" title="Ros2 QoS">QoS</a>çš„åŸºæœ¬ä»‹ç»ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html" title="Ros2 QoS">QoS</a>çš„è®¾ç½®ä¸­ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°æ˜¯æœ€é‡è¦çš„ã€‚ä¸€ä¸ªæ˜¯<code>depth</code>ï¼Œä¸€ä¸ªæ˜¯<code>RELIABILITY</code>ã€‚<code>depth</code>å¯ä»¥ç®€è¦ç†è§£æˆä¸­é—´ä»¶DDSä¸ºè¿™ä¸ªæ¶ˆæ¯é¢„ç•™çš„ç¼“å­˜é˜Ÿåˆ—é•¿åº¦ã€‚ <code>RELIABILITY</code>ä¸»è¦æœ‰ä¸¤ç§é€‰é¡¹<code>best_effort</code>å’Œ<code>reliable</code>ï¼Œå®ƒä»¬çš„å…³ç³»ç±»ä¼¼<code>TCP</code>,<code>UDP</code>ã€‚<code>best_effort</code>ä¸èƒ½ä¿è¯æ¯ä¸€ä¸ªæ¶ˆæ¯åˆ°åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œä½†å¯ä»¥ä¿æŒæœ€å¥½çš„å®æ—¶ä¿¡ã€‚<code>reliable</code>ä¿è¯æ¯ä¸€å¸§æ¶ˆæ¯ éƒ½åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œä½†æ˜¯æ— æ³•ä¿è¯å®æ—¶æ€§ã€‚ROS2ä¸­ä¸“é—¨ä¸ºä¼ æ„Ÿå™¨é¢„è®¾äº†ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://docs.ros2.org/foxy/api/rclcpp/classrclcpp_1_1SensorDataQoS.html">SensorDataQoS</a>ï¼Œé‡Œé¢é‡‡ç”¨çš„å°±æ˜¯<code>best_effort</code> çš„è®¾ç½®ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>è®¾ç½®äº†ä¸‰ç§<code>QoS</code>ï¼Œåˆ†åˆ«ä¸ºï¼šåŸå§‹IMUæ•°æ®ã€åŸå§‹é›·è¾¾æ•°æ®ã€æ¡†æ¶å†…éƒ¨ä¼ è¾“</p>
<ol type="1">
<li><p>åŸå§‹IMUæ•°æ®QoS <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief åŸå§‹IMUæ•°æ®çš„QOSï¼Œå› ä¸ºIMUæ•°æ®è¾ƒå°ï¼Œæ‰€ä»¥depthå¯ä»¥è®¾æˆè¾ƒå¤§</span></span><br><span class="line"><span class="type">rmw_qos_profile_t</span> qos_profile_imu&#123;</span><br><span class="line">  RMW_QOS_POLICY_HISTORY_KEEP_LAST,</span><br><span class="line">  <span class="number">2000</span>,</span><br><span class="line">  RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT,</span><br><span class="line">  RMW_QOS_POLICY_DURABILITY_VOLATILE,</span><br><span class="line">  RMW_QOS_DEADLINE_DEFAULT,</span><br><span class="line">  RMW_QOS_LIFESPAN_DEFAULT,</span><br><span class="line">  RMW_QOS_POLICY_LIVELINESS_SYSTEM_DEFAULT,</span><br><span class="line">  RMW_QOS_LIVELINESS_LEASE_DURATION_DEFAULT,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> qos_imu = rclcpp::<span class="built_in">QoS</span>(</span><br><span class="line">    rclcpp::<span class="built_in">QoSInitialization</span>(</span><br><span class="line">      qos_profile_imu.history,</span><br><span class="line">      qos_profile_imu.depth</span><br><span class="line">    ),</span><br><span class="line">    qos_profile_imu);</span><br></pre></td></tr></table></figure></p></li>
<li><p>åŸå§‹é›·è¾¾æ•°æ®QoS <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief åŸå§‹é›·è¾¾æ•°æ®topicçš„QOSï¼Œä¸»è¦æ˜¯best_effortå’Œdepthèµ·ä½œç”¨</span></span><br><span class="line"><span class="type">rmw_qos_profile_t</span> qos_profile_lidar&#123;</span><br><span class="line">  RMW_QOS_POLICY_HISTORY_KEEP_LAST,</span><br><span class="line">  <span class="number">5</span>,</span><br><span class="line">  RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT,</span><br><span class="line">  RMW_QOS_POLICY_DURABILITY_VOLATILE,</span><br><span class="line">  RMW_QOS_DEADLINE_DEFAULT,</span><br><span class="line">  RMW_QOS_LIFESPAN_DEFAULT,</span><br><span class="line">  RMW_QOS_POLICY_LIVELINESS_SYSTEM_DEFAULT,</span><br><span class="line">  RMW_QOS_LIVELINESS_LEASE_DURATION_DEFAULT,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> qos_lidar = rclcpp::<span class="built_in">QoS</span>(</span><br><span class="line">    rclcpp::<span class="built_in">QoSInitialization</span>(</span><br><span class="line">      qos_profile_lidar.history,</span><br><span class="line">      qos_profile_lidar.depth</span><br><span class="line">    ),</span><br><span class="line">    qos_profile_lidar);</span><br></pre></td></tr></table></figure></p></li>
<li><p>ç®—æ³•æ¡†æ¶å†…éƒ¨ä¼ è¾“QoS ç®—æ³•æ¡†æ¶å†…éƒ¨è¦æ±‚æœ‰æœ€é«˜çš„å®æ—¶æ€§ï¼Œå¹¶ä¸”ç”±äºä¼ è¾“ä¸­æœ‰å¾ˆå¤šç‚¹äº‘ç±»å‹çš„æ•°æ®ï¼ˆè¾ƒå¤§ï¼‰ï¼Œå› æ­¤ä½œè€…æŠŠ<code>depth</code>è®¾ç½®ä¸º1 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief ç®—æ³•æ¡†æ¶ä¸­é»˜è®¤çš„QOSï¼Œä¸»è¦æ˜¯depth=1å’Œreliability=best_effortèµ·ä½œç”¨ã€‚å¯¹äºä¼ è¾“å®æ—¶æ€§æœ‰è¦æ±‚ï¼Œä¸è¦æ±‚æ¯ä¸ªæ•°æ®å¯æ¥æ”¶çš„æ¶ˆæ¯ï¼Œä¸€èˆ¬</span></span><br><span class="line"><span class="comment">/// è®¾æˆbest_effortã€‚åœ¨ROS2ä¸­å¯¹äºä¼ æ„Ÿå™¨æ•°æ®ï¼Œæœ‰ä¸€ä¸ªå†…ç½®çš„QOSå«rclcpp::SensorDataQoS()</span></span><br><span class="line"><span class="type">rmw_qos_profile_t</span> qos_profile&#123;</span><br><span class="line">  RMW_QOS_POLICY_HISTORY_KEEP_LAST,</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT,</span><br><span class="line">  RMW_QOS_POLICY_DURABILITY_VOLATILE,</span><br><span class="line">  RMW_QOS_DEADLINE_DEFAULT,</span><br><span class="line">  RMW_QOS_LIFESPAN_DEFAULT,</span><br><span class="line">  RMW_QOS_POLICY_LIVELINESS_SYSTEM_DEFAULT,</span><br><span class="line">  RMW_QOS_LIVELINESS_LEASE_DURATION_DEFAULT,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> qos = rclcpp::<span class="built_in">QoS</span>(</span><br><span class="line">    rclcpp::<span class="built_in">QoSInitialization</span>(</span><br><span class="line">      qos_profile.history,</span><br><span class="line">      qos_profile.depth</span><br><span class="line">    ),</span><br><span class="line">    qos_profile);</span><br></pre></td></tr></table></figure></p></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”æ€»ä½“æµç¨‹è®¤è¯†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-16 19:38:59" itemprop="dateCreated datePublished" datetime="2023-03-16T19:38:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-22 21:31:59" itemprop="dateModified" datetime="2023-03-22T21:31:59+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”æ€»ä½“æµç¨‹è®¤è¯†" href="/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::152660a48ad07f280a45860dc663a523" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="æ€»ä½“æµç¨‹">æ€»ä½“æµç¨‹</h2>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå¹²è´§ã€‚ä¸‹å›¾æ˜¯æ•´ç†å‡ºæ¥çš„<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>æ•´ä½“è¿è¡Œæµç¨‹</p>
<figure>
<img src="./imgs/Design-Pipelines.png" alt="" /><figcaption>Pipeline</figcaption>
</figure>
<h3 id="æ•´ä½“è®¤è¯†">æ•´ä½“è®¤è¯†</h3>
<p>æ‰€è°“çš„ç´§è€¦åˆï¼Œæˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼šIMUæœ¬èº«å°±å¯ä»¥ç§¯åˆ†å‡ºæ¥ä¸€ä¸ªä½å§¿ï¼Œè¿ç»­å¸§çš„ç‚¹äº‘åŒ¹é…ä¹Ÿå¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªä½å§¿ï¼Œå¦‚æœä¸¤è€…åˆ†åˆ«è¿›è¡Œï¼Œç„¶åå†åšä¸€ä¸ªåŠ æƒèåˆï¼Œé‚£ä¹ˆå°±å±äºæ¾è€¦åˆã€‚è€Œä»ä¸Šé¢çš„æ¡†æ¶å›¾ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>çš„èåˆæ¡†æ¶æ•´ä½“å‘ˆç°ä¸€ä¸ª<code>åœˆ</code>ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½ä¸ºä¸‹ä¸€ä¸ªç¯èŠ‚æä¾›ä¿¡æ¯ï¼Œæœ€åä¸€ä¸ªç¯èŠ‚åˆä¸ºç¬¬ä¸€ä¸ªç¯èŠ‚æä¾›ä¿¡æ¯ã€‚åŒæ—¶ï¼Œè€¦åˆä¹‹å¤„è¿˜åœ¨äºä»¥ä¸‹å‡ ç‚¹ï¼š 1. é«˜é¢‘çš„IMUä¿¡æ¯å¯¹æ¿€å…‰é›·è¾¾ç‚¹äº‘åšäº†ç•¸å˜çŸ«æ­£ï¼Œåšäº†ç•¸å˜çŸ«æ­£åçš„ç‚¹äº‘è¢«ç”¨æ¥åšåŒ¹é…è®¡ç®—æ¿€å…‰é‡Œç¨‹è®¡ 2. IMUçš„ç§¯åˆ†ç»“æœè¢«ç”¨æ¥å½“ä½œè¯¥å¸§ç‚¹äº‘çš„åˆå€¼ï¼Œä¸ºç‚¹äº‘åŒ¹é…æä¾›äº†è¾ƒå¥½çš„åˆå§‹ä¼°è®¡ 3. é›·è¾¾é‡Œç¨‹è®¡çš„ç»“æœè¢«ç”¨æ¥è®¡ç®—IMUçš„åå·®ï¼ŒåŒæ—¶ä¹Ÿè¢«ç”¨æ¥æŒç»­çº æ­£IMUé‡Œç¨‹è®¡</p>
<p>è™½ç„¶<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>æ¡†æ¶ä¸­è¿˜å¯ä»¥èåˆ<code>GPS</code>ä¿¡æ¯ï¼Œä½†æ˜¯ä¸»è¦è¿˜æ˜¯å¯¹é›·è¾¾ç‚¹äº‘å’ŒIMUä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºè¾“å…¥æ˜¯ç‚¹äº‘å’ŒIMUæ•°æ®ï¼Œè¾“å‡ºæ˜¯å°è½¦å½“å‰æ—¶åˆ»çš„ä½å§¿ï¼Œå·²ç»å¯¹å†å²æ—¶åˆ»ä½å§¿çš„å¹³æ»‘ã€‚</p>
<ul>
<li><p>æ¡†æ¶çš„å…¥å£æ˜¯ç‚¹äº‘å»ç•¸å˜æ¨¡å—ï¼Œä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å¯¹æ¿€å…‰é›·è¾¾è¿åŠ¨ç•¸å˜åšçŸ«æ­£ï¼Œç„¶åè¾“å‡ºå»å®Œç•¸å˜çš„ç‚¹äº‘ã€‚</p></li>
<li><p>å»å®Œç•¸å˜çš„ç‚¹äº‘ç»è¿‡ç‰¹å¾æå–æ¨¡å—ï¼Œæå–å‡ºè§’ç‰¹å¾ç‚¹å’Œå¹³é¢ç‰¹å¾ç‚¹ï¼Œè¢«å›¾ä¼˜åŒ–æ¨¡å—ä¸­çš„ç‚¹äº‘åŒ¹é…éƒ¨åˆ†ç”¨æ¥åšç‚¹äº‘åŒ¹é…ã€‚</p></li>
<li><p>å›¾ä¼˜åŒ–æ¨¡å—åˆ©ç”¨å»å®Œç•¸å˜åçš„ç‚¹äº‘ä¸å†å²å¸§æ„å»ºçš„å±€éƒ¨åœ°å›¾åšåŒ¹é…ï¼Œå¾—å‡ºè¾ƒå‡†ç¡®çš„é‡Œç¨‹è®¡ç»“æœã€‚åŒæ—¶åˆ©ç”¨å›¾ä¼˜åŒ–ï¼ŒåŠ å…¥å›ç¯æ£€æµ‹å› å­ï¼Œä½¿å¾—æ•´ä½“ä¼°è®¡æ›´ä¸ºå‡†ç¡®é¡ºæ»‘</p></li>
<li><p>IMUé¢„ç§¯åˆ†æ¨¡å—ä»IMUå’Œå›¾ä¼˜åŒ–æ¨¡å—æ¥æ”¶æ•°æ®ï¼Œå¯¹IMUçš„åŸå§‹æ•°æ®åšç§¯åˆ†ï¼Œå¾—å‡ºæ¯ä¸€å¸§ç‚¹äº‘çš„åˆå§‹ä½å§¿ï¼Œæä¾›ç»™å›¾ä¼˜åŒ–æ¨¡å—ä½œä¸ºä¼˜åŒ–åˆå§‹å€¼ã€‚åŒæ—¶åˆä»å›¾ä¼˜åŒ–æ¨¡å—æ‹¿å‡ºç»è¿‡ç‚¹äº‘ã€å›¾ä¼˜åŒ–æ ¡æ­£åçš„é‡Œç¨‹è®¡ç»“æœæ ¡æ­£æœ¬èº«çš„ç»“æœ</p></li>
<li><p>åæ ‡ç³»å‘å¸ƒä¸»è¦æ˜¯ä¸ºäº†<code>RIVZ</code>æ˜¾ç¤ºä¸­ç”¨çš„ï¼Œä¸»è¦å°±æ˜¯å°†å„ç§é‡Œç¨‹è®¡ç»“æœè½¬æ¢æˆ<code>TF</code>åæ ‡å…³ç³»å‘å¸ƒå‡ºå»ã€‚åœ¨åŸå§‹<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­æ˜¯ä¸<code>imuPreintegration</code>æ”¾ç½®åœ¨åŒä¸€ä¸ªæ–‡ä»¶</p></li>
</ul>
<h3 id="è¿åŠ¨ç•¸å˜çŸ«æ­£">è¿åŠ¨ç•¸å˜çŸ«æ­£</h3>
<ul>
<li>ä¸ºä»€ä¹ˆæ¿€å…‰é›·è¾¾æœ‰è¿åŠ¨ç•¸å˜ï¼Ÿ æ¿€å…‰é›·è¾¾é€šè¿‡å‘å°„é«˜èƒ½é‡æ¿€å…‰çº¿æŸï¼Œè®¡ç®—æ¿€å…‰çº¿æŸå¾€è¿”æ—¶é—´ï¼Œå¾—åˆ°è¯¥æ¿€å…‰çº¿æ‰“åˆ°çš„ç‰©ä½“çš„è·ç¦»ã€‚ä»¥æœºæ¢°å¼æ¿€å…‰é›·è¾¾ä¸ºä¾‹ï¼Œé›·è¾¾åœ¨ç»Ÿä¸€æ—¶åˆ»å¯ä»¥å‘é€å¤šæ¡æ¿€å…‰çº¿ï¼ˆ32ã€64ã€128ï¼‰ï¼Œè¿™å¤šæ¡æ¿€å…‰çº¿åœ¨å‚ç›´æ–¹å‘ä¸Šå¯ä»¥æ‰«åˆ°ä¸‰ç»´ç©ºé—´ä¸­å‚ç›´çš„ä¸€æ¡çº¿ï¼Œæ¿€å…‰é›·è¾¾é€šè¿‡ç¯ç»•ä¸€å‘¨çš„æ–¹å¼å¯ä»¥å¯¹360çš„ç©ºé—´åšä¸‰ç»´æˆåƒ <img src="./imgs/lidar.webp" alt="lidar" /></li>
</ul>
<p>ç”±äºæ¿€å…‰é›·è¾¾æ˜¯é€šè¿‡æ¿€å…‰çº¿æŸç¯ç»•ä¸€å‘¨çš„æ–¹å¼æˆåƒä¸€å¸§çš„ç‚¹äº‘ï¼Œé‚£ä¹ˆè¿™ä¸€å¸§ç‚¹äº‘çš„ç‚¹å°±æ˜¯åœ¨ä¸åŒçš„æ—¶é—´æ¢æµ‹çš„ã€‚å¦‚æœæ¿€å…‰çº¿æŸåœ¨ç¯ç»•ä¸€å‘¨çš„è¿‡ç¨‹ä¸­ï¼Œæ¿€å…‰é›·è¾¾æ˜¯åœ¨è¿åŠ¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸€å¸§ç‚¹äº‘å°±ç”±äºæ¿€å…‰é›·è¾¾çš„è¿åŠ¨è€Œå˜å¾—ä¸å‡†ç¡®ï¼Œå› æ­¤éœ€è¦å¯¹å…¶åšæ ¡æ­£ã€‚ <img src="./imgs/livox_lidar_distortion.png" alt="livox_lidar_distortion_removal" /> ï¼ˆä¸Šé¢è¿™å¹…å›¾ç‰‡å¼•ç”¨è‡ªlivoxå®˜ç½‘[Liovox_distortion_removal])</p>
<p>æ¿€å…‰é›·è¾¾è¾“å‡ºçš„æ¯ä¸€å¸§ç‚¹äº‘<span class="math inline">\(P\)</span>ï¼Œé‡Œé¢çš„æ¯ä¸€ä¸ªç‚¹<span class="math inline">\(p_i\)</span>ï¼Œéƒ½æœ‰ä¸€ä¸ªå±æ€§<span class="math inline">\(t_i\)</span>ï¼Œè®°å½•äº†è¯¥ç‚¹è·ç¦»è¯¥å¸§ç‚¹äº‘èµ·å§‹æ—¶åˆ»çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢ä»£ç æ®µé‡Œçš„<code>time</code>å­—æ®µã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imageProjection.cpp 49-60</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VelodynePointXYZIRT</span></span><br><span class="line">&#123;</span><br><span class="line">    PCL_ADD_POINT4D</span><br><span class="line">    PCL_ADD_INTENSITY;</span><br><span class="line">    <span class="type">uint16_t</span> ring;</span><br><span class="line">    <span class="type">float</span> time;</span><br><span class="line">    EIGEN_MAKE_ALIGNED_OPERATOR_NEW</span><br><span class="line">&#125; EIGEN_ALIGN16;</span><br><span class="line"><span class="built_in">POINT_CLOUD_REGISTER_POINT_STRUCT</span> (VelodynePointXYZIRT,</span><br><span class="line">    (<span class="type">float</span>, x, x) (<span class="type">float</span>, y, y) (<span class="type">float</span>, z, z) (<span class="type">float</span>, intensity, intensity)</span><br><span class="line">    (<span class="type">uint16_t</span>, ring, ring) (<span class="type">float</span>, time, time)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>ç”±äºIMUæ˜¯éå¸¸é«˜é¢‘çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºè¯¥å¸§ç‚¹äº‘æˆåƒæ—¶é—´æ®µå†…çš„æ¿€å…‰é›·è¾¾ä½ç§»å’Œæ—‹è½¬çš„å˜æ¢ï¼Œç„¶åé€šè¿‡æ¯ä¸€ä¸ªç‚¹çš„æ—¶é—´<span class="math inline">\(t_i\)</span>ï¼Œå¯ä»¥æ ¹æ®æ—¶é—´è¿›è¡Œæ’å€¼å¾—å‡ºæ¯ä¸€ä¸ªç‚¹ç›¸å¯¹äºèµ·å§‹ç‚¹çš„è½¬æ¢å…³ç³»<span class="math inline">\(T_i\)</span>ã€‚ï¼ˆæ³¨ï¼šLIOSAMé‡Œé¢æ˜¯ç›´æ¥é€šè¿‡æ—¶é—´æˆ³æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯è¿›è¡Œæ’å€¼ï¼‰ã€‚ä»è€Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ¯ä¸ªç‚¹éƒ½è½¬æ¢åˆ°èµ·å§‹ç‚¹çš„åæ ‡ç³» <span class="math display">\[
p_i^0 = T_ip_i
\]</span></p>
<h3 id="ç‚¹äº‘ç‰¹å¾æå–">ç‚¹äº‘ç‰¹å¾æå–</h3>
<p>æ¿€å…‰é‡Œç¨‹è®¡ä¸­ä¸€èˆ¬ä¼šæ¶‰åŠåˆ°ç‚¹äº‘åŒ¹é…ï¼Œå¦‚æœç”¨åŸå§‹ç‚¹äº‘è¿›è¡ŒåŒ¹é…ç”±äºç‚¹æ•°è¿‡å¤šçš„å…³ç³»ï¼Œä¼šå¯¼è‡´è€—æ—¶å¤ªé•¿ï¼Œå› æ­¤<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>ä¸­ç”¨ç±»ä¼¼<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>çš„æ–¹æ³•è¿›è¡Œ<code>è¾¹ç¼˜ç‚¹</code>,<code>å¹³é¢ç‚¹</code>ä¸¤ç±»ç‰¹å¾ç‚¹çš„æå–ï¼Œåé¢ç‚¹äº‘åŒ¹é…éƒ¨åˆ†ä½¿ç”¨è¿™ä¸¤ç§ç‰¹å¾ç‚¹è¿›è¡Œ<code>LM</code>ä¼˜åŒ–æ±‚è§£å‡ºåŒ¹é…å…³ç³»ã€‚</p>
<p>è¿™éƒ¨åˆ†çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œåé¢å…³äºè¿™ä¸ªæ¨¡å—çš„è¯¦ç»†å†…å®¹ä¼šä»‹ç»ï¼Œè¿™é‡Œå”¯ä¸€è¦æ¸…æ¥šçš„æ˜¯ï¼Œè¿™é‡Œçš„ç‚¹äº‘ç‰¹å¾ç‚¹æå–ç”¨çš„æ˜¯æ¯ä¸ªç‚¹çš„æ›²ç‡ï¼Œé€‰æ‹©æ›²ç‡å¤§çš„ç‚¹ä½œä¸ºè¾¹ç¼˜ç‚¹ï¼Œé€‰æ‹©æ›²ç‡å°çš„ç‚¹ä½œä¸ºå¹³é¢ç‚¹ã€‚ä½†æ˜¯æ›²ç‡çš„è®¡ç®—æ˜¯ç”¨æ¯ä¸ªç‚¹å‘¨å›´çš„ç‚¹åˆ°å…¶å¹³å‡è·ç¦»ä½œä¸ºè¿‘ä¼¼ã€‚</p>
<h3 id="imué¢„ç§¯åˆ†æ¨¡å—">IMUé¢„ç§¯åˆ†æ¨¡å—</h3>
<p>è¿™ä¸€ä¸ªæ¨¡å—è™½ç„¶ä»åŸç†å’Œå®ç°ä¸Šæ¥è¯´ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹å¤æ‚ï¼Œä½†æ˜¯ä»åŠŸèƒ½ä¸Šç®€å•æ¥è¯´åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å®æ—¶å¯¹<code>IMUåŸå§‹æ•°æ®</code>åšå¤„ç†ï¼ˆç§¯åˆ†ï¼‰ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªæ—¶åˆ»çš„IMUé‡Œç¨‹è®¡ï¼ˆä¹Ÿæ˜¯6è‡ªç”±åº¦ä½å§¿ï¼‰ï¼Œç„¶åè¯¥ä½å§¿è¢«ç”¨æ¥ä½œä¸ºè¯¥å¸§ç‚¹äº‘çš„åˆå§‹ä¼°è®¡ä½å§¿ï¼Œè¿™ä¸ªåˆå§‹ä¼°è®¡ä½å§¿ä¼šè¢«ç”¨æ¥ä½œä¸ºç‚¹äº‘åŒ¹é…çš„åˆå§‹ä¼°è®¡ã€‚</p>
<h3 id="ç‚¹äº‘åŒ¹é…åŠå›¾ä¼˜åŒ–">ç‚¹äº‘åŒ¹é…åŠå›¾ä¼˜åŒ–</h3>
<p>è¿™æ˜¯æ•´ä¸ªæ¡†æ¶æœ€å¤æ‚çš„ä¸€ä¸ªæ¨¡å—ï¼ˆä¹Ÿè®¸æ˜¯æ²¡æœ‰å¾ˆå¥½è§£è€¦ï¼Ÿï¼‰ã€‚è¿™ä¸ªæ¨¡å—ä¸»è¦åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š 1. ç‚¹äº‘åŒ¹é… 2. å›ç¯æ£€æµ‹ 3. å› å­å›¾æ„å»ºåŠä¼˜åŒ– 4. æ ¹æ®å…³é”®å¸§ä¿¡æ¯æ„å»ºå…¨å±€åœ°å›¾</p>
<p>å…·ä½“å†…å®¹ä¼šåœ¨åé¢çš„ç« èŠ‚å±•å¼€ï¼Œè¿™é‡Œåº”è¯¥è¦æœ‰å‡ ä¸ªæ„Ÿæ€§è®¤è¯†ï¼š 1. ä¸€èˆ¬ç‚¹äº‘ç²¾ç»†åŒ¹é…ï¼ˆæ¯”å¦‚ICPç®—æ³•ï¼‰éœ€è¦æœ‰ä¸€ä¸ªè‰¯å¥½çš„åˆå§‹å€¼ï¼Œè¿™é‡Œçš„åˆå§‹å€¼å¯ä»¥ç†è§£æˆé‡‡ç”¨IMUé¢„ç§¯åˆ†æ¨¡å—çš„è¾“å‡ºã€‚ 2. ç‚¹äº‘åŒ¹é…éƒ¨åˆ†ç”¨çš„æ˜¯æ²¿ç”¨è‡ªLOAM-&gt;LeGO-LOAMçš„ç‚¹äº‘åŒ¹é…ç®—æ³•ï¼Œä¸æ˜¯ä½¿ç”¨ICPã€‚<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM" title="LeGO-LOAM repo">LeGO-LOAM</a>ä¹Ÿæ˜¯<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan" title="ä½œè€…Github">TixiaoShan</a>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM" title="liosamä»“åº“">LIOSAM</a>çš„ä¸Šä¸€ç¯‡ç›¸å…³è®ºæ–‡ 3. å›ç¯æ£€æµ‹æ ¹æ®é‡Œç¨‹è®¡çš„x,y,zæ£€ç´¢ç´§é‚»å¸§ï¼Œç„¶åé€šè¿‡ICPç®—æ³•è®¡ç®—å½“å‰å¸§ä¸è¿‘é‚»å¸§çš„è½¬æ¢å…³ç³» 4. ç»è¿‡ç‚¹äº‘åŒ¹é…åçš„ä½å§¿ä¼šç»è¿‡å›¾ä¼˜åŒ–å¾—å‡ºæ›´å¹³æ»‘çš„ä½å§¿ 5. åœ°å›¾å’Œå› å­å›¾çš„å› å­å®é™…ä¸Šæ˜¯ä»¥å…³é”®å¸§çš„å½¢æ€å­˜åœ¨åç«¯ä¼˜åŒ–éƒ¨åˆ†ï¼Œå…³é”®å¸§çš„é€‰å–ä¼šæ¯”è¾ƒç¨€ç–ï¼Œæ¯”å¦‚è·ç¦»å°ä¸1ç±³ä¸ä¼šé‡‡ç”¨ä¸ºå…³é”®å¸§ã€‚ä¸é‡‡ç”¨ä¸ºå…³é”®å¸§çš„ç‚¹äº‘ä¼šæ‰§è¡Œå®Œç‚¹äº‘åŒ¹é…åå°±ç›´æ¥è¾“å‡ºä½å§¿ã€‚ 6. åœ¨æœ‰æ–°çš„å›ç¯å› å­åŠ å…¥å› å­å›¾åï¼Œä¼šè¿›è¡Œå¤šæ¬¡å› å­å›¾ä¼˜åŒ–å™¨çš„æ›´æ–°æ­¥éª¤ï¼Œç„¶åå°†æ‰€æœ‰å†å²å…³é”®å¸§çš„ä½å§¿éƒ½æ›´æ–°ä¸€é 7. è¿™ä¸ªéƒ¨åˆ†è¿˜æ”¯æŒ<code>GPSé‡Œç¨‹è®¡</code>çš„ç›‘å¬ï¼Œå¹¶å°†<code>GPSé‡Œç¨‹è®¡</code>ä¹ŸåŠ å…¥å› å­å›¾è¿›è¡Œä¼˜åŒ–</p>
<h2 id="åæ ‡ç³»è§„å®š">åæ ‡ç³»è§„å®š</h2>
<h3 id="åæ ‡ç³»è§„å®š-1">åæ ‡ç³»è§„å®š</h3>
<p>åŸæœ‰çš„<code>urdf</code>æ–‡ä»¶åŠ å…¥äº†å¤ªå¤šé¢å¤–æ²¡å¿…è¦çš„å…³èŠ‚ï¼Œå¯¼è‡´<code>rviz</code>ä¸­<code>tf-tree</code>å…³ç³»å¤ªè¿‡å¤æ‚ã€‚ä¸ºäº†ç®€åŒ–åæ ‡ç³»å…³ç³»ï¼Œä½†åŒæ—¶åˆç»´æŒåæ ‡ç³»å…³ç³»æ ‡å‡†åŒ–å¹¶ä¸”ä¸<code>ROS</code>çš„è§„å®šç›¸åŒï¼ˆ<code>ROS</code>ä¸­å…³äºå§¿æ€ä¼°è®¡çš„åæ ‡ç³»å…³ç³»ä¸»è¦å‚è€ƒï¼š<a target="_blank" rel="noopener" href="http://docs.ros.org/en/melodic/api/robot_localization/html/preparing_sensor_data.html">robot_localization_coordinate_system</a>ï¼Œè¿™é‡Œå¯¹é¡¹ç›®ä¸­çš„åæ ‡ç³»å…³ç³»åšäº†ä¸€äº›ç®€åŒ–ä¿®æ”¹ã€‚ æ ¹æ®robot_localizationåŒ…çš„è§„å®šï¼Œæ‰€æœ‰å§¿æ€éƒ½è¦è½¬åˆ°ä¸–ç•Œåæ ‡ç³»ï¼Œé€šå¸¸æ˜¯<code>map</code>æˆ–è€…<code>odom</code>åæ ‡ç³»ã€‚æ‰€æœ‰çš„twistæ•°æ®ï¼Œéƒ½è¦è½¬åˆ°base_linkåæ ‡ç³»ä¸‹å¤„ç†ã€‚</p>
<h3 id="simple-lio-samåæ ‡ç³»è¯´æ˜">Simple-LIO-SAMåæ ‡ç³»è¯´æ˜</h3>
<ol type="1">
<li>æ ¹æ®REPèµ„æ–™ï¼Œä¸€èˆ¬æœ‰4ä¸ªåæ ‡ç³»<code>earth</code>,<code>map</code>,<code>odom</code>,<code>base_link</code>ã€‚ç”±äºåœ¨SLAMä¸­ä¸€èˆ¬æ²¡æœ‰å¼•å…¥åœ°çƒåæ ‡ç³»ã€‚æ‰€ä»¥åœ¨è¿™é‡Œåªæœ‰åä¸‰ä¸ªåæ ‡ç³»ã€‚ åŒæ—¶ï¼Œå¦‚æœæ˜¯ä»¥èµ·å§‹ç‚¹ä½œä¸ºåœ°å›¾åŸç‚¹ï¼Œ<code>map</code>,<code>odom</code>ä¸¤ä¸ªåæ ‡ç³»æ˜¯é‡åˆçš„å…³ç³»ã€‚</li>
<li>å¦å¤–ï¼Œä¸ºäº†å¯ä»¥åœ¨Rivzæ˜¾ç¤ºåŸå§‹ç‚¹äº‘ä¿¡æ¯ï¼Œåˆ™ä¹ŸåŠ å…¥ä¸€ä¸ªé›·è¾¾åæ ‡ç³»ã€‚</li>
<li>ä¸ºäº†è®©åæ ‡ç³»å®šä¹‰è‡ªæ´½ï¼Œè™½ç„¶åœ¨ç®—æ³•ä¸­æ²¡æœ‰ç›´æ¥ç”¨åˆ°ï¼Œä½†æ˜¯IMUåŠ é€Ÿåº¦é€Ÿåº¦å’Œè§’é€Ÿåº¦åº”è¯¥å®šä¹‰åœ¨IMUåæ ‡ç³»ï¼Œå› æ­¤å¼•å…¥IMUåæ ‡ç³»</li>
<li>ä¸ºäº†è®©å®šä¹‰æ›´ä¸ºæ ‡å‡†ï¼Œè¿™é‡Œä¿ç•™<code>map</code>åæ ‡ç³»ï¼Œè™½ç„¶åœ¨SLAMä¸­<code>map</code>,<code>odom</code>å¤§éƒ¨åˆ†æƒ…å†µæ˜¯é‡å çš„</li>
<li>å› æ­¤ï¼Œæ•´ä¸ªspl_lio_samæ¡†æ¶å¯ä»¥ç®€åŒ–æˆ5ä¸ªåæ ‡ç³»ï¼š<code>map</code>, <code>odom</code>,<code>base_link</code>,<code>lidar_link</code>,<code>imu_link</code>åæ ‡ç³»ã€‚å…¶ä¸­ï¼Œ <code>map</code>æ˜¯åœ°å›¾åŸç‚¹ï¼Œåœ¨å»ºå›¾æ—¶æ˜¯èµ·å§‹ç‚¹ï¼Œåœ¨é‡å®šä½æ¨¡å¼æ—¶ï¼Œæ˜¯åœ°å›¾åŸç‚¹ã€‚<code>odom</code>æ˜¯é‡Œç¨‹è®¡åæ ‡ç³»ï¼›<code>base_link</code>æ˜¯è½¦è¾†è‡ªèº«åæ ‡ç³»ã€‚<code>lidar_link</code>åæ ‡ç³»æ˜¯é›·è¾¾åæ ‡ç³»ï¼Œ åœ¨lio_samä¸­æ˜¯ä¸<code>base_link</code>åæ ‡ç³»å¯¹é½çš„ï¼Œä½†æ˜¯<code>lidar_link</code>å­—æ®µä¼šæ ¹æ®é›·è¾¾å‹å·ä¸åŒï¼Œè¢«ä¿®æ”¹ã€‚<code>imu_link</code>åæ ‡ç³»æ˜¯IMUåæ ‡ç³»ï¼Œé…ç½®æ–‡ä»¶ä¸­ æœ‰æŒ‡æ˜IMUåæ ‡ç³»åˆ°Lidaråæ ‡ç³»çš„è½¬æ¢å…³ç³»ã€‚</li>
</ol>
<h3 id="åæ ‡ç³»å…³ç³»çš„å…¶ä»–è¯´æ˜">åæ ‡ç³»å…³ç³»çš„å…¶ä»–è¯´æ˜</h3>
<ol type="1">
<li>ROSçš„Message Headeråªæœ‰ä¸€ä¸ªframe_idå­—æ®µï¼Œè¡¨æ˜è¿™ä¸ªæ•°æ®æ˜¯åœ¨å“ªä¸ªåæ ‡ç³»ä¸‹çš„ã€‚</li>
<li>nav_msgs/Odometryä¸­è¿˜æœ‰ä¸€ä¸ªchild_frame_idå­—æ®µï¼Œnav_msgs/Odometryä¸­çš„twistæ•°æ®åº”è¯¥æ˜¯åœ¨child_frame_idåæ ‡ç³»ä¸‹çš„æ•°æ® &gt; The twist in this message should be specified in the coordinate frame given by the child_frame_id</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">è®°ä¸€æ¬¡è§£å†³rosbag2å†…å­˜é”™è¯¯é—®é¢˜è¿‡ç¨‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-15 18:28:01" itemprop="dateCreated datePublished" datetime="2023-03-15T18:28:01+08:00">2023-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="è®°ä¸€æ¬¡è§£å†³rosbag2å†…å­˜é”™è¯¯é—®é¢˜è¿‡ç¨‹" href="/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::73e4783c1a71c1ae17cdb35318885253" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
</ul>
<h2 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h2>
<p>ç”±äºå·¥ä½œéœ€è¦ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªç¨‹åºï¼Œæ ¹æ®è®°å½•çš„ä¿¡æ¯ï¼Œä»<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>ä¿å­˜çš„æ•°æ®åŒ…æ ¹æ®æ‰“ç‚¹çš„æ—¶é—´æˆ³ï¼Œæå–å‡ºä¸€æ®µæ®µå•ç‹¬çš„æ•°æ®åŒ…ã€‚ ä¸ºäº†å­˜å‚¨ç©ºé—´è€ƒè™‘ï¼Œä¿å­˜æ—¶ä»¥åŠæå–æ—¶éƒ½æŒ‡å®šäº†ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble#recording-with-compression">å‹ç¼©çš„æ–¹å¼</a>è¿›è¡Œå­˜å‚¨ã€‚å‹ç¼©å™¨å’Œå‹ç¼©æ¨¡å¼å¦‚ä¸‹ï¼š <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line"><span class="attr">compression_mode:</span> <span class="string">message</span></span><br></pre></td></tr></table></figure></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>ä¸ä»…æœ‰å‘½ä»¤è¡Œå·¥å…·ï¼ŒåŒæ—¶è¿˜å¼€æ”¾APIç»™å¼€å‘è€…ä½¿ç”¨ã€‚<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>è¿˜æä¾›äº†<code>convert</code>åŠŸèƒ½ï¼Œå¯ä»¥å¯¹å½•ä¸‹æ¥çš„bagfileè¿›è¡Œ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble#converting-bags">äºŒæ¬¡æå–</a>ã€‚å› æ­¤å¼€å‘è¿™éƒ¨åˆ†åŠŸèƒ½å¯ä»¥å‚è€ƒæºç é‡Œé¢çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/humble/rosbag2_transport/src/rosbag2_transport/bag_rewrite.cpp">bag_rewriter.cpp</a></p>
<h2 id="å¼€å‘ç¯å¢ƒ">å¼€å‘ç¯å¢ƒ</h2>
<blockquote>
<p>ROS: ROS2-humble</p>
</blockquote>
<blockquote>
<p>OS: ubuntu 22.04</p>
</blockquote>
<blockquote>
<p>language: cpp17</p>
</blockquote>
<blockquote>
<p>rosbag2: 0.15.4-2jammy.20230118.031755</p>
</blockquote>
<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>å®Œæˆä¸Šè¿°æ•°æ®æå–åŠŸèƒ½åè¿›è¡Œæµ‹è¯•ï¼Œå‘ç°æå–çš„æ—¶å€™å¦‚æœåŒæ—¶æå–å¤šä¸ªç›®æ ‡ï¼ˆæ„å»ºå¤šä¸ªwriterï¼Œè¯»å–messageåè¿›è¡Œå†™æ“ä½œï¼Œ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_transport/src/rosbag2_transport/bag_rewrite.cpp#L135">rosbag2æºç å‚è€ƒéƒ¨åˆ†</a>ï¼Œå¹¶ä¸”éƒ½è¿›è¡Œå‹ç¼©çš„æ—¶å€™ï¼Œä¼šæœ‰<code>core dump</code>ï¼Œé”™è¯¯ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corrupted size vs. prev_size</span><br><span class="line">[ros2run]: Aborted</span><br></pre></td></tr></table></figure></p>
<p>ç„¶è€Œåœ¨å…¶ä»–æƒ…å†µï¼š1.åŒæ—¶æå–å¤šä¸ªç›®æ ‡ï¼Œä½†æ˜¯ä¸è¿›è¡Œå‹ç¼©ï¼›2.æå–ä¸€ä¸ªç›®æ ‡ï¼Œè¿›è¡Œå‹ç¼©ï¼›çš„æ—¶å€™ï¼Œç¨‹åºéƒ½å¯ä»¥æ­£å¸¸è¿è¡Œ</p>
<p>ä¸ºäº†ç¡®ä¿ä¸æ˜¯è‡ªå·±ç¼–å†™çš„ç¨‹åºå¯¼è‡´çš„é—®é¢˜ï¼Œåˆä½¿ç”¨<code>rosbag2 cli</code>è¿›è¡Œç±»ä¼¼çš„å°è¯•ã€‚æ ¹æ®<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble#converting-bags">converting-bags</a>çš„è¯´æ˜ï¼Œæˆ‘ä½¿ç”¨ä¸‹é¢çš„<code>output_options.yaml</code>è¿›è¡Œæ•°æ®è½¬æ¢ï¼š <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output_bags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag01</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag02</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br></pre></td></tr></table></figure></p>
<p>ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæå– <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag convert -i ./path/to/bag/file -o output_options.yaml</span><br></pre></td></tr></table></figure></p>
<p>æœä¸å…¶ç„¶ï¼Œç›´æ¥ä½¿ç”¨<code>rosbag2</code>çš„åŒ…ä¹Ÿä¼šæœ‰<code>core</code>é—®é¢˜ï¼Œä¸è¿‡æŠ¥çš„ä¿¡æ¯ä¼šæœ‰åŒºåˆ«ï¼Œä¸åŒæ¬¡è¿è¡ŒæŠ¥çš„ä¿¡æ¯è¿˜ä¸ä¸€æ ·ï¼Œä¸»è¦æ˜¯ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">malloc(): unsorted double linked list corrupted</span><br><span class="line">free(): corrupted unsorted chunks</span><br><span class="line">corrupted double-linked list</span><br></pre></td></tr></table></figure></p>
<h2 id="é—®é¢˜å¤ç°">é—®é¢˜å¤ç°</h2>
<p>ç®€å•èµ·è§å¯ä»¥ç›´æ¥ä½¿ç”¨<code>rosbag2 cli</code>å¤ç°è¿™ä¸ªé—®é¢˜ 1. å‡†å¤‡ä¸€ä¸ªros2çš„bagåŒ… 2. æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶å‘½åä¸ºï¼š<code>output_options.yaml</code>ï¼Œå¹¶å¡«å…¥ä¸‹é¢å†…å®¹ï¼š <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output_bags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag01</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag02</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br></pre></td></tr></table></figure> 3. æ‰§è¡Œæ•°æ®è½¬æ¢å‘½ä»¤ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /opt/ros/humble/setup.bash</span><br><span class="line">ros2 bag convert -i ./path/to/bag/file -o output_options.yaml</span><br></pre></td></tr></table></figure></p>
<h2 id="é—®é¢˜å®šä½">é—®é¢˜å®šä½</h2>
<h3 id="å¢åŠ æ—¥å¿—">å¢åŠ æ—¥å¿—</h3>
<p>ç”±äºå·²ç»ç¡®è®¤ä¸æ˜¯è‡ªå·±å†™çš„ç¨‹åºçš„é—®é¢˜ï¼Œæ‰€ä»¥å…¶å®å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ ### gdbæ£€æŸ¥ cppç¨‹åºæ’æŸ¥è¿˜æ˜¯éœ€è¦ä¸Šgdbï¼Œä¸è¦è‡ªå·±çæŠ˜è…¾çæ”¹ä»£ç ã€‚<a href="#appendA">æ–‡æœ«è®°å½•</a>å¦‚ä½•åœ¨<code>ubuntu</code>ä¸Šç”Ÿæˆ<code>coreæ–‡ä»¶</code>ã€‚ è¿è¡Œä¸€æ¬¡ç¨‹åºï¼Œç”Ÿæˆ<code>coreæ–‡ä»¶</code>åä½¿ç”¨gdbæ£€æŸ¥é”™è¯¯å †æ ˆ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdb ros_ws/install/package/lib/package/excutable /path/to/corefile</span><br><span class="line"></span><br><span class="line">bt  <span class="comment"># gdbå‘½ä»¤ï¼Œæ‰“å°é”™è¯¯å †æ ˆ</span></span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯</p>
<figure>
<img src="./imgs/backtraces.png" alt="" /><figcaption>backtraces</figcaption>
</figure>
<p>è™½ç„¶æ˜¯åœ¨å­çº¿ç¨‹ä¸­å‡ºé”™ï¼Œä½†æ˜¯å¤§æ¦‚ä¹Ÿèƒ½çœ‹åˆ°æ˜¯åœ¨<code>rosbag2_compression::SequentialCompressonWriter::compression_thread_fn()</code>å‡½æ•°ä¸­å‡ºé”™ã€‚ è¿™ä¹Ÿç¬¦åˆäº†ç°è±¡ï¼Œåªåœ¨è¿›è¡Œå‹ç¼©çš„æ—¶å€™ä¼šå‡ºé”™ã€‚</p>
<p>åŒæ—¶ï¼Œä»é”™è¯¯å †æ ˆé‡Œå¯ä»¥çœ‹å‡ºåº”è¯¥æ˜¯<code>rosbag2_compression_zstd::ZstdCompressor</code>åœ¨è¿›è¡Œå‹ç¼©å¤„ç†çš„æ—¶å€™è°ƒç”¨<code>rcutils_uint8_array_resize</code>å‡½æ•°å‡ºé”™ã€‚</p>
<h3 id="å¯¹æ¯”ä¸åŒçš„writer">å¯¹æ¯”ä¸åŒçš„writer</h3>
<p>ç”±äºåœ¨è¿›è¡Œå¤šä¸ª<code>writers</code>å†™æ•°æ®ï¼Œä½†æ˜¯ä¸æ‰§è¡Œå‹ç¼©çš„æ—¶å€™å¹¶æ²¡æœ‰ç›¸å…³é—®é¢˜å‘ç”Ÿï¼Œæ‰€ä»¥å¯ä»¥å¯¹æ¯”ä¸€ä¸‹æ™®é€šçš„<code>writer</code>å’Œ<code>SequentialCompressonWriter</code>åœ¨å†™å‡½æ•°ä¸­çš„åŒºåˆ« #### æ™®é€šçš„writerï¼Œå³rosbag2_cpp::SequentialWriter æ™®é€šçš„<code>writer</code>ï¼Œå³<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/humble/rosbag2_cpp/src/rosbag2_cpp/writers/sequential_writer.cpp">rosbag2_cpp::SequentialWriter</a>ä¸­ï¼Œ<code>void SequentialWriter::write(std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; message)</code>å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_cpp/src/rosbag2_cpp/writers/sequential_writer.cpp#L328-L337">æ ¸å¿ƒä»£ç </a>æ˜¯è¿™å‡ è¡Œ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (storage_options_.max_cache_size == <span class="number">0u</span>) &#123;</span><br><span class="line"><span class="comment">// If cache size is set to zero, we write to storage directly</span></span><br><span class="line">storage_-&gt;<span class="built_in">write</span>(converted_msg);</span><br><span class="line">++topic_information-&gt;message_count;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// Otherwise, use cache buffer</span></span><br><span class="line">message_cache_-&gt;<span class="built_in">push</span>(converted_msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”±äº<code>bag_rewrite</code>åœ¨è°ƒç”¨<code>writer</code>çš„æ—¶å€™ï¼Œ<code>max_cache_size</code>å§‹ç»ˆ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_transport/src/rosbag2_transport/bag_rewrite.cpp#L191">è®¾ç½®ä¸º0</a>ï¼Œå› æ­¤æ‰§è¡Œçš„æ˜¯<code>if</code>åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è°ƒç”¨åº•å±‚çš„æ•°æ®åº“å°è£…ç±»ç›´æ¥å†™å…¥ç¡¬ç›˜ã€‚</p>
<h4 id="å¸¦å‹ç¼©çš„writerå³rosbag2_compressionsequentialcompressionwriter">å¸¦å‹ç¼©çš„writerå³rosbag2_compression::SequentialCompressionWriter</h4>
<p>å¸¦å‹ç¼©åŠŸèƒ½çš„writerè¿™éƒ¨åˆ†çš„é€»è¾‘å¢åŠ äº†ä¸€ä¸ªå•ç‹¬çº¿ç¨‹åšå‹ç¼©å¤„ç†ï¼Œå‡½æ•°<code>void SequentialCompressionWriter::write(   std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; message)</code>çš„æ ¸å¿ƒéƒ¨åˆ†ä¸»è¦æ˜¯<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_compression/src/rosbag2_compression/sequential_compression_writer.cpp#L317-L321">è¿™å‡ è¡Œ</a> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(compressor_queue_mutex_)</span></span>;</span><br><span class="line"><span class="keyword">while</span> (compressor_message_queue_.<span class="built_in">size</span>() &gt; compression_options_.compression_queue_size) &#123;</span><br><span class="line">    compressor_message_queue_.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line">compressor_message_queue_.<span class="built_in">push</span>(message);</span><br><span class="line">compressor_condition_.<span class="built_in">notify_one</span>();</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­çš„<code>compressor_message_queue_</code>åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å‡½æ•°<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_compression/src/rosbag2_compression/sequential_compression_writer.cpp#L63">void SequentialCompressionWriter::compression_thread_fn()</a>è¢«å¤„ç†ã€‚ è¿™é‡Œé¢æœ‰ä¸€ä¸ªå¯¹ä¼ å…¥çš„<code>SerializedMessageSharedPtr</code>å¯¹è±¡ä¸­çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_compression/src/rosbag2_compression/sequential_compression_writer.cpp#L96">å†…å­˜ç›´æ¥è¿›è¡Œå¤„ç†</a></p>
<h4 id="é‡æ–°æŸ¥çœ‹è°ƒç”¨apiçš„ä»£ç ">é‡æ–°æŸ¥çœ‹è°ƒç”¨APIçš„ä»£ç </h4>
<p>è°ƒç”¨<code>rosbag2 API</code>è¿›è¡Œæ•°æ®å†™æ“ä½œçš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create rosbag2_storage::StorageOptions</span></span><br><span class="line">rosbag2_storage::StorageOptions storageOptions;</span><br><span class="line"><span class="comment">// create reader</span></span><br><span class="line"><span class="keyword">auto</span> inputReader = rosbag2_transport::ReaderWriterFactory::<span class="built_in">make_reader</span>(storageOptions);</span><br><span class="line"><span class="comment">// open file</span></span><br><span class="line">inputReader-&gt;<span class="built_in">open</span>(storageOptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create multiplt writers</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// perform write</span></span><br><span class="line"><span class="keyword">while</span> (inputReader-&gt;<span class="built_in">has_next</span>())</span><br><span class="line">&#123;</span><br><span class="line">    std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; nextMsg = <span class="literal">nullptr</span>;</span><br><span class="line">    nextMsg = inputReader-&gt;<span class="built_in">read_next</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp; writer : outputWriters):</span><br><span class="line">    &#123;</span><br><span class="line">        writer-&gt;<span class="built_in">write</span>(nextMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></p>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä»<code>reader</code>ä¸­æ‹¿åˆ°çš„<code>SerializedBagMessage</code>æ˜¯ä»¥å…±äº«æŒ‡é’ˆçš„å½¢å¼ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬æŠŠå…±äº«æŒ‡é’ˆä¼ ç»™ä¸åŒçš„<code>writer</code>æ—¶ï¼Œä¸åŒçš„<code>writer</code>å†…éƒ¨åŒæ—¶å¯¹åŒä¸€å—å†…å­˜è¿›è¡Œæ•°æ®å‹ç¼©å¤„ç†ï¼Œå› æ­¤ä¹Ÿå°±å¯¼è‡´äº†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€å—åœ°å€ç©ºé—´çš„é”™è¯¯ã€‚</strong></p>
<h2 id="ä¿®å¤">ä¿®å¤</h2>
<p>ç”±äºä¸æƒ³æ›´æ”¹<code>rosbag2</code>çš„ä»£ç ï¼Œå› æ­¤æƒ³åŠæ³•åœ¨è°ƒç”¨å±‚è§£å†³ã€‚æ—¢ç„¶é—®é¢˜å…±äº«æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜è¢«ä¸åŒçº¿ç¨‹åŒæ—¶å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨æ¯ä¸€æ¬¡è°ƒç”¨<code>writer-&gt;write(nextMsg)</code>çš„æ—¶å€™å¯¹<code>nextMsg</code>æ‰§è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œè®©ä¸åŒçš„<code>writer</code>æ“ä½œä¸åŒå†…å­˜å³å¯ã€‚ è¿™é‡Œæ¯”è¾ƒå¤æ‚çš„æ˜¯<code>SerializedBagMessage</code>ä¸­ä½¿ç”¨ä¸€ä¸ªæŒ‡å‘<code>rcutils_uint8_array_t</code>çš„æŒ‡é’ˆå¯¹å†…å­˜è¿›è¡Œç®¡ç†ã€‚è€Œ<code>rcutils_uint8_array_t</code>é‡Œé¢åˆä½¿ç”¨ä¸€ä¸ªè£¸<code>uint8_t*</code>æŒ‡é’ˆæŒ‡å‘ç®¡ç†çš„å†…å­˜ã€‚åŒæ—¶<code>rcutils</code>çš„æ–‡æ¡£ä¸å¤Ÿè¯¦ç»†ï¼Œä¹Ÿæ²¡æœ‰æä¾›å‡½æ•°å¯¹<code>rcutils_uint8_array_t</code>æ‰§è¡Œæ·±æ‹·è´æ“ä½œã€‚ä¸è¿‡åªè¦èƒ½å¤Ÿæ˜ç™½ä¸Šé¢çš„å†…å­˜ç®¡ç†å…³ç³»ï¼Œä¿®å¤èµ·æ¥ä¸å¤ªå›°éš¾ï¼Œå…³äº<code>rcutils_uint8_array_t</code>çš„æ“ä½œå¯ä»¥å‚è€ƒ<code>rosbag2</code>é‡Œé¢çš„ä»£ç ï¼Œæœ€ç»ˆä¿®å¤çš„ä»£ç å¦‚ä¸‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">...create reader &amp;&amp; writer</span><br><span class="line"><span class="comment">// perform write</span></span><br><span class="line"><span class="keyword">while</span> (inputReader-&gt;<span class="built_in">has_next</span>())</span><br><span class="line">&#123;</span><br><span class="line">    std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; nextMsg = <span class="literal">nullptr</span>;</span><br><span class="line">    nextMsg = inputReader-&gt;<span class="built_in">read_next</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp; writer : outputWriters):</span><br><span class="line">    &#123;</span><br><span class="line">        std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; nextMsg_copy = std::<span class="built_in">make_shared</span>&lt;rosbag2_storage::SerializedBagMessage&gt;();</span><br><span class="line">        <span class="comment">// æ–°å»ºrcutils_uint8_array_téœ€è¦æŒ‰ç…§ä¸‹é¢è¿™æ ·çš„æ“ä½œ</span></span><br><span class="line">        nextMsg_copy-&gt;serialized_data = std::<span class="built_in">shared_ptr</span>&lt;<span class="type">rcutils_uint8_array_t</span>&gt;(</span><br><span class="line">        <span class="keyword">new</span> <span class="type">rcutils_uint8_array_t</span>,</span><br><span class="line">        [](<span class="type">rcutils_uint8_array_t</span> * msg) &#123;</span><br><span class="line">        <span class="keyword">auto</span> fini_return = <span class="built_in">rcutils_uint8_array_fini</span>(msg);</span><br><span class="line">        <span class="keyword">delete</span> msg;</span><br><span class="line">        <span class="keyword">if</span> (fini_return != RCUTILS_RET_OK) &#123;</span><br><span class="line">            <span class="built_in">RCLCPP_ERROR_STREAM</span>(</span><br><span class="line">            rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rosbag2_cpp&quot;</span>),</span><br><span class="line">            <span class="string">&quot;Failed to destroy serialized message: &quot;</span> &lt;&lt; <span class="built_in">rcutils_get_error_string</span>().str);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºåéœ€è¦æ‰§è¡Œå†…å­˜åˆå§‹åŒ–</span></span><br><span class="line">        <span class="type">rcutils_allocator_t</span> allocator = <span class="built_in">rcutils_get_default_allocator</span>();</span><br><span class="line">        <span class="keyword">auto</span> ret = <span class="built_in">rcutils_uint8_array_init</span>(</span><br><span class="line">            nextMsg_copy-&gt;serialized_data.<span class="built_in">get</span>(),</span><br><span class="line">            nextMsg-&gt;serialized_data-&gt;buffer_capacity,</span><br><span class="line">            &amp;allocator);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (ret != RCUTILS_RET_OK)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">RCLCPP_ERROR</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Init arrry failed with ret code = %d&quot;</span>, ret);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤åˆ¶å†…å®¹</span></span><br><span class="line">        nextMsg_copy-&gt;topic_name = nextMsg-&gt;topic_name;</span><br><span class="line">        nextMsg_copy-&gt;time_stamp = nextMsg-&gt;time_stamp;</span><br><span class="line">        nextMsg_copy-&gt;serialized_data-&gt;buffer_capacity = nextMsg-&gt;serialized_data-&gt;buffer_capacity;</span><br><span class="line">        nextMsg_copy-&gt;serialized_data-&gt;buffer_length = nextMsg-&gt;serialized_data-&gt;buffer_length;</span><br><span class="line">        <span class="comment">// å¤åˆ¶å†…å­˜</span></span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="type">void</span>*)nextMsg_copy-&gt;serialized_data-&gt;buffer,</span><br><span class="line">                (<span class="type">void</span>*)nextMsg-&gt;serialized_data-&gt;buffer, nextMsg-&gt;serialized_data-&gt;buffer_length);</span><br><span class="line">        writer-&gt;<span class="built_in">write</span>(nextMsg_copy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<p>è¿™ä¸ªbugåŒæ—¶æäº¤åˆ°<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>ä»“åº“<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/issues/1262">issuesä¸­</a>ï¼Œçœ‹çœ‹åé¢æœ‰æ²¡æœ‰æœºä¼šä¿®å¤å¹¶æäº¤PR</p>
<h2 id="é™„å½•aubuntu-coreæ–‡ä»¶ç”Ÿæˆ">é™„å½•Aï¼šubuntu coreæ–‡ä»¶ç”Ÿæˆ</h2>
<div id="appendA">

</div>
<ol type="1">
<li><p>ubuntuæœ‰ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯æœé›†ç³»ç»Ÿapportï¼Œå¿…é¡»è¦å…³æ‰ä¹‹åæ‰èƒ½ç”Ÿæˆcoreæ–‡ä»¶ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service apport status</span><br><span class="line">sudo service apport stop</span><br><span class="line">sudo systemctl apport disble  <span class="comment"># ä¼¼ä¹æ— æ³•å…³é—­å¼€æœºå¯åŠ¨ï¼Œæ¯æ¬¡éœ€è¦çš„æ—¶å€™éœ€è¦æ‰‹å·¥ç¡®è®¤æ˜¯å¦å…³é—­</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>è®¾ç½®coreæ–‡ä»¶å¤§å°ï¼Œé»˜è®¤æ˜¯0ï¼Œæ‰€ä»¥ä¸ä¼šç”Ÿæˆcoreæ–‡ä»¶ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c  <span class="comment"># è‹¥ç»“æœæ˜¯0ï¼Œåˆ™ä¸ä¼šç”Ÿæˆcoreæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited  <span class="comment"># ä¸é™åˆ¶coreæ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -c unlimited&quot;</span> &gt;&gt; ~/.bashrc  <span class="comment"># é€‰æ‹©å½“å‰ä½¿ç”¨çš„ç»ˆç«¯</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -c unlimited&quot;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure></p></li>
<li><p>è®¾ç½®corefileè·¯å¾„(æ³¨æ„ï¼Œè·¯å¾„å¿…é¡»æ™®é€šç”¨æˆ·å¯è¯»ï¼ï¼‰ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /corefile</span><br><span class="line">sudo <span class="built_in">chmod</span> 777 /corefile</span><br><span class="line">sysctl -w kernel.core_pattern=/corefile/core-%e-%p-%t</span><br></pre></td></tr></table></figure></p></li>
<li><p><code>CMakeLists.txtåŠ ä¸Š``Debugæ¨¡å¼</code>ä¸‹ä¸è¿›è¡Œç¼–è¯‘å™¨ä¼˜åŒ– <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In CMakeLists.txt</span></span><br><span class="line">SET(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot;<span class="variable">$ENV</span>&#123;CXXFLAGS&#125; -O0 -Wall -g -ggdb -Wno-unused-parameter&quot;</span>)  </span><br></pre></td></tr></table></figure> æ³¨æ„åœ¨ç¼–è¯‘<code>ROS2</code>åŒ…çš„æ—¶å€™è¦æŒ‡æ˜<code>Debug</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --packages-select package_name --cmake-args -DCMAKE_BUILD_TYPE=Debug</span><br></pre></td></tr></table></figure></p></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-14 19:49:06" itemprop="dateCreated datePublished" datetime="2023-03-14T19:49:06+08:00">2023-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ç¯å¢ƒæ­å»ºä¸è¿è¡Œ" href="/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::b824fa070f036b85c958cacd75daa48f" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="è¿è¡Œç¯å¢ƒæ­å»º">è¿è¡Œç¯å¢ƒæ­å»º</h2>
<p>æœ¬é¡¹ç›®æä¾›åŸºäº<code>ROS2-humble</code>çš„é•œåƒï¼Œå¹¶æä¾›è„šæœ¬å¯ç›´æ¥åœ¨é•œåƒä¸­å¯åŠ¨å¯è§†åŒ–ç¨‹åº ### æ•°æ® æœ¬é¡¹ç›®åŒæ—¶æä¾›è½¬ä¸º<code>rosbag2</code>æ ¼å¼çš„æ•°æ®åŒ…ï¼Œ<a href="">ä¸‹è½½åœ°å€</a> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DATA_DIR=/path/to/download/ros2bag/dir</span><br></pre></td></tr></table></figure> æœ¬é¡¹ç›®ä¸­é»˜è®¤çš„é…ç½®æ–‡ä»¶<code>params_default.yaml</code>å¯ä»¥ç›´æ¥è¿è¡Œä¸‹é¢çš„æ•°æ®ï¼š - park_dataset - walking_dataset - garden_dataset</p>
<h3 id="ç¯å¢ƒéƒ¨ç½²">ç¯å¢ƒéƒ¨ç½²</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:zeal-up/Simple-LIO-SAM.git</span><br><span class="line"><span class="built_in">cd</span> Simple-LIO-SAM</span><br><span class="line">./docker_run.sh -h  <span class="comment"># show help message</span></span><br><span class="line">./docker_run.sh -c /path/to/code/repo -d <span class="variable">$DATA_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ./docker_into.sh  # enter the container next time</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘">ç¼–è¯‘</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Simple-LIO-SAM</span><br><span class="line">./docker_into.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢å‘½ä»¤åœ¨é•œåƒä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">cd</span> ~/ros_ws/</span><br><span class="line"><span class="built_in">mkdir</span> src &amp;&amp; <span class="built_in">cd</span> src &amp;&amp;<span class="built_in">ln</span> -s /home/splsam/codes ./</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">source</span> /opt/ros/humble/setup.bash</span><br><span class="line">colcon build --packages-select spl_lio_sam</span><br></pre></td></tr></table></figure>
<h3 id="è¿è¡Œ">è¿è¡Œ</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dockeré•œåƒä¸‹è¿è¡Œ</span></span><br><span class="line"><span class="built_in">cd</span> ~/ros_ws</span><br><span class="line"><span class="built_in">source</span> ./install/setup.bash</span><br><span class="line">ros2 launch spl_lio_sam run.launch.py </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¼€ç»ˆç«¯</span></span><br><span class="line"><span class="built_in">cd</span> Simple-LIO-SAM</span><br><span class="line">./docker_into.sh</span><br><span class="line"><span class="built_in">cd</span> data/ros2/</span><br><span class="line">ros2 bag play ./park_dataset/ --topics /points_raw /imu_raw</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæ—¶ç”»é¢ï¼š <img src="./imgs/runtime.gif" alt="SplRunParkDataset" /></p>
<h2 id="å¼€å‘ç¯å¢ƒæ­å»º">å¼€å‘ç¯å¢ƒæ­å»º</h2>
<p>ç”±äºæœ¬é¡¹ç›®ä½œè€…åœ¨ä½¿ç”¨<code>vscode</code>å¼€å‘<code>c++</code>æ—¶ç»å¸¸ä¼šé‡åˆ°æ— æ³•å¿«æ·è·³è½¬é—®é¢˜ï¼ˆå…¶å®ç¬”è€…å‘ç°æœ‰å¾ˆå¤šäººåœ¨ä½¿ç”¨vscodeå¼€å‘æ—¶éƒ½ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œ å› æ­¤ä¸€å¹¶æŠŠè§£å†³æ–¹æ¡ˆå†™å…¥é¡¹ç›®ä¸­ã€‚</p>
<h3 id="vscode-cppå‡½æ•°å¿«æ·è·³è½¬">vscode Cppå‡½æ•°å¿«æ·è·³è½¬</h3>
<ol type="1">
<li>å®‰è£…cppæ‰©å±• vscodeä¾§è¾¹æ è¿›å…¥æ‰©å±•é€‰é¡¹ï¼ˆctrl+shift+x)ï¼Œæœç´¢<code>c++</code>ï¼Œå®‰è£…<code>C/C++ Extension Pack</code></li>
<li>æ‰“å¼€é¡¹ç›® &gt; File-&gt;Open Folder</li>
<li>ä¿å­˜ä¸ºå·¥ä½œåŒº &gt; File-&gt;Save Workspace as é€‰æ‹©ç›®æ ‡ç›®å½•åŠæ–‡ä»¶ï¼ˆé»˜è®¤ä»¥<code>.code-workspace</code>ç»“å°¾ï¼‰</li>
<li>æ‰“å¼€åˆšæ‰ä¿å­˜çš„å·¥ä½œåŒºæ–‡ä»¶ &gt; File-&gt;Open File é€‰æ‹©åˆšæ‰æ‰“å¼€çš„å·¥ä½œåŒºæ–‡ä»¶</li>
<li>å¯¹å·¥ä½œåŒºæ·»åŠ <code>c++</code>åº“æ£€ç´¢è·¯å¾„ åœ¨åˆšæ‰æ‰“å¼€çš„å·¥ä½œåŒºæ–‡ä»¶ä¸­ï¼Œå‚è€ƒä»¥ä¸‹æ ¼å¼ç¼–è¾‘ <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;folders&quot;:</span> [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;path&quot;:</span> <span class="string">&quot;../Simple-LIO-SAM&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">		<span class="attr">&quot;C_Cpp.default.includePath&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;$&#123;default&#125;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/usr/include/**&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/usr/include/c++/9/&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/usr/lib/gcc/x86_64-linux-gnu/8/include/&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/include/**&quot;</span>,</span><br><span class="line"></span><br><span class="line">			<span class="string">&quot;$&#123;workspaceFolder&#125;/include&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">//</span> <span class="string">é‡ç‚¹ï¼ï¼è¿™é‡Œçš„è·¯å¾„è¦è®¾ç½®ä¸ºros2å·¥ä½œç©ºé—´ä¸‹spl_lio_samç¼–è¯‘å‡ºæ¥çš„å¤´æ–‡ä»¶</span></span><br><span class="line">			<span class="string">&quot;/path/to/ros2_ws/install/spl_lio_sam/include/spl_lio_sam&quot;</span></span><br><span class="line"></span><br><span class="line">		],</span><br><span class="line">		<span class="attr">&quot;C_Cpp.files.exclude&quot;:</span> &#123;</span><br><span class="line">			<span class="string">&quot;**/.vscode&quot;</span><span class="string">:</span> <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;**/.vs&quot;</span><span class="string">:</span> <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;C_Cpp.default.cStandard&quot;:</span> <span class="string">&quot;c17&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;C_Cpp.default.cppStandard&quot;:</span> <span class="string">&quot;c++17&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;python.analysis.include&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span>,</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">&quot;python.autoComplete.extraPaths&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span>,</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">&quot;python.analysis.extraPaths&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span>,</span><br><span class="line">		],</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="å¯¹å·¥ä½œåŒºæ–‡ä»¶çš„è§£é‡Š">å¯¹å·¥ä½œåŒºæ–‡ä»¶çš„è§£é‡Š</h3>
<p>å…¶å®ä¸»è¦èµ·ä½œç”¨çš„æ˜¯å·¥ä½œåŒºæ–‡ä»¶ä¸­<code>settings-&gt;C_Cpp.default.includePath</code>å­—æ®µå†…å®¹ï¼Œvscodeçš„cppæ‰©å±•ä¼šè¯»å–è¯¥å·¥ä½œç©ºé—´æ–‡ä»¶ä¸‹ çš„è¿™ä¸ªå­—æ®µï¼Œå¹¶å°†é‡Œé¢çš„è·¯å¾„è¿›è¡Œè§£æåŠ åˆ°å¤´æ–‡ä»¶è§£æè·¯å¾„ä¸­ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªè·¯å¾„è¦æ³¨æ„çš„</p>
<ol type="1">
<li><code>"$&#123;workspaceFolder&#125;/include"</code>ï¼Œä¹Ÿå°±æ˜¯Simple-LIO-SAMä»“åº“ä¸‹çš„includeè·¯å¾„</li>
<li><code>"/path/to/ros2_ws/install/spl_lio_sam/include/spl_lio_sam"</code>ï¼Œè¿™ä¸ªè¦è®¾ç½®æˆä½ çš„roså·¥ä½œç©ºé—´å¯¹åº”çš„è·¯å¾„</li>
</ol>
<p>å¦å¤–ï¼Œå¦‚æœå‘ç°è‡ªå·±è·¯å¾„è®¾ç½®å®Œæˆï¼Œä½†æ˜¯æœ‰äº›å‡½æ•°è¿˜æç¤ºä¸‹åˆ’çº¿ï¼Œè¦çœ‹çœ‹æ˜¯ä¸æ˜¯é‚£äº›å‡½æ•°æ˜¯<code>c++17</code>æˆ–è€…æ›´é«˜çš„æ ‡å‡†æ‰æ”¯æŒçš„ç‰¹æ€§ï¼Œåœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­ è®¾ç½®c++/cæ ‡å‡†ä¸º17</p>
<h3 id="å…¶ä½™æ³¨æ„">å…¶ä½™æ³¨æ„</h3>
<ol type="1">
<li>å°½é‡ä¸è¦ç”¨<code>/path/**</code>çš„æ ¼å¼æ·»åŠ includeè·¯å¾„ï¼Œè™½ç„¶çœ‹èµ·æ¥å¾ˆçœäº‹ï¼Œä½†ä¼šå½±å“æ£€ç´¢æ•ˆç‡</li>
<li>åˆšè®¾ç½®å®Œè·¯å¾„éœ€è¦ç­‰å¾…vscodeæ£€ç´¢æ„å»ºæ•°æ®åº“ï¼Œåœ¨vscodeå³ä¸‹æ–¹çŠ¶æ€æ¡ä¼šæç¤ºæ­£åœ¨è¿›è¡Œæ£€ç´¢</li>
<li>ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­<code>"python.analysis.extraPaths","python.autoComplete.extraPaths","python.analysis.include"</code>æ˜¯è®¾ç½®pythonè¯­æ³•æç¤ºå™¨çš„ åº“æ£€ç´¢è·¯å¾„ï¼Œä¸åŒçš„pythonæç¤ºå™¨æ’ä»¶ä¼šä½¿ç”¨ä¸åŒçš„è·¯å¾„ã€‚</li>
</ol>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIO-SAM</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258">LIO-SAM paper</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">This Project</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/chennuo0125-HIT/LIO-SAM-note">LIO-SAM-note</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/smilefacehh/LIO-SAM-DetailedNote">LIO-SAM-DetailedNote</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/13/lio_sam/intro/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”é¡¹ç›®ç®€ä»‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 19:45:58" itemprop="dateCreated datePublished" datetime="2023-03-13T19:45:58+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”é¡¹ç›®ç®€ä»‹" href="/2023/03/13/lio_sam/intro/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d227db67a0df8ebb129db6bbfad2da40" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="liosamä»‹ç»">LIOSAMä»‹ç»</h2>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>ï¼ˆTightly-coupled Lidar Inertial Odometry via Smoothing and Mappingï¼‰ï¼Œç´§è€¦åˆæ¿€å…‰â€”â€”æƒ¯æ€§é‡Œç¨‹è®¡å†ç¨‹æ–¹æ³•ã€‚ ä½œè€…<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan" title="ä½œè€…Github">TixiaoShan</a>æ˜¯SLAMå±Šå¤§ç¥ï¼Œåœ¨LIOSAMä¹‹å‰å‘è¡¨è¿‡LeGO-LOAMï¼Œåœ¨LIOSAMä¹‹åå‘å¸ƒäº†LVI-SAMï¼Œåœ¨LIOSAMåŸºç¡€ä¸ŠåˆåŠ å…¥äº†è¯­ä¹‰å®šä½å› å­ã€‚ ç”±äºç½‘ä¸Šå…³äº<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>çš„è§£è¯»å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œè¿™é‡Œä¸ä¼šè¿›è¡Œå¤ªè¿‡è¯¦ç»†çš„å¤è¿°ï¼Œå…·ä½“çš„å†…å®¹è§£æä¼šæ”¾åœ¨åé¢è®²è§£ä»£ç çš„æ—¶å€™æ…¢æ…¢ä»”ç»†é˜è¿°ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒLIOSAMæ•´ä½“çš„æ¡†æ¶ä¸å…¶ä»–æ–¹æ³•åŒºåˆ«åœ¨ä¸ï¼š 1. ä½¿ç”¨å› å­å›¾ä½œä¸ºåç«¯ä¼˜åŒ–æ¡†æ¶ï¼Œå°†IMUé¢„ç§¯åˆ†ä¸é›·è¾¾ç‚¹äº‘åŒ¹é…åŠå›ç¯æ£€æµ‹ç­‰ç´§è€¦åˆ 1. ä½¿ç”¨å½“å‰å¸§-å±€éƒ¨åœ°å›¾åŒ¹é…è€Œä¸æ˜¯å¯¹å…¨å±€åœ°å›¾åŒ¹é…æ¥åŠ é€Ÿç‚¹äº‘åŒ¹é…é€Ÿåº¦ 1. åŸºäºä½ç½®å…³ç³»é€‰æ‹©å›ç¯å¸§ï¼Œå¹¶ä½¿ç”¨ç‚¹äº‘åŒ¹é…è®¡ç®—å›ç¯å› å­ 1. ä½¿ç”¨é«˜é¢‘IMUå¹¶è¿›è¡Œç®€å•ç§¯åˆ†å¯¹ç‚¹äº‘åšè¿åŠ¨ç•¸å˜æ ¡æ­£</p>
<p>å¦å¤–ï¼ŒLIOSAMä½œè€…çš„å·¥ç¨‹åŠŸåº•å¾ˆå¥½ï¼ŒLIOSAMä»£ç åº“è¢«githubä¸Šå¾ˆå¤šSLAMå¼€æºé¡¹ç›®ä½œä¸ºcode base</p>
<h2 id="æœ¬é¡¹ç›®ç›®çš„åŠç‰¹ç‚¹ä»‹ç»">æœ¬é¡¹ç›®ç›®çš„åŠç‰¹ç‚¹ä»‹ç»</h2>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>æºä»£ç è™½ç„¶ä¸èƒ½è¯´åºå¤§ï¼Œç”šè‡³å¯ä»¥è¯´ç®€å•ï¼Œå› ä¸ºæ•´ä¸ªä»£ç åº“ä¸»è¦åªè¦5ä¸ªæ–‡ä»¶ã€‚ <img src="./imgs/org_files.png" alt="åŸå§‹srcç›®å½•" /> ä½†æ˜¯é‡Œé¢æ¯ä¸ªæ¨¡å—éƒ½é€šè¿‡ROSçš„topicä¸å…¶ä»–æ¨¡å—æœ‰ç´§å¯†çš„è”ç³»ã€‚ æ•´ä¸ªçš„æµç¨‹å¯¹æ–°æ‰‹ååˆ†ä¸å‹å¥½ï¼Œä¸‹å›¾æ˜¯LIOSAMåŸæœ¬è¿è¡Œæ—¶çš„<code>rqt_graph</code></p>
<figure>
<img src="./imgs/org_rqtgraph.png" alt="" /><figcaption>åŸå§‹rqt_graph</figcaption>
</figure>
<p>ç¬¬äºŒä¸ªå¤æ‚ä¹‹å¤„åœ¨ä¸LIOSAMæ¡†æ¶è®¾è®¡åˆ°çš„çŸ¥è¯†ç‚¹å’Œå·¥å…·è¾ƒå¤šï¼Œè‡³å°‘è¦ç†Ÿæ‚‰<code>ROS,gtsam,pcl</code>å‡ ä¸ªåº“ï¼Œç®—æ³•å±‚é¢éœ€è¦ç†Ÿæ‚‰<code>ç‚¹äº‘åŒ¹é…ã€IMUç§¯åˆ†ã€å› å­å›¾ã€ä¸‰ç»´è½¬æ¢</code>ç­‰ã€‚ å¯¹äºç†Ÿæ‚‰SLAMçš„äººæ¥è¯´å¯èƒ½è¾ƒä¸ºç®€å•ä¸Šæ‰‹ï¼Œä½†æ˜¯å¯¹äºæ–°å…¥é—¨çš„äººæ¥è¯´åˆ™ä¸€å¼€å§‹ä¼šä¸€å¤´é›¾æ°´ã€‚</p>
<p>åŸºäºä¸Šè¿°è¿™äº›åŸå› ï¼Œç¬”è€…è¿›è¡Œäº†<a href="Simple%20Lio%20Sam">SPL-LIO-SAM</a>é¡¹ç›®ï¼Œå¸Œæœ›èƒ½å¤Ÿä»¥æœ€å¤§å¹…åº¦å¸®åŠ©åˆå­¦è€…ç†è§£<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>æ¡†æ¶åŠé‡Œé¢çš„ç®—æ³•ç»†èŠ‚ã€‚ æœ¬é¡¹ç›®å¯¹<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>åšäº†å¦‚ä¸‹æ”¹è¿›</p>
<h3 id="åŸºäºæœ€æ–°çš„ros2-humbleå®ç°">åŸºäºæœ€æ–°çš„ROS2-humbleå®ç°</h3>
<p>è™½ç„¶LIOSAMæºç ä¸­æœ‰ä¸€ä¸ªros2åˆ†æ”¯ï¼Œä½†è¯¥åˆ†æ”¯çš„ç»´æŠ¤è€…å¹¶ä¸æ˜¯åŸä½œè€…ï¼Œè€Œä¸”å·²ç»é•¿æ—¶é—´æ²¡æœ‰äººç»´æŠ¤ï¼Œä¸”è¯¥åˆ†æ”¯å­˜åœ¨ä¸€äº›bugæ²¡æœ‰è¢«ä¿®å¤ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨è¿›è¡Œæœ¬é¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ä¸­ ç†Ÿæ‚‰æœ€æ–°çš„ROS2æ¡†æ¶ï¼Œç¬”è€…åœ¨LIOSAMçš„ros2åˆ†æ”¯åŸºç¡€ä¸Šï¼Œä¿®å¤äº†å­˜åœ¨çš„bugï¼ŒåŒæ—¶å°†åŠŸèƒ½è¾ƒä¸ºç‹¬ç«‹çš„<code>Transformfusion</code>ç±»æŠ½å–æˆç‹¬ç«‹çš„ç±»ã€‚</p>
<p>ä¸ºäº†ä¾¿äºä¸Šæ‰‹åŠéƒ¨ç½²ï¼Œç¬”è€…åŒæ—¶å‡†å¤‡äº†é€‚é…çš„dockeré•œåƒä¾›å­¦ä¹ è€…ä½¿ç”¨ã€‚</p>
<h3 id="ç®€åŒ–">ç®€åŒ–</h3>
<h4 id="è¯é¢˜å‘å¸ƒçš„ç®€åŒ–">è¯é¢˜å‘å¸ƒçš„ç®€åŒ–</h4>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>åŸå§‹ä»£ç ä¸­æœ‰å¾ˆå¤šä¸­é—´ç»“æœçš„å‘å¸ƒï¼Œè¿™äº›ä¸­é—´ç»“æœå¯ä»¥ç”¨æ¥å¯è§†åŒ–åŠè°ƒè¯•ç¨‹åºï¼Œä½†æ˜¯å¯¹äºå­¦ä¹ è€…å’Œå¼€å‘è€…è€Œè¨€ä¸ä»…æ„ä¹‰ä¸å¤§ï¼Œè€Œä¸”ä¼šåœ¨åˆå§‹å­¦ä¹ æºç é˜¶æ®µè¯¯å¯¼å­¦ä¹ è€…ã€‚ æœ¬é¡¹ç›®åœ¨è¯é¢˜å‘å¸ƒä¸Šè¿›è¡Œ<code>å¤§å¹…åº¦ç®€åŒ–</code>ï¼Œç®€åŒ–åçš„è®¾è®¡å¦‚ä¸‹ï¼š <img src="./imgs/Design-Node%26%26Topics.png" alt="èŠ‚ç‚¹åŠè¯é¢˜è®¾è®¡" /></p>
<p>ç®€åŒ–åè¿è¡Œæ—¶çš„<code>rqt_graph</code>: <img src="./imgs/spl_liosam_rosgraph.png" alt="ç®€åŒ–åçš„rosâ€”grpah" /></p>
<h4 id="åæ ‡ç³»ç®€åŒ–">åæ ‡ç³»ç®€åŒ–</h4>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>ä¸­å®ç”¨çš„åæ ‡ç³»å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯ä½œè€…æä¾›çš„<code>urdf</code>åŒ…å«äº†å¤ªå¤šä¸ºäº†å…¼å®¹æ€§è€ƒè™‘çš„åæ ‡ç³»ï¼Œè¿™äº›åæ ‡ç³»å¯¹äºå®é™…è¿è¡Œå’Œç†è§£å¹¶æ²¡æœ‰ç”¨ã€‚å› æ­¤ï¼Œæœ¬é¡¹ç›®åŸºäºROSå¯¹åæ ‡ç³»çš„çº¦æŸï¼Œå°† åæ ‡ç³»å…³ç³»æ ‘ç®€åŒ–ä¸ºå¦‚ä¸‹ï¼š <img src="./imgs/Design-CoordinateSystem.png" alt="ç®€åŒ–åçš„åæ ‡ç³»å…³ç³»" /></p>
<h4 id="ä¿ç•™ç®—æ³•åŠå®šä¹‰å®Œæ•´æ€§">ä¿ç•™ç®—æ³•åŠå®šä¹‰å®Œæ•´æ€§</h4>
<p>è™½ç„¶æœ¬é¡¹ç›®å»é™¤äº†å¾ˆå¤šéå¿…è¦è¯é¢˜ï¼ŒåŒæ—¶å¯¹äºä¸€äº›éå¿…è¦ä»£ç ä¹Ÿè¿›è¡Œäº†ç®€åŒ–ï¼Œä½†å¯¹ä¸€äº›å­¦ä¹ ç®—æ³•æœ‰å¸®åŠ©çš„ç»†èŠ‚ä¾æ—§ä¿ç•™ã€‚æ¯”å¦‚æ¿€å…‰é‡Œç¨‹è®¡åœ¨å‘å¸ƒçš„æ—¶å€™æœ‰<code>mapping/odometry</code>å’Œ<code>mapping/odometry_incremental</code>ä¸¤ä¸ªè¯é¢˜ï¼Œä¸¤ä¸ªè¯é¢˜è™½ç„¶ç±»ä¼¼ä½†æ˜¯èƒŒåå´æœ‰å¾ˆä¸åŒçš„å‡½æ•°ï¼Œä½†åŒæ—¶ä¸¤è€…åˆä¸€åˆä¸å½±å“ç®—æ³•çš„è¿è¡Œã€‚å› æ­¤é‡‡å–çš„åšæ³•æ—¶åœ¨ä»£ç ä¸­ä¿ç•™è¿™éƒ¨åˆ†ä»£ç ï¼ŒåŒæ—¶åŠ ä»¥è§£é‡Šï¼Œä½†å‘å¸ƒæ—¶åªå‘å¸ƒå…¶ä¸­ä¸€ä¸ªè¯é¢˜ã€‚</p>
<h3 id="å®Œå–„çš„æ³¨é‡ŠåŠæµç¨‹å›¾">å®Œå–„çš„æ³¨é‡ŠåŠæµç¨‹å›¾</h3>
<p>ç½‘ä¸Šå…¶å®å¯¹<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>æºç çš„æ³¨é‡Šå¹¶ä¸å°‘ï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://github.com/chennuo0125-HIT/LIO-SAM-note" title="LIO-SAM-note">LIO-SAM-note</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/smilefacehh/LIO-SAM-DetailedNote" title="LIO-SAM-DetailedNote">LIO-SAM-DetailedNote</a>ï¼Œè¿˜æœ‰ä¸€äº›blogä¹Ÿå¯¹æºç åšäº†è§£é‡Šï¼Œä½†æ˜¯éƒ½ä¸å¤ªå®Œç¾ï¼ŒåŒæ—¶ç¼ºå°‘æµç¨‹æ€§çš„ç»„ç»‡ã€‚æœ¬é¡¹ç›®å€Ÿé‰´äº†ä¸€äº›å¼€æºé¡¹ç›®çš„æ³¨é‡Šï¼Œå¹¶åŠ ä»¥å®Œå–„ï¼Œå¯ä»¥è¯´ï¼Œæœ¬é¡¹ç›®æ˜¯ç›®å‰å¯¹<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>æ³¨é‡Šæœ€å®Œå–„çš„å¼€æºé¡¹ç›®ã€‚ <img src="./imgs/comments.png" alt="éƒ¨åˆ†æ³¨é‡Šå›¾" /></p>
<p>ä¸ºäº†æœ€ä¸ºæ¸…æ™°çš„å±•ç¤º<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258" title="liosamè®ºæ–‡">LIOSAM</a>ç®—æ³•ä¸åŒæ¨¡å—çš„æµç¨‹ï¼Œè¯¥é¡¹ç›®è¿˜å¯¹å„ä¸ªæ¨¡å—æµç¨‹è¿›è¡Œæ¢³ç†ï¼Œå»ºç«‹äº†å®Œå–„çš„æµç¨‹å›¾è®¾è®¡ <img src="./imgs/Design-Pipelines.png" alt="Pipeline" /> <img src="./imgs/Design-imageProjection_top0.png" alt="imageProjection_top0" /> <img src="./imgs/Design-imageProjection_top1.png" alt="imageProjection_top0" /></p>
<h2 id="åç»­ç« èŠ‚">åç»­ç« èŠ‚</h2>
<ol type="1">
<li>èŠ‚ä¸€ï¼šå¼€å‘ç¯å¢ƒæ­å»ºåŠè¿è¡Œ</li>
<li>èŠ‚äºŒï¼šæ€»ä½“æµç¨‹åŠutilityæ–‡ä»¶</li>
<li>èŠ‚ä¸‰ï¼šæ¿€å…‰é›·è¾¾è¿åŠ¨ç•¸å˜çŸ«æ­£æ¨¡å—</li>
<li>èŠ‚å››ï¼šç‚¹äº‘ç‰¹å¾æå–æ¨¡å—</li>
<li>èŠ‚äº”ï¼šGtsamå¿«é€Ÿè®¤è¯†</li>
<li>èŠ‚å…­ï¼šIMUé¢„ç§¯åˆ†æ¨¡å—</li>
<li>èŠ‚ä¸ƒï¼šæ¿€å…‰é‡Œç¨‹è®¡æ¨¡å—</li>
<li>èŠ‚å…«ï¼šåæ ‡ç³»å‘å¸ƒæ¨¡å—</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">FastDDSå…³é”®æ¦‚å¿µ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 18:02:43" itemprop="dateCreated datePublished" datetime="2023-03-13T18:02:43+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/DDS/" itemprop="url" rel="index"><span itemprop="name">DDS</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="FastDDSå…³é”®æ¦‚å¿µ" href="/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::73f7a0f706535d55ad531611b3af6c03" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="æ¶æ„">æ¶æ„</h1>
<p>æ¶æ„å›¾ <img src="./imgs/fast-dds-architecture.svg" alt="æ¶æ„å›¾" /></p>
<p>åŸŸï¼ˆDomainï¼‰çš„æ¦‚å¿µ <img src="imgs/domain_concept.jpg" alt="Domain" /> <img src="imgs/dds_domain.svg" alt="Domain" /></p>
<p>æ•°æ®ä¸­å¿ƒæ”¶å‘æ¨¡å‹ï¼ˆDCPS:Data Centric Publisher and Subscriber) <img src="imgs/DataCentricModel.png" alt="DCPS" /></p>
<h1 id="why-need-a-publisher-and-subscriber">Why need a publisher and subscriber</h1>
<blockquote>
<p>These publishers and subscribers donâ€™t need to know about each other ahead of time; they discover each other dynamically at runtime. The data they share is described by a â€œtopic,â€ and publishers and subscribers send and receive data only for the topics they are interested in. In this pattern, many publishers may publish the same topic, and many subscribers may subscribe to the same topic. Subscribers receive data from all of the publishers that they share a topic with. Publishers send data directly to subscribers, with no need for a broker or centralized application to mediate communications. (https://community.rti.com/static/documentation/connext-dds/6.0.1/doc/manuals/connext_dds/getting_started/cpp11/intro_pubsub_cpp.html)</p>
</blockquote>
<h1 id="notes">Notes</h1>
<p>Publisher å’Œ Subscriber è´Ÿè´£ç”ŸæˆDataWriter&amp;&amp;DataReaderï¼Œä¸€ä¸ªPublisher[Subscriber]å¯ä»¥ç»‘å®šå¤šä¸ªDataWriter[DataReader]ã€‚æ¯ä¸€ä¸ªDataWriter[DataReader]éƒ½ä¼šç»‘å®šåˆ°ä¸€ä¸ªtopicï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šå¯¹åº”çš„å›è°ƒå‡½æ•°DataWriterListener[DataReaderListener]</p>
<h1 id="æ•°æ®ç›‘æ§fastdds-monitor">æ•°æ®ç›‘æ§â€”â€”FastDDS Monitor</h1>
<p><a target="_blank" rel="noopener" href="https://fast-dds-monitor.readthedocs.io/en/latest/rst/getting_started/tutorial.html">FastDDS Monitor Tutorial</a> ## åŸç† FastDDSåº“æœ‰ä¸€ä¸ªå†…åµŒçš„Participantï¼Œå«åšStatistic Participantï¼ŒåŒ…å«åœ¨FastDDSçš„Statistic Moduleä¸­ã€‚è¯¥æ¨¡å—ä¸æ˜¯é»˜è®¤ç¼–è¯‘çš„ï¼Œå› æ­¤éœ€è¦åœ¨ç¼–è¯‘FastDDSçš„æ—¶å€™æŒ‡æ˜CMakeé€‰é¡¹ã€‚ å®é™…ä¸Šæ˜¯ç”¨æˆ·å¼€å‘åº”ç”¨æ—¶ï¼Œåœ¨æ„å»º<strong>DomainParticipants</strong>é˜¶æ®µï¼Œå¦‚æœé€šè¿‡æŸç§æ–¹å¼æŒ‡æ˜äº†è¦å°†æ•°æ®ç»Ÿè®¡ä¿¡æ¯å¾€å¤–å‘é€ï¼Œåˆ™Statistic Moduleæ¨¡å—å°±ä¼šè‡ªåŠ¨æ”¶é›†ä¿¡æ¯ï¼Œç„¶åå¾€å›ºå®šçš„topicå‘é€ç›‘æ§æ•°æ®ã€‚FastDDS Monitoré€šè¿‡è¿™äº›å†…åµŒçš„topicï¼Œå¯ä»¥ç›‘æ§æ•°æ®çš„æ”¶å‘æƒ…å†µã€‚</p>
<p><a target="_blank" rel="noopener" href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/statistics/statistics.html">å¦‚ä½•æ‰“å¼€Statistics DataWriters</a> <a target="_blank" rel="noopener" href="https://fast-dds-monitor.readthedocs.io/en/latest/rst/getting_started/tutorial.html">å¦‚ä½•ä½¿ç”¨FastDDS Monitor</a></p>
<p><strong>æ³¨æ„ï¼Œå¦‚æœç¼–è¯‘FastDDSçš„æ—¶å€™æ‰“å¼€Statistics Moduleæ¨¡å—ï¼Œç”±äºä¼šå‘é€é¢å¤–çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¼šæŸå¤±æ€§èƒ½</strong> &gt; Consequently, by default, Fast DDS does not compile this module because it may entail affecting the applicationâ€™s performance.(https://fast-dds.docs.eprosima.com/en/latest/fastdds/statistics/statistics.html)</p>
<figure>
<img src="imgs/monitor.jpg" alt="" /><figcaption>æ•°æ®ç›‘æ§çª—å£</figcaption>
</figure>
<h1 id="record-replay">Record &amp;&amp; Replay</h1>
<blockquote>
<p>rosbag2 is a ROS 2 application that can be used to capture DDS messages and store them on an SQLite database which allows inspecting and replaying said messages at a later time.</p>
</blockquote>
<ol type="1">
<li>rosbag2å¯ä»¥å°†åœ¨Topicä¸­ä¼ é€çš„æ•°æ®ä»¥SQLiteçš„å½¢å¼ä¿å­˜</li>
<li>FastDDSæ²¡æœ‰è‡ªå·±çš„æ•°æ®ä¿å­˜å’Œå›æ”¾å·¥å…·ï¼Œå®˜æ–¹è¯´æ˜ç”¨çš„æ˜¯ROS2çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2">rosbag2</a>åŒ…ã€‚è¦ä½¿ç”¨è¯¥åŒ…æ¥è®°å½•å’Œå›æ”¾FastDDSçš„æ•°æ®éœ€è¦å®‰è£…ROS2ç¯å¢ƒå’Œrosbag2</li>
<li>ç”±äºrosbag2æ˜¯ç”¨æ¥ä¿å­˜ros2çš„messageçš„ï¼Œå¹¶ä¸æ˜¯FastDDSçš„å®˜æ–¹å·¥å…·ï¼Œå› æ­¤å¦‚æœè¦ç”¨rosbag2å›æ”¾ï¼Œéœ€è¦åšè¾ƒå¤šçš„é…ç½®</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/use_cases/rosbag_capture/rosbag_capture.html#rosbag-capture">ä½¿ç”¨rosbag-capture</a></p>
<h1 id="limitations">Limitations</h1>
<ol type="1">
<li>æ²¡æœ‰è¿›ç¨‹ç®¡ç†å’Œå¯åŠ¨å·¥å…·ã€‚ROS/Apollo/XPilotéƒ½æœ‰å±äºè‡ªå·±çš„è¿›ç¨‹è°ƒåº¦ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥æŒ‰æŒ‡å®šé¡ºåºå¯åŠ¨å¤šä¸ªè¿›ç¨‹å¹¶æ‰§è¡Œç›¸å…³è°ƒåº¦ã€‚</li>
<li>ä¼¼ä¹æ— æ³•å®ç°åƒROSçš„Serviceè¿™ç§ç±»ä¼¼RPCçš„åŠŸèƒ½</li>
</ol>
<h1 id="reference-resources-link">Reference &amp;&amp; Resources link</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://github.com/eProsima/Fast-DDS">FastDDS Github</a></li>
<li><a target="_blank" rel="noopener" href="https://fast-dds-monitor.readthedocs.io/en/latest/rst/installation/linux.html">FastDDS Monitor Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/use_cases/rosbag_capture/rosbag_capture.html#rosbag-capture">ä½¿ç”¨rosbag-capture</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/eProsima/Fast-DDS-python.git">Fast-DDS-Python</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/" class="post-title-link" itemprop="url">ç»ä¹…ä¸è¡°çš„å¡å°”æ›¼æ»¤æ³¢å™¨-åŸºç¡€çŸ¥è¯†åŠå…¬å¼æ¨å¯¼</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 17:59:59" itemprop="dateCreated datePublished" datetime="2023-03-13T17:59:59+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/%E6%BB%A4%E6%B3%A2/" itemprop="url" rel="index"><span itemprop="name">æ»¤æ³¢</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/%E6%BB%A4%E6%B3%A2/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/" itemprop="url" rel="index"><span itemprop="name">å¡å°”æ›¼æ»¤æ³¢</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="ç»ä¹…ä¸è¡°çš„å¡å°”æ›¼æ»¤æ³¢å™¨-åŸºç¡€çŸ¥è¯†åŠå…¬å¼æ¨å¯¼" href="/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::485da1f1f8066e1c77d786731c1e5117" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸€å¡å°”æ›¼æ»¤æ³¢å™¨çš„åº”ç”¨åœºæ™¯">ä¸€ã€å¡å°”æ›¼æ»¤æ³¢å™¨çš„åº”ç”¨åœºæ™¯</h1>
<p>å¡å°”æ›¼æ»¤æ³¢å™¨ä¹‹å‰è¢«å¹¿æ³›ç”¨æ¥åšåŠ¨æ€ç³»ç»Ÿçš„çŠ¶æ€ä¼°è®¡ã€é¢„æµ‹ã€‚ä¸»è¦çš„ç›®çš„å°±æ˜¯ç”¨æ¥ä»å¸¦å™ªå£°çš„è§‚æµ‹é‡ï¼Œæ¯”å¦‚å„ç§ä¼ æ„Ÿå™¨çš„è§‚æµ‹ï¼ˆIMUã€GPSã€é‡Œç¨‹è®¡ç­‰ï¼‰ä¼°è®¡å‡ºæœ€ä¼˜çš„ç³»ç»ŸçŠ¶æ€ï¼ˆstateï¼‰ã€‚ä¸è¿‡è¦æ˜ç¡®å¼ºè°ƒçš„æ˜¯ï¼Œç”±äºæµ‹é‡éƒ½å¸¦æœ‰å™ªå£°ï¼Œä¹Ÿå°±æ˜¯éšæœºæ€§ï¼Œæ‰€ä»¥çœŸæ­£å‡†ç¡®çš„çŠ¶æ€æ˜¯æ— æ³•è·çŸ¥çš„ã€‚</p>
<p>æœ€å°äºŒä¹˜æ³•å¯ä»¥ä»ä¸€é•¿ä¸²çš„æµ‹é‡å€¼å›å½’å‡ºä¸€ä¸ªæœ€ä¸ºåŒ¹é…çš„æ¨¡å‹ã€‚å¡å°”æ›¼æ»¤æ³¢ç›¸æ¯”äºæœ€å°äºŒä¹˜æ³•ï¼Œé‡‡ç”¨äº†ä¸€ç§é€’å½’çš„è®¡ç®—æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€æ—¶åˆ»åªéœ€è¦ä¿å­˜ä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚å› æ­¤å¯ä»¥è¢«ç”¨æ¥å¤„ç†å®æ—¶ä»»åŠ¡ã€‚</p>
<p>è™½ç„¶å¡å°”æ›¼æ»¤æ³¢å™¨ä»ç¾å›½é˜¿æ³¢ç½—ç™»æœˆè®¡åˆ’åˆ°å¦‚ä»Šå·²æœ‰å‡ åå¹´ï¼Œä¸”ç›®å‰æœ‰æ›´å…ˆè¿›çš„å› å­å›¾ï¼ˆFactor Graphï¼‰ç®—æ³•ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šé¢†åŸŸä¾æ—§å¯ä»¥çœ‹åˆ°å¡å°”æ›¼æ»¤æ³¢å™¨çš„èº«å½±ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨é©¾é©¶çš„å„ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ï¼šä»IMUçš„æ•°æ®ï¼ˆä¸‰è½´åŠ é€Ÿåº¦ï¼Œä¸‰è½´è§’é€Ÿåº¦ï¼‰è®¡ç®—å‡ºè¿åŠ¨ç‰©ä½“çš„å½“å‰ä½ç½®ã€‚</p>
<h1 id="äºŒå¡å°”æ›¼æ»¤æ³¢å™¨çš„ä¸¤ä¸ªæ­¥éª¤å®è§‚è®¤è¯†">äºŒã€å¡å°”æ›¼æ»¤æ³¢å™¨çš„ä¸¤ä¸ªæ­¥éª¤â€”â€”å®è§‚è®¤è¯†</h1>
<p>å¡å°”æ›¼æ»¤æ³¢åŒ…å«ä¸¤ä¸ªæ­¥éª¤</p>
<ol type="1">
<li>é¢„æµ‹ï¼ˆpredictionï¼‰â€”â€” Dynamic model</li>
<li>æ›´æ–°ï¼ˆcorrection/measurment updateï¼‰â€”â€” Observation model</li>
</ol>
<p>æ‰€è°“<strong>é¢„æµ‹</strong>ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ•°å­¦æ¨¡å‹ï¼Œæ ¹æ®å½“å‰çš„ä¼ æ„Ÿå™¨è¾“å…¥ï¼Œç›´æ¥è®¡ç®—æ­¤æ—¶ç³»ç»Ÿçš„çŠ¶æ€ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ–¹ç¨‹çš„è®¡ç®—å°±è¡Œã€‚</p>
<p>æ‰€è°“çš„<strong>æ›´æ–°</strong>ï¼Œå°±æ˜¯åœ¨æŸäº›æ—¶åˆ»æˆ–è€…æ¯ä¸€æ—¶åˆ»ï¼Œè·å–ä¸€äº›ç³»ç»Ÿçš„çŠ¶æ€è¾“å…¥ï¼ˆå¯ä»¥åŒæ ·æ˜¯ä¼ æ„Ÿå™¨çš„å€¼ï¼‰ï¼Œç”šè‡³æ˜¯<strong>é¢„æµ‹</strong>é˜¶æ®µä¸­åŒæ ·çš„ä¼ æ„Ÿå™¨çš„å€¼ï¼Œå°†å…¶å½“ä½œçœŸå€¼ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå€¼å«åš<strong>æµ‹é‡å€¼</strong>ã€‚æ¯”è¾ƒæ­¤åˆ»<strong>é¢„æµ‹</strong>çš„ç³»ç»ŸçŠ¶æ€å’Œ<strong>æµ‹é‡</strong>çš„ç³»ç»ŸçŠ¶æ€ï¼Œå¯¹<strong>é¢„æµ‹</strong>å‡ºçš„ç³»ç»ŸçŠ¶æ€è¿›è¡Œä¿®æ­£ï¼Œå› æ­¤ä¹Ÿå«<strong>æµ‹é‡æ›´æ–°</strong>ï¼ˆmeasurment updateï¼‰ã€‚</p>
<figure>
<img src="./imgs/framework.png" alt="" /><figcaption>framework</figcaption>
</figure>
<h1 id="ä¸‰å¡å°”æ›¼æ»¤æ³¢çš„å‡ å¤§æ¦‚å¿µ">ä¸‰ã€å¡å°”æ›¼æ»¤æ³¢çš„å‡ å¤§æ¦‚å¿µ</h1>
<h2 id="çŠ¶æ€å‘é‡state-vector">1ã€çŠ¶æ€å‘é‡State Vector</h2>
<p>ç³»ç»Ÿçš„çŠ¶æ€å‘é‡åŒ…å«äº†ç³»ç»Ÿä¸­æˆ‘ä»¬å…³å¿ƒçš„çŠ¶æ€å˜é‡ï¼Œæ¯”å¦‚é€Ÿåº¦<span class="math inline">\(\textbf{v}=[v_x, v_y,v_z]\)</span>ï¼Œè·ç¦»<span class="math inline">\(\textbf{d}=[d_x, d_y,d_z]\)</span>ï¼ŒåŠ é€Ÿåº¦<span class="math inline">\(\textbf{a}=[a_x,a_y,a_z]\)</span>ç­‰ã€‚æˆ‘ä»¬ç”¨<span class="math inline">\(\textbf{x}\)</span>è¡¨ç¤ºç³»ç»Ÿå‘é‡ <span class="math display">\[ \textbf{x} = \begin{bmatrix} \textbf{d}\\ \textbf{v}\\ \textbf{a} \end{bmatrix}\\\]</span></p>
<p>å› ä¸ºå¡å°”æ›¼æ»¤æ³¢æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å…ˆä»¥æ¯ä¸ªæ—¶åˆ»éƒ½è¿›è¡Œæµ‹é‡å’Œä¿®æ­£è¿™ä¸¤ä¸ªæ­¥éª¤ä½œä¸ºè®²è§£ã€‚é‚£ä¹ˆï¼Œæ¯ä¸€æ—¶åˆ»çš„ä¸¤ä¸ªæ­¥éª¤çš„è¾“å‡ºå¯¹åº”ä¸¤ä¸ªç³»ç»Ÿå‘é‡ï¼Œä¸€ä¸ªæ˜¯é¢„æµ‹çš„ç³»ç»Ÿå‘é‡<span class="math inline">\(\textbf{x}^-\)</span>ï¼Œä¸€ä¸ªæ˜¯ä¿®æ­£åçš„ç³»ç»Ÿå‘é‡<span class="math inline">\(\textbf{x}^+\)</span>ã€‚</p>
<p><strong><em><strong>ps</strong>:å¤§å†™å­—æ¯è¡¨ç¤ºçŸ©é˜µï¼›å°å†™åŠ ç²—å­—æ¯è¡¨ç¤ºå‘é‡ï¼›å°å†™å­—æ¯è¡¨ç¤ºå˜é‡</em></strong></p>
<h2 id="çŠ¶æ€æ–¹ç¨‹é¢„æµ‹æ–¹ç¨‹">2ã€çŠ¶æ€æ–¹ç¨‹&amp;&amp;é¢„æµ‹æ–¹ç¨‹</h2>
<h3 id="çŠ¶æ€æ–¹ç¨‹">çŠ¶æ€æ–¹ç¨‹</h3>
<p><strong>çŠ¶æ€æ–¹ç¨‹</strong>æè¿°äº†å°†ä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€å‘é‡<span class="math inline">\(\textbf{x}_{t-1}\)</span>æ˜ å°„åˆ°å½“å‰çš„ç³»ç»ŸçŠ¶æ€<span class="math inline">\(\textbf{x}_t\)</span> <span class="math display">\[ \textbf{x}_t = A_t\textbf{x}_{t-1}+ B_t\textbf{u}_t+\textbf{w}_t \tag{1}\]</span></p>
<p>å…¶ä¸­ï¼ŒçŸ©é˜µ<span class="math inline">\(A\)</span>ç§°ä¸ºè½¬æ¢çŸ©é˜µï¼ˆTransition Matrixï¼‰ï¼Œ<span class="math inline">\(\textbf{u}_t\)</span>æ˜¯å½“å‰æ—¶åˆ»çš„ç³»ç»Ÿè¾“å…¥ï¼ŒçŸ©é˜µ<span class="math inline">\(B\)</span>ç§°ä¸ºæ§åˆ¶çŸ©é˜µï¼ˆControl Matrixï¼‰åæ˜ äº†ç³»ç»Ÿè¾“å…¥åˆ°ç³»ç»ŸçŠ¶æ€çš„æ˜ å°„å…³ç³»ï¼Œ<span class="math inline">\(\textbf{w}_t\)</span>æ˜¯è¿‡ç¨‹å™ªå£°ï¼Œæˆ‘ä»¬å‡å®šå…¶ç¬¦åˆå‡å€¼ä¸º0ï¼Œåæ–¹å·®çŸ©é˜µä¸º<span class="math inline">\(Q_t\)</span>çš„é«˜æ–¯å™ªå£°ã€‚è¿™é‡Œè¦æ³¨æ„çš„æœ‰å‡ ç‚¹ï¼š</p>
<ol type="1">
<li>çŸ©é˜µ<span class="math inline">\(Aã€B\)</span>éƒ½éšç€æ—¶é—´æ¼”è¿›è¿›è¡Œæ›´æ–°</li>
<li>ä»å…¬å¼1çš„å½¢å¼å¯ä»¥çœ‹å‡ºï¼Œå¡å°”æ›¼æ»¤æ³¢çš„æ•°å­¦å»ºæ¨¡å½¢å¼æ˜¯çº¿æ€§æ–¹ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯å¡å°”æ›¼æ»¤æ³¢çš„é™åˆ¶ä¹‹ä¸€ã€‚æ‰©å±•å¡å°”æ›¼æ»¤æ³¢å™¨ï¼ˆExtended Kalman Filterï¼‰æ”¯æŒéçº¿æ€§æ¨¡å‹ã€‚</li>
<li>è¿™é‡Œçš„çŠ¶æ€æ–¹ç¨‹æ˜¯ä¸€ä¸ªâ€œå‡†ç¡®â€çš„è¡¨è¾¾ï¼Œå› ä¸ºä¸å‡†ç¡®çš„éƒ¨åˆ†å·²ç»æ”¾åœ¨å™ªå£°é¡¹ä¸­ï¼Œè¦è·Ÿä¸‹é¢çš„é¢„æµ‹æ–¹ç¨‹åŒºåˆ†å¼€æ¥ã€‚è¿™ä¸ªâ€œå‡†ç¡®â€çš„è¡¨è¾¾ç”±äºæœ‰å™ªå£°ï¼ˆéšæœºå‘é‡ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•ä½¿ç”¨å®ƒä½œä¸ºè¾“å‡ºï¼Œåªèƒ½ç”¨å®ƒæ¥åˆ†æã€æ¨å¯¼ã€‚</li>
</ol>
<h3 id="é¢„æµ‹æ–¹ç¨‹">é¢„æµ‹æ–¹ç¨‹</h3>
<p><strong>é¢„æµ‹æ–¹ç¨‹</strong>è·ŸçŠ¶æ€æ–¹ç¨‹åŸºæœ¬ä¸€æ ·ï¼Œè¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œå™ªå£°<span class="math inline">\(\textbf{w}_t\)</span>æ˜¯å‡å€¼ä¸º0çš„é«˜æ–¯å™ªå£°ï¼Œå› æ­¤æœ€å¤§æ¦‚ç‡å¯¹åº”çš„å€¼ä¸º0ï¼Œå› æ­¤æˆ‘ä»¬åœ¨é¢„æµ‹çŠ¶æ€å‘é‡çš„æ—¶å€™å…¶å®ä¸ç”¨ç®¡æœ€åä¸€é¡¹ <span class="math display">\[ \hat{\textbf{x}}^-_t = \textbf{A}_t\hat{\textbf{x}}^+_{t-1} + \textbf{B}_t\textbf{u}_t\tag{2}\]</span></p>
<p>è¿™é‡Œå¯¹ç³»ç»ŸçŠ¶æ€å‘é‡ä¸Šé¢åŠ ä¸Šä¸€ä¸ªå¸½å­è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¼°è®¡é‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å®é™…è¾“å‡ºçš„é‡ã€‚å…¶ä¸­<span class="math inline">\(\hat{\textbf{x}}^+ _{t-1}\)</span>è¡¨ç¤ºä¸Šä¸€æ—¶åˆ»æ‰§è¡Œå®Œæ­¥éª¤äºŒ<strong>æ›´æ–°</strong>åçš„çŠ¶æ€å‘é‡ï¼Œ<span class="math inline">\(\hat{\textbf{x}}^- _{t}\)</span>è¡¨ç¤ºå½“å‰æ—¶å€™åªæ‰§è¡Œäº†æ­¥éª¤1<strong>é¢„æµ‹</strong>çš„çŠ¶æ€å‘é‡ã€‚</p>
<h3 id="ç†è§£é¢„æµ‹æ–¹ç¨‹">ç†è§£é¢„æµ‹æ–¹ç¨‹</h3>
<p>é¢„æµ‹æ–¹ç¨‹ï¼ˆå…¬å¼2ï¼‰ä»å½¢å¼ä¸Šçœ‹åªæ˜¯æŠŠçŠ¶æ€æ–¹ç¨‹ï¼ˆå…¬å¼1ï¼‰å»æ‰äº†å™ªå£°é¡¹ï¼Œä½†å…¶ä¸­åŒ…å«äº†å¾ˆå¤šå«ä¹‰ã€‚å…¶ä¸­ï¼Œè¦æ—¶åˆ»è®°å¾—çš„æ˜¯æˆ‘ä»¬æŠŠç³»ç»ŸçŠ¶æ€å½“ä½œä¸€ä¸ªéšæœºå‘é‡å¤„ç†ï¼Œä¸¥æ ¼çš„è¡¨è¿°éœ€è¦å¼•å…¥éšæœºè¿‡ç¨‹çš„ç›¸å…³çŸ¥è¯†ï¼Œä½†å…¶å®æ²¡å¤ªå¤§å¿…è¦ã€‚ç”±äºå…¬å¼ï¼ˆ1ï¼‰ä¸­çŠ¶æ€å‘é‡æ˜¯ä¸€ä¸ªéšæœºå‘é‡ï¼Œä¸”å™ªå£°é¡¹æ˜¯å‡å€¼ä¸º0çš„é«˜æ–¯å™ªå£°ï¼Œé‚£ä¹ˆçŠ¶æ€å‘é‡<span class="math inline">\(\textbf{x}_t\)</span>ä¹Ÿæ»¡è¶³é«˜æ–¯åˆ†å¸ƒï¼Œå…¶æœ€å¤§æ¦‚ç‡çš„åœ°æ–¹å°±å¯¹åº”è¿™å™ªå£°ä¸º0çš„åœ°æ–¹ï¼Œå› æ­¤æˆ‘ä»¬æœ‰ç†ç”±å°†è¿™ä¸ªæ¦‚ç‡æœ€å¤§å¤„å¯¹åº”çš„å€¼å½“ä½œæˆ‘ä»¬çš„<strong>é¢„æµ‹</strong>ã€‚</p>
<figure>
<img src="./imgs/gaussian.png" alt="" /><figcaption>gaussian</figcaption>
</figure>
<h2 id="æµ‹é‡æ–¹ç¨‹æµ‹é‡ä¼°è®¡æ–¹ç¨‹">3ã€æµ‹é‡æ–¹ç¨‹&amp;&amp;æµ‹é‡ä¼°è®¡æ–¹ç¨‹</h2>
<h3 id="æµ‹é‡æ–¹ç¨‹">æµ‹é‡æ–¹ç¨‹</h3>
<p><strong>æµ‹é‡æ–¹ç¨‹</strong>åæ˜ äº†ç³»ç»Ÿçš„æµ‹é‡å€¼å’Œç³»ç»ŸçŠ¶æ€å‘é‡ä¹‹é—´çš„å…³ç³» <span class="math display">\[ \textbf{z}_t=H_t\textbf{x}_t+v_t\tag{3}\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(\textbf{z}_t\)</span>æ˜¯å½“å‰æ—¶åˆ»çš„æµ‹é‡å€¼ï¼Œ<span class="math inline">\(H_t\)</span>ç§°ä¸ºæµ‹é‡çŸ©é˜µï¼ˆMeasurement Matrixï¼‰ï¼Œæè¿°äº†ä»ç³»ç»ŸçŠ¶æ€åˆ°æµ‹é‡å€¼çš„è½¬æ¢å…³ç³»ï¼ˆä¸¾ä¸€ä¸ªæœ€ç®€å•çš„å…³ç³»ï¼Œç³»ç»ŸçŠ¶æ€æ˜¯ç‰©ä½“çš„ç›´çº¿è·ç¦»ï¼Œæµ‹é‡å€¼æ˜¯ä½¿ç”¨æ¿€å…‰ç¬”æµ‹å‡ºæ¥çš„å…‰ä»åŸç‚¹åˆ°ç‰©ä½“çš„æ—¶é—´ï¼Œé‚£ä¹ˆ<span class="math inline">\(H\)</span>å°±æ˜¯å…‰é€Ÿçš„å€’æ•°ï¼‰, <span class="math inline">\(\textbf{v}_t\)</span>æ˜¯æµ‹é‡å™ªå£°ï¼Œæˆ‘ä»¬å‡å®šå…¶ç¬¦åˆå‡å€¼ä¸º0ï¼Œåæ–¹å·®ä¸º<span class="math inline">\(R_t\)</span>çš„é«˜æ–¯å™ªå£°ã€‚æ³¨æ„è¿™é‡Œæ— è®ºæ˜¯çŠ¶æ€å‘é‡è¿˜æ˜¯æµ‹é‡å‘é‡éƒ½æ²¡æœ‰åŠ å¸½å­ï¼ˆ<span class="math inline">\(\hat{.}\)</span>ï¼‰ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸ª"å‡†ç¡®"çš„è¡¨è¾¾å¼ã€‚</p>
<h3 id="æµ‹é‡ä¼°è®¡æ–¹ç¨‹">æµ‹é‡ä¼°è®¡æ–¹ç¨‹</h3>
<p>åŒæ ·ï¼Œæˆ‘ä»¬å¦‚æœå¿½ç•¥å™ªå£°é¡¹ï¼Œå°±å˜æˆäº†å¯¹æ­¤æ—¶æµ‹é‡é‡çš„ä¼°è®¡ï¼ˆæ³¨æ„çŠ¶æ€å‘é‡çš„ä¸Šæ ‡å’Œè§’æ ‡ï¼‰ï¼š</p>
<p><span class="math display">\[ \hat{\textbf{z}}_t=H_t\hat{\textbf{x}}^-_t\tag{4}\]</span></p>
<h2 id="æµ‹é‡æ›´æ–°æ–¹ç¨‹">4ã€æµ‹é‡æ›´æ–°æ–¹ç¨‹</h2>
<p>ä¸Šé¢ç»™å‡ºäº†å¯¹æµ‹é‡é‡çš„ä¼°è®¡ï¼Œä½†æ˜¯ç°åœ¨çš„æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæµ‹é‡å€¼ï¼ˆé€šè¿‡æŸäº›æµ‹é‡æ–¹å¼æˆ–è€…ä¼ æ„Ÿå™¨æ•°æ®ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦è®¡ç®—å¾—åˆ°çš„é‡ï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨è¿™ä¸ªæµ‹é‡å¾—å‡ºçš„é‡æ¥æ›´æ–°æˆ‘ä»¬å¯¹çŠ¶æ€å‘é‡çš„ä¼°è®¡ï¼Ÿè¿™å°±æ¶‰åŠåˆ°æµ‹é‡æ›´æ–°æ–¹ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯å¡å°”æ›¼æ»¤æ³¢é‡Œæœ€éš¾çš„éƒ¨åˆ†ï¼Œè¿™é‡Œå…ˆç»™å‡ºæ›´æ–°æ–¹ç¨‹çš„å½¢å¼ã€‚</p>
<p><span class="math display">\[ \hat{\textbf{x}}^+_t=\hat{\textbf{x}}^-_t+K_t(z_t-H_t\hat{\textbf{x}}^-_t)\tag{5}\]</span> <span class="math display">\[ K_t=\frac{P^-_tH_t^T}{H_tP^-_tH_t^T+R_t}\tag{6}\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(K_t\)</span>å«åšå¡å°”æ›¼å¢ç›Šï¼›<span class="math inline">\(P^-_t\)</span>æ˜¯ç³»ç»Ÿæµ‹é‡å€¼<span class="math inline">\(\hat{\textbf{x}}^-_t\)</span>çš„è¯¯å·®åæ–¹å·®çŸ©é˜µã€‚</p>
<h1 id="å››è¯¯å·®å’Œåæ–¹å·®çŸ©é˜µ">å››ã€è¯¯å·®å’Œåæ–¹å·®çŸ©é˜µ</h1>
<p>æ ¹æ®å…¬å¼ï¼ˆ1ï¼‰å‡å»å…¬å¼ï¼ˆ2ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºè¯¯å·®çš„åæ–¹å·®çŸ©é˜µçš„è¡¨è¾¾å½¢å¼</p>
<p><span class="math display">\[ e^-_t \triangleq \textbf{x}_t - \hat{\textbf{x}}^-_t\\\]</span> <span class="math display">\[ P^-_t = \mathbb{E}[\textbf{e}^-_t {\textbf{e}^{-}_{t}}^T]\\\]</span></p>
<p>æŠŠå…¬å¼ï¼ˆ1ï¼‰å’Œï¼ˆ2ï¼‰å¸¦å…¥è¯¯å·®è¡¨è¾¾å¼ï¼Œå¯ä»¥æ¨å¯¼å‡ºç³»ç»ŸçŠ¶æ€çš„åæ–¹å·®çŸ©é˜µçš„é€’å½’è¡¨è¾¾å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
P^-_t&amp;=\mathbb{E}[\big((A_tx_{t-1}+w_t)-A_tx_{t-1}^+\big)\big((A_tx_{t-1}+w_t)-A_tx_{t-1}^+\big)^T]\\&amp;=\mathbb{E}[\big(A_t(x_{t-1}-x_{t-1}^+)+w_t\big)\big(A_t(x_{t-1}-x_{t-1}^+)+w_t\big)^T]\\ &amp;=\mathbb{E}[A_t(x_{t-1}-x_{t-1}^+)(x_{t-1}-x_{t-1}^+)^TA_t^T]+\mathbb{E}[w_tw_t^T]\\ &amp;=A_tP_{t-1}^+A_t^T+Q_t
\end{split}\\\]</span></p>
<p>å…¶ä¸­ï¼Œä»ç¬¬äºŒä¸ªç­‰å·åˆ°ç¬¬ä¸‰ä¸ªç­‰å·åˆ©ç”¨äº†çŠ¶æ€å‘é‡å’Œéšæœºå™ªå£° çš„æ— å…³æ€§ï¼ˆåæ–¹å·®ä¸º0ï¼‰ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢çš„å…¬å¼ï¼ˆ7ï¼‰</p>
<p><span class="math display">\[P^-_t=A_tP^+_{t-1}A^T_t+Q_t\tag{7}\]</span></p>
<h1 id="äº”æ›´æ–°æ–¹ç¨‹çš„æ¨å¯¼">äº”ã€æ›´æ–°æ–¹ç¨‹çš„æ¨å¯¼</h1>
<p>ç°åœ¨æˆ‘ä»¬è¿›è¡Œåˆ°äº†è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„æµ‹æ–¹ç¨‹å…¬å¼ï¼ˆ2ï¼‰å¾—åˆ°äº†<span class="math inline">\(t\)</span>æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€é¢„æµ‹é‡<span class="math inline">\(\textbf{x}_t^-\)</span>ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ—¶åˆ»å¾—åˆ°äº†ä¸€ä¸ªæµ‹é‡å€¼ï¼Œä¸”æ ¹æ®æµ‹é‡æ–¹ç¨‹ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä¸æ­¤æ—¶çš„çŠ¶æ€å‘é‡æ»¡è¶³å…¬å¼ï¼ˆ3ï¼‰ï¼š<span class="math inline">\(\textbf{z}_t=H_t\textbf{x}_t+v_t\)</span> ã€‚é‚£ä¹ˆå…¶å®æˆ‘ä»¬å¯ä»¥ä»å…¬å¼ï¼ˆ3ï¼‰ä¹Ÿå¾—åˆ°æ­¤æ—¶ç³»ç»ŸçŠ¶æ€çš„å¦ä¸€ä¸ªä¼°è®¡ï¼Œç”±å…¬å¼ï¼ˆ3ï¼‰å°† ç§»åŠ¨åˆ°ç­‰å¼å·¦ä¾§ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p>
<p><span class="math display">\[\textbf{x}^2_t = \textbf{H}_t^{-1}\textbf{z}_t\\\]</span></p>
<p>è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰æŠŠå™ªå£°<span class="math inline">\(\textbf{v}_t\)</span>è¡¨ç¤ºå‡ºæ¥ï¼Œæ˜¯å› ä¸ºè¿™é‡Œå°† å½“ä½œä¸€ä¸ªéšæœºå‘é‡å¤„ç†ï¼Œå…¶å‡å€¼ä¸º<span class="math inline">\(\bar{z}_t\)</span>ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ—¶åˆ»æµ‹é‡å¾—å‡ºçš„é‡ï¼›å…¶æ–¹å·®ä¸º<span class="math inline">\(R_t\)</span>ï¼ˆåœ¨å…¬å¼3ä¸­ç»™å‡ºï¼‰</p>
<p>æˆ‘ä»¬çš„çŠ¶æ€æ–¹ç¨‹ä¹Ÿç»™å‡ºäº†çŠ¶æ€å‘é‡çš„ä¸€ä¸ªç­‰å¼ <span class="math display">\[ \textbf{x}^1_t = \textbf{A}_t\textbf{x}_{t-1}+ \textbf{B}_t\textbf{u}_t+w_t\]</span></p>
<p>è¿™é‡Œç”¨<strong>ä¸Šæ ‡1å’Œ2</strong>è¡¨ç¤ºçŠ¶æ€å‘é‡çš„ä¸¤ä¸ªæ¥æºã€‚è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªç­‰å¼é‡Œé¢éƒ½åŒ…å«äº†ä¸€ä¸ªéšæœºå™ªå£°ï¼Œå› æ­¤$^1_t ã€^2_t $éƒ½æ˜¯éšæœºå‘é‡ã€‚åŒæ—¶ï¼Œä»–ä»¬çš„åˆ†å¸ƒéƒ½ç¬¦åˆé«˜æ–¯åˆ†å¸ƒã€‚å®ƒä»¬çš„å‡å€¼å’Œæ–¹å·®åˆ†åˆ«æ˜¯ï¼š</p>
<p><span class="math display">\[
\begin{split} &amp;\mu_1=x_t^-\\ &amp;\sigma_1^2=P_t^-\\ &amp;\mu_2=H_t^{-1}\bar{z}_t\\ &amp;\sigma_2^2=H_t^{-1}R_t(H_t^{-1})^T\\  \end{split}\\\]</span></p>
<p>ç°åœ¨æœ‰äº†ä¸¤ä¸ªå…³äºçŠ¶æ€å‘é‡çš„æ¦‚ç‡åˆ†å¸ƒï¼Œé‚£æ¥ä¸‹æ¥çš„äº‹æƒ…å°±ç®€å•äº†ã€‚å› ä¸ºè¿™ä¸¤ä¸ªçŠ¶æ€å‘é‡çš„æ¥æºæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤ä»–ä»¬çš„è”åˆæ¦‚ç‡åˆ†å¸ƒæ˜¯å„è‡ªæ¦‚ç‡åˆ†å¸ƒçš„ä¹˜ç§¯ã€‚é‡ç‚¹æ˜¯ï¼Œé«˜æ–¯åˆ†å¸ƒçš„ä¹˜ç§¯ä¾æ—§æ˜¯é«˜æ–¯åˆ†å¸ƒï¼ï¼ï¼ï¼æ–°çš„é«˜æ–¯åˆ†å¸ƒçš„å‡å€¼å’Œæ–¹å·®æœ‰å¦‚ä¸‹è¡¨è¾¾å½¢å¼ï¼š</p>
<figure>
<img src="./imgs/joint_gaussian.png" alt="" /><figcaption>joint gaussian</figcaption>
</figure>
<p>ç”¨ä¸Šé¢çš„å¼å­ä»£å…¥ï¼Œå¯ä»¥å¾—åˆ°è”åˆæ¦‚ç‡åˆ†å¸ƒçš„å‡å€¼å’Œæ–¹å·®ï¼š <strong>å‡å€¼</strong> <span class="math display">\[ \begin{split} \mu_{fused}&amp;=\frac{\mu_1\sigma_2^2+\mu_2\sigma_1^2}{\sigma_1^2+\sigma_2^2}\\ &amp;=\mu_1+\frac{(\mu_2-\mu_1)\sigma_1^2}{\sigma_1^2+\sigma_2^2}\\ &amp;=x_t^-+\frac{(H_t^{-1}\bar{z}_t-x_t^-)P_t^-}{P_t^-+H_t^{-1}R_t(H_t^{-1})^T}\\ &amp;=x_t^-+\frac{P_t^-H_t^T}{H_tP_t^-H_t^T+R_t}(\bar{z}_t-H_tx_t^-)\\ &amp;=x_t^-+K_t(\bar{z}_t-H_tx_t^-) \end{split}\\\]</span></p>
<p><strong>æ–¹å·®</strong></p>
<p><span class="math display">\[
\begin{split} \sigma_{fused}^2 &amp;=\frac{\sigma_1^2\sigma_2^2}{\sigma_1^2+\sigma_2^2}\\ &amp;=\sigma_1^2-\frac{\sigma_1^4}{\sigma_1^2+\sigma_2^2}\\ &amp;=P_t^--\frac{P_t^-H_t^TH_tP_t^-}{H_tP_t^-H_t^T+R_t}\\ &amp;=P_t^--K_tH_tP_t^- \end{split}\\\]</span></p>
<p>è¿™ä¸ª<span class="math inline">\(\sigma_{fused}^2\)</span>å°±æ˜¯æ›´æ–°åçš„ç³»ç»ŸçŠ¶æ€è¯¯å·®çš„åæ–¹å·®çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ä¸‹é¢çš„å¼å­</p>
<p><span class="math display">\[ P^+_{t}=P^-_t-K_tH_tP^-_t\tag{8}\]</span></p>
<h1 id="å…­æ€»ç»“">å…­ã€æ€»ç»“</h1>
<p><strong>é¢„æµ‹æ–¹ç¨‹</strong> <span class="math display">\[ \hat{\textbf{x}}^-_t = \textbf{A}_t\hat{\textbf{x}}^+_{t-1} + \textbf{B}_t\textbf{u}(t)\tag{2}\]</span> <span class="math display">\[P^-_t=A_tP^+_{t-1}A^T_t+Q_t\tag{7}\]</span></p>
<p><strong>æ›´æ–°æ–¹ç¨‹</strong> <span class="math display">\[ \hat{\textbf{x}}^+_t=\hat{\textbf{x}}^-_t+K_t(z_t-H_t\hat{\textbf{x}}^-_t)\tag{5}\]</span> <span class="math display">\[ K_t=\frac{P^-_tH_t^T}{H_tP^-_tH_t^T+R_t}\tag{6} \]</span> <span class="math display">\[ P^+_{t}=P^-_t-K_tH_tP^-_t\tag{8} \]</span></p>
<hr />
<h1 id="è½¬è½½é¡»çŸ¥">è½¬è½½é¡»çŸ¥</h1>
<ol type="1">
<li>è¯·äºæ–‡ç« æ ‡é¢˜æ³¨æ˜è½¬è½½</li>
<li>è¯·äºæ–‡ç« èµ·å§‹ä½ç½®æ³¨æ˜åŸå§‹é“¾æ¥</li>
<li>è¯·åœ¨æ¨æ–‡æ–‡æœ«çš„ã€é˜…è¯»åŸæ–‡ã€‘é“¾æ¥ä¸ŠåŸå§‹é“¾æ¥</li>
<li>æ„Ÿè°¢~</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/archives/page/2/">2</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/archives/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zeal</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cywzGuJ0w","appkey":"7c4a236bb42c7db38424a76bf68ccf99","count":true}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
