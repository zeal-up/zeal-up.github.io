<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zeal-up.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.15.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
<meta property="og:type" content="website">
<meta property="og:title" content="Zeal&#39;s Blog">
<meta property="og:url" content="https://zeal-up.github.io/archives/index.html">
<meta property="og:site_name" content="Zeal&#39;s Blog">
<meta property="og:description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zeal">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zeal-up.github.io/archives/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"archives/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zeal's Blog</title>
  
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-SE75EDBKX6","only_pageview":true}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?41fc030db57d5570dd22f78997dc4a7e"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>
  <a target="_blank" rel="noopener" href="https://github.com/zeal-up" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zeal's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">å¥½å¥½å­¦ä¹ ï½å¤©å¤©å‘ä¸Šï½</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zeal</p>
  <div class="site-description" itemprop="description">å­¦ä¹ è®°å½•åŠåˆ†äº«</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/06/12/slam-theory/manifold-integration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/12/slam-theory/manifold-integration/" class="post-title-link" itemprop="url">ä»IMUé¢„ç§¯åˆ†ç†è§£æœ€å¤§åéªŒæ¦‚ç‡é—®é¢˜åŠæä»£æ•°åº”ç”¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-06-12 17:36:16" itemprop="dateCreated datePublished" datetime="2023-06-12T17:36:16+08:00">2023-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-06-14 16:15:51" itemprop="dateModified" datetime="2023-06-14T16:15:51+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/Theory/" itemprop="url" rel="index"><span itemprop="name">Theory</span></a>
        </span>
    </span>

  
    <span id="/2023/06/12/slam-theory/manifold-integration/" class="post-meta-item leancloud_visitors" data-flag-title="ä»IMUé¢„ç§¯åˆ†ç†è§£æœ€å¤§åéªŒæ¦‚ç‡é—®é¢˜åŠæä»£æ•°åº”ç”¨" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="ä»IMUé¢„ç§¯åˆ†ç†è§£æœ€å¤§åéªŒæ¦‚ç‡é—®é¢˜åŠæä»£æ•°åº”ç”¨" href="/2023/06/12/slam-theory/manifold-integration/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::6de792b20332fd968c280dccbaee3292" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="æœ¬æ–‡å†…å®¹">æœ¬æ–‡å†…å®¹</h2>
<p>ä¸ºäº†èƒ½å¤Ÿæ›´æ·±åˆ»åœ°ç†è§£</p>
<ol type="1">
<li>åç«¯ä¼˜åŒ–ä¸­çš„æœ€å°äºŒä¹˜é—®é¢˜</li>
<li>æä»£æ•°åœ¨å®šä½åç«¯çš„åº”ç”¨</li>
</ol>
<p>è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæœ¬æ–‡ä½¿ç”¨IMUé¢„ç§¯åˆ†ä½œä¸ºä¸€ä¸ªå®é™…é—®é¢˜æ¥è”ç³»ä¸Šé¢ä¸¤ä¸ªå†…å®¹ã€‚IMUé¢„ç§¯åˆ†å¯ä»¥åœ¨æ¬§æ‹‰è§’è¡¨è¾¾ä¸‹è¿›è¡Œï¼Œä½†æ˜¯æ›´ä¼˜çš„æ–¹æ³•æ˜¯åœ¨æµå½¢ï¼ˆç‰¹æ®Šæ­£äº¤ç¾¤<span class="math inline">\(SO(3)\)</span>æ˜¯ä¸€ç§æµå½¢ï¼‰ä¸Šè¿›è¡Œã€‚å› æ­¤ï¼Œæœ¬æ–‡ä½¿ç”¨è®ºæ–‡<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1512.02363">ã€ŠOn-Manifold Preintegration for Real-TimeVisual-Inertial Odometryã€‹</a>æå‡ºçš„IMUé¢„ç§¯åˆ†æ–¹æ³•ä½œä¸ºåº”ç”¨å®ä¾‹ï¼Œåœ¨è®²è¿°æ–¹æ³•çš„åŒæ—¶å°†ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ç»“åˆå…¶ä¸­ï¼Œä½¿å¾—è¯»è€…ä¸æ­¢å¯¹ç†è®ºåŸºç¡€èƒ½å¤Ÿæœ‰æ‰€äº†è§£ï¼Œä¹Ÿèƒ½å¤Ÿæ˜ç™½æœ€å°äºŒä¹˜å’Œæä»£æ•°æ˜¯å¦‚ä½•è¢«ç”¨æ¥è§£å†³å®é™…é—®é¢˜çš„ã€‚</p>
<h2 id="ä¸€åŸºç¡€ç†è®ºçŸ¥è¯†">ä¸€ã€åŸºç¡€ç†è®ºçŸ¥è¯†</h2>
<p>å…³äºå®šä½åç«¯ä¼˜åŒ–æ˜¯å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡å½¢å¼å˜æˆæœ€å°äºŒä¹˜é—®é¢˜ï¼Œå¯ä»¥é˜…è¯»ç¬”è€…çš„ä¸¤ç¯‡æ–‡ç« ï¼šã€Šåç«¯ä¼˜åŒ–å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆç†è®ºç¯‡ï¼‰/ï¼ˆåº”ç”¨ç¯‡ï¼‰ã€‹</p>
<p>å…³äºæä»£æ•°åŸºç¡€çŸ¥è¯†å¯ä»¥é˜…è¯»ç¬”è€…è¿™ç¯‡æ–‡ç« ï¼šã€ŠSLAM/å®šä½ä¸­æä»£æ•°åŸºç¡€æ¦‚å¿µåŠå…¬å¼ã€‹ï¼ˆæä»£æ•°åŸºç¡€çŸ¥è¯†ä¹Ÿå¯ä»¥é˜…è¯»SLAMåå››è®²çš„ç›¸åº”å†…å®¹ï¼‰</p>
<h3 id="é‡è¦å®šç†æ€§è´¨å¤‡å¿˜">é‡è¦å®šç†/æ€§è´¨å¤‡å¿˜</h3>
<p>PS:è¿™éƒ¨åˆ†ç›´æ¥è·³è¿‡ï¼Œåæ–‡æ¨å¯¼è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°è¿™äº›æ€§è´¨å†å›å¤´çœ‹å³å¯</p>
<p><strong>æ–œå¯¹ç§°çŸ©é˜µæ€§è´¨</strong></p>
<p><span class="math display">\[
\begin{array}{lcl}
\boldsymbol{a}^{\wedge}\boldsymbol{b} = -\boldsymbol{b}^{\wedge}\boldsymbol{a} &amp;&amp; \forall \boldsymbol{a,b} \in \mathbb{R}^3
\end{array}\tag{1-1}
\]</span></p>
<p><strong>æŒ‡æ•°æ˜ å°„å…¬å¼</strong></p>
<p><span class="math display">\[
\exp(\boldsymbol{\phi}^{\wedge}) = \mathbf{I}+\frac{\sin{(||\boldsymbol{\phi}||)}}{||\boldsymbol{\phi}||}\boldsymbol{\phi}^{\wedge}+\frac{1-\cos{(||\boldsymbol{\phi}||)}}{||\boldsymbol{\phi}||^2}(\boldsymbol{\phi}^{\wedge})^2\tag{1-2}
\]</span></p>
<p><strong>æŒ‡æ•°æ˜ å°„ä¸€é˜¶è¿‘ä¼¼</strong></p>
<p><span class="math display">\[
\exp(\boldsymbol{\phi}^{\wedge})\approx \mathbf{I}+\boldsymbol{\phi}^{\wedge}\tag{1-3}
\]</span></p>
<p><strong>å‘é‡å½¢å¼çš„æŒ‡æ•°/å¯¹æ•°æ˜ å°„</strong></p>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è®°<span class="math inline">\(\operatorname{Exp}(\cdot)\)</span>å’Œ<span class="math inline">\(\operatorname{Log}(\cdot)\)</span>ä¸ºå‘é‡å½¢å¼çš„å¯¹æ•°å’ŒæŒ‡æ•°æ˜ å°„</p>
<p><span class="math display">\[
\begin{array}{}
\operatorname{Exp}:&amp;\mathbb{R}^3 \rightarrow SO(3)\\
\operatorname{Log}:&amp;SO(3)\rightarrow \mathbb{R}^3
\end{array}\tag{1-4}
\]</span></p>
<p><strong>BCHä¸€é˜¶è¿‘ä¼¼</strong></p>
<p><span class="math display">\[
\operatorname{Exp}(\phi+\delta{\phi})\approx \operatorname{Exp}(\phi)\operatorname{Exp}(J_r(\phi)\delta{\phi})\tag{1-5}
\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(J_r(\phi)\)</span>ç§°ä¸ºå³é›…å¯æ¯”çŸ©é˜µ</p>
<p>BCHä¸€é˜¶è¿‘ä¼¼è¿˜æœ‰å¦ä¸€ç§å†™æ³•</p>
<p><span class="math display">\[
\operatorname{Log}\left(\operatorname{Exp}(\phi)\operatorname{Exp}(\delta{\phi})\right)\approx 
\phi + J_r^{-1}(\phi)\delta{\phi}\tag{1-6}
\]</span></p>
<p><strong>æŒ‡æ•°æ˜ å°„æ€§è´¨</strong></p>
<p><span class="math display">\[
R\operatorname{Exp}(\phi)R^T=\operatorname{Exp}(R\phi^{\wedge}R^T)=\operatorname{Exp}(R\phi)\tag{1-7}
\]</span></p>
<p>ä¸Šå¼ä¹Ÿå¯å¾—</p>
<p><span class="math display">\[
\operatorname{Exp}(\phi)R = R\operatorname{Exp}(R^T\phi)\tag{1-8}
\]</span></p>
<p>å¦æœ‰ï¼Œå½“<span class="math inline">\(\delta{\phi}\)</span>ä¸ºå¾®å°é‡</p>
<p><span class="math display">\[
\operatorname{Exp}(-\delta{\phi})^T=\operatorname{Exp}(\delta{\phi})\tag{1-9}
\]</span></p>
<p><strong>å³é›…å¯æ¯”çŸ©é˜µæ€§è´¨</strong></p>
<p>åœ¨å…¬å¼ï¼ˆ1-5ï¼‰ä¸­çš„<span class="math inline">\(J_r(\phi)\)</span>ï¼Œå¦‚æœ<span class="math inline">\(\phi\)</span>æ˜¯å¾®å°é‡ï¼Œåˆ™å…¶è¿‘ä¼¼ä¸ºå•ä½çŸ©é˜µã€‚è®°ä¸º</p>
<p><span class="math display">\[
J_r(\delta{\phi})\approx\mathbf{I},\quad \text{when }\delta{\phi}\text{ is small}\tag{1-10}
\]</span></p>
<p><strong>æ—‹è½¬çŸ©é˜µçš„æ‰°åŠ¨æ¨¡å‹</strong></p>
<p>å½“æ—‹è½¬çŸ©é˜µçš„åˆ†å¸ƒå…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<p><span class="math display">\[
\tilde{R}=R\operatorname{Exp}(\epsilon),\quad \epsilon \sim \mathcal{N}(0,\Sigma)\tag{1-11}
\]</span></p>
<p>å…¶è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼ˆnegative log-likelihoodï¼‰æœ‰å¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
\mathcal{L}(R)&amp;=\frac{1}{2}||\operatorname{Log}(R^{-1}\tilde{R})||^2_{\Sigma}+const\\
&amp;=\
\frac{1}{2}||\operatorname{Log}(\tilde{R}^{-1}R)||^2_{\Sigma}+const
\end{split}\tag{1-12}
\]</span></p>
<h2 id="äºŒé—®é¢˜å¼•å‡º">äºŒã€é—®é¢˜å¼•å‡º</h2>
<p>ç›®å‰SLAMæ–¹æ¡ˆåŒ…å«å‰ç«¯å’Œåç«¯ã€‚å‰ç«¯ä½¿ç”¨è§†è§‰/æ¿€å…‰ï¼ŒèåˆIMUæ•°æ®è¾“å‡ºä¸€ä¸ªé‡Œç¨‹è®¡;åç«¯å°è¯•ä»å†å²è½¨è¿¹å’Œå›ç¯æ£€æµ‹ä¸­ä¼˜åŒ–å‡ºæ›´å‡†ç¡®çš„å†å²ä½å§¿ã€‚IMUåœ¨å‰åç«¯éƒ½æ‰¿æ‹…ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„è§’è‰²ã€‚IMUæ•°æ®è¿›è¡Œç§¯åˆ†ï¼Œå¯ä»¥çš„åˆ°æ—‹è½¬å’Œä½ç½®çš„ä¼°è®¡ï¼Œè¿™ä¸ªä¼°è®¡å¯ä»¥ç”¨æ¥åšè§†è§‰/ç‚¹äº‘åŒ¹é…çš„åˆå§‹ä½å§¿ã€‚IMUç§¯åˆ†éœ€è¦ä»¥æŸä¸€å¸§çš„çŠ¶æ€ä½œä¸ºåŸºç¡€å¾€ä¸‹æŒç»­ç´¯åŠ ï¼Œä½†æ˜¯SLAMåç«¯çš„ä¼˜åŒ–ä¼šæ”¹å˜å†å²è½¨è¿¹ä½å§¿ï¼Œå¯¼è‡´IMUç§¯åˆ†éœ€è¦é‡æ–°è®¡ç®—ã€‚ä¸ºäº†é¿å…é‡å¤ç§¯åˆ†çš„é—®é¢˜ï¼Œå¯ä»¥å°†IMUçš„ç§¯åˆ†å½¢å¼å˜åŒ–ä¸ºå¯¹ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´æ•°æ®è¿›è¡Œç´¯ç§¯ï¼Œè·å¾—ä¸¤å¸§ä¹‹é—´çš„ç›¸å¯¹çŠ¶æ€å˜åŒ–ï¼Œæ­¤ç§°ä¸º<strong>IMUé¢„ç§¯åˆ†</strong></p>
<figure>
<img src="./imgs/01-keyframes_imu_pre.png" alt="" /><figcaption>IMUé¢„ç§¯åˆ†</figcaption>
</figure>
<h3 id="imué¢„ç§¯åˆ†ç§¯åˆ†">IMUé¢„ç§¯åˆ†/ç§¯åˆ†</h3>
<p><strong>IMUç§¯åˆ†</strong> : ä»¥æŸä¸€æ—¶åˆ»çš„çŠ¶æ€ä¸ºåŸºç¡€ï¼ˆä½å§¿ã€é€Ÿåº¦ï¼‰ï¼Œå¯¹åç»­çš„IMUè¾“å‡ºï¼ˆè§’é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰è¿›è¡Œç§¯åˆ†ï¼ˆç´¯åŠ ï¼‰ï¼Œå¾—åˆ°åç»­æ—¶åˆ»çš„çŠ¶æ€ï¼ˆä½å§¿ã€é€Ÿåº¦ï¼‰</p>
<p><strong>IMUé¢„ç§¯åˆ†</strong> ï¼š å°†ä¸¤å¸§ä¹‹é—´çš„IMUè¾“å‡ºï¼ˆè§’é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰è¿›è¡Œç§¯åˆ†ï¼ˆç´¯åŠ ï¼‰ï¼Œå¾—åˆ°ä¸¤å¸§ä¹‹é—´çš„ç›¸å¯¹çŠ¶æ€ï¼ˆç›¸å¯¹æ—‹è½¬ã€ç›¸å¯¹é€Ÿåº¦ã€ç›¸å¯¹ä½ç½®ï¼‰</p>
<h3 id="åæ ‡ç³»">åæ ‡ç³»</h3>
<figure>
<img src="./imgs/02-coordinate_system.png" alt="" /><figcaption>åæ ‡ç³»å®šä¹‰</figcaption>
</figure>
<p>æœ¬æ–‡ä»¥è§†è§‰æƒ¯æ€§SLAMä¸ºåº”ç”¨åœºæ™¯ã€‚IMUåæ ‡ç³»åˆç§°ä½œBodyåæ ‡ç³»ï¼Œç›¸æœºåæ ‡ç³»ï¼ˆCamï¼‰ä¸Bodyåæ ‡ç³»æœ‰ä¸€ä¸ªå›ºå®šä½å§¿å˜æ¢<span class="math inline">\(T_{BC}\)</span>ã€‚è½¦è¾†ä½å§¿ä¸ºè½¦è¾†åœ¨ä¸–ç•Œï¼ˆWorldï¼‰åæ ‡ç³»ä¸‹çš„å§¿æ€<span class="math inline">\(T_{WB}=(R_{WB},_W\boldsymbol{p})\)</span></p>
<h3 id="æ¨å¯¼çš„æœ€ç»ˆç›®çš„é‡è¦">æ¨å¯¼çš„æœ€ç»ˆç›®çš„ï¼ˆé‡è¦ï¼ï¼ï¼‰</h3>
<p><strong>æ¨å¯¼æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿå°†é¢„ç§¯åˆ†åçš„ç»“æœï¼ˆçŠ¶æ€Stateï¼‰æ„é€ æˆæœ€å°äºŒä¹˜å½¢å¼ï¼Œä¹Ÿå°±æ˜¯è¯¯å·®çš„å¹³æ–¹</strong></p>
<p>ä¸ºäº†èƒ½å¤Ÿè·å¾—æœ€å°äºŒä¹˜å½¢å¼ï¼Œéœ€è¦å°†çŠ¶æ€æ„é€ æˆçœŸå€¼+é«˜æ–¯å™ªå£°çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯æµ‹é‡å€¼çš„ä¼¼ç„¶å‡½æ•°ï¼Œè¿™æ ·ï¼Œåªéœ€è¦å¯¹ä¼¼ç„¶å‡½æ•°å–è´Ÿå¯¹æ•°å³å¯ã€‚æ³¨æ„ï¼Œè¿˜éœ€è¦è·å¾—å™ªå£°çš„åæ–¹å·®è¡¨è¾¾ï¼Œå› ä¸ºåæ–¹å·®çš„å€’æ•°ï¼Œå³ä¿¡æ¯çŸ©é˜µï¼Œéœ€è¦ç”¨æ¥å¯¹äºŒæ¬¡é¡¹åŠ æƒ</p>
<p><span class="math display">\[
\begin{array}{lcl}
\tilde{\mathcal{X}} = \mathcal{X} \oplus \epsilon, &amp;&amp; \epsilon \sim \mathcal{N}\left(0,\Sigma\right)\tag{2-1}
\end{array}
\]</span></p>
<p>ä¸Šè¿°ä¸­<span class="math inline">\(\mathcal{X}\)</span>è¡¨ç¤ºçŠ¶æ€ï¼Œé€šå¸¸æ˜¯æ—‹è½¬ã€å¹³ç§»ã€é€Ÿåº¦ã€IMUåå·®ç­‰ã€‚ä¸Šé¢å…¬å¼ä¹‹æ‰€ä»¥ç”¨å¤åˆç¬¦å·<span class="math inline">\(\oplus\)</span>æ˜¯å› ä¸ºæœ‰äº›çŠ¶æ€å˜é‡ï¼Œæ¯”å¦‚æ—‹è½¬æ˜¯ä¸èƒ½ç›´æ¥ç›¸åŠ çš„ï¼Œå¯¹äºæ—‹è½¬çŸ©é˜µï¼Œ<span class="math inline">\(\oplus\)</span>æ˜¯çŸ©é˜µä¹˜æ³•</p>
<p>åªè¦æˆ‘ä»¬æ¨å¯¼å‡ºå…¬å¼ï¼ˆ2-1ï¼‰ï¼Œå°±å¯ä»¥å°†é«˜æ–¯åˆ†å¸ƒç”¨è´Ÿå¯¹æ•°çš„å½¢å¼å˜åŒ–ä¸ºæœ€å°äºŒä¹˜å½¢å¼</p>
<p><span class="math display">\[
\underset{\mathcal{X}}{\operatorname{argmin}}||\tilde{\mathcal{X}}\ominus\mathcal{X}||^2_{\Sigma}\tag{2-2}
\]</span></p>
<p><strong>é‡ç”³ï¼Œæˆ‘ä»¬éœ€è¦æ¨å¯¼å‡ºä»¥ä¸‹å†…å®¹</strong></p>
<ol type="1">
<li>çŠ¶æ€å‘é‡çš„é«˜æ–¯åˆ†å¸ƒå½¢å¼ï¼ˆçœŸå€¼+é«˜æ–¯å™ªå£°ï¼‰</li>
<li>å™ªå£°çš„åæ–¹å·®è¡¨è¾¾</li>
</ol>
<h3 id="æ–¹æ³•è¦ç‚¹é‡è¦">æ–¹æ³•è¦ç‚¹ï¼ˆé‡è¦ï¼ï¼ï¼‰</h3>
<ol type="1">
<li>æ‰€æœ‰çš„æ¨å¯¼éƒ½åœ¨æµå½¢ï¼ˆæç¾¤ï¼‰ä¸Šæ¨å¯¼ã€‚æœ¬æ–‡çš„æ¨å¯¼åªç”¨åˆ°äº†ç‰¹æ®Šæ­£äº¤ç¾¤<span class="math inline">\(SO(3)\)</span>ã€‚è¿™æ ·ï¼Œä¼˜åŒ–è¿‡ç¨‹å¯ä»¥åœ¨æä»£æ•°ç©ºé—´ä¸Šè¿›è¡Œï¼Œä¸ç”¨è€ƒè™‘æ—‹è½¬çŸ©é˜µçš„çº¦æŸ</li>
<li>ä¸ºäº†é¿å…ä¼˜åŒ–çš„æ—¶å€™æ¯ä¸€ä¸ªIMUæµ‹é‡å°±éœ€è¦å¢åŠ ä¸€ä¸ªä¼˜åŒ–å› ç´ ï¼Œå°†ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´çš„çš„æ‰€æœ‰IMUæ•°æ®ç§¯åˆ†ä½œä¸ºä¸€ä¸ªçº¦æŸåŠ å…¥åç«¯ä¼˜åŒ–ã€‚ï¼ˆå¸¸è§åšæ³•ï¼‰</li>
<li>å°†IMUçš„ç§¯åˆ†å…¬å¼é‡æ–°æ¨å¯¼æˆIMUé¢„ç§¯åˆ†å½¢å¼ï¼Œä½¿å¾—å½“åç«¯ä¼˜åŒ–æ”¹å˜å†å²ä½å§¿æ—¶ï¼Œä¸éœ€è¦é‡æ–°æ‰§è¡Œç§¯åˆ†è¿‡ç¨‹</li>
</ol>
<h3 id="æ¨å¯¼è¿‡ç¨‹æ€»è¿°">æ¨å¯¼è¿‡ç¨‹æ€»è¿°</h3>
<ol type="1">
<li>æ ¹æ®IMUæ¨¡å‹ï¼Œæ„é€ IMUç§¯åˆ†å½¢å¼ï¼ˆåœ¨æµå½¢ä¸Šè¿›è¡Œæ¨å¯¼ï¼Œä½¿å¾—ä¼˜åŒ–å¯ä»¥åœ¨æä»£æ•°ç©ºé—´ä¸Šè¿›è¡Œï¼Œä¸éœ€è¦è€ƒè™‘æ—‹è½¬çš„çº¦æŸï¼‰</li>
<li>å°†IMUç§¯åˆ†å…¬å¼å˜åŒ–ä¸ºåœ¨ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´æ‰€æœ‰IMUæµ‹é‡çš„ç§¯åˆ†</li>
<li>æ„é€ çŠ¶æ€å˜åŒ–çš„é¢„ç§¯åˆ†å½¢å¼ï¼Œä½¿å¾—ç§¯åˆ†è¿‡ç¨‹åœ¨å†å²ä½å§¿ç”±äºåç«¯ä¼˜åŒ–å˜åŒ–ä¹‹åä¸éœ€è¦é‡æ–°æ‰§è¡Œã€‚æ­¤æ—¶è¿˜ä¾èµ–å†å²æ—¶åˆ»çš„IMUåå·®</li>
<li>å°†å™ªå£°ä»é¢„ç§¯åˆ†å…¬å¼ä»é¢„ç§¯åˆ†å…¬å¼ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œæ„é€ ï¼ˆ2-1ï¼‰çš„æ ‡å‡†å½¢å¼</li>
<li>æ¨å¯¼åæ–¹å·®çš„é€’æ¨å½¢å¼</li>
<li>å°†å†å²æ—¶åˆ»çš„Biasä»é¢„ç§¯åˆ†å…¬å¼ä¸­å‰¥ç¦»ï¼Œä½¿å¾—é¢„ç§¯åˆ†å…¬å¼å®Œå…¨ä¸ä¾èµ–å†å²æ—¶åˆ»çš„çŠ¶æ€</li>
<li>æ¨å¯¼å½“IMUåå·®æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚ä½•æ›´æ–°é¢„ç§¯åˆ†ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—</li>
</ol>
<h2 id="ä¸‰çŠ¶æ€å‘é‡åŠä¼˜åŒ–ç›®æ ‡">ä¸‰ã€çŠ¶æ€å‘é‡åŠä¼˜åŒ–ç›®æ ‡</h2>
<p>çŠ¶æ€å‘é‡ï¼ˆStateï¼‰æè¿°<span class="math inline">\(i\)</span>æ—¶åˆ»è½¦è¾†çš„æ—‹è½¬ã€ä½ç½®ã€é€Ÿåº¦ã€IMUåå·®</p>
<p><span class="math display">\[
\textbf{x}_i\overset{\cdot}{=}[\text{R}_i,\textbf{p}_i,\textbf{v}_i,\textbf{b}_i]\tag{3-1}
\]</span></p>
<p>è½¦è¾†ï¼ˆBodyï¼‰åæ ‡ç³»ä¸IMUåæ ‡ç³»å‡è®¾ä¸ºç›¸åŒåæ ‡ç³»ï¼Œå› æ­¤ä¸Šå¼ä¹Ÿæ˜¯<span class="math inline">\(i\)</span>æ—¶åˆ»çš„IMUçŠ¶æ€</p>
<p>å…¶ä¸­</p>
<ul>
<li><span class="math inline">\(\textbf{v}_i \in \mathbb{R}^3\)</span></li>
<li><span class="math inline">\(\textbf{b}_i = [\textbf{b}_i^g \quad \textbf{b}_i^a] \in \mathbb{R}^6\)</span>æ˜¯è§’é€Ÿåº¦ï¼ˆgyroscopeï¼‰å’ŒåŠ é€Ÿåº¦ï¼ˆaccelerometerï¼‰çš„åå·®</li>
</ul>
<hr />
<p><strong>è®°ä¸‹åˆ—ç¬¦å·</strong></p>
<ul>
<li><p><span class="math inline">\(\mathcal{K}_k\)</span>ä¸º<span class="math inline">\(k\)</span>æ—¶åˆ»ä¹‹å‰çš„æ‰€æœ‰å…³é”®å¸§</p></li>
<li><p>å¹¶è®°çŠ¶æ€é›†åˆä¸º</p></li>
</ul>
<p><span class="math display">\[
\mathcal{X}_k \overset{\cdot}{=}\{\textbf{x}_i\}_{i\in \mathcal{K}_k}\tag{3-2}
\]</span></p>
<ul>
<li><span class="math inline">\(\mathcal{I}_{ij},(i,j)\in \mathcal{K}_k\)</span>ä¸ºå…³é”®å¸§<span class="math inline">\(i,j\)</span>ä¹‹é—´çš„æ‰€æœ‰IMUæµ‹é‡</li>
</ul>
<hr />
<p>ä¼¼ç„¶å‡½æ•°</p>
<p><span class="math display">\[
\begin{split}
p(\mathcal{X}_k|\mathcal{I}_k) &amp; \propto p(\mathcal{X}_0)p(\mathcal{I}_k|\mathcal{X}_k)\\
&amp;=\
p(\mathcal{X}_0)\prod_{(i,j)\in \mathcal{K}_k}p(\mathcal{I}_{ij}|\textbf{x}_i, \textbf{x}_j)
\end{split}\tag{3-3}
\]</span></p>
<p>å…¶ä¸­ç”¨åˆ°äº†ç‹¬ç«‹åŒåˆ†å¸ƒæ€§è´¨å’Œé©¬å°”å¯å¤«å‡è®¾</p>
<hr />
<p>ä¼˜åŒ–çš„æœ€å°äºŒä¹˜å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
\mathcal{X}^{*}_k
&amp;=\
\underset{\mathcal{K}_k}{\operatorname{argmin}} -\log_ep(\mathcal{X}_k|\mathcal{I}_k)\\
&amp;=\
\underset{\mathcal{K}_k}{\operatorname{argmin}}\sum_{(i,j)\in \mathcal{K}_k}||\mathbf{r}_{\mathcal{I}_{ij}}||^2_{\Sigma_{ij}} + ||\textbf{r}_0||^2_{\Sigma_0}
\end{split}\tag{3-4}
\]</span></p>
<h2 id="å››imuæ¨¡å‹">å››ã€IMUæ¨¡å‹</h2>
<p><span class="math display">\[
_\text{B}\tilde{\boldsymbol{\omega}}(t)= {_\text{B}\boldsymbol{\omega(t)}} + \textbf{b}^g(t)+ \boldsymbol{\eta}^g(t)\tag{4-1}
\]</span></p>
<p><span class="math display">\[
_\text{B}\tilde{\textbf{a}}(t)=R^T_{\text{WB}}(t)\left({_\text{W}\textbf{a}(t)} - {_\text{W}\textbf{g}}\right) + \textbf{b}^a(t) + \boldsymbol{\eta}^a(t)\tag{4-2}
\]</span></p>
<p>å…¶ä¸­</p>
<ul>
<li><span class="math inline">\(_\text{B}\)</span> å‰ä¸‹æ ‡æ„å‘³ç€è¯¥é‡æ˜¯åœ¨Bodyåæ ‡ç³»ä¸‹ã€‚å¦‚ <span class="math inline">\(_\text{B}\tilde{\boldsymbol{\omega}}(t)\)</span>æ˜¯åœ¨Bodyåæ ‡ç³»ä¸‹çš„è§’é€Ÿåº¦ï¼Œä¹Ÿå°±æ˜¯IMUé™€èºä»ªçš„è¾“å‡º</li>
<li><span class="math inline">\(\textbf{b}^g,\textbf{b}^a\)</span>æ˜¯IMUè§’é€Ÿåº¦å’ŒåŠ é€Ÿåº¦çš„åå·®ï¼Œè¿™ä¸¤è€…ä¹Ÿæ˜¯ä¸€ä¸ªéšç€æ—¶é—´ç¼“æ…¢å˜åŒ–çš„é‡</li>
<li><span class="math inline">\(\boldsymbol{\eta}^g, \boldsymbol{\eta}^a\)</span>æ˜¯è§’é€Ÿåº¦å’ŒåŠ é€Ÿåº¦çš„å™ªå£°ã€‚å‡å€¼ä¸º0çš„é«˜æ–¯å™ªå£°</li>
</ul>
<p>å¯¹äºç¦»æ•£ï¼ˆdiscretï¼‰å½¢å¼çš„é«˜æ–¯å™ªå£°<span class="math inline">\(\boldsymbol{\eta}^{gd}, \boldsymbol{\eta}^{ad}\)</span>ï¼Œä»–ä»¬çš„åæ–¹å·®ä¸è¿ç»­å½¢å¼é«˜æ–¯å™ªå£°çš„åŠŸç‡è°±å¼ºåº¦å…·æœ‰å¦‚ä¸‹å…³ç³»</p>
<p><span class="math display">\[
\text{Cov}(\boldsymbol{\eta}^{gd}) = \frac{1}{\Delta{t}}\text{Cov}(\boldsymbol{\eta}^{g})\tag{4-3}
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(\Delta{t}\)</span>æ˜¯é‡‡æ ·æ—¶é—´å‘¨æœŸ</p>
<h2 id="äº”è¿åŠ¨æ¨¡å‹åŠç§¯åˆ†">äº”ã€è¿åŠ¨æ¨¡å‹åŠç§¯åˆ†</h2>
<p><strong><em>ä¸ºäº†ä½¿å¾—æ•´ä½“æ€è·¯æ¸…æ™°ï¼Œç®€åŒ–æ¨å¯¼è¿‡ç¨‹ï¼Œåæ–‡éƒ½ä¼šé‡ç‚¹æ”¾åœ¨çŠ¶æ€å‘é‡ä¸­çš„æ—‹è½¬éƒ¨åˆ†</em></strong></p>
<h3 id="è¿åŠ¨æ¨¡å‹">è¿åŠ¨æ¨¡å‹</h3>
<p><span class="math display">\[
\begin{split}
&amp;\dot{R}_{\text{WB}}=R_{\text{WB}}\ {_{\text{B}}\boldsymbol{\omega}^{\wedge}}\\
\end{split}\tag{5-1}
\]</span></p>
<p>ä¸Šå¼ä¸­<span class="math inline">\(\dot{R}_{\text{WB}}\)</span>è¡¨ç¤º<span class="math inline">\({R}_{\text{WB}}\)</span>çš„å¯¼æ•°ã€‚ä¸Šå¼æ˜¯æ—‹è½¬çŸ©é˜µè§’è¿åŠ¨æ–¹ç¨‹ï¼Œå…·ä½“æ¨å¯¼è¿‡ç¨‹è¯»è€…å¯ä»¥æŸ¥æ‰¾æ—‹è½¬çŸ©é˜µæ±‚å¯¼ç›¸å…³èµ„æ–™</p>
<h3 id="è¿åŠ¨æ¨¡å‹çš„ç§¯åˆ†">è¿åŠ¨æ¨¡å‹çš„ç§¯åˆ†</h3>
<p>å‡è®¾<span class="math inline">\(_{\text{B}}\boldsymbol{\omega}\)</span>åœ¨æ—¶é—´é—´éš”<span class="math inline">\([t,t+\Delta{t}]\)</span>å†…ä¿æŒä¸å˜ï¼Œåˆ™å…¬å¼ï¼ˆ5-1ï¼‰çš„<strong>ç¦»æ•£å½¢å¼ç§¯åˆ†</strong> ä¸º</p>
<p><span class="math display">\[
R_{\text{WB}}(t+\Delta{t})=R_{\text{WB}}(t)\operatorname{Exp}\Big({_{\text{B}}\boldsymbol{\omega}}(t)\Delta{t}\Big)\tag{5-2}
\]</span></p>
<p>å…¬å¼ï¼ˆ5-2ï¼‰æ˜¯å¾®åˆ†æ–¹ç¨‹ï¼ˆ5-1ï¼‰çš„è§£ã€‚å¦‚æœè¿™é‡Œæ€ç»´å¡ä½äº†ï¼Œä¸è¦æ·±ç©¶ï¼Œè®°ä½ï¼ˆ5-2ï¼‰çš„ç»“è®ºå³å¯</p>
<p>å°†IMUæ¨¡å‹â€”â€”å…¬å¼ï¼ˆ4-1ï¼‰å¸¦å…¥å…¬å¼ï¼ˆ5-1ï¼‰ï¼Œå¯å¾—</p>
<p><span class="math display">\[
R(t+\Delta{t})=R(t)\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}(t)-\textbf{b}^g(t)-\boldsymbol{\eta}^{gd}(t)\right)\Delta{t}\Big) \tag{5-3}
\]</span></p>
<p>ä¸Šå¼ä¸­<span class="math inline">\(\boldsymbol{\eta}^{gd}(t)\)</span>æ˜¯é«˜æ–¯å™ªå£°çš„ç¦»æ•£å½¢å¼ï¼Œä¸”åæ–¹å·®ä¸è¿ç»­å½¢å¼çš„åŠŸç‡è°±å¼ºåº¦æœ‰å…¬å¼ï¼ˆ4-3ï¼‰çš„è”ç³»</p>
<p>å…¬å¼ï¼ˆ5-3ï¼‰å»æ‰äº†ä¸Šä¸‹æ ‡ï¼Œä¸è¿‡ç°åœ¨åº”è¯¥ä¸ä¼šå¼•èµ·æ­§ä¹‰äº†</p>
<p><strong><em>è¦æ³¨æ„çš„æ˜¯</em></strong> ï¼Œå…¬å¼ï¼ˆ5-3ï¼‰æ˜¯å‡è®¾åœ¨IMUçš„é‡‡æ ·å‘¨æœŸ<span class="math inline">\(\Delta{t}\)</span>å†…è§’é€Ÿåº¦æ˜¯ä¸å˜çš„ï¼Œè¿™ä¸€ç‚¹è™½ç„¶ä¸æ˜¯äº‹å®ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¾ƒé«˜é¢‘ç‡çš„IMUé¿å…ç”±äºè¿™ä¸€ç‚¹å¼•èµ·çš„è¯¯å·®ã€‚ï¼ˆå¸¸è§çš„IMUé¢‘ç‡ä¸º200-500Hzï¼‰</p>
<h3 id="è¿åŠ¨æ¨¡å‹ç§¯åˆ†çš„ç´¯ç§¯å½¢å¼">è¿åŠ¨æ¨¡å‹ç§¯åˆ†çš„ç´¯ç§¯å½¢å¼</h3>
<p>å…¬å¼ï¼ˆ5-3ï¼‰æ˜¯å¯¹ä¸€ä¸ªIMUçš„æµ‹é‡æ•°æ®åšç§¯åˆ†ï¼Œä¸ºäº†å¾—åˆ°ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´çš„ç§¯åˆ†ï¼Œæˆ‘ä»¬å°†å…³é”®å¸§<span class="math inline">\((i,j)\)</span>ä¹‹é—´çš„æ‰€æœ‰IMUæµ‹é‡éƒ½ç´¯è®¡èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
R_j = R_i\prod^{j-1}_{k=i}\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_k-\boldsymbol{\eta}^{gd}_k\right)\Delta{t}\Big)\tag{5-4}
\]</span></p>
<p>ç”±äºåå·®æ˜¯ç¼“æ…¢å˜åŒ–çš„ï¼ˆæ‰€è°“çš„å¸ƒæœ—è¿åŠ¨ï¼Œä¹Ÿå°±æ˜¯ç™½å™ªå£°çš„ç§¯åˆ†ï¼‰ï¼Œæ‰€ä»¥åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»¤å…³é”®å¸§<span class="math inline">\((i,j)\)</span>ä¹‹é—´çš„åå·®ä¿æŒä¸å˜</p>
<p><span class="math display">\[
\boldsymbol{\eta}^{gd}_i=\boldsymbol{\eta}^{gd}_{i+1}=...=\boldsymbol{\eta}^{gd}_{j-1}\tag{5-5}
\]</span></p>
<h2 id="å…­é¢„ç§¯åˆ†ç›¸å¯¹å¢é‡å½¢å¼">å…­ã€é¢„ç§¯åˆ†/ç›¸å¯¹å¢é‡å½¢å¼</h2>
<p>å…¬å¼ï¼ˆ5-4ï¼‰è®©æˆ‘ä»¬æ ¹æ®IMUçš„è¾“å‡ºå¾—åˆ°äº†ä¸¤å¸§ä¹‹é—´æ—‹è½¬çš„çº¦æŸï¼Œä½†æ˜¯å…¬å¼ï¼ˆ5-4ï¼‰ç­‰å·çš„å³ä¾§ä¸<span class="math inline">\(i\)</span>æ—¶åˆ»çš„æ—‹è½¬å’Œ <strong>åå·®</strong> ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯ä¸<span class="math inline">\(i\)</span>æ—¶åˆ»çš„çŠ¶æ€ <span class="math inline">\(\textbf{x}_i\)</span>ç›¸å…³ã€‚è¿™é‡Œçš„ç¼ºæ†¾åœ¨äºï¼Œå½“æˆ‘ä»¬åœ¨åç«¯ä¼˜åŒ–å¯¹å†å²è½¨è¿¹ä¼˜åŒ–ä¹‹åï¼Œ<span class="math inline">\(\textbf{x}_i\)</span>ä¼šæ”¹å˜ï¼Œè¿™æ ·å…¬å¼ï¼ˆ5-4ï¼‰å°±éœ€è¦é‡æ–°è®¡ç®—ã€‚ä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬å°†å…¬å¼ï¼ˆ5-4ï¼‰è¿›è¡Œè°ƒæ•´ä¸ºç›¸å¯¹å¢é‡å½¢å¼</p>
<p><span class="math display">\[
\Delta{R_{ij}}\overset{\cdot}{=}\prod^{j-1}_{k=i}\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_k-\boldsymbol{\eta}^{gd}_k\right)\Delta{t}\Big)\tag{6-1}
\]</span></p>
<p><strong><em>è¦æ³¨æ„çš„æ˜¯</em></strong> ï¼Œå…¬å¼ï¼ˆ6-1ï¼‰ä¾æ—§ä¸<span class="math inline">\(i\)</span>æ—¶åˆ»çš„åå·®<span class="math inline">\(\boldsymbol{\eta}^{gd}_i\)</span>ã€‚æˆ‘ä»¬æš‚æ—¶å¿½ç•¥è¿™ä¸€ç‚¹ã€‚åœ¨ç¬¬ä¹èŠ‚ï¼Œæˆ‘ä»¬æ¨å¯¼å½“åå·®æ”¹å˜çš„æ—¶å€™ï¼Œå¦‚ä½•é¿å…é‡å¤è®¡ç®—å…¬å¼ï¼ˆ6-1ï¼‰</p>
<h2 id="ä¸ƒå°†å™ªå£°é¡¹ç‹¬ç«‹æ„é€ é«˜æ–¯åˆ†å¸ƒå½¢å¼">ä¸ƒã€å°†å™ªå£°é¡¹ç‹¬ç«‹æ„é€ é«˜æ–¯åˆ†å¸ƒå½¢å¼</h2>
<p>å…¬å¼ï¼ˆ6-1ï¼‰å·²ç»ä½¿ç”¨IMUçš„è¾“å‡ºå°†<span class="math inline">\(i,j\)</span>æ—¶åˆ»çš„æ—‹è½¬è”ç³»èµ·æ¥ã€‚ä½†æ˜¯å…¬å¼ï¼ˆ6-1ï¼‰ä¹‹ä¸­å°†å™ªå£°é¡¹æ‚ç³…åœ¨å„ä¸ªç´¯ç§¯é¡¹ä¹‹ä¸­ï¼Œè¿™å¯¼è‡´äº†æˆ‘ä»¬æ— æ³•ç®€å•åœ°å†™å‡º<span class="math inline">\(\Delta{R_{ij}}\)</span>çš„æ¦‚ç‡åˆ†å¸ƒå‡½æ•°ã€‚å›é¡¾ç¬¬äºŒèŠ‚ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„é€ æ ‡å‡†çš„æµ‹é‡æ–¹ç¨‹å½¢å¼ï¼ˆ2-1ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬æ‰å¯ä»¥å°†MAPé—®é¢˜æ”¹å†™ä¸ºæœ€å°äºŒä¹˜é—®é¢˜ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸€ä¸ªç›®çš„ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å°†å™ªå£°é¡¹ç‹¬ç«‹å‡ºæ¥</p>
<p>æˆ‘ä»¬é¦–å…ˆåˆ©ç”¨BCHä¸€é˜¶è¿‘ä¼¼å…¬å¼ï¼Œå³å…¬å¼ï¼ˆ1-5ï¼‰ï¼Œå°†å™ªå£°é¡¹ç‹¬ç«‹ã€‚å…¬å¼ï¼ˆ6-1ï¼‰å¯ä»¥å†™æˆ</p>
<p><span class="math display">\[
\Delta{R_{ij}}\overset{eq(1-5)}{\approx}\
\prod^{j-1}_{k=i}\
\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_i\right) \Delta{t} \Big)\
\operatorname{Exp}\left(-J_r^k\boldsymbol{\eta}^{gd}_k\Delta{t}\right)\tag{7-1}
\]</span></p>
<p>å…¶ä¸­</p>
<p><span class="math display">\[
J_r^k \overset{\cdot}{=}J_r^k\left(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_i\right)\Delta{t}\right)\tag{7-2}
\]</span></p>
<p>æˆ‘ä»¬è®°</p>
<p><span class="math display">\[
\Delta{\tilde{R}_{ij}} \overset{\cdot}{=}\
\prod^{j-1}_{k=i}\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_i\right)\Delta{t}\Big)\tag{7-3}
\]</span></p>
<p>è§‚å¯Ÿå…¬å¼ï¼ˆ7-1ï¼‰ï¼Œæˆ‘ä»¬å°†ç´¯ç§¯ä¸­çš„æœ€åä¸¤é¡¹æŠ½å‡ºæ¥</p>
<p><span class="math display">\[
\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_{j \text{-} 2}-\textbf{b}^g_i\right) \Delta{t} \Big)\
\Bigg[\
\operatorname{Exp}\left(-J_r^{j \text{-} 2}\boldsymbol{\eta}^{gd}_{j \text{-} 2}\Delta{t}\right)\
\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_{j \text{-} 1}-\textbf{b}^g_i\right) \Delta{t} \Big)\
\Bigg]\
\operatorname{Exp}\left(-J_r^{j \text{-} 1}\boldsymbol{\eta}^{gd}_{j \text{-} 1}\Delta{t}\right)\tag{7-3}
\]</span></p>
<p>åˆ©ç”¨å…¬å¼ï¼ˆ1-8ï¼‰<span class="math inline">\(\operatorname{Exp}(\phi)R = R\operatorname{Exp}(R^T\phi)\)</span>ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸­é—´ä¸¤é¡¹æ”¹å†™å¦‚ä¸‹</p>
<p><span class="math display">\[
\begin{split}
&amp;\operatorname{Exp}\left(-J_r^{j \text{-} 2}\boldsymbol{\eta}^{gd}_{j \text{-} 2}\Delta{t}\right)\
\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_{j \text{-} 1}-\textbf{b}^g_i\right) \Delta{t} \Big)\\
=&amp;\
\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_{j \text{-} 1}-\textbf{b}^g_i\right) \Delta{t} \Big)\
\operatorname{Exp}\Big(-\Delta{\tilde{R}^T_{j\text{-}1j}}J_r^{j \text{-} 2}\boldsymbol{\eta}^{gd}_{j \text{-} 2}\Delta{t}\Big)
\end{split}\tag{7-4}
\]</span></p>
<p>å¯¹å…¬å¼ï¼ˆ7-1ï¼‰ä»åå¾€å‰åº”ç”¨å…¬å¼ï¼ˆ7-4ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†å™ªå£°é¡¹ç‹¬ç«‹å‡ºæ¥</p>
<p><span class="math display">\[
\begin{split}
\Delta{R_{ij}}\
&amp;=\
\Delta{\tilde{R}_{ij}}\
\prod^{j-1}_{k=i}\
\operatorname{Exp}\Big(-\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\Big)\\
&amp;\overset{\cdot}{=}\
\Delta{\tilde{R}_{ij}}\
\operatorname{Exp}(-\delta\phi_{ij})
\end{split}\tag{7-5}
\]</span></p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†<span class="math inline">\(\Delta{\tilde{R}_{ij}}\)</span>å†™ä¸ºå¦‚å…¬å¼ï¼ˆ2-1ï¼‰çš„æ ‡å‡†å½¢å¼ï¼Œå›é¡¾å…¬å¼ï¼ˆ1-9ï¼‰<span class="math inline">\(\operatorname{Exp}(-\delta{\phi})^T=\operatorname{Exp}(\delta{\phi})\)</span></p>
<p><span class="math display">\[
\begin{split}
\Delta{\tilde{R}_{ij}}\
=\
\Delta{R_{ij}}\
\operatorname{Exp}(\delta\phi_{ij})\
\end{split}\tag{7-6}
\]</span></p>
<h2 id="å…«åæ–¹å·®çŸ©é˜µçš„é€’å½’å½¢å¼">å…«ã€åæ–¹å·®çŸ©é˜µçš„é€’å½’å½¢å¼</h2>
<p>å…¬å¼ï¼ˆ7-6ï¼‰æ¨å¯¼å‡ºäº†å¦‚å…¬å¼ï¼ˆ2-1ï¼‰çš„æ ‡å‡†å½¢å¼ï¼Œä½†æ˜¯è¿˜å·®ä¸€ç‚¹ï¼Œå°±æ˜¯å™ªå£°é¡¹<span class="math inline">\(\operatorname{Exp}(-\delta\phi_{ij})\)</span>æ˜¯å¦ç¬¦åˆ0å‡å€¼çš„é«˜æ–¯åˆ†å¸ƒï¼Œä»¥åŠå®ƒçš„åæ–¹å·®æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<p>è¿™ä¸€èŠ‚çš„ç›®çš„æ˜¯æ¨å¯¼å™ªå£°é¡¹çš„åˆ†å¸ƒä»¥åŠåæ–¹å·®çš„å¢é‡å½¢å¼</p>
<p>è®©æˆ‘ä»¬ä»å…¬å¼ï¼ˆ7-5ï¼‰æ‘˜å½•å™ªå£°é¡¹</p>
<p><span class="math display">\[
\operatorname{Exp}(-\delta\phi_{ij})\
=\
\prod^{j-1}_{k=i}\
\operatorname{Exp}\Big(-\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\Big)\tag{8-1}
\]</span></p>
<p>è®°</p>
<p><span class="math display">\[
\xi_k=\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\tag{8-2}
\]</span></p>
<p>ç”±äº<span class="math inline">\(\boldsymbol{\eta}^{gd}_{k}\)</span>æ˜¯ä¸ªæå¾®å°é‡ï¼Œè€Œä¸”<span class="math inline">\(\delta{\phi}_{ij}\)</span>ä¹Ÿæ˜¯ä¸ªå¾®å°é‡ï¼Œæ‰€ä»¥<span class="math inline">\(\xi_k\)</span>æ•´ä½“ä¹Ÿæ˜¯å¾®å°é‡ï¼Œå› æ­¤ï¼Œæ ¹æ®æ€§è´¨ï¼ˆ1-9ï¼‰</p>
<p><span class="math display">\[
J_r(\xi_k)\approx \mathbf{I}\tag{8-3}
\]</span></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æ ¹æ®å…¬å¼ï¼ˆ1-6ï¼‰ï¼Œå°†ï¼ˆ8-1ï¼‰å¯ä»¥å†™æˆ</p>
<p><span class="math display">\[
\operatorname{Exp}(-\delta\phi_{ij})\
=\
\operatorname{Exp}\left(-\sum^{j-1}_{k=i}\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\right)\tag{8-4}
\]</span></p>
<p>å³</p>
<p><span class="math display">\[
\delta\phi_{ij}\
\approx\
\sum^{j-1}_{k=i}\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\tag{8-5}
\]</span></p>
<hr />
<p>ä»å…¬å¼ï¼ˆ8-5ï¼‰æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¬å¼ï¼ˆ7-6ï¼‰çš„å™ªå£°é¡¹æ˜¯é«˜æ–¯å™ªå£°<span class="math inline">\(\boldsymbol{\eta}^{gd}\)</span>çš„çº¿æ€§ç»„åˆï¼Œå› æ­¤å…¶æœ¬èº«ä¹Ÿæ˜¯é«˜æ–¯å™ªå£°</p>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥è¿›ä¸€æ­¥æ¨å¯¼è¿™ä¸ªå™ªå£°çš„åæ–¹å·®çš„è¡¨è¾¾å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
\delta\phi_{ij}\
&amp;\approx\
\sum^{j-1}_{k=i}\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\\
&amp;=\
\sum^{j-1}_{k=i}\Delta{\tilde{R}^T_{k+1,j}}J_r^k\boldsymbol{\eta}^{gd}_k\Delta{t}\
+\
\overset{=\mathbf{I}_{3\times 3}}{\overbrace{\Delta{\tilde{R}^T_{j,j}}}}\
J_r^{j-1}\boldsymbol{\eta}^{gd}_{j-1}\Delta{t}\\
&amp;=\
\sum^{j-1}_{k=i}(\overset{=\Delta{\tilde{R}_{k+1,j}}}{\overbrace{\Delta{\tilde{R}_{k+1,j-1}}\Delta{\tilde{R}_{j-1,j}}}})\
+\
J_r^{j-1}\boldsymbol{\eta}^{gd}_{j-1}\Delta{t}\\
&amp;=\
\Delta{\tilde{R}^T_{j-1,j}}\sum^{j-2}_{k=i}\Delta{\tilde{R}^T_{k+1,j-1}}J_r^k\boldsymbol{\eta}^{gd}_k\Delta{t}\
+\
J_r^{j-1}\boldsymbol{\eta}^{gd}_{j-1}\Delta{t}\\
&amp;=\
\Delta{\tilde{R}^T_{j-1,j}}\delta{\phi}_{ij-1}+J_r^{j-1}\boldsymbol{\eta}^{gd}_{j-1}\Delta{t}
\end{split}\tag{8-6}
\]</span></p>
<p>æ ¹æ®é«˜æ–¯åˆ†å¸ƒåæ–¹å·®çš„æ€§è´¨</p>
<p><span class="math display">\[
\Sigma_{ij}\
=\
\Delta{\tilde{R}^T_{j-1,j}}\
\Sigma_{ij-1}\
\Delta{\tilde{R}_{j-1,j}}\
+\
(J_r^{j-1}\Delta{t})\
\Sigma_{\boldsymbol{\eta}}\
(J_r^{j-1}\Delta{t})^T\tag{8-7}
\]</span></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥ä»¤åæ–¹å·®çš„åˆå§‹å€¼<span class="math inline">\(\Sigma_{ii}=\textbf{0}_{9\times 9}\)</span></p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¾—å‡ºäº†åæ–¹å·®çš„é€’å½’å½¢å¼</p>
<h2 id="ä¹åå·®é¡¹biasæ›´æ–°">ä¹ã€åå·®é¡¹Biasæ›´æ–°</h2>
<h3 id="æš‚æ—¶æ€§æ€»ç»“">æš‚æ—¶æ€§æ€»ç»“</h3>
<p>åˆ°ç›®å‰ä½ç½®ï¼Œæˆ‘ä»¬å·²ç»æ¨å¯¼å‡ºäº†å¦‚ä¸‹å†…å®¹</p>
<ol type="1">
<li>æµ‹é‡æ–¹ç¨‹çš„æ ‡å‡†è¡¨è¾¾å½¢å¼ï¼Œå³å…¬å¼ï¼ˆ7-6ï¼‰</li>
<li>æµ‹é‡æ–¹ç¨‹å™ªå£°åæ–¹å·®çš„é€’å½’è¡¨è¾¾å½¢å¼ï¼Œå³å…¬å¼ï¼ˆ8-7ï¼‰</li>
</ol>
<p>ä½†æ˜¯è¦æ³¨æ„ï¼Œå…¬å¼ï¼ˆ7-6ï¼‰é‡Œé¢è¿˜åå·®é¡¹<span class="math inline">\(\textbf{b}_i^g\)</span>ã€‚ä¹Ÿå°±æ˜¯å…¶ä¾æ—§ä¾èµ–<span class="math inline">\(i\)</span>æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨åå·®æ›´æ–°çš„æ—¶å€™ï¼Œé¿å…æµ‹é‡æ–¹ç¨‹çš„é‡å¤è®¡ç®—ï¼Ÿè¿™å°±æ˜¯æœ¬èŠ‚è¦æ¨å¯¼çš„å†…å®¹</p>
<h3 id="çº³å…¥åå·®æ›´æ–°">çº³å…¥åå·®æ›´æ–°</h3>
<p>å½“åå·®é¡¹æ›´æ–°</p>
<p><span class="math display">\[
\hat{\textbf{b}} \leftarrow \bar{\textbf{b}}+\delta{\textbf{b}}\tag{9-1}
\]</span></p>
<p>æˆ‘ä»¬å¸Œæœ›è®¡ç®—æ›´æ–°åçš„æµ‹é‡<span class="math inline">\(\Delta{\tilde{R}_{ij}(\hat{\textbf{b}}^g_i)}\)</span>ï¼Œç›¸æ¯”ä¸åŸå…ˆçš„å€¼<span class="math inline">\(\Delta{\tilde{R}_{ij}(\bar{\textbf{b}}^g_i)}\)</span>çš„æ›´æ–°é‡</p>
<p>è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦é‡å¤è®¡ç®—<span class="math inline">\(\Delta{\tilde{R}_{ij}}\)</span></p>
<p>æŠŠ<span class="math inline">\(\hat{\textbf{b}}^g_i\)</span>ä»£å…¥<span class="math inline">\(\Delta{\tilde{R}_{ij}}\)</span>çš„è¡¨è¾¾å¼ï¼ˆ7-3ï¼‰</p>
<p><span class="math display">\[
\Delta{\tilde{R}}_{ij}(\hat{\textbf{b}}^g_i)\
=\
\prod^{j-1}_{k=i}\
\operatorname{Exp}\Big(
    \left(
        \tilde{\boldsymbol{\omega}}_k-\hat{\textbf{b}}^g_i
    \right)\Delta{t}
    \Big)\tag{9-2}
\]</span></p>
<p>å°†å…¬å¼ï¼ˆ9-1ï¼‰ä»£å…¥ï¼ˆ9-2ï¼‰ï¼Œå¹¶åˆ©ç”¨BCHä¸€é˜¶è¿‘ä¼¼å…¬å¼ï¼ˆ1-5ï¼‰å±•å¼€</p>
<p><span class="math display">\[
\begin{split}
    \Delta{\tilde{R}}_{ij}(\hat{\textbf{b}}^g_i)\
        &amp; = \prod^{j-1}_{k=i}\
            \operatorname{Exp}\Big(
                \left(
                    \tilde{\boldsymbol{\omega}}_k-(\bar{\textbf{b}}^g_i+\delta{\textbf{b}}^g_i)
                \right)\Delta{t}
            \Big)\\
        &amp; = \prod^{j-1}_{k=i}\
            \operatorname{Exp}\Big(
                \left(\tilde{\boldsymbol{\omega}}_k-\bar{\textbf{b}}^g_i\right)\Delta{t}
            \Big)\
            \operatorname{Exp}\Big(
                -J_r^k\delta{\textbf{b}}^g_i\Delta{t}
            \Big)
\end{split}\tag{9-3}
\]</span></p>
<p>é‡‡ç”¨æ¨å¯¼å…¬å¼ï¼ˆ7-1ï¼‰åˆ°ï¼ˆ7-5ï¼‰çš„æ–¹å¼ï¼Œä»åå¾€å‰æ¨ï¼Œå¹¶åˆ©ç”¨å…¬å¼ï¼ˆ1-8ï¼‰ï¼Œä¸Šå¼å¯ä»¥å†™ä¸º</p>
<p><span class="math display">\[
\begin{split}
  \Delta{\tilde{R}}_{ij}(\hat{\textbf{b}}^g_i)\
    =\Delta{\bar{R}_{ij}}\prod^{j-1}_{k=i}\
      \operatorname{Exp}\Big(
        -\Delta{\bar{R}}_{k+1,j}^TJ_r^k\delta{\textbf{b}^g_i}\Delta{t}
      \Big)
\end{split}\tag{9-4}
\]</span></p>
<p>æˆ‘ä»¬å†é‡‡ç”¨ç±»ä¼¼ï¼ˆ8-1ï¼‰åˆ°ï¼ˆ8-5ï¼‰çš„æ¨å¯¼æ–¹æ³•ï¼Œï¼ˆ<span class="math inline">\(\delta{\textbf{b}}\)</span>æ˜¯ä¸€ä¸ªæå°é‡ï¼Œæ‰€ä»¥å±•å¼€æ—¶çš„å³é›…å¯æ¯”æ¥è¿‘å•ä½çŸ©é˜µï¼‰</p>
<p>å…¬å¼ï¼ˆ9-4ï¼‰å¯ä»¥å†™ä¸º</p>
<p><span class="math display">\[
\begin{split}
  \Delta{\tilde{R}}_{ij}(\hat{\textbf{b}}^g_i)\
    &amp; \approx \Delta{\bar{R}_{ij}}\
      \operatorname{Exp}\Big(
        \sum^{j-1}_{k=i}-\Delta{\bar{R}}_{k+1,j}^TJ_r^k\delta{\textbf{b}^g_i}\Delta{t}
      \Big)\\
    &amp; \overset{\cdot}{=} \Delta{\bar{R}_{ij}}\
      \operatorname{Exp}\Big(
        \frac{\partial{\Delta{\bar{R}^{\vee}_{ij}}}}{\partial{\textbf{b}^g}}\
        \delta{\textbf{b}^g_i}
      \Big)
\end{split}\tag{9-5}
\]</span></p>
<h2 id="åæœ€å°äºŒä¹˜å½¢å¼è¯¯å·®">åã€æœ€å°äºŒä¹˜å½¢å¼/è¯¯å·®</h2>
<p>ä»å…¬å¼ï¼ˆ1-12ï¼‰æˆ‘ä»¬æå‰æ„é€ å¥½äº†æ—‹è½¬çš„æœ€å¤§ä¼¼ç„¶çš„è´Ÿå¯¹æ•°å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
  \mathcal{L}(R) &amp; =
    \frac{1}{2}||\operatorname{Log}(\tilde{R}^{-1}R)||^2_{\Sigma}+const
\end{split}
\]</span></p>
<p>æˆ‘ä»¬å·²ç»æ„é€ äº†ç›¸å¯¹æ—‹è½¬çš„è¡¨è¾¾å½¢å¼ï¼ˆ9-5ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å¾—å‡ºäº†æ—‹è½¬çš„è¯¯å·®æ¨¡å‹</p>
<p><span class="math display">\[
\begin{split}
  \textbf{r}_{\Delta{R}_{ij}} = 
    \operatorname{Log}\left(
        \bigg(
          \Delta{\bar{R}_{ij}}\
            \operatorname{Exp}\big(
                \frac{\partial{\Delta{\bar{R}^{\vee}_{ij}}}}{\partial{\textbf{b}^g}}\
                \delta{\textbf{b}^g_i}
            \big)
        \bigg)^T
        R_i^TR_j
    \right)
\end{split}\tag{10-1}
\]</span></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦ä»è®ºæ–‡<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1512.02363">ã€ŠOn-Manifold Preintegration for Real-TimeVisual-Inertial Odometryã€‹</a>å‡ºå‘ï¼ŒæŒ‘é€‰å…¶ä¸­çš„æ—‹è½¬çŸ©é˜µç›¸å…³å†…å®¹ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿä»å®é™…åº”ç”¨å‡ºå‘ï¼Œè”ç³»åç«¯ä¼˜åŒ–çš„éçº¿æ€§æœ€å°äºŒä¹˜ä¼˜åŒ–é—®é¢˜å’Œæç¾¤æä»£æ•°çŸ¥è¯†ï¼ŒåŠ æ·±ç†è®ºçŸ¥è¯†çš„å°è±¡ã€‚</p>
<p>å†æ¬¡å¼ºè°ƒï¼Œæœ¬æ–‡éœ€è¦æ‹¥æœ‰ä¸€å®šçš„æç¾¤æä»£æ•°åŸºç¡€çŸ¥è¯†ï¼Œä»¥åŠåç«¯ä¼˜åŒ–ä¸­å¦‚ä½•å°†æœ€å¤§åéªŒæ¦‚ç‡é—®é¢˜è½¬åŒ–åˆ°æœ€å°äºŒä¹˜é—®é¢˜ï¼Œæ²¡æœ‰è¿™ä¸¤ä¸ªéƒ¨åˆ†çš„çŸ¥è¯†å¯ä»¥å‚è€ƒç¬”è€…æ•´ç†çš„ä¸¤ç¯‡ç¬”è®°ã€‚</p>
<p><strong>æœ¬æ–‡åªæŒ‘é€‰äº†ç³»ç»ŸçŠ¶æ€ä¸­çš„æ—‹è½¬åˆ†é‡ç›¸å…³çš„å†…å®¹ã€‚å®é™…ä¸ŠåŸè®ºæ–‡å¯¹ä½ç½®ã€é€Ÿåº¦çš„æ¨å¯¼ä¹Ÿååˆ†è¯¦ç»†ã€‚ä½†æ˜¯å¤ªè¿‡æ‚ä¹±çš„å†…å®¹ä¸ä»…å¯¹ç†è§£æ•´ä¸ªæ¨å¯¼è¿‡ç¨‹æ€è·¯æ˜¯å¦‚ä½•æ¥çš„æ²¡æœ‰å¸®åŠ©ï¼Œè¿˜ä¼šè®©è¯»è€…ä¸€å¤´é›¾æ°´ã€‚</strong></p>
<p>æœ¬æ–‡é¦–å…ˆç»™å‡ºä¸€äº›åŸºç¡€çŸ¥è¯†å’Œåç»­æ¨å¯¼ç”¨çš„æ€§è´¨ï¼ˆç¬¬ä¸€èŠ‚ï¼‰</p>
<p>ç¬¬äºŒèŠ‚çš„é‡ç‚¹æ˜¯è®©è¯»è€…è¦æ˜ç™½è¿™ä¹ˆé•¿ç¯‡å¤§è®ºçš„æ¨å¯¼è¿‡ç¨‹çš„çº¿ç´¢æ˜¯ä»€ä¹ˆï¼Œæœ€ç»ˆç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯å°†æµ‹é‡ä¸çœŸå®å€¼èƒ½å¤Ÿå†™æˆå¦‚å…¬å¼ï¼ˆ2-1ï¼‰çš„æ ‡å‡†å½¢å¼ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥æ ¹æ®é«˜æ–¯åˆ†å¸ƒçš„æ€§è´¨å°†æœ€å¤§ä¼¼ç„¶é—®é¢˜é€šè¿‡è´Ÿå¯¹æ•°è½¬åŒ–ä¸ºæœ€å°äºŒä¹˜é—®é¢˜ã€‚</p>
<p><span class="math display">\[
\begin{array}{lcl}
\tilde{\mathcal{X}} = \mathcal{X} \oplus \epsilon, &amp;&amp; \epsilon \sim \mathcal{N}\left(0,\Sigma\right)\tag{2-1}
\end{array}
\]</span></p>
<p>ç¬¬ä¸‰èŠ‚åˆ°ç¬¬äº”èŠ‚ï¼Œæˆ‘ä»¬æ¨å¯¼äº†å¦‚ä½•æ ¹æ®IMUçš„è¾“å‡ºæ•°æ®ï¼Œå°†å…³é”®å¸§<span class="math inline">\((i,j)\)</span>çš„ä½å§¿ä¸­çš„æ—‹è½¬åˆ†é‡è”ç³»èµ·æ¥ï¼Œå³é€šè¿‡å…¬å¼ï¼ˆ5-4ï¼‰</p>
<p><span class="math display">\[
R_j = R_i\prod^{j-1}_{k=i}\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_k-\boldsymbol{\eta}^{gd}_k\right)\Delta{t}\Big)\tag{5-4}
\]</span></p>
<p>ä¸ºäº†é¿å…ä¼˜åŒ–è¿‡åå…³é”®å¸§<span class="math inline">\(i\)</span>çš„çŠ¶æ€æ”¹å˜ï¼Œç§¯åˆ†éœ€è¦é‡å¤è®¡ç®—çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ç¬¬å…­èŠ‚æ¨å¯¼äº†IMUé¢„ç§¯åˆ†å½¢å¼ï¼Œä¹Ÿå°±æ˜¯ä¸¤å¸§ä¹‹é—´çš„ç›¸å¯¹è¿åŠ¨å½¢å¼ï¼Œå³å…¬å¼ï¼ˆ6-1ï¼‰</p>
<p><span class="math display">\[
\Delta{R_{ij}}\overset{\cdot}{=}\prod^{j-1}_{k=i}\operatorname{Exp}\Big(\left(\tilde{\boldsymbol{\omega}}_k-\textbf{b}^g_k-\boldsymbol{\eta}^{gd}_k\right)\Delta{t}\Big)\tag{6-1}
\]</span></p>
<p>ä¸ºäº†æ„é€ æ ‡å‡†å½¢å¼ï¼ˆ2-1ï¼‰ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸ƒèŠ‚ä¸­å°†å™ªå£°é¡¹ç‹¬ç«‹å‡ºæ¥ï¼ŒæˆåŠŸæ„é€ æ ‡å‡†å½¢å¼ï¼Œå³å…¬å¼ï¼ˆ7-6ï¼‰</p>
<p><span class="math display">\[
\begin{split}
\Delta{\tilde{R}_{ij}}\
=\
\Delta{R_{ij}}\
\operatorname{Exp}(\delta\phi_{ij})\
\end{split}\tag{7-6}
\]</span></p>
<p>ä¸ºäº†åœ¨æœ€å°äºŒä¹˜é—®é¢˜ä¸­ä½¿ç”¨å™ªå£°çš„åæ–¹å·®çŸ©é˜µåŠ æƒï¼Œæˆ‘ä»¬åœ¨ç¬¬å…«èŠ‚æ¨å¯¼äº†å™ªå£°çš„åˆ†å¸ƒåŠæ–¹å·®çš„é€’å½’å½¢å¼ï¼Œå³å…¬å¼ï¼ˆ8-5ï¼‰</p>
<p><span class="math display">\[
\delta\phi_{ij}\
\approx\
\sum^{j-1}_{k=i}\Delta{\tilde{R}^T_{k\text{+}1j}}J_r^{k}\boldsymbol{\eta}^{gd}_{k}\Delta{t}\tag{8-5}
\]</span></p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥è§£å†³å¦‚ä½•åœ¨IMUåå·®æ›´æ–°çš„æ—¶å€™ï¼Œé¿å…ç§¯åˆ†è¿‡ç¨‹éœ€è¦é‡å¤è®¡ç®—çš„é—®é¢˜ï¼Œå³å…¬å¼ï¼ˆ9-5ï¼‰</p>
<p><span class="math display">\[
\begin{split}
  \Delta{\tilde{R}}_{ij}(\hat{\textbf{b}}^g_i)\
    &amp; \approx \Delta{\bar{R}_{ij}}\
      \operatorname{Exp}\Big(
        \sum^{j-1}_{k=i}-\Delta{\bar{R}}_{k+1,j}^TJ_r^k\delta{\textbf{b}^g_i}\Delta{t}
      \Big)\\
    &amp; \overset{\cdot}{=} \Delta{\bar{R}_{ij}}\
      \operatorname{Exp}\Big(
        \frac{\partial{\Delta{\bar{R}^{\vee}_{ij}}}}{\partial{\textbf{b}^g}}\
        \delta{\textbf{b}^g_i}
      \Big)
\end{split}\tag{9-5}
\]</span></p>
<p>å‰©ä¸‹çš„é—®é¢˜ä¹Ÿå°±è‡ªç„¶è§£å†³ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ ‡å‡†å½¢å¼æ„é€ è¯¯å·®å‡½æ•°çš„è¡¨è¾¾ï¼Œå³å…¬å¼ï¼ˆ10-1ï¼‰</p>
<p><span class="math display">\[
\begin{split}
  \textbf{r}_{\Delta{R}_{ij}} = 
    \operatorname{Log}\left(
        \bigg(
          \Delta{\bar{R}_{ij}}\
            \operatorname{Exp}\big(
                \frac{\partial{\Delta{\bar{R}^{\vee}_{ij}}}}{\partial{\textbf{b}^g}}\
                \delta{\textbf{b}^g_i}
            \big)
        \bigg)^T
        R_i^TR_j
    \right)
\end{split}\tag{10-1}
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/06/08/cv/surround-view-projection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/cv/surround-view-projection/" class="post-title-link" itemprop="url">è¶…è¯¦ç»†ï¼ä»å•åº”çŸ©é˜µæ¨å¯¼åˆ°è‡ªåŠ¨é©¾é©¶ç¯è§†æŠ•å½±åº”ç”¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-06-08 09:38:44" itemprop="dateCreated datePublished" datetime="2023-06-08T09:38:44+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-06-14 12:07:02" itemprop="dateModified" datetime="2023-06-14T12:07:02+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœºè§†è§‰</span></a>
        </span>
    </span>

  
    <span id="/2023/06/08/cv/surround-view-projection/" class="post-meta-item leancloud_visitors" data-flag-title="è¶…è¯¦ç»†ï¼ä»å•åº”çŸ©é˜µæ¨å¯¼åˆ°è‡ªåŠ¨é©¾é©¶ç¯è§†æŠ•å½±åº”ç”¨" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="è¶…è¯¦ç»†ï¼ä»å•åº”çŸ©é˜µæ¨å¯¼åˆ°è‡ªåŠ¨é©¾é©¶ç¯è§†æŠ•å½±åº”ç”¨" href="/2023/06/08/cv/surround-view-projection/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::f13a6e5ecc3be4fc943645106759d469" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="æœ¬æ–‡å†…å®¹">æœ¬æ–‡å†…å®¹</h2>
<p>æœ¬æ–‡çš„ä¸»è¦ç›®çš„åœ¨äºä»‹ç»è‡ªåŠ¨é©¾é©¶ä¸­ç¯è§†æŠ•å½±ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¿¯ç°å›¾/é¸Ÿç°å›¾/BEVå›¾ï¼Œå…¶èƒŒåçš„è®¡ç®—æœºè§†è§‰åŸç†ã€‚ç¯è§†æŠ•å½±çš„èƒŒåç†è®ºåŸºç¡€å°±æ˜¯å•åº”çŸ©é˜µï¼ˆHomography Matrixï¼‰ã€‚ä¸ºäº†å»ºç«‹ä»ç›´è§‚åˆ°ä¸€èˆ¬å½¢å¼ï¼Œæœ¬æ–‡ä»ä»¥ä¸‹ç« èŠ‚å†…å®¹å±•å¼€</p>
<p>åœ¨ç¬¬ä¸€èŠ‚ä¸­å…ˆè§„å®šç›¸æœºåæ ‡ç³»å’Œå›¾åƒåæ ‡ç³»ï¼Œä»¥åŠä»‹ç»å¸¸ç”¨çš„è½¦è¾†åæ ‡ç³»çš„è§„å®šã€‚åŒæ—¶ï¼Œå¯¹ç›¸æœºæŠ•å½±ä¸­å¸¸ä½¿ç”¨çš„é½æ¬¡åæ ‡åšäº†ç®€è¦ä»‹ç»ï¼Œé¡ºå¸¦å›é¡¾ç›¸æœºæŠ•å½±æ–¹ç¨‹ã€‚</p>
<p>ç¬¬äºŒèŠ‚å…ˆå¯¹å•åº”çŸ©é˜µåšä»‹ç»ã€‚å¯¹äºä¸€ä¸ªç©ºé—´ä¸­ä¸€ä¸ªå¹³é¢ï¼Œä»¥åŠä¸¤ä¸ªä¸åŒå§¿æ€çš„ç›¸æœºï¼Œä¸¤ä¸ªç›¸æœºçš„å¯¹è¯¥å¹³é¢çš„æˆåƒä¹‹é—´çš„è”ç³»æ˜¯å•åº”çŸ©é˜µã€‚ä½†æ˜¯å¦‚ä½•ä»ç›¸æœºé—´çš„å…³ç³»æ¨å¯¼å•åº”çŸ©é˜µçš„å…·ä½“å½¢å¼ï¼Ÿè¯¥èŠ‚ä»ç‰¹æ®ŠåŒ–å½¢å¼å’Œä¸€èˆ¬åŒ–å½¢å¼ä¸¤ä¸ªè§’åº¦å¯¹å•åº”çŸ©é˜µçš„è¡¨è¾¾è¿›è¡Œæ¨å¯¼ã€‚</p>
<p>ç¯è§†æŠ•å½±æ˜¯å¤šä¸ªæ–¹å‘çš„åœ°é¢æˆåƒç»“æœåˆ°ä¸€ä¸ªä½äºè½¦è¾†ä¸Šæ–¹ï¼Œå¹³è¡Œäºåœ°é¢å¾€ä¸‹æˆåƒçš„è™šæ‹Ÿç›¸æœºçš„æˆåƒç»“æœçš„å˜æ¢ã€‚ç¬¬ä¸‰èŠ‚è¯¦ç»†æ¨å¯¼è¿™ä¸ªåº”ç”¨ä¸­çš„æŠ•å½±è¿‡ç¨‹ä»¥åŠç›¸æœºå†…å¤–å‚ä¸å•åº”çŸ©é˜µçš„å…³ç³»ã€‚</p>
<p>ç¬¬å››èŠ‚ä»‹ç»å¦‚ä½•åœ¨ä¸çŸ¥é“ç›¸æœºå†…å¤–å‚çš„æƒ…å†µä¸‹é€šè¿‡ç‚¹å¯¹åŒ¹é…çš„æ–¹æ³•æ±‚è§£å•åº”çŸ©é˜µã€‚</p>
<h2 id="åŸºç¡€çŸ¥è¯†åŠç›¸å…³å®šä¹‰">åŸºç¡€çŸ¥è¯†åŠç›¸å…³å®šä¹‰</h2>
<h3 id="ç›¸æœºåæ ‡ç³»ä¸å›¾åƒåæ ‡ç³»">ç›¸æœºåæ ‡ç³»ä¸å›¾åƒåæ ‡ç³»</h3>
<p>åœ¨è®¡ç®—æœºè§†è§‰çš„ä¸€èˆ¬ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬è§„å®š<strong>ç›¸æœºåæ ‡ç³»</strong>ä¸ºå…‰è½´ï¼ˆç»è¿‡ç›¸æœºåŸç‚¹ï¼‰å¾€å‰ä¸º<span class="math inline">\(Z\)</span>è½´æ­£æ–¹å‘ï¼Œå³ä¸º<span class="math inline">\(X\)</span>ï¼Œä¸‹ä¸º<span class="math inline">\(Y\)</span> å¯¹ç©ºé—´ä¸­çš„ç‚¹æ”¾ç¼©åˆ°å½’ä¸€åŒ–å¹³é¢ï¼Œå½’ä¸€åŒ–å¹³é¢çš„åæ ‡ç³»å®šä¹‰ä¹Ÿç±»ä¼¼ç›¸æœºåæ ‡ç³»ã€‚ ä½†æ˜¯åœ¨å›¾åƒä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä»¤å›¾ç‰‡çš„å·¦ä¸Šè§’ä¸ºåæ ‡åŸç‚¹ï¼Œæ¨ªè½´å¾€å³ä¸º<span class="math inline">\(u/X\)</span>æ­£æ–¹å‘ï¼Œç«–è½´å¾€ä¸‹ä¸º<span class="math inline">\(v/Y\)</span>æ­£æ–¹å‘ï¼Œåˆå«<strong>åƒç´ åæ ‡ç³»</strong></p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure>
<img src="./imgs/01-pinhole.png" alt="" /><figcaption>ç›¸æœºåŠåƒç´ åæ ‡ç³»</figcaption>
</figure>
<h3 id="è½¦è¾†åæ ‡ç³»">è½¦è¾†åæ ‡ç³»</h3>
<p>æˆ‘ä»¬ä¸€èˆ¬è§„å®šè½¦çš„åè½®æ¨ªè½´ä¸­å¿ƒåœ¨åœ°é¢çš„ç‚¹ä¸ºåæ ‡ç³»åŸç‚¹ï¼Œ<span class="math inline">\(X\)</span>æ­£æ–¹å‘æŒ‡å‘è½¦å¤´ï¼Œ<span class="math inline">\(Y\)</span>è½´æ­£æ–¹å‘æŒ‡å‘è½¦å·¦</p>
<figure>
<img src="./imgs/02-vehical_coordinate.png" alt="" /><figcaption>è½¦è¾†åæ ‡ç³»</figcaption>
</figure>
<h3 id="é½æ¬¡åæ ‡homogeneous-coordinate">é½æ¬¡åæ ‡ï¼ˆHomogeneous Coordinateï¼‰</h3>
<p>å½“æˆ‘ä»¬å¯¹ä¸‰ç»´ç©ºé—´ä¸­ä¸€ä¸ªç‚¹<span class="math inline">\(P_1=[X_1,Y_1,Z_1]^T\)</span>åšæ—‹è½¬å¹³ç§»å˜æ¢åˆ°å¦ä¸€ä¸ªç‚¹<span class="math inline">\(P_2\)</span>ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼</p>
<p><span class="math display">\[
P_2 = RP_1+\boldsymbol{t}
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(R\in \mathbb{R}^{3\times3}\)</span>ä¸ºæ—‹è½¬çŸ©é˜µï¼Œ<span class="math inline">\(\boldsymbol{t}\in \mathbb{R}^{3\times 1}\)</span>ä¸ºå¹³ç§»å‘é‡</p>
<p>ä¸Šå¼ä¹Ÿå¯ä»¥å°†ç‚¹åæ ‡å†™ä¸º<span class="math inline">\(P_1=[X_1,Y_1,Z_1,1]^T\)</span>çš„å½¢å¼ï¼Œç„¶åç”¨å˜æ¢çŸ©é˜µå¯¹ç‚¹åšåæ ‡å˜æ¢</p>
<p><span class="math display">\[
P_2 = T_{21}P_1
\]</span></p>
<p><span class="math display">\[
T_{21} =
\begin{bmatrix}
R&amp;\boldsymbol{t}\\
\boldsymbol{0}&amp;1
\end{bmatrix}\in \mathbb{R}^{4\times 4}
\]</span></p>
<p><span class="math inline">\(T_{21}\)</span>ç§°ä¸ºå˜æ¢çŸ©é˜µ;<span class="math inline">\(P_1=[X_1,Y_1,Z_1,1]^T\)</span>è¿™ç§å½¢å¼ä¹Ÿå«é½æ¬¡åæ ‡ï¼ˆHomogeneous Coordinateï¼‰</p>
<p><strong>æ³¨æ„</strong>ï¼šé½æ¬¡åæ ‡å…¶å®æœ‰ä¸¥æ ¼çš„å®šä¹‰ï¼Œå…·ä½“å½¢å¼å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E9%BD%90%E6%AC%A1%E5%9D%90%E6%A0%87">Wiki:Homogeneous Coordinate</a></p>
<p>åŒç†ï¼Œåœ¨åšåƒç´ åæ ‡çš„é€†å˜æ¢ï¼Œä¹Ÿé€šå¸¸å°†åƒç´ åæ ‡<span class="math inline">\([u,v]^T\)</span>åé¢æ·»åŠ ä¸€ä¸ª1å˜ä¸ºé½æ¬¡åæ ‡<span class="math inline">\(p=[u,v,1]^T\)</span></p>
<p><span class="math display">\[
p_n=K^{-1}p
\]</span></p>
<h3 id="æŠ•å½±æ–¹ç¨‹">æŠ•å½±æ–¹ç¨‹</h3>
<p>ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹<span class="math inline">\(P_W\)</span>æŠ•å½±åˆ°å›¾åƒä¸Šçš„ç‚¹<span class="math inline">\(\boldsymbol{p}\)</span>ï¼Œæˆ‘ä»¬ç›´æ¥è®°è¿™ä¸ªè¿‡ç¨‹ä¸º</p>
<p><span class="math display">\[
\begin{split}
\lambda \boldsymbol{p}
&amp;=\
KT_{CW}P_W\\
&amp;=\
\begin{bmatrix}
u&amp;v&amp;1
\end{bmatrix}^T
\end{split}
\]</span></p>
<p>è¿™é‡Œé¢åŒ…å«äº†ä¸€æ¬¡é½æ¬¡åæ ‡çš„è½¬æ¢ï¼ˆ<span class="math inline">\(T_{CW}P_W \in \mathbb{R}^{4\times 1}\)</span>,<span class="math inline">\(K\in \mathbb{R}^{3\times 1}\)</span>ï¼‰ï¼Œä½†æ˜¯ä¸ä¼šå¯¹ç†è§£æœ‰æ­§ä¹‰</p>
<h2 id="å•åº”çŸ©é˜µhomography-matrix">å•åº”çŸ©é˜µï¼ˆHomography Matrixï¼‰</h2>
<p>åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œä¸¤ä¸ªç›¸æœºå¯¹äºç©ºé—´ä¸­çš„åŒä¸€ä¸ªå¹³é¢çš„æˆåƒç»“æœå¯ä»¥é€šè¿‡å•åº”çŸ©é˜µè¿›è¡Œæ˜ å°„ï¼ˆç›¸å·®ä¸€ä¸ªå¸¸é‡ç³»æ•°ï¼‰</p>
<p>å¦<span class="math inline">\([x,y,1]^T\)</span>ä¸ºå›¾ç‰‡1çš„åƒç´ é½æ¬¡åæ ‡ï¼Œ<span class="math inline">\([x^{\prime},y^{\prime},1]^T\)</span>ä¸ºåŒä¸€ä¸ªç‚¹åœ¨å›¾ç‰‡2çš„åƒç´ é½æ¬¡åæ ‡ï¼Œåˆ™ä¸Šé¢é‚£å¥è¯å¯ä»¥ç­‰ä»·ä¸ºå¦‚ä¸‹å…³ç³»ï¼š</p>
<p><span class="math display">\[
\lambda
\begin{bmatrix}
x^{\prime}\\
y^{\prime}\\
1
\end{bmatrix}=
\boldsymbol{H}
\begin{bmatrix}
x\\
y\\
1
\end{bmatrix}=
\begin{bmatrix}
h_{00} &amp; h_{10} &amp; h_{20}\\
h_{01} &amp; h_{11} &amp; h_{21}\\
h_{02} &amp; h_{12} &amp; h_{22}
\end{bmatrix}
\begin{bmatrix}
x\\
y\\
1
\end{bmatrix}\tag{2-1}
\]</span></p>
<p>å…¬å¼ï¼ˆ2-1ï¼‰ä¸­çš„ç³»æ•°<span class="math inline">\(\lambda\)</span>ç”¨æ¥å°†å˜æ¢åçš„åæ ‡å½’ä¸€åŒ–ï¼ˆå°†ç¬¬ä¸‰ä¸ªç»´åº¦çš„å€¼æ”¾ç¼©ä¸º1ï¼‰ <strong>åŒæ—¶è¦æ³¨æ„ï¼Œå•åº”çŸ©é˜µè™½ç„¶æœ‰9ä¸ªå…ƒç´ ï¼Œä½†è‡ªç”±åº¦åªæœ‰8ï¼Œå¯ä»¥é™¤ä»¥<span class="math inline">\(h_{22}\)</span>è¿›è¡Œå½’ä¸€åŒ–</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»ç”¨å½¢è±¡åŒ–çš„è§£é‡Šå’Œä¸€èˆ¬åŒ–çš„æ¨å¯¼æ¥å»ºç«‹å•åº”çŸ©é˜µä¸ç›¸æœºå†…å‚ã€å¤–å‚çš„å…³ç³»</p>
<h3 id="ç‰¹æ®Šå½¢å¼æ¨å¯¼">ç‰¹æ®Šå½¢å¼æ¨å¯¼</h3>
<p>æˆ‘ä»¬å‡è®¾ç©ºé—´ä¸­æœ‰ä¸€å¹³é¢ï¼Œä¸¤ä¸ªç›¸æœº<span class="math inline">\(C_1,C_2\)</span>åœ¨ä¸¤ä¸ªä¸åŒçš„å§¿æ€ä¸‹å¯¹è¿™ä¸ªå¹³é¢è¿›è¡Œæˆåƒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä»¤ä¸–ç•Œåæ ‡ç³»ï¼ˆ<span class="math inline">\(O_G\)</span>)<span class="math inline">\(çš„\)</span>Z<span class="math inline">\(è½´å‚ç›´äºè¯¥å¹³é¢ï¼Œå¹¶ä¸”ä»¤è¯¥å¹³é¢åˆšå¥½ä½äºä¸–ç•Œåæ ‡ç³»çš„\)</span>XY<span class="math inline">\(å¹³é¢ï¼Œè¿™æ ·è¿™ä¸ªå¹³é¢ä¸Šçš„ç‚¹\)</span>z$åæ ‡ç­‰äº0ã€‚å¯ä»¥ç”¨ä¸‹å›¾å¸®å¿™ç†è§£</p>
<figure>
<img src="./imgs/03-multi_camera.png" alt="" /><figcaption>åŒç›¸æœºæˆåƒç»Ÿä¸€å¹³é¢</figcaption>
</figure>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬è®°ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœº<span class="math inline">\(C_1\)</span>çš„å˜æ¢çŸ©é˜µä¸º<span class="math inline">\(T_{C_1W}\)</span>ï¼Œåˆ°ç›¸æœº<span class="math inline">\(C_2\)</span>çš„å˜æ¢çŸ©é˜µä¸º<span class="math inline">\(T_{C_2W}\)</span>;<span class="math inline">\(K_1,K_2\)</span>ä¸ºä¸¤ä¸ªç›¸æœºçš„å†…å‚ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å¯¹å¹³é¢ä¸Šçš„ä¸€ä¸ªç‚¹<span class="math inline">\(P_W=[X_w,Y_w,Z_w=0,1]^T\)</span>è¿›è¡ŒæŠ•å½±ï¼Œå¾—åˆ°åœ¨ä¸¤ä¸ªç›¸æœºæˆåƒçš„å›¾ç‰‡ä¸Šå¯¹åº”çš„åƒç´ ç‚¹<span class="math inline">\(\boldsymbol{p}_1,\boldsymbol{p}_2\)</span>ã€‚æŠ•å½±è¿‡ç¨‹å…·æœ‰å¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
\lambda_1\boldsymbol{p}_1
&amp;=\
\begin{bmatrix}
u_1\\
v_1\\
1
\end{bmatrix}
=\
K_1T_{C_1W}P_W\\
&amp;=\
K_1
\begin{bmatrix}
r_{00} &amp; r_{01} &amp; r_{02} &amp; t_0\\
r_{10} &amp; r_{11} &amp; r_{12} &amp; t_1\\
r_{20} &amp; r_{21} &amp; r_{22} &amp; t_2\\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
X_W\\
Y_W\\
0\\
1
\end{bmatrix}\\
&amp;=\
K_1
\begin{bmatrix}
r_{00} &amp; r_{01} &amp; t_0\\
r_{10} &amp; r_{11} &amp; t_1\\
r_{20} &amp; r_{21} &amp; t_2
\end{bmatrix}
\begin{bmatrix}
X_W\\
Y_W\\
1
\end{bmatrix}\\
&amp;=\
K_1T_{C_1W}^{0:3;0:2,3}P_W
\end{split}
\]</span></p>
<p>ä¸Šå¼ä¸­<span class="math inline">\(T^{0:3;0:2,3}\)</span>è¡¨ç¤ºå˜æ¢çŸ©é˜µå‰3è¡Œçš„0,1,3åˆ—ã€‚ä¸ºäº†æ–¹ä¾¿è®°å·ï¼Œæˆ‘ä»¬å°†<span class="math inline">\(T_{C_1W}^{0:3;0:2,3}\)</span>è®°ä¸º<span class="math inline">\(J_{C_1W}\)</span></p>
<p>åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å›¾åƒ2çš„ç±»ä¼¼æŠ•å½±æ–¹ç¨‹ï¼Œæˆ‘ä»¬æ•´ç†å¦‚ä¸‹</p>
<p><span class="math display">\[
\begin{split}
\lambda_1\boldsymbol{p}_1 &amp;= K_1J_{C_1W}P_W\\
\\
\lambda_2\boldsymbol{p}_2 &amp;= K_2J_{C_2W}P_W\\
\end{split}\tag{2-2}
\]</span></p>
<p>æ³¨æ„ä¸Šå¼ä¸­<span class="math inline">\(P_W=[X_W,Y_W,1]\)</span>ï¼Œä¸”ä¸Šå¼ä¸­çŸ©é˜µç›¸ä¹˜çš„è¡Œåˆ—æ•°é‡éƒ½æ˜¯å¯¹åº”çš„</p>
<p>æˆ‘ä»¬å°†ä¸Šå¼ï¼ˆ2-2ï¼‰é‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œå°†<span class="math inline">\(P_W\)</span>å†™ä¸º<span class="math inline">\(p_1\)</span>çš„å‡½æ•°ï¼Œæœ‰</p>
<p><span class="math display">\[
P_W=\lambda_1J_{C_1W}^{-1}K_1^{-1}\boldsymbol{p}_1\tag{2-3}
\]</span></p>
<p>å°†ï¼ˆ2-3ï¼‰å¸¦å…¥ï¼ˆ2-2ï¼‰ä¸­çš„ç›¸æœº2æ–¹ç¨‹</p>
<p><span class="math display">\[
\lambda_2\boldsymbol{p}_2=\lambda_1K_2J_{C_2W}J_{C_1W}^{-1}K_1^{-1}\boldsymbol{p}_1
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(\lambda_1,\lambda_2\)</span>åªæ˜¯ä¸ºäº†å°†æŠ•å½±åçš„å€¼è¿›è¡Œæ”¾ç¼©ï¼Œä½¿å¾—ç¬¬ä¸‰ä¸ªå…ƒç´ çš„å€¼ä¸º1,æ‰€ä»¥ä¸¤è€…å¯ä»¥å†™æˆä¸€ä¸ªï¼Œæœ€åæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
&amp;\lambda\boldsymbol{p}_2=\boldsymbol{H}_{21}\boldsymbol{p}_1\\
&amp; \boldsymbol{H}_{21} = K_2J_{C_2W}J_{C_1W}^{-1}K_1^{-1}\\
&amp;J=T^{0:3,0:2,3}
\end{split}\tag{2-4}
\]</span></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¬å¼ï¼ˆ2-4ï¼‰çš„å½¢å¼å’Œå…¬å¼ï¼ˆ2-1ï¼‰æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ—¶å°†å•åº”çŸ©é˜µä¸ç›¸æœºçš„å†…å‚å¤–å‚è”ç³»èµ·æ¥</p>
<h3 id="å•åº”çŸ©é˜µä¸ç›¸æœºå†…å¤–å‚å…³ç³»çš„ä¸€èˆ¬å½¢å¼">å•åº”çŸ©é˜µä¸ç›¸æœºå†…å¤–å‚å…³ç³»çš„ä¸€èˆ¬å½¢å¼</h3>
<p>ä¸Šä¸€ä¸ªå°èŠ‚æˆ‘ä»¬å¯¹å•åº”çŸ©é˜µä¸ç›¸æœºçš„å†…å¤–å‚ä¹‹é—´çš„å…³ç³»å»ºç«‹äº†å…¬å¼åŒ–çš„è”ç³»å’Œç›´è§‚ä¸Šçš„ç†è§£ã€‚ä¸Šä¸€å°èŠ‚çš„æ¨å¯¼å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºç©ºé—´ä¸­çš„ä¸€å¿«å¹³é¢ï¼Œå­˜åœ¨ä¸€ä¸ª<span class="math inline">\(3 \times 3\)</span>çš„çŸ©é˜µï¼ˆè‡ªç”±åº¦ä¸º8ï¼‰å°†ä¸¤ä¸ªç›¸æœºå¯¹è¿™å—å¹³é¢çš„æˆåƒç»“æœè”ç³»èµ·æ¥ã€‚</p>
<p>åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å‡è®¾ä¸–ç•Œåæ ‡ç³»ä¸æˆåƒå¹³é¢å¯¹é½ã€‚æˆ‘ä»¬åœ¨è¿™ä¸€å°èŠ‚ä¸­ç»§ç»­æ¨å¯¼æ›´ä¸€èˆ¬çš„è¡¨è¾¾å½¢å¼ï¼Œè¿™ä¸€å°èŠ‚çš„å†…å®¹ä¸»è¦å‚è€ƒ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Homography_(computer_vision)">Wiki:Homography (computer vision)</a></p>
<p>ç”±äºä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯çŸ¥é“ç›¸æœºçš„å¤–å‚ï¼ˆä¹Ÿå°±æ˜¯ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»çš„å˜æ¢å…³ç³»ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸€èŠ‚ä¸å‡è®¾å¹³é¢çš„åæ ‡ç³»ä¸ä¸–ç•Œåæ ‡ç³»å¯¹é½ï¼Œæˆ‘ä»¬å‡è®¾å¹³é¢åœ¨ç›¸æœº<span class="math inline">\(C_1\)</span>ä¸‹çš„æ³•å‘é‡ä¸º<span class="math inline">\(\boldsymbol{n}\)</span>ï¼Œå¹³é¢åˆ°ç›¸æœº<span class="math inline">\(C_1\)</span>çš„è·ç¦»ä¸º<span class="math inline">\(d\)</span>ï¼Œä¸”å¯¹äºæ³•å‘é‡çš„æ–¹å‘ï¼Œæˆ‘ä»¬åšå¦‚ä¸‹è§„å®šï¼šå¯¹äºå¹³é¢ä¸Šçš„ç‚¹<span class="math inline">\(P_{C_1}\)</span>ï¼Œæ»¡è¶³<span class="math inline">\(\boldsymbol{n}^TP_{C_1}+d=0\)</span>ï¼Œå…¶ä¸­<span class="math inline">\(\boldsymbol{n}^TP_{C_1}\)</span>ä¸ºç‚¹åˆ°æ³•å‘é‡çš„æŠ•å½±</p>
<figure>
<img src="./imgs/04-homo_general.png" alt="" /><figcaption>å•åº”çŸ©é˜µçš„ä¸€èˆ¬å½¢å¼æ¨å¯¼</figcaption>
</figure>
<p>å‡è®¾ç›¸æœº<span class="math inline">\(C_1\)</span>çš„å¤–å‚ä¸º<span class="math inline">\(T_{C_1W}=[R_1|\boldsymbol{t}_1]\)</span>ï¼Œç›¸æœº<span class="math inline">\(C_2\)</span>çš„å¤–å‚ä¸º<span class="math inline">\(T_{C_2W}=[R_2|\boldsymbol{t}_2]\)</span>ï¼Œç”±å˜æ¢çŸ©é˜µçš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°</p>
<p><span class="math display">\[
\begin{split}
T_{WC_1} &amp;= T_{C_1W}^{-1}\\
&amp;= 
\begin{bmatrix}
R_1&amp;\boldsymbol{t}_1\\
\boldsymbol{0}&amp;1
\end{bmatrix}^{-1}\\
&amp;=\
\begin{bmatrix}
R_1^{-1}&amp;-R_1^{-1}\boldsymbol{t}_1\\
\boldsymbol{0}&amp;1
\end{bmatrix}
\end{split}\tag{2-5}
\]</span></p>
<p>æ‰€ä»¥ç›¸æœº1åˆ°ç›¸æœº2çš„å˜æ¢çŸ©é˜µä¸º</p>
<p><span class="math display">\[
\begin{split}
T_{C_2C_1} &amp;= T_{C_2W}T_{WC_1}\\
&amp;= 
\begin{bmatrix}
R_2&amp;\boldsymbol{t}_2\\
\boldsymbol{0}&amp;1
\end{bmatrix}
\begin{bmatrix}
R_1^{-1}&amp;-R_1^{-1}\boldsymbol{t}_1\\
\boldsymbol{0}&amp;1
\end{bmatrix}\\
&amp;=\
\begin{bmatrix}
R_2R_1^{-1}&amp;-R_2R_1^{-1}\boldsymbol{t}_1+\boldsymbol{t}_2\\
\boldsymbol{0}&amp;1
\end{bmatrix}\\
&amp;=\
\begin{bmatrix}
R_{21}&amp;\boldsymbol{t}_{21}\\
\boldsymbol{0}&amp;1
\end{bmatrix}
\end{split}\tag{2-6}
\]</span></p>
<p>æ ¹æ®ç›¸æœºæŠ•å½±å…³ç³»ï¼Œæˆ‘ä»¬æœ‰</p>
<p><span class="math display">\[
\begin{split}
&amp;\boldsymbol{p}_1=\frac{1}{Z_{C_1}}K_1P_1\\
&amp;\boldsymbol{p}_2=\frac{1}{Z_{C_2}}K_2P_2\\
\end{split}\tag{2-7}
\]</span></p>
<p><span class="math display">\[
P_1 = Z_{C_1}K_1^{-1}\boldsymbol{p}_1\tag{2-8}
\]</span></p>
<p>åˆ<span class="math inline">\(P_1,P_2\)</span>ä¸ºç‚¹<span class="math inline">\(P_W\)</span>åœ¨ä¸¤ä¸ªç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡ï¼Œè¿™ä¸¤ä¸ªç‚¹åˆå¯ä»¥é€šè¿‡ä¸‹é¢çš„å˜æ¢è”ç³»</p>
<p><span class="math display">\[
P_2 = R_{21}P_1 + \boldsymbol{t}_{21}\tag{2-9}
\]</span></p>
<p>è”åˆï¼ˆ2-7ï¼‰åˆ°ï¼ˆ2-9ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º</p>
<p><span class="math display">\[
\boldsymbol{p}_2=\frac{1}{Z_{C_2}}K_2(R_{21}Z_{C_1}K_1^{-1}\boldsymbol{p}_1+\boldsymbol{t}_{21})\tag{2-10}
\]</span></p>
<p>å¯¹äºå¹³é¢ï¼Œæˆ‘ä»¬å·²ç»åšäº†å¦‚ä¸‹è§„å®šï¼š åœ¨ç›¸æœº<span class="math inline">\(C_1\)</span>åæ ‡ç³»ä¸‹ï¼Œå¯¹äºå¹³é¢ä¸Šçš„ç‚¹<span class="math inline">\(P_{1}\)</span>ï¼Œæ»¡è¶³<span class="math inline">\(\boldsymbol{n}^TP_{1}+d=0\)</span>ï¼Œå…¶ä¸­<span class="math inline">\(\boldsymbol{n}^TP_{1}\)</span>ä¸ºç‚¹åˆ°æ³•å‘é‡çš„æŠ•å½±ã€‚å³</p>
<p><span class="math display">\[
\frac{\boldsymbol{n}^TP_1}{-d}=1\tag{2-11}
\]</span></p>
<p>å°†ï¼ˆ2-11ï¼‰å¸¦å…¥å…¬å¼ï¼ˆ2-10ï¼‰ä¸­çš„<span class="math inline">\(\boldsymbol{t}_{21}\)</span>å¯ä»¥å¾—åˆ°</p>
<p><span class="math display">\[
\begin{split}
\boldsymbol{t}_{21}
&amp;=\
\boldsymbol{t}_{21}\frac{\boldsymbol{n}^TP_1}{-d}\\
&amp;=\
\frac{\boldsymbol{t}_{21}\boldsymbol{n}^T}{-d}P_1\\
&amp;\overset{2-8}{=}\
-\frac{\boldsymbol{t}_{21}\boldsymbol{n}^T}{d}Z_{C_1}K_1^{-1}\boldsymbol{p}_1
\end{split}\tag{2-12}
\]</span></p>
<p>å°†ï¼ˆ2-12ï¼‰ä»£å…¥å…¬å¼ï¼ˆ2-10ï¼‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°</p>
<p><span class="math display">\[
\begin{split}
\boldsymbol{p}_2&amp;=\frac{1}{Z_{C_2}}K_2\left(R_{21}-\frac{\boldsymbol{t}_{21}\boldsymbol{n}^T}{d}\right)Z_{C_1}K_1^{-1}\boldsymbol{p}_1\\
&amp;=\
\frac{Z_{C_1}}{Z_{C_2}}K_2H_{21}K_1^{-1}\boldsymbol{p_1}
\end{split}\tag{2-13}
\]</span></p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å•åº”çŸ©é˜µçš„è¡¨è¾¾å½¢å¼</p>
<p><span class="math display">\[
H_{21} = R_{21}-\frac{\boldsymbol{t}_{21}\boldsymbol{n}^T}{d}\tag{2-14}
\]</span></p>
<p>å¦‚æœæˆ‘ä»¬å°†<span class="math inline">\(R_{21}\)</span>ä¸<span class="math inline">\(t_{21}\)</span>çš„å±•å¼€å½¢å¼ï¼Œå³å…¬å¼ï¼ˆ2-6ï¼‰ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å¾—åˆ°</p>
<p><span class="math display">\[
H_{21} = R_2R_1^{-1} - \frac{\left(-R_2R_1^{-1}\boldsymbol{t}_1+\boldsymbol{t}_2\right)\boldsymbol{n}^T}{d}\tag{2-15}
\]</span></p>
<hr />
<p>è¿™ç¯‡è®ºæ–‡<a target="_blank" rel="noopener" href="https://sci-hub.st/10.1145/3343031.3350885">Online Camera Pose Optimization for the Surround-viewSystem</a>ï¼Œä¸­å…³äºç¯è§†å›¾çš„åœ°å¹³é¢æŠ•å½±ä¸€ç« çš„å…¬å¼æ¨å¯¼å¾ˆè¯¦ç»†ï¼Œä½œä¸ºåŸºç¡€ç†è®ºå­¦ä¹ å¾ˆä¸é”™ã€‚</p>
<h2 id="ç¯è§†æŠ•å½±bev">ç¯è§†æŠ•å½±/BEV</h2>
<h3 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h3>
<p>ä»å‰æ–‡ä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œå¯¹äºç©ºé—´ä¸­çš„ä¸€ä¸ªå¹³é¢ï¼Œä¸åŒä½å§¿çš„ç›¸æœºæˆåƒçš„å›¾ç‰‡å¯ä»¥é€šè¿‡å•åº”çŸ©é˜µåœ¨ä¸åŒçš„å›¾ç‰‡ä¸­è¿›è¡Œå˜æ¢ã€‚å¯¹äºè‡ªåŠ¨é©¾é©¶è½¦è¾†æ¥è¯´ï¼Œç¯ç»•è½¦å‘¨çš„å¤šä¸ªæ‘„åƒå¤´(ä¸€èˆ¬æ˜¯4ä¸ªåŠä»¥ä¸Š)ä¼šåŒæ—¶æ‹æ‘„åˆ°åœ°é¢ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æœ‰ä¸€ä¸ªè™šæ‹Ÿç›¸æœºä½äºè½¦è¾†æ­£ä¸Šæ–¹å¾€ä¸‹æ‹æ‘„ã€‚è¿™æ ·ï¼Œè½¦å‘¨çš„æ‘„åƒå¤´å¯ä»¥æ ¹æ®åœ°å¹³é¢å¯¹åº”çš„å•åº”çŸ©é˜µæŠ•å½±åˆ°è™šæ‹Ÿç›¸æœºï¼Œå¾—åˆ°æ‰€è°“çš„ä¿¯ç°å›¾/é¸Ÿç°å›¾ï¼Œä¹Ÿå°±æ˜¯ <strong>BEV(Bird Eye View)</strong></p>
<h3 id="å›¾ç¤ºè¯´æ˜">å›¾ç¤ºè¯´æ˜</h3>
<hr />
<figure>
<img src="./imgs/05-ground_coor.png" alt="" /><figcaption>åœ°é¢åæ ‡ç³»ä¸ç¯è§†å›¾ç‰‡åæ ‡ç³»çš„è”ç³»</figcaption>
</figure>
<p>ä¸Šå›¾ä¸­<span class="math inline">\(O_G\)</span>æ˜¯åœ°é¢åæ ‡ç³»ï¼Œè¿™é‡Œä¸ç¬¬ä¸€èŠ‚ä¸­è¯´æ˜çš„è½¦è¾†åæ ‡ç³»æœ‰ä¸€ç‚¹ä¸åŒï¼Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿åæ–‡è¿›è¡Œå…¬å¼æ¨å¯¼ã€‚å®é™…ä¸­åªéœ€è¦æŠŠå›¾ä¸­çš„åœ°é¢åæ ‡ç³»ä¸è½¦è¾†åæ ‡ç³»æ ¹æ®è½¦èº«å‚æ•°ç®€å•è®¡ç®—å‡ºå˜æ¢çŸ©é˜µå³å¯ã€‚</p>
<p>ä¸Šå›¾ä¸­<span class="math inline">\(O_I\)</span>æ˜¯å›¾åƒåæ ‡ç³»ï¼Œä»¥å·¦ä¸Šè§’ä¸ºåæ ‡åŸç‚¹ï¼Œ<span class="math inline">\(u,v\)</span>ä¸ºåƒç´ çš„æ¨ªè½´ã€çºµè½´åæ ‡å€¼ã€‚<span class="math inline">\(H,W\)</span>ä¸ºæˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„åœ°å¹³é¢æŠ•å½±å›¾åƒçš„æŠ•å½±èŒƒå›´ï¼Œå•ä½æ˜¯<span class="math inline">\(ç±³\)</span>ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä»¤<span class="math inline">\(d_W,d_H\)</span>ä¸ºå›¾åƒæ¯ä¸ªåƒç´ å¯¹åº”çš„å®é™…ä¸­æ–¹æ ¼çš„å¤§å°ï¼Œå•ä½ä¹Ÿæ˜¯<span class="math inline">\(ç±³\)</span></p>
<hr />
<h3 id="åœ°å¹³é¢ç‚¹åˆ°ç›¸æœºæŠ•å½±">åœ°å¹³é¢ç‚¹åˆ°ç›¸æœºæŠ•å½±</h3>
<p>å‡è®¾è½¦å‘¨æœ‰4ä¸ªç›¸æœº<span class="math inline">\(C_1,C_2,C_3,C_4\)</span>ï¼Œ4ä¸ªç›¸æœºçš„ä¸åœ°é¢åæ ‡ç³»çš„ä½å§¿å…³ç³»ä¸º<span class="math inline">\(T_{C_1G}, T_{C_2G}, T_{C_3G}, T_{C_4G}\)</span></p>
<p>å¯¹äºä¸€ä¸ªåœ°é¢åæ ‡ç³»ä¸‹çš„ç‚¹<span class="math inline">\(P_{G}=[X_G,Y_G,Z_G,1]^T\)</span>ï¼Œåœ¨é€šè¿‡æŠ•å½±æ–¹ç¨‹æŠ•å½±åœ¨ç›¸æœº<span class="math inline">\(C_i\)</span>ä¸Šçš„å›¾åƒåƒç´ åæ ‡<span class="math inline">\(\boldsymbol{p}_i\)</span>æœ‰å¦‚ä¸‹å…³ç³»ï¼š</p>
<p><span class="math display">\[
\begin{split}
P_{C_i}&amp;=T_{C_iG}P_G\\
&amp;=
\begin{bmatrix}
X_{C_i} &amp; Y_{C_i} &amp; Z_{C_i} &amp; 1
\end{bmatrix}^T
\end{split}
\]</span></p>
<p>åˆ™<span class="math inline">\(P_G\)</span>åœ¨ç›¸æœº<span class="math inline">\(C_i\)</span>ä¸­å¯¹åº”çš„åƒç´ åæ ‡ä¸º</p>
<p><span class="math display">\[
\begin{split}
\lambda_{C_i} \boldsymbol{p}_{C_i} 
&amp;=\
K_{C_i}P_{C_{i}}\\
&amp;=\
K_{C_i}T_{C_iG}P_G
\end{split}\tag{3-1}
\]</span></p>
<p><span class="math inline">\(K_{C_i}\)</span>æ˜¯ç›¸æœº<span class="math inline">\(C_i\)</span>çš„å†…å‚ï¼Œ<span class="math inline">\(\lambda_{C_i}\)</span>æ˜¯æ”¾ç¼©ç³»æ•°ï¼Œç¡®ä¿æœ€å<span class="math inline">\(\boldsymbol{p}_{C_i}\)</span>çš„ç¬¬ä¸‰ä¸ªç»´åº¦å€¼ä¸º1,ä¹Ÿå°±æ˜¯å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š<span class="math inline">\(\boldsymbol{p}_{C_i}=[u,v,1]^T\)</span>ã€‚å¦å¤–ï¼Œè¦æ³¨æ„ï¼ˆ3-1ï¼‰ä¸­åŒ…å«ä¸€ä¸ªé½æ¬¡åæ ‡çš„å˜æ¢ã€‚</p>
<p>ç°åœ¨å‡è®¾ç‚¹<span class="math inline">\(P_G\)</span>çš„<span class="math inline">\(Z\)</span>è½´åæ ‡æ˜¯0,ä¹Ÿå°±æ˜¯ç‚¹ä½äºåœ°é¢ï¼Œåˆ™ <span class="math inline">\(P_{G}=[X_G,Y_G,0,1]^T\)</span>ï¼Œä¸Šé¢<span class="math inline">\(P_{C_i}=T_{C_iG}P_G\)</span>å±•å¼€ä¼šå˜æˆ</p>
<p><span class="math display">\[
\begin{split}
P_{C_i}&amp;=T_{C_iG}P_G\\
&amp;=
\begin{bmatrix}
r_{00} &amp; r_{01} &amp; r_{02} &amp; t_0\\
r_{10} &amp; r_{11} &amp; r_{12} &amp; t_1\\
r_{20} &amp; r_{21} &amp; r_{22} &amp; t_2\\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
X_{G_i}\\
Y_{G_i}\\
0\\
1
\end{bmatrix}\\
&amp;=
\begin{bmatrix}
r_{00} &amp; r_{01} &amp; t_0\\
r_{10} &amp; r_{11} &amp; t_1\\
r_{20} &amp; r_{21} &amp; t_2\\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
X_{G_i}\\
Y_{G_i}\\
1
\end{bmatrix}
\end{split}
\]</span></p>
<p>æˆ‘ä»¬å¯ä»¥é‡æ–°è®°å…¬å¼ï¼ˆ3-1ï¼‰ä¸º</p>
<p><span class="math display">\[
\begin{split}
\lambda_{C_i}\boldsymbol{p}_{C_i}=K_{C_i}T_{C_iG}^{0:3;0:2,3}P_G
\end{split}\tag{3-3}
\]</span></p>
<p>å…¶ä¸­</p>
<p><span class="math display">\[
T_{C_iG}^{0:3;0:2,3} =
\begin{bmatrix}
r_{00} &amp; r_{01} &amp; t_0\\
r_{10} &amp; r_{11} &amp; t_1\\
r_{20} &amp; r_{21} &amp; t_2
\end{bmatrix}
\]</span></p>
<p>è¡¨ç¤ºå˜æ¢çŸ©é˜µçš„å‰ä¸‰è¡Œï¼Œç¬¬0,1,3åˆ—</p>
<p>å…¬å¼ï¼ˆ3-3ï¼‰å®é™…å°±æ˜¯ç¬¬äºŒèŠ‚ä¸­æ¨å¯¼å‡ºçš„å…¬å¼ï¼ˆ2-2ï¼‰</p>
<h3 id="åœ°å¹³é¢ç‚¹è™šæ‹Ÿç›¸æœºæŠ•å½±">åœ°å¹³é¢ç‚¹è™šæ‹Ÿç›¸æœºæŠ•å½±</h3>
<p>æ ¹æ®ä¸Šå›¾ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æŠ•å½±ä»¥åœ°é¢åæ ‡ç³»åŸç‚¹ä¸ºä¸­å¿ƒï¼Œ<span class="math inline">\(H\times W\)</span>çš„åœ°é¢åŒºåŸŸã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æŠ•å½±åçš„åƒç´ åˆ†è¾¨ç‡ä¸ºä¸€ä¸ªåƒç´ å¯¹åº”æ¨ªè½´ã€é•¿è½´ä¸º<span class="math inline">\(d_W,d_H\)</span>é•¿åº¦çš„åœ°é¢æ–¹æ ¼ã€‚<strong>ï¼ˆPS:å®é™…ä¸Šç›¸æœºçš„ç„¦è·çš„å®šä¹‰å°±æ˜¯æ¯ä¸ªåƒç´ å¯¹åº”çš„å®é™…å°ºå¯¸ï¼Œç„¦è·çš„å•ä½ä¸º<span class="math inline">\(pixel/meter\)</span>ï¼‰</strong>ã€‚å¯¹äºåœ°å¹³é¢æŠ•å½±ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æœ‰ä¸€ä¸ªè™šæ‹Ÿç›¸æœºä½äºåœ°é¢ä¸Š1ç±³ï¼Œè¿™æ ·<span class="math inline">\(u=f_xX_G+c_x\)</span>ï¼Œ<span class="math inline">\(f_x=\frac{1}{d_W}\)</span>ï¼Œ<span class="math inline">\(c_x=\frac{W}{2d_W}\)</span>ã€‚æˆ‘ä»¬å¯ä»¥å†™æˆå¦‚ä¸‹çš„å½¢å¼</p>
<p><span class="math display">\[
\begin{bmatrix}
u_G\\
v_G\\
1
\end{bmatrix}=
\begin{bmatrix}
\frac{1}{d_W} &amp; 0 &amp; \frac{W}{2d_W}\\
0 &amp; \frac{1}{d_H} &amp; \frac{H}{2d_H}\\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
X_G\\
Y_G\\
1
\end{bmatrix}\tag{3-4}
\]</span></p>
<p>ä¸Šå¼å¯ä»¥å†™æˆçŸ©é˜µå½¢å¼ï¼Œæˆ‘ä»¬è®°<span class="math inline">\(K_G\)</span>ä¸ºä¸Šå¼ä¸­çš„çŸ©é˜µï¼ˆè™šæ‹Ÿç›¸æœºçš„å†…å‚ï¼‰</p>
<p><span class="math display">\[
\boldsymbol{p}_G = K_GP_G\tag{3-5}
\]</span></p>
<p>è”ç«‹å…¬å¼ï¼ˆ3-3ï¼‰å’Œå…¬å¼ï¼ˆ3-5ï¼‰å¯ä»¥å†™ä¸ºå¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
\lambda \boldsymbol{p}_G=K_G\left(T_{C_iG}^{0:3;0:2,3}\right)^{-1}K_{C_i}^{-1}\boldsymbol{p}_{C_i}\tag{3-6}
\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(\lambda\)</span>ç³»æ•°åªæ˜¯ä¸ºäº†å°†<span class="math inline">\(\boldsymbol{p}_G\)</span>çš„æœ€åä¸€ä¸ªç»´åº¦å½’ä¸€åŒ–ï¼Œä¸éœ€è¦å…·ä½“å½¢å¼ã€‚</p>
<h2 id="ç›´æ¥ä¼°è®¡ç¯è§†æŠ•å½±çš„å•åº”çŸ©é˜µ">ç›´æ¥ä¼°è®¡ç¯è§†æŠ•å½±çš„å•åº”çŸ©é˜µ</h2>
<p>é™¤äº†æ ¹æ®ç¬¬ä¸‰èŠ‚çš„æ¨å¯¼ï¼Œä»ç›¸æœºå†…å¤–å‚ç›´æ¥æ¨å¯¼å‡ºè½¦å‘¨ç›¸æœºåˆ°åœ°å¹³é¢çš„æŠ•å½±çŸ©é˜µï¼Œè¿˜å¯ä»¥ç›´æ¥äººå·¥é€‰ç‚¹ä¼°è®¡å•åº”çŸ©é˜µã€‚è¿™ä¸€ç‚¹è·Ÿé€è§†çŸ«æ­£ï¼ˆPerspective Correctionï¼‰ä»»åŠ¡åŸºæœ¬ç±»ä¼¼ã€‚æ‰€è°“çš„é€è§†çŸ«æ­£ï¼Œå°±æ˜¯å¯¹äºåŒä¸€ä¸ªå¹³é¢çš„ä¸åŒæˆåƒç»“æœï¼ˆä¸¤å¼ å›¾ç‰‡ï¼‰ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸¤å¼ å›¾ç‰‡ä¸Šçš„å¯¹åº”ç‚¹æ„å»ºå¯¹åº”ç‚¹é›†ï¼Œæ ¹æ®å•åº”çŸ©é˜µçš„å®šä¹‰</p>
<p><span class="math display">\[
\boldsymbol{p}_2 = H_{21}\boldsymbol{p}_1
\]</span></p>
<p>æˆ‘ä»¬å¯ä»¥ä»å¯¹åº”çš„ç‚¹é›†ä¸­æ±‚è§£å‡ºå•åº”çŸ©é˜µã€‚ç”±äºå‰é¢ç¬¬äºŒèŠ‚æˆ‘ä»¬çŸ¥é“å•åº”çŸ©é˜µçš„å®é™…è‡ªç”±åº¦ä¸º8ï¼Œè€Œä¸€ä¸ªå¯¹åº”ç‚¹å¯¹å¯ä»¥æ„å»ºä¸¤ä¸ªçº¦æŸæ–¹ç¨‹ï¼ˆ<span class="math inline">\(x,y\)</span>ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å…±æœ€å°‘éœ€è¦4ä¸ªç‚¹å¯¹æ¥æ±‚è§£å•åº”çŸ©é˜µã€‚</p>
<h3 id="ç¤ºä¾‹å›¾">ç¤ºä¾‹å›¾</h3>
<p>è¿˜æ˜¯ä»¥ä¸Šæ–‡çš„ç®€ç¬”å›¾æ¥è¯´æ˜</p>
<figure>
<img src="./imgs/06-perspective_correction.png" alt="" /><figcaption>é€è§†çŸ«æ­£ç¤ºæ„å›¾</figcaption>
</figure>
<p>ä¸Šå›¾ä¸­ä¸¤ä¸ªç›¸æœºå¯¹åŒä¸€ä¸ªå¹³é¢æˆåƒï¼Œå¾—åˆ°ä¸¤å¼ å›¾ç‰‡ã€‚ä¸¤å¼ å›¾ç‰‡ä¸­<span class="math inline">\(A,B,C,D\)</span>å››ä¸ªç‚¹æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œè®°è¿™äº›ç‚¹å¯¹ä¸º<span class="math inline">\(\boldsymbol{p}_i,\boldsymbol{p}_i^{\prime}\)</span>ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å»ºç«‹æ–¹ç¨‹</p>
<p><span class="math display">\[
\begin{split}
\lambda \boldsymbol{p}_i^{\prime}&amp;=H\boldsymbol{p}_i
\end{split}
\]</span></p>
<p>å³ <span class="math display">\[
\lambda
\begin{bmatrix}
u_i^{\prime}\\
v_i^{\prime}\\
1
\end{bmatrix}
=\
\begin{bmatrix}
h_{00}&amp;h_{01}&amp;h_{02}\\
h_{10}&amp;h_{11}&amp;h_{21}\\
h_{20}&amp;h_{21}&amp;h_{22}\\
\end{bmatrix}
\begin{bmatrix}
u_i\\
v_i\\
1
\end{bmatrix}\tag{4-1}
\]</span></p>
<h3 id="å•åº”çŸ©é˜µæ±‚è§£">å•åº”çŸ©é˜µæ±‚è§£</h3>
<p>å…¬å¼ï¼ˆ4-1ï¼‰çš„æ±‚è§£å¯ä»¥ç”¨æœ€å°äºŒä¹˜æ³•ï¼Œæˆ–è€…æœ€å°äºŒä¹˜æ³•+RANSACç­‰ç®—æ³•ï¼Œä¼˜åŒ–ç›®æ ‡ä¸ºï¼š</p>
<p><span class="math display">\[
J = \sum_{i}\left(u_i^{\prime}-\frac{h_{00}u_i+h_{01}v_i+h_{02}}{h_{20}u_i+h_{21}v_i+h_{22}}\right)^2+\left(v_i^{\prime}-\frac{h_{10}u_i+h_{11}v_i+h_{21}}{h_{20}u_i+h_{21}v_i+h_{22}}\right)^2
\]</span></p>
<p>è¿™éƒ¨åˆ†çš„æ±‚è§£å¯ä»¥ä½¿ç”¨OpenCVçš„å‡½æ•°<a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/d9/d0c/group__calib3d.html#ga4abc2ece9fab9398f2e560d53c8c9780">OpenCV:findHomography</a></p>
<h3 id="ç¯è§†æŠ•å½±å•åº”çŸ©é˜µæ±‚è§£">ç¯è§†æŠ•å½±å•åº”çŸ©é˜µæ±‚è§£</h3>
<p>åœ¨ç¯è§†æŠ•å½±ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é¢å¤–çš„æ ‡å®šç‰©è¦æ±‚è§£å•åº”çŸ©é˜µã€‚ä¸»è¦çš„åŸç†å°±æ˜¯æˆ‘ä»¬å°†åœ°é¢ä¸Šçš„åæ ‡å’Œå›¾åƒä¸­çš„åæ ‡è”ç«‹å†™æˆå¦‚å…¬å¼ï¼ˆ4-1ï¼‰çš„å½¢å¼ï¼Œç„¶åè°ƒç”¨æ¥å£è®¡ç®—å•åº”çŸ©é˜µã€‚å›¾åƒä¸­çš„åæ ‡å¯ä»¥é€šè¿‡æ‰‹å·¥é€‰ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›è§’ç‚¹æ£€æµ‹ç¨‹åºã€‚</p>
<figure>
<img src="./imgs/07-compute-homo.png" alt="" /><figcaption>ç¯è§†å•åº”çŸ©é˜µæ±‚è§£</figcaption>
</figure>
<p>ä¸Šå›¾å¼•ç”¨è‡ªï¼šhttps://www.guyuehome.com/39649</p>
<p>ä¸Šå›¾ä¸­0,1,2,3å››ä¸ªç‚¹æ˜¯åœ¨å›¾ç‰‡ä¸Šé€‰æ‹©çš„ç‚¹ï¼Œå› æ­¤çŸ¥é“åƒç´ å€¼ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬åˆå¯ä»¥é€šè¿‡æ ‡å®šå¸ƒçš„å‡ ä½•å±æ€§ä»¥åŠæˆ‘ä»¬æå‰è®¾å®šçš„æŠ•å½±å›¾çš„åˆ†è¾¨ç‡ï¼Œå¾—å‡ºè¿™å››ä¸ªç‚¹åœ¨BEVä¸Šçš„ç­‰æ•ˆåƒç´ å€¼ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥æ±‚è§£æ–¹ç¨‹ï¼ˆ4-1ï¼‰å¾—å‡ºå•åº”çŸ©é˜µ</p>
<h2 id="å•åº”çŸ©é˜µçš„å…¶ä»–åº”ç”¨">å•åº”çŸ©é˜µçš„å…¶ä»–åº”ç”¨</h2>
<p>å•åº”çŸ©é˜µè¿˜å¯ä»¥ç”¨åœ¨æ±‚è§£å¹³é¢æ ‡å®šæ¿çš„ä½å§¿ã€å…¨æ™¯å›¾æ‹¼æ¥ç­‰åº”ç”¨ï¼Œ<a target="_blank" rel="noopener" href="https://docs.opencv.org/4.x/d9/dab/tutorial_homography.html">OpenCVçš„è¿™ä¸€ç¯‡æ•™ç¨‹</a>å†™å¾—ååˆ†è¯¦ç»†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Homography_(computer_vision)">Wiki:Homography_(computer_vision)</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/d9/d0c/group__calib3d.html#ga4abc2ece9fab9398f2e560d53c8c9780">OpenCV:findHomography</a></li>
<li><a target="_blank" rel="noopener" href="https://www.guyuehome.com/39649">å¤æœˆå±…:AVM ç¯è§†æ‹¼æ¥æ–¹æ³•ä»‹ç»</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.x/d9/dab/tutorial_homography.html">OpenCVï¼šBasic concepts of the homography explained with code</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/06/05/cv/camera-model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/05/cv/camera-model/" class="post-title-link" itemprop="url">åè¡€æ•´ç†ï¼šä»ç›¸æœºæ¨¡å‹ï¼ˆé’ˆå­”ã€é±¼çœ¼ã€å…¨æ™¯ï¼‰åˆ°OpenCVæºç å®ç°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-06-05 17:35:04" itemprop="dateCreated datePublished" datetime="2023-06-05T17:35:04+08:00">2023-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-06-12 15:42:27" itemprop="dateModified" datetime="2023-06-12T15:42:27+08:00">2023-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœºè§†è§‰</span></a>
        </span>
    </span>

  
    <span id="/2023/06/05/cv/camera-model/" class="post-meta-item leancloud_visitors" data-flag-title="åè¡€æ•´ç†ï¼šä»ç›¸æœºæ¨¡å‹ï¼ˆé’ˆå­”ã€é±¼çœ¼ã€å…¨æ™¯ï¼‰åˆ°OpenCVæºç å®ç°" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="åè¡€æ•´ç†ï¼šä»ç›¸æœºæ¨¡å‹ï¼ˆé’ˆå­”ã€é±¼çœ¼ã€å…¨æ™¯ï¼‰åˆ°OpenCVæºç å®ç°" href="/2023/06/05/cv/camera-model/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::7f7d0e7ebf1819ceb3ada055941a8a17" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="æœ¬æ–‡å†…å®¹">æœ¬æ–‡å†…å®¹</h2>
<p>æœ¬æ–‡æ—¨åœ¨è¾ƒä¸ºç›´è§‚åœ°ä»‹ç»ç›¸æœºæˆåƒèƒŒåçš„æ•°å­¦æ¨¡å‹ï¼Œä¸»è¦çš„ç« èŠ‚ç»„ç»‡å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>ç¬¬ä¸€ç« ç”¨æœ€ç®€å•çš„é’ˆå­”æŠ•å½±æ¨¡å‹ä¸ºä¾‹è®²è§£ä¸€ä¸ªä¸‰ç»´ç‚¹æ˜¯å¦‚ä½•æ˜ å°„åˆ°å›¾åƒä¸­çš„ä¸€ä¸ªåƒç´ </li>
<li>ç¬¬äºŒç« ä»‹ç»é™¤äº†é’ˆå­”æŠ•å½±æ¨¡å‹å¤–å…¶ä»–ä¸€äº›ç»å…¸æŠ•å½±æ¨¡å‹ï¼Œæ—¨åœ¨è®©è¯»è€…å»ºç«‹ä¸åŒæŠ•å½±æ¨¡å‹ä¹‹é—´çš„å»ºæ¨¡è¿‡ç¨‹</li>
<li>ç¬¬ä¸‰ç« ä»‹ç»å¦‚ä½•æŠŠä¸åŒçš„æŠ•å½±æ¨¡å‹ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æŠ•å½±è¿‡ç¨‹è¡¨è¾¾</li>
<li>ç¬¬å››ç« è¿›ä¸€æ­¥è¡¥å……ç¬¬ä¸‰ç« çš„ç»Ÿä¸€æŠ•å½±æ¨¡å‹ï¼Œå¹¶ä»‹ç»ç•¸å˜çš„å®šä¹‰å’Œå»ç•¸å˜çš„åŸç†</li>
<li>ç¬¬äº”ç« é’ˆå¯¹å…¨æ™¯ç›¸æœºçš„åŸºæœ¬æ¦‚å¿µå’Œä¸¤ç§åº”ç”¨å¹¿æ³›çš„å…¨æ™¯ç›¸æœºæ¨¡å‹åšå‡ºä»‹ç»</li>
<li>ç¬¬å…­ç« ç”¨ä»£ç ç¤ºä¾‹ä»‹ç»å¦‚ä½•ä½¿ç”¨OpenCVçš„æ¥å£å¯¹å›¾åƒå»ç•¸å˜</li>
</ol>
<h2 id="ä¸€ç›¸æœºæ˜¯å¦‚ä½•æˆåƒçš„">ä¸€ã€ç›¸æœºæ˜¯å¦‚ä½•æˆåƒçš„ï¼Ÿ</h2>
<p>ç¥­ä¸Šä¸€å¼ ç»å…¸å›¾</p>
<figure>
<img src="./imgs/01-pinhole.png" alt="" /><figcaption>é’ˆå­”ç›¸æœºæ¨¡å‹</figcaption>
</figure>
<h3 id="ä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹æ€æ ·æ˜ å°„åˆ°å›¾ç‰‡ä¸Šçš„ä¸€ä¸ªåƒç´ ">ä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹æ€æ ·æ˜ å°„åˆ°å›¾ç‰‡ä¸Šçš„ä¸€ä¸ªåƒç´ ï¼Ÿ</h3>
<p>æˆ‘ä»¬ä»ä¸€ä¸ªæœ€ç®€å•çš„é—®é¢˜å¼€å§‹ï¼šä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹<span class="math inline">\(P=[X,Y,Z]\)</span>æ˜¯å¦‚ä½•ç»è¿‡ç›¸æœºæˆåƒå˜ä¸ºå›¾åƒä¸Šçš„ä¸€ä¸ªåƒç´ <span class="math inline">\(\boldsymbol{p}=[u,v]\)</span>çš„ï¼Ÿ</p>
<p>æˆ‘ä»¬æœ€å¸¸è§çš„æŠ•å½±æ¨¡å‹<strong>Perspective Projection Model</strong> æè¿°çš„å°±æ˜¯<strong>é’ˆå­”ç›¸æœº</strong> çš„æˆåƒåŸç†ã€‚ä»ä¸Šé¢çš„å›¾æ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢å¯ä»¥å¾—å‡º</p>
<p><span class="math display">\[
\frac{X_c}{Z_c} = \frac{u - c_x}{f}\tag{1-1}
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(c_x\)</span>ä¸ºå…‰è½´åœ¨å›¾åƒä¸­çš„<span class="math inline">\(x\)</span>åæ ‡ï¼Œå¦‚æœç›¸æœºçš„å…‰è½´ä¸æ„Ÿå…‰å…ƒå™¨ä»¶å®Œå…¨å¯¹é½çš„è¯ï¼Œ<span class="math inline">\(c_x = \frac{1}{2}W\)</span>, <span class="math inline">\(W\)</span>æ˜¯å›¾åƒçš„å®½åº¦ï¼ˆå•ä½æ˜¯åƒç´ ï¼‰</p>
<p>ä»ä¸Šé¢çš„å…³ç³»å¯ä»¥å¾—å‡ºï¼Œå°†ä¸€ä¸ªä¸‰ç»´ç‚¹æŠ•å½±åˆ°åƒç´ åæ ‡ç³»çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å…¬å¼ã€‚å¯¹åº”çš„å°±æ˜¯é’ˆå­”ç›¸æœºæ¨¡å‹ã€‚<strong>ä¸‹æ ‡<span class="math inline">\((\cdot)_c\)</span></strong> è¡¨ç¤ºè¿™ä¸ªç‚¹æ˜¯åœ¨ç›¸æœºåæ ‡ç³»ä¸‹çš„ç‚¹</p>
<p><span class="math display">\[
\begin{split}
\lambda
\begin{bmatrix}
u\\
v\\
1
\end{bmatrix}=
\begin{bmatrix}
f_x&amp;0&amp;c_x\\
0&amp;f_y&amp;c_y\\
0&amp;0&amp;1
\end{bmatrix}
\begin{bmatrix}
X_c\\
Y_c\\
Z_c\\
\end{bmatrix}
\end{split}\tag{1-2}
\]</span></p>
<p>å…¬å¼ï¼ˆ1-2ï¼‰åœ¨ä»£ç ä¸­ä¹Ÿç»å¸¸å¯¹<span class="math inline">\(u,v\)</span>åˆ†å¼€è¿›è¡Œè®¡ç®—</p>
<p><span class="math display">\[
\begin{split}
u = f_x \frac{X_c}{Z_c} + c_x
\\
\\
v = f_y \frac{Y_c}{Z_c} + c_y
\end{split}\tag{1-3}
\]</span></p>
<p>å½“ç„¶ï¼Œä¸ºäº†ç®€åŒ–è®°å·ï¼Œå…¬å¼ï¼ˆ1-2ï¼‰ä¹Ÿé€šå¸¸è®°ä¸ºçŸ©é˜µç›¸ä¹˜çš„å½¢å¼</p>
<p><span class="math display">\[
\lambda\boldsymbol{p}=KP_c\tag{1-4}
\]</span></p>
<p>å¦‚æœæˆ‘ä»¬æå‰å¯¹<span class="math inline">\(P_c\)</span>åšå½’ä¸€åŒ–å¤„ç†ï¼Œä¹Ÿå°±æ˜¯é™¤ä»¥<span class="math inline">\(Z_c\)</span>ï¼ˆå‡è®¾ç‚¹ä½äºç›¸æœºå‰ï¼Œå³<span class="math inline">\(Z_c&gt;0\)</span>ï¼‰ï¼Œåˆ™å¯ä»¥å»æ‰<span class="math inline">\(\lambda\)</span>ç³»æ•°ï¼Œå³å¦‚ä¸‹å½¢å¼ï¼š</p>
<p><span class="math display">\[
\begin{split}
&amp;\boldsymbol{p}_n=\frac{P_c}{Z_c}=
\begin{bmatrix}
\frac{X_c}{Z_c}&amp;\frac{Y_c}{Z_c}&amp;1
\end{bmatrix}^T
\\
&amp;\boldsymbol{p}=K\boldsymbol{p}_n
\end{split}\tag{1-5}
\]</span></p>
<p>å…¬å¼ï¼ˆ1-4ï¼‰ä¸­<span class="math inline">\(\boldsymbol{p}_n\)</span>ä½äº<span class="math inline">\(Z=1\)</span>çš„å¹³é¢ï¼Œåˆå«å½’ä¸€åŒ–å¹³é¢ï¼ˆnomalized planeï¼‰ï¼Œåæ–‡ä¼šå†æ¬¡è®²åˆ°è¿™ä¸ªå¹³é¢ã€‚</p>
<p>å…¬å¼ï¼ˆ1-2ï¼‰åˆ°å…¬å¼ï¼ˆ1-5ï¼‰å…¶å®éƒ½æ˜¯ç­‰ä»·çš„</p>
<p>å¦‚æœç»™çš„ä¸‰ç»´ç‚¹æ˜¯åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(P_w=[X_w,Y_w,Z_w]\)</span>ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å…ˆæŠŠè¯¥ç‚¹ç”¨ç›¸æœºçš„å¤–å‚è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»ä¸‹ï¼ˆåˆšæ€§å˜æ¢ï¼‰å³å¯ï¼š</p>
<p><span class="math display">\[
\begin{split}
\lambda\boldsymbol{p} = KT_{cw}P_w\\
\\
T_{cw} = [R|t]
\end{split}\tag{1-6}
\]</span></p>
<p>ç”±äºåˆšæ€§å˜æ¢è¿‡ç¨‹ä¸å½±å“å¯¹ç›¸æœºæŠ•å½±æ¨¡å‹çš„è®¨è®ºï¼Œå› æ­¤åé¢éƒ½å‡è®¾ä¸‰ç»´ç‚¹æ˜¯å¤„äºç›¸æœºåæ ‡ç³»</p>
<h3 id="ç›¸æœºåæ ‡ç³»">ç›¸æœºåæ ‡ç³»</h3>
<p>åœ¨OpenCVä¸­ä»¥åŠå¤§éƒ¨åˆ†è§†è§‰å¤„ç†åº“ä¸­ï¼Œç›¸æœºåæ ‡ç³»çš„è§„å®šéƒ½ä¸ä¸Šè¿°çš„å›¾ä¸€è‡´ï¼Œå°±æ˜¯ç›¸æœºå…‰è½´å¾€å‰ä¸º<span class="math inline">\(Z\)</span>ï¼Œå›¾åƒæ°´å¹³å¾€å³ä¸º<span class="math inline">\(X\)</span>ï¼Œå›¾åƒå‚ç›´å¾€ä¸‹ä¸º<span class="math inline">\(Y\)</span>ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯åœ¨ä¸€äº›ä»¿çœŸæ¸²æŸ“å™¨æˆ–è€…ç‰¹å®šä»»åŠ¡çš„æ•°æ®é›†ä¸­å¯èƒ½ä¼šè§„å®šå›¾åƒå‚ç›´å¾€ä¸Šä¸º<span class="math inline">\(Z\)</span>ï¼Œå‰ä¸º<span class="math inline">\(X\)</span>ï¼Œæœå·¦ä¸º<span class="math inline">\(Y\)</span>ï¼Œä½†æ˜¯è¿™ä¸€ç‚¹æ˜¯æ— å…³ç´§è¦çš„ï¼Œè¿™ä¸€ç‚¹å·®åˆ«å¯ä»¥åæ˜ åœ¨ç›¸æœºçš„å¤–å‚é‡Œï¼Œä¹Ÿå°±æ˜¯å…¬å¼ï¼ˆ1-6ï¼‰ä¸­çš„<span class="math inline">\(T_{cw}\)</span>ï¼Œåªè¦æŒ‰ç…§OpenCVçš„æ–¹å¼è§„å®šç›¸æœºåæ ‡ç³»ï¼Œæ€»æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¤–å‚çŸ©é˜µ<span class="math inline">\(T_{cw}\)</span>å°†ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ç‚¹å˜æ¢åˆ°ç›¸æœºåæ ‡ç³»ï¼ˆå‰<span class="math inline">\(Z\)</span>å³<span class="math inline">\(X\)</span>ä¸‹<span class="math inline">\(Y\)</span>ï¼‰</p>
<h3 id="å¤§ç™½è¯æ€»ç»“">å¤§ç™½è¯æ€»ç»“</h3>
<p>é—®ï¼šç›¸æœºæ˜¯å¦‚ä½•æˆåƒçš„ï¼Ÿ ç­”ï¼šå…‰æŸä»ç‰©ä½“è¡¨é¢åå°„ï¼Œç»è¿‡ç›¸æœºé•œå¤´ï¼Œåˆ°è¾¾æ„Ÿå…‰åŸä»¶ï¼Œè¿™ä¸€ç³»åˆ—ç‰©ç†è¿‡ç¨‹å¯ä»¥é€šè¿‡æ•°å­¦å…¬å¼è¡¨è¾¾ï¼Œæœ€ç»ˆå˜æˆä¸€ä¸ªç®€å•çš„çŸ©é˜µæ“ä½œå°†ä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹å¯¹åº”åˆ°å›¾ç‰‡çš„ä¸€ä¸ªåƒç´ ã€‚</p>
<h2 id="äºŒä¸åŒçš„ç›¸æœºæŠ•å½±æ¨¡å‹">äºŒã€ä¸åŒçš„ç›¸æœºæŠ•å½±æ¨¡å‹</h2>
<p>ç¬¬ä¸€èŠ‚ä»‹ç»çš„æ˜¯é’ˆå­”æŠ•å½±æ¨¡å‹ï¼Œä½†æ˜¯äº‹å®ä¸Šç›¸æœºé•œå¤´éƒ½æ˜¯å¤šç§å¤šæ ·çš„ï¼Œä¸å¯èƒ½éƒ½æ˜¯ç¬¦åˆé’ˆå­”æŠ•å½±æ¨¡å‹ã€‚æœ¬èŠ‚ä¼šä»‹ç»ç»å…¸çš„ç›¸æœºæŠ•å½±æ¨¡å‹ï¼Œå¹¶ä»ç›´è§‚æ„Ÿå—å’Œå½¢å¼åŒ–å®šä¹‰ä¸Šä»‹ç»ä¸åŒçš„æŠ•å½±æ¨¡å‹æ˜¯å¦‚ä½•è”ç³»åœ¨ä¸€èµ·çš„</p>
<h3 id="ä»€ä¹ˆæ˜¯ç›¸æœºæŠ•å½±æ¨¡å‹">ä»€ä¹ˆæ˜¯ç›¸æœºæŠ•å½±æ¨¡å‹</h3>
<p><strong>ç›¸æœºæŠ•å½±æ¨¡å‹ç”¨æ•°å­¦çš„æ–¹å¼æè¿°äº†ä¸€ä¸ªçœŸå®ä¸–ç•Œä¸­çš„ä¸‰ç»´ç‚¹åˆ°å›¾åƒä¸Šåƒç´ åæ ‡çš„æ˜ å°„å…³ç³»</strong></p>
<p>ç›¸æœºæŠ•å½±æ¨¡å‹å®é™…ä¸Šå°±æ˜¯å¯¹ç›¸æœºæˆåƒè¿‡ç¨‹ï¼ˆç‰©ç†ï¼‰çš„æ•°å­¦å»ºæ¨¡ã€‚å»ºæ¨¡çš„ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿå°½é‡ç¬¦åˆçœŸå®çš„æˆåƒè¿‡ç¨‹ã€‚ä¸åŒçš„å»ºæ¨¡æ–¹å¼å°±å¯¹åº”ä¸åŒçš„ç›¸æœºæŠ•å½±æ¨¡å‹</p>
<h3 id="ç»å…¸çš„ç›¸æœºæŠ•å½±æ¨¡å‹">ç»å…¸çš„ç›¸æœºæŠ•å½±æ¨¡å‹</h3>
<p>æˆ‘ä»¬å›å¤´çœ‹çœ‹å…¬å¼ï¼ˆ1-3ï¼‰ï¼Œå¹¶æš‚æ—¶<strong>åªå…³æ³¨<span class="math inline">\(X\)</span>è½´çš„æ˜ å°„å…³ç³»</strong></p>
<p><span class="math display">\[
\begin{split}
u = f_x \frac{X_c}{Z_c} + c_x
\end{split}\tag{1-3}
\]</span></p>
<p>ä¸Šå¼ä¸­<span class="math inline">\(f_x\)</span>ç§°ä¸ºç›¸æœºç„¦è·ï¼Œååº”äº†ä¸€ä¸ªå•ä½é•¿åº¦åº”è¯¥æ˜ å°„ä¸ºå‡ ä¸ªåƒç´ ï¼Œå•ä½æ˜¯<span class="math inline">\(pixels/m\)</span>ï¼Œ<span class="math inline">\(c_x\)</span>æ˜¯ç›¸æœºåæ ‡ç³»ï¼ˆä»¥å…‰è½´ç‚¹ä¸ºåŸç‚¹ï¼‰åˆ°å›¾åƒåæ ‡ç³»ï¼ˆä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼‰ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ç›¸æœºçš„å›ºæœ‰å‚æ•°ã€‚ è€Œä¸Šå¼è½´<span class="math inline">\(\frac{X_c}{Z_c}\)</span>åˆšå¥½æ˜¯ç‚¹<span class="math inline">\(P_c\)</span>åˆ°ç›¸æœºå…‰å¿ƒè¿çº¿ä¸å…‰è½´è§’åº¦çš„æ­£åˆ‡å€¼ï¼Œæˆ‘ä»¬è®°å…‰æŸä¸å…‰è½´çš„å¤¹è§’ä¸º<span class="math inline">\(\theta\)</span>ï¼Œå¹¶å°†å›¾ç‰‡åŸç‚¹ç§»åŠ¨åˆ°å›¾ç‰‡ä¸­å¿ƒï¼Œåˆ™å…¬å¼ï¼ˆ1-3ï¼‰å¯ä»¥å†™ä¸º</p>
<p><span class="math display">\[
u^{\prime}=f_x\tan(\theta)\tag{2-1}
\]</span></p>
<p>ä¸Šå¼çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆå›¾ä¸­çš„<span class="math inline">\(r\)</span>åœ¨åªè€ƒè™‘<span class="math inline">\(X\)</span>è½´çš„æ—¶å€™å°±æ˜¯<span class="math inline">\(u^{\prime}\)</span>ï¼‰ï¼š</p>
<figure>
<img src="./imgs/02-theta_projection.jpg" alt="" /><figcaption>å…‰æŸä¸å…‰è½´å¤¹è§’</figcaption>
</figure>
<p>åœ¨å…¬å¼ï¼ˆ2-1ï¼‰ä¸­ï¼Œ<span class="math inline">\(X\)</span>è½´çš„æŠ•å½±åæ ‡æ˜¯<span class="math inline">\(\theta\)</span>çš„å‡½æ•°ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ç”¨ä¸åŒçš„å‡½æ•°è¡¨è¾¾è¿™ä¸ªè¿‡ç¨‹ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ä¸åŒçš„å‡½æ•°å°±å¯¹åº”äº†ä¸åŒçš„æŠ•å½±æ¨¡å‹ã€‚ä¸‹å›¾å°±ç»™å‡ºäº†åœ¨ç»å…¸æŠ•å½±æ¨¡å‹ä¸­å¯¹<span class="math inline">\(\theta\)</span>çš„ä¸åŒæ˜ å°„æ–¹å¼</p>
<figure>
<img src="./imgs/03-classic_projection.jpg" alt="" /><figcaption>ç»å…¸æŠ•å½±æ¨¡å‹</figcaption>
</figure>
<p>äº‹å®ä¸Šï¼Œ<span class="math inline">\(f\)</span>ä½œä¸ºç›¸æœºçš„ç„¦è·ï¼Œåœ¨ä¸Šå›¾ä¸­çš„ä¸åŒæŠ•å½±æ¨¡å‹éƒ½ç»Ÿä¸€å‡ºç°ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥èˆå¼ƒç„¦è·ç¬¦å·ã€‚äºæ˜¯ï¼Œä¸Šå›¾ä¸­ä¸åŒçš„å‡½æ•°å…³ç³»ä¸æŠ•å½±æ¨¡å‹çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<ul>
<li><span class="math inline">\(r(\theta)=\tan(\theta)\)</span>ï¼Œperspective projection/é’ˆå­”æŠ•å½±æ¨¡å‹/rectilinear model</li>
<li><span class="math inline">\(r(\theta)=2\tan{\big(\frac{\theta}{2}\big)}\)</span>, stereographic projection</li>
<li><span class="math inline">\(r(\theta)=\theta\)</span>, equidistant projection</li>
<li><span class="math inline">\(r(\theta)=\sin{(\theta)}\)</span>, sine-law projection</li>
<li><span class="math inline">\(r(\theta)=2\sin{\big(\frac{\theta}{2}\big)}\)</span>, equi-solid angle projection</li>
</ul>
<p>ä¸Šé¢ä¸¤å¹…å›¾å‡ºè‡ª:<a target="_blank" rel="noopener" href="http://michel.thoby.free.fr/Fisheye_history_short/Projections/Models_of_classical_projections.html">Models for the various classical lens projections</a>ï¼Œè¿™ç¯‡æ–‡ç« æ¯”è¾ƒå½¢è±¡åœ°ä»‹ç»å„ç§ç»å…¸çš„ç›¸æœºæŠ•å½±æ¨¡å‹ï¼Œå¹¶ç»™å‡ºä»–ä»¬çš„å‡½æ•°æ›²çº¿åˆ†æã€‚ä¸è¿‡æ€»ä½“åå½¢è±¡åŒ–ï¼Œæ²¡æœ‰å¼•å…¥æ›´å½¢å¼åŒ–çš„æè¿°ã€‚</p>
<h2 id="ä¸‰ç›¸æœºæŠ•å½±æ¨¡å‹çš„ç»Ÿä¸€è¡¨è¾¾å½¢å¼">ä¸‰ã€ç›¸æœºæŠ•å½±æ¨¡å‹çš„ç»Ÿä¸€è¡¨è¾¾å½¢å¼</h2>
<p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å°†æŠ•å½±å…³ç³»é™åˆ¶åœ¨<span class="math inline">\(X\)</span>è½´ï¼Œå¹¶ä¸”ç»™å‡ºäº†è¾ƒä¸ºç›´è§‚çš„å›¾ç¤ºã€‚ç›®çš„åœ¨äºä¸¤ä¸ªï¼š1ï¼‰ç»™è¯»è€…å»ºç«‹æ›´æ·±åˆ»çš„ç›¸æœºæŠ•å½±è¿‡ç¨‹;2ï¼‰è®©è¯»è€…å¯¹å‡ ç§ç»å…¸çš„æŠ•å½±æ¨¡å‹æœ‰åˆæ­¥çš„ç›´è§‚äº†è§£ã€‚åœ¨è¿™ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç»™å‡ºæ›´ä¸ºç»Ÿä¸€çš„ç›¸æœºæŠ•å½±è¡¨è¾¾æ–¹å¼ï¼ŒåŒæ—¶ä¸ºåæ–‡è®¨è®ºç›¸æœºçš„<strong>ç•¸å˜</strong> å»ºç«‹å¿…è¦çš„ç†è®ºåŸºç¡€ã€‚</p>
<p>æˆ‘ä»¬å°†ç›¸æœºçš„æŠ•å½±è¿‡ç¨‹æ‹†åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼š1ï¼‰å°†ç©ºé—´ä¸­çš„ç‚¹æŠ•å½±åˆ°å•ä½çƒè¡¨é¢;2ï¼‰å°†å•ä½çƒä¸Šçš„ç‚¹æŠ•å½±åˆ°å½’ä¸€åŒ–å¹³é¢;3ï¼‰å°†å½’ä¸€åŒ–å¹³é¢ä¸Šçš„ç‚¹åˆ©ç”¨é’ˆå­”æ¨¡å‹æŠ•å½±åˆ°å›¾åƒåæ ‡ç³»ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»è¿™å‡ ä¸ªè¿‡ç¨‹</p>
<h3 id="å•ä½çƒæŠ•å½±">å•ä½çƒæŠ•å½±</h3>
<p>æƒ³è±¡ä¸€ä¸‹ä¸€æŸå…‰æŸä»ç›¸æœºå…‰å¿ƒå°„å‡ºï¼Œç»è¿‡å›¾åƒä¸­çš„ä¸€ä¸ªåƒç´ ç„¶åå¾€å¤–æ— é™å»¶ä¼¸ï¼Œå¯ä»¥æƒ³è±¡åˆ°ï¼Œè¿™ä¸ªå…‰æŸç»è¿‡çš„ä»»ä½•ç‚¹åˆ°å›¾åƒçš„æŠ•å½±éƒ½æ˜¯ç»è¿‡çš„é‚£ä¸ªåƒç´ ã€‚è¿™ä¸ªç®€å•çš„äº‹å®å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªä¸‰ç»´ç‚¹è¿›è¡Œä»»æ„çš„æ”¾ç¼©ï¼Œå…¶åœ¨å›¾åƒä¸Šçš„æˆåƒç‚¹éƒ½ä¸ä¼šæ”¹å˜ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°†ä¸‰ç»´ç‚¹<span class="math inline">\(P_c\)</span>é™¤ä»¥å®ƒè‡ªèº«çš„è†œï¼Œå°†å…¶æŠ•å½±åˆ°ä¸€ä¸ªå•ä½çƒï¼Œå…¶æŠ•å½±åæ ‡ä¸º<span class="math inline">\(P_s\)</span></p>
<p><span class="math display">\[
\begin{split}
P_s = \frac{P_c}{||P_c||}=
\begin{bmatrix}
\frac{X_c}{||P_c||}&amp;\frac{Y_c}{||P_c||}&amp;\frac{Z_c}{||P_c||}
\end{bmatrix}^T
\end{split}\tag{3-1}
\]</span></p>
<p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<figure>
<img src="./imgs/04-unit_sphere.png" alt="" /><figcaption>å•ä½çƒæŠ•å½±ç¤ºæ„å›¾</figcaption>
</figure>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œ<span class="math inline">\(\theta\)</span>æ˜¯å…‰æŸä¸å…‰è½´çš„å¤¹è§’ï¼Œ<span class="math inline">\(\alpha\)</span>ä¸ºå…‰æŸä¸æ°´å¹³è½´çš„å¤¹è§’ã€‚</p>
<p>ä¸¤ä¸ªè§’åº¦æœ‰å¦‚ä¸‹å…³ç³»ï¼š</p>
<p><span class="math display">\[
\begin{split}
&amp;\rho = \sqrt{(X_s^2+Y_s^2)}\\
&amp;\theta=\operatorname{atan}(\frac{\rho}{Z_s})=\operatorname{asin}(\rho)\\
&amp;\alpha=\operatorname{atan}(\frac{Y_s}{X_s})
\end{split}\tag{3-2}
\]</span></p>
<p>ä¹‹æ‰€ä»¥æ„å»º<span class="math inline">\(\theta\)</span>å’Œ<span class="math inline">\(\alpha\)</span>æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åç»­å¯ä»¥å°†æŠ•å½±è¿‡ç¨‹å»ºç«‹ä¸ºè¿™ä¸¤ä¸ªè§’åº¦çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åªä¸å…‰æŸçš„è§’åº¦æœ‰å…³ï¼Œè€Œä¸å…·ä½“çš„ç‚¹åæ ‡æ— å…³ï¼Œè¿™ä¹Ÿæ˜¯ç¬¦åˆç›´è§‚çš„ã€‚</p>
<p>å¦å¤–ï¼Œä»å‰é¢çš„å™è¿°ä»¥åŠå¸¸è¯†ï¼Œæˆ‘ä»¬çŸ¥é“é’ˆå­”æˆåƒç»“æœæ˜¯ä¸€ä¸ªå€’ç«‹çš„åƒï¼Œä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸æœºåšä¸€ä¸ªé•œåƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure>
<img src="./imgs/05-mirror_camera.png" alt="" /><figcaption>å¯¹ç›¸æœºåšé•œåƒ</figcaption>
</figure>
<p>è¿™ä¸ªå•ä½çƒæœ‰æ—¶å€™åˆå«è§†çƒï¼ˆViewing Sphereï¼‰</p>
<h3 id="å½’ä¸€åŒ–å¹³é¢æ¨¡å‹å¹³é¢">å½’ä¸€åŒ–å¹³é¢&amp;&amp;æ¨¡å‹å¹³é¢</h3>
<p>å°†ä¸–ç•Œåæ ‡ç³»çš„ç‚¹æŠ•å½±åˆ°å•ä½çƒåï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å°†å…¶æ˜ å°„åˆ°<span class="math inline">\(Z=1\)</span>çš„å¹³é¢ä¸Šï¼Œè¿™ä¸ªå¹³é¢åˆå«å½’ä¸€åŒ–å¹³é¢ï¼ˆNormalized Planeï¼‰ã€‚ æ­¤æ—¶ä¸åŒçš„æŠ•å½±æ¨¡å‹ä¼šå¯¹åœ¨å½’ä¸€åŒ–å¹³é¢ä¸Šçš„ç‚¹åˆ°åŸç‚¹çš„è¿çº¿åšæ”¾ç¼©<span class="math inline">\(r(\theta)\)</span>ï¼Œä¸ºäº†åæ–‡å™è¿°çš„ç»Ÿä¸€æ€§ï¼Œæˆ‘ä»¬å†æ‹†åˆ†å‡ºä¸€ä¸ªæ¨¡å‹å¹³é¢ã€‚åœ¨å½’ä¸€åŒ–å¹³é¢ä¸Šçš„ç‚¹åªæ˜¯<span class="math inline">\(P_c\)</span>ä¸å…‰å¿ƒç‚¹çš„è¿çº¿å’Œå¹³é¢çš„äº¤ç‚¹ï¼Œå³ï¼š</p>
<p><span class="math display">\[
p_n = \frac{P_c}{||Z_c||}\tag{3-3}
\]</span></p>
<p>åœ¨æ¨¡å‹å¹³é¢ä¸Šï¼ˆModel Planeï¼‰ï¼Œå¯¹å½’ä¸€åŒ–å¹³é¢ä¸Šçš„ç‚¹åšåŠå¾„æ”¾ç¼©ï¼Œå³</p>
<p><span class="math display">\[
\begin{split}
\boldsymbol{p}_d=
\begin{bmatrix}
r(\theta)\cos(\alpha)\\
r(\theta)\sin(\alpha)\\
1
\end{bmatrix}=
\begin{bmatrix}
u_d\\
v_d\\
1
\end{bmatrix}
\end{split}\tag{3-4}
\]</span></p>
<p>è¿™ä¸¤ä¸ªå¹³é¢çš„å˜æ¢è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure>
<img src="./imgs/06-normalized_plane.png" alt="" /><figcaption>å½’ä¸€åŒ–å¹³é¢æŠ•å½±&amp;&amp;æ¨¡å‹å¹³é¢</figcaption>
</figure>
<p>ä»ç¬¬äºŒèŠ‚ä¸­ç»å…¸çš„æŠ•å½±æ¨¡å‹æˆ‘ä»¬å‘ç°ï¼Œå…¶å®ä¸åŒçš„æŠ•å½±æ¨¡å‹éƒ½æ²¡æœ‰å¯¹<span class="math inline">\(\alpha\)</span>äº§ç”Ÿå½±å“ï¼Œè€Œæ˜¯å¯¹æŠ•å½±ç‚¹åˆ°åŸç‚¹çš„è·ç¦»<span class="math inline">\(r(\theta)\)</span>å»ºç«‹ä¸åŒçš„å‡½æ•°å½¢å¼</p>
<p>ç¨åæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œä¸ºäº†èƒ½å¤Ÿå°†æ‰€æœ‰æ¨¡å‹éƒ½ç»Ÿä¸€ä¸ºé’ˆå­”æŠ•å½±æ¨¡å‹ï¼Œä¼šå°†æ¨¡å‹å¹³é¢å˜ä¸ºç•¸å˜å¹³é¢ï¼Œç”¨æ›´å…·æœ‰ä¸€èˆ¬æ€§çš„å¤šé¡¹å¼ä»£æ›¿å‰é¢<span class="math inline">\(r(\theta)\)</span>çš„è¡¨è¾¾å½¢å¼ã€‚ï¼ˆå› æ­¤ï¼Œç°åœ¨æ¨¡å‹å¹³é¢ä¸Šçš„ç‚¹ç”¨ä¸‹æ ‡<span class="math inline">\(d\)</span>æ ‡æ˜ï¼Œè¡¨ç¤ºdistortionï¼‰</p>
<h3 id="é€è§†å˜æ¢">é€è§†å˜æ¢</h3>
<p>å¾—åˆ°æ¨¡å‹å¹³é¢ä¸Šçš„åæ ‡<span class="math inline">\(\boldsymbol{p}_d=[u_d,v_d,1]^T\)</span>åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç›¸æœºå†…å‚<span class="math inline">\(K\)</span>å°†å…¶å˜æ¢åˆ°å›¾åƒå¹³é¢ï¼Œè¿™ä¸ªæ­¥éª¤å®é™…ä¸Šå°±åªæ˜¯åæ ‡çš„å˜æ¢äº†ã€‚</p>
<p><span class="math display">\[
\begin{split}
u = f_xu_d+c_x\\
v = f_yv_d+c_y
\end{split}\tag{3-5}
\]</span></p>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€å¼ å®Œæ•´åœ°è¡¨è¾¾ç›¸æœºæŠ•å½±æ¨¡å‹çš„ç¤ºæ„å›¾ï¼š</p>
<figure>
<img src="./imgs/07-unified_model.png" alt="" /><figcaption>ç›¸æœºæŠ•å½±æ¨¡å‹ç»Ÿä¸€è¡¨è¾¾å½¢å¼</figcaption>
</figure>
<h3 id="å°†é’ˆå­”æŠ•å½±å¸¦å…¥ä¸Šè¿°ç»Ÿä¸€æ¨¡å‹">å°†é’ˆå­”æŠ•å½±å¸¦å…¥ä¸Šè¿°ç»Ÿä¸€æ¨¡å‹</h3>
<p>æˆ‘ä»¬å¯ä»¥å°†é’ˆå­”æ¨¡å‹ï¼Œå³<span class="math inline">\(r(\theta)=\tan(\theta)\)</span>ä»£å…¥ä¸Šé¢çš„æ¨¡å‹ï¼Œè”ç«‹å…¬å¼ï¼ˆ3-1ï¼‰-ï¼ˆ3-5ï¼‰,æœ€åå¯ä»¥å‘ç°ï¼Œå…¬å¼ï¼ˆ3-5ï¼‰çš„ç»“æœå…¶å®å°±æ˜¯å…¬å¼ï¼ˆ1-3ï¼‰ï¼Œä¹Ÿå°±æ˜¯é’ˆå­”æŠ•å½±æ¨¡å‹çš„å…¬å¼ã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å†å±•å¼€å…¬å¼ã€‚è¯»è€…è‡ªå·±æ¨å¯¼ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹éå¸¸æœ‰åˆ©äºç†è§£ä¸Šè¿°çš„è¿‡ç¨‹ã€‚</p>
<h3 id="ä¸åŒæŠ•å½±æ¨¡å‹çš„å‡½æ•°å›¾">ä¸åŒæŠ•å½±æ¨¡å‹çš„å‡½æ•°å›¾</h3>
<p>æˆ‘ä»¬å¯ä»¥å°†ä¸åŒçš„ç»å…¸æŠ•å½±æ¨¡å‹çš„å‡½æ•°ç”»å‡ºæ¥ï¼ˆæ¨ªè½´ä¸º<span class="math inline">\(\theta\)</span>ï¼Œçºµè½´ä¸º<span class="math inline">\(r(\theta)\)</span>ï¼‰ï¼Œç»“æœå¦‚ä¸‹</p>
<figure>
<img src="./imgs/07-classic_proj_plot.jpg" alt="" /><figcaption>ç»å…¸æŠ•å½±æ¨¡å‹çš„å‡½æ•°æ›²çº¿</figcaption>
</figure>
<p>ä»ä¸Šå›¾æˆ‘ä»¬åº”è¯¥è‡³å°‘è¦è§‚å¯Ÿåˆ°ä¸€ä¸ªé‡è¦çš„äº‹å®ï¼šé’ˆå­”æŠ•å½±æ¨¡å‹æ— æ³•å¯¹<span class="math inline">\(&gt;=90\degree\)</span>çš„è§†é‡æˆåƒã€‚å› ä¸º<span class="math inline">\(\tan(\cdot)\)</span>åœ¨90åº¦çš„æ—¶å€™ä¼šè¶‹äºæ— ç©·å¤§ã€‚å®é™…ä¸Šï¼Œä»ä¸Šé¢çš„å‡½æ•°å›¾å¯ä»¥çœ‹åˆ°ï¼Œé’ˆå­”æŠ•å½±æ¨¡å‹åªèƒ½åœ¨å¤§çº¦æ°´å¹³140åº¦ä»¥å†…çš„è§†é‡æˆåƒ</p>
<h3 id="ç›¸æœºæŠ•å½±æ¨¡å‹æ€»ç»“">ç›¸æœºæŠ•å½±æ¨¡å‹æ€»ç»“</h3>
<p>åˆ°ç›®å‰ä½ç½®ï¼Œæˆ‘ä»¬åº”è¯¥å»ºç«‹è‡³å°‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„è®¤è¯†ï¼š</p>
<ol type="1">
<li>ç»Ÿä¸€åŒ–çš„æŠ•å½±æ¨¡å‹ç»è¿‡ï¼šå•ä½çƒæŠ•å½±-&gt;å½’ä¸€åŒ–å¹³é¢-&gt;é€è§†å˜æ¢å‡ ä¸ªè¿‡ç¨‹ï¼Œå°†ä¸€ä¸ªä¸‰ç»´ç‚¹æŠ•å½±åˆ°å›¾åƒä¸Šçš„åƒç´ </li>
<li>ä¸åŒçš„ç»å…¸æŠ•å½±æ¨¡å‹åœ¨æŠ•å½±è¿‡ç¨‹ä¸­ä¸ä¼šæ”¹å˜å…‰æŸä¸<span class="math inline">\(X\)</span>è½´çš„å¤¹è§’ï¼Œåªæ˜¯å¯¹åƒç´ åˆ°å›¾åƒåŸç‚¹çš„è·ç¦»å»ºç«‹ä¸åŒçš„æ–¹ç¨‹</li>
</ol>
<h2 id="å››ç›¸æœºçš„ç•¸å˜">å››ã€ç›¸æœºçš„ç•¸å˜</h2>
<h3 id="é’ˆå­”æ¨¡å‹çš„ä¼˜è¶Šæ€§">é’ˆå­”æ¨¡å‹çš„ä¼˜è¶Šæ€§</h3>
<p>é¦–å…ˆæè¿°ä¸€ä¸‹æˆ‘ä»¬äººç±»ç›´è§‚ä¸Šå¯¹äºâ€œæ ‡å‡†çš„å›¾åƒâ€è¿™ä¸ªè¯çš„ä¸€ä¸ªæ„Ÿæ€§è®¤è¯†ï¼Œæ˜¯ä¸æ˜¯æˆ‘ä»¬ä¼šè§‰å¾—æ¨ªå¹³ç«–ç›´ï¼ŒçœŸå®ä¸­æ˜¯ç›´çº¿åˆ™å›¾åƒä¸­ä¹Ÿæ˜¯ç›´çº¿ï¼Œè¿™æ ·çš„å›¾ç‰‡ä¼šæ¯”è¾ƒâ€œæ ‡å‡†â€ï¼Ÿäº‹å®ä¸Šï¼Œé’ˆå­”æŠ•å½±æ¨¡å‹å°±åˆšå¥½å…·æœ‰è¿™æ ·çš„æ€§è´¨ã€‚è¿™ä¸ªæ€§è´¨ä¹Ÿå¯ä»¥ä»å…¶æŠ•å½±æ–¹ç¨‹çœ‹å‡ºæ¥ã€‚ç»è¿‡é’ˆå­”æˆåƒçš„ç‰©ä½“ï¼Œå¥½åƒå°±æ˜¯æŠŠæ•´ä¸ªç‰©ä½“ç¼©å°æ”¾åœ¨å›¾ç‰‡ä¸Šï¼Œå› æ­¤åœ†æ˜¯åœ†ï¼Œç›´çº¿æ˜¯ç›´çº¿ã€‚è€Œå…¶ä»–æŠ•å½±æ¨¡å‹å°±å¯èƒ½ä¼šå‘ˆç°è†¨èƒ€ã€ç´§ç¼©çš„æˆåƒæ•ˆæœã€‚å¦‚ä¸‹å›¾</p>
<figure>
<img src="./imgs/08-image_affect.png" alt="" /><figcaption>æ ‡å‡†çš„é’ˆå­”æˆåƒä¸å…¶ä»–æŠ•å½±æ¨¡å‹çš„å›¾åƒ</figcaption>
</figure>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<p>â€œç•¸å˜â€è¿™ä¸ªè¯ä»è¯è¯­ä¸Šåº”è¯¥ç†è§£æˆç”±äºé•œå¤´åŠ å·¥ç­‰å› ç´ é€ æˆé•œå¤´ä¸æŠ•å½±æ¨¡å‹çš„å·®å¼‚ã€‚ä½†å®é™…ä¸Šï¼Œ<strong>ç›¸æœºç•¸å˜ç°åœ¨æè¿°çš„æ˜¯ç›¸æœºæˆåƒè¿‡ç¨‹ä¸é’ˆå­”æŠ•å½±æ¨¡å‹çš„å·®å¼‚ï¼ˆa deviation from the pinhole modelï¼‰</strong> ï¼Œä¹Ÿå°±æ˜¯ï¼šé’ˆå­”æŠ•å½±+ç•¸å˜æ¨¡å‹=å®é™…æˆåƒ</p>
<p>è€Œâ€œå»ç•¸å˜â€åˆ™æ˜¯ä½¿ç”¨ç•¸å˜æ¨¡å‹å¯¹å›¾åƒè¿›è¡Œé€†æ“ä½œï¼Œä½¿å¾—å›¾åƒå°±åƒç”¨é’ˆå­”æŠ•å½±æ¨¡å‹æˆåƒå‡ºæ¥çš„ä¸€æ ·ã€‚</p>
<h3 id="åœ¨å½’ä¸€åŒ–å¹³é¢æ’å…¥ç•¸å˜æ¨¡å‹">åœ¨å½’ä¸€åŒ–å¹³é¢æ’å…¥ç•¸å˜æ¨¡å‹</h3>
<p>ä¸ºäº†èƒ½å¤Ÿåˆ©ç”¨é’ˆå­”æ¨¡å‹çš„æ€§è´¨ï¼Œæˆ‘ä»¬åœ¨å‰æ–‡ç»™å‡ºçš„ç»Ÿä¸€ç›¸æœºæŠ•å½±æ¨¡å‹ä¸­å°†æ¨¡å‹å¹³é¢ç”¨ç•¸å˜å¹³é¢ä»£æ›¿ã€‚è¿™é‡Œçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œ<strong>ç”¨ä¸€ä¸ªæ›´å…·ä¸€èˆ¬æ€§çš„å¤šé¡¹å¼æ›¿ä»£å„ä¸ªæŠ•å½±æ¨¡å‹ä¸­çš„æ¨¡å‹å‡½æ•°ï¼Œä»¥æ­¤è¾¾åˆ°ç”¨ä¸€ä¸ªæ–¹ç¨‹è¡¨è¾¾å¤šä¸ªæŠ•å½±æ¨¡å‹çš„ç›®çš„ã€‚</strong></p>
<p>æ›¿æ¢åçš„ç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºï¼š</p>
<figure>
<img src="./imgs/09-distortion_plane.png" alt="" /><figcaption>åŠ å…¥ç•¸å˜å¹³é¢çš„æŠ•å½±æ¨¡å‹</figcaption>
</figure>
<p>æ³¨æ„ä¸Šå›¾ä¸ä¸Šä¸€èŠ‚æœ€åçš„ç»Ÿä¸€æŠ•å½±æ¨¡å‹å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡Model Planeåå­—æ¢æˆDistortion Plane</p>
<p>æˆ‘ä»¬è¿™ä¸€èŠ‚é‡‡ç”¨<a href="#OpenCV2.4">OpenCVå®ç°çš„ç•¸å˜æ¨¡å‹</a>æ¥è®²è§£ç•¸å˜è¿‡ç¨‹</p>
<p>æˆ‘ä»¬è¿˜æ˜¯å…ˆå°†<span class="math inline">\(P_c\)</span>ç‚¹æŠ•å½±åˆ°å½’ä¸€åŒ–å¹³é¢å¾—åˆ°<span class="math inline">\(\boldsymbol{p}_n=[u_n,v_n]\)</span>ï¼Œå¹¶ä»¤å…¶åˆ°åŸç‚¹çš„åŠå¾„ä¸º<span class="math inline">\(r=\sqrt{(u_n^2+v_n^2)}\)</span></p>
<h3 id="å¾„å‘ç•¸å˜radial-distortion">å¾„å‘ç•¸å˜ï¼ˆRadial Distortionï¼‰</h3>
<p>æ‰€è°“çš„å¾„å‘ç•¸å˜ï¼ˆRadial Distortionï¼‰å°±æ˜¯æŒ‡åªå¯¹ç‚¹<span class="math inline">\(p_n\)</span>åšåŠå¾„ä¸Šçš„ä¼¸ç¼©å˜åŒ–ï¼Œè¿™ä¸€ç‚¹å…¶å®å°±è·Ÿç»å…¸æŠ•å½±æ¨¡å‹ä¸€æ ·ç”¨ä¸€ä¸ªå‡½æ•°å»ºç«‹åŠå¾„çš„å˜åŒ–ï¼Œåœ¨OpenCVä¸­ï¼Œæ ‡å‡†é•œå¤´çš„å¾„å‘ç•¸å˜å¯ä»¥ç”¨å¦‚ä¸‹æ–¹ç¨‹è¡¨è¾¾ï¼š</p>
<p><span class="math display">\[
\begin{split}
&amp;u^{\prime}=u_n(1+k_1r^2+k_2r^4+k_3r^6)\\
&amp;v^{\prime}=v_n(1+k_1r^2+k_2r^4+k_3r^6)
\end{split}\tag{4-1}
\]</span></p>
<p>å¾„å‘ç•¸å˜å¯¹äºç¯ç»•å…‰è½´ä¸€å‘¨çš„æ”¹å˜æ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤ä¹Ÿå«åšåŠå¾„å¯¹ç§°ç•¸å˜ï¼ˆRadial Symmetric Distortionï¼‰æˆ–è€…ç•¸å˜çš„å¯¹ç§°éƒ¨åˆ†ï¼ˆSymmetric Part Of Distortion Modelï¼‰</p>
<h3 id="åˆ‡å‘ç•¸å˜tangential-distortion">åˆ‡å‘ç•¸å˜ï¼ˆTangential Distortionï¼‰</h3>
<p>çœŸå®çš„é•œå¤´ç”±äºåŠ å·¥è¯¯å·®å’Œå®‰è£…è¯¯å·®ï¼Œä¼šå¯¼è‡´é•œå¤´ä¸æ„Ÿå…‰åŸä»¶çš„ä¸­å¿ƒä¸æ˜¯å®Œå…¨å¯¹é½çš„ï¼Œå› æ­¤åœ¨å¹³è¡Œçš„æ–¹å‘ä¸Šä¼šä¸æ ‡å‡†çš„é’ˆå­”æˆåƒæ¨¡å‹æœ‰å·®å¼‚ï¼Œè¿™ç§å·®å¼‚å¯¹äºå…‰è½´ä¸æ˜¯æ—‹è½¬å¯¹ç§°çš„ï¼Œä¹Ÿå«åšåˆ‡å‘ç•¸å˜ï¼ˆTangential Distortionï¼‰</p>
<p>OpenCVä¸­é•œå¤´çš„åˆ‡å‘ç•¸å˜æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
\begin{split}
u_{d}=u^{\prime}+2p_1u_nv_n+p_2(r^2+2u_n)\\
v_{d}=v^{\prime}+p_1(r^2+2{v_n}^2) + 2p_2u_nv_n
\end{split}\tag{4-2}
\]</span></p>
<p>å…¬å¼ï¼ˆ4-1ï¼‰å’Œå…¬å¼ï¼ˆ4-2ï¼‰ä¸­çš„<span class="math inline">\(k_1,k_2,k_3,p_1,p_2\)</span>å«åšç•¸å˜å‚æ•°ï¼ˆDistortion Coefficientsï¼‰</p>
<h3 id="å»ç•¸å˜">å»ç•¸å˜</h3>
<p>æœ‰äº†ç•¸å˜æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªä¸‰ç»´ç‚¹ç»è¿‡ï¼šå•ä½çƒæŠ•å½±-&gt;å½’ä¸€åŒ–å¹³é¢æŠ•å½±-&gt;ç•¸å˜æ¨¡å‹-&gt;é€è§†å˜æ¢ï¼Œå¾—åˆ°è¯¥ç‚¹åœ¨å›¾åƒä¸­çš„åƒç´ ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ ‡å®šç‰©ï¼Œç»è¿‡æ±‚è§£å¾—åˆ°ä¸Šè¿°çš„ç•¸å˜ç³»æ•°ï¼Œè¿›è€Œå¾—åˆ°ç•¸å˜è¿‡ç¨‹çš„åè¿‡ç¨‹ã€‚æˆ‘ä»¬å°†å›¾åƒä¸Šçš„ç‚¹å…ˆç»è¿‡é€è§†å˜æ¢çš„åå˜æ¢å¾—åˆ°åœ¨ç•¸å˜å¹³é¢ä¸Šçš„ç‚¹ï¼Œå†ç»è¿‡ç•¸å˜è¿‡ç¨‹çš„åè¿‡ç¨‹ï¼Œå†æŠ•å›å›¾åƒä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°ä¸€å‰¯æ²¡æœ‰ç•¸å˜çš„å›¾åƒï¼Œå…¶çœ‹èµ·æ¥å°±åƒæ˜¯ç”¨å®Œå…¨æ ‡å‡†çš„é’ˆå­”æŠ•å½±æ¨¡å‹æˆåƒçš„ç…§ç‰‡ã€‚</p>
<p>ä¸‹é¢çš„å›¾ç‰‡å±•ç¤ºäº†ä»ç•¸å˜åˆ°å»ç•¸å˜çš„å›¾åƒå˜åŒ–</p>
<figure>
<img src="./imgs/10-distorted_to_undistorted.png" alt="" /><figcaption>å»ç•¸å˜å›¾åƒå˜åŒ–</figcaption>
</figure>
<p>åšå®Œå»ç•¸å˜åï¼Œæ•´ä¸ªçš„æˆåƒè¿‡ç¨‹å°±åƒç›´æ¥ç”¨é’ˆå­”æŠ•å½±æ¨¡å‹ï¼ˆå…¬å¼1-3ï¼‰æˆåƒä¸€èˆ¬ï¼Œå°±åƒä¸‹å›¾ä¸€æ ·ã€‚</p>
<figure>
<img src="./imgs/11-undistorted_model.png" alt="" /><figcaption>å»ç•¸å˜çš„ç­‰æ•ˆæŠ•å½±è¿‡ç¨‹</figcaption>
</figure>
<p>æå‡ºç•¸å˜æ¨¡å‹çš„æ–‡ç« éœ€è¦ç»™å‡ºå¦‚ä½•æ ‡å®šå‡ºç•¸å˜å‚æ•°ï¼ŒåŒæ—¶å¦‚ä½•è®¡ç®—ä»ç•¸å˜ç‚¹åˆ°éç•¸å˜ç‚¹ï¼Œè¿™é‡Œé¢ä¸»è¦æ˜¯ä¸€äº›æ•°å­¦æ±‚è§£ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®¨è®ºï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Distortion_(optics)#Software_correction">wiki:Distortion</a></p>
<h2 id="äº”å…¨æ™¯ç›¸æœºomidirectional-camera">äº”ã€å…¨æ™¯ç›¸æœºï¼ˆOmidirectional Cameraï¼‰</h2>
<p>æ‰€è°“çš„å…¨æ™¯ç›¸æœºå¹¿æ³›æ¦‚å¿µä¸ŠæŒ‡æˆåƒè§’åº¦èƒ½å¤Ÿå¤§äºç­‰äº180åº¦çš„ç›¸æœºï¼Œä»–ä»¬çœ‹èµ·æ¥å¤§æ¦‚åƒæ˜¯ä¸‹é¢è¿™æ ·</p>
<figure>
<img src="./imgs/12-omni_cam.png" alt="" /><figcaption>å…¨æ™¯ç›¸æœºç±»å‹</figcaption>
</figure>
<p>ä»ç¬¬äºŒèŠ‚ï¼ˆä¸åŒçš„ç›¸æœºæŠ•å½±æ¨¡å‹ï¼‰æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ ¹æ®é’ˆå­”æŠ•å½±æ¨¡å‹è®¾è®¡å‡ºçš„é•œå¤´æ— æ³•å¯¹å¤§äºç­‰äº90åº¦ï¼ˆå·¦å³ï¼‰çš„è§†é‡æˆåƒï¼Œé€šå¸¸ç”±äºè¿›å…‰é‡ç­‰é—®é¢˜ï¼Œè¿™ç±»ç›¸æœºä¸€èˆ¬åªæœ‰140åº¦å·¦å³çš„æˆåƒè§†é‡ã€‚</p>
<p>ä¸€èˆ¬çš„ç•¸å˜æ¨¡å‹çš„è®¾è®¡ä»¥é’ˆå­”ç›¸æœºæ¨¡å‹ä¸ºåŸºç¡€ï¼Œé€šè¿‡å‚æ•°æ¨¡å‹ä¿®æ­£çœŸå®çš„æˆåƒä¸é’ˆå­”æˆåƒçš„å·®å¼‚ï¼Œå› ä¸ºåœ¨å¾ˆå¤šçš„åº”ç”¨ä¸­æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šè¿‡â€œå»ç•¸å˜â€çš„æ–¹å¼ï¼Œå°†å›¾ç‰‡å˜æˆâ€œç›´çº¿è¿˜æ˜¯ç›´çº¿ï¼ˆStraight lines are straightï¼‰ï¼Œåœ¨<a href="#KannalaBrandt">KannalaBrandtè®ºæ–‡</a>ä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼š</p>
<blockquote>
<p>It is impossible to project the hemispherical field of view on a finite image plane by a perspective projection so fish-eye lenses are designed to obey some other projection model.This is the reason why the inherent distortion of a fish-eye lens should not be considered only as a deviation from the pinhole model</p>
</blockquote>
<p>äºæ˜¯ï¼Œå°±æœ‰å¾ˆå¤šä¸“é—¨é’ˆå¯¹å…¨æ™¯ç›¸æœºï¼ˆ<strong>Omidirection Camera/Fisheye Camera/Wide-Angle camera</strong>ï¼‰çš„å»ºæ¨¡ç ”ç©¶å‡ºç°ã€‚</p>
<p>é‡æ–°ç†æ¸…ä¸€ä¸‹æˆ‘ä»¬çš„ç›®çš„ï¼š</p>
<ol type="1">
<li>æ‹¥æœ‰ä¸€ç§ç»Ÿä¸€çš„è¡¨è¾¾æ–¹å¼èƒ½å¤Ÿå°½é‡æ‹ŸåˆçœŸå®çš„å…¨æ™¯ç›¸æœºçš„æˆåƒè¿‡ç¨‹</li>
<li>è¿™ç§è¡¨è¾¾æ–¹å¼åº”è¯¥ç®€æ´æœ‰æ•ˆ</li>
<li>èƒ½å¤Ÿå¯¹æ¨¡å‹çš„å‚æ•°æ±‚è§£ï¼Œå¹¶å°†å›¾åƒé€šè¿‡â€œå»ç•¸å˜â€å˜æˆåƒæ˜¯ç”±é’ˆå­”ç›¸æœºæ‹æ‘„å‡ºæ¥çš„æ¨ªå¹³ç«–ç›´çš„å›¾åƒ</li>
</ol>
<p>OpenCVä¸­é’ˆå¯¹å…¨æ™¯ç›¸æœºçš„æ ‡å®šå’Œå»ç•¸å˜ç»™å‡ºäº†ä¸¤ç§å®ç°</p>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://sci-hub.st/10.1109/TPAMI.2006.153">KannalaBrandtæ¨¡å‹</a>.å¯¹åº”å®ç°<a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/db/d58/group__calib3d__fisheye.html">OpenCV::Fisheye</a></li>
<li><a target="_blank" rel="noopener" href="https://sci-hub.st/10.1109/ROBOT.2007.364084">CMeiæ¨¡å‹</a>. å¯¹åº”å®ç°<a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/dd/d12/tutorial_omnidir_calib_main.html">OpenCV::Omnidir</a></li>
</ol>
<p>ä¸‹é¢ç®€å•ä»‹ç»è¿™ä¸¤ç§æ¨¡å‹</p>
<h3 id="kannalabrandtæ¨¡å‹">KannalaBrandtæ¨¡å‹</h3>
<p>ç¬¬ä¸€æ­¥è¿˜æ˜¯å…ˆå°†ç‚¹æŠ•å½±åˆ°å•ä½çƒæ¨¡å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—å‡ºäº†<span class="math inline">\(\theta,\alpha\)</span>ä¸¤ä¸ªè§’åº¦ï¼Œåç»­çš„ç•¸å˜æ¨¡å‹å°±æ˜¯å…³äºè¿™ä¸¤ä¸ªè§’åº¦çš„å‡½æ•°</p>
<p>è¿™é‡Œè¿™é‡Œæ‘˜å½•OpenCVçš„æè¿°æ–¹å¼<a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/db/d58/group__calib3d__fisheye.html">OpenCV_Fisheye</a>ï¼Œç›¸æ¯”äºè®ºæ–‡ï¼Œåœ¨æ¨¡å‹å‚æ•°ä¸Šç®€åŒ–äº†å¾ˆå¤š</p>
<p>KannalaBrandtæ¨¡å‹ä½¿ç”¨ä¸€ä¸ªå¤šé¡¹å¼æè¿°å¾„å‘ç•¸å˜ï¼ˆç•¸å˜çš„å¯¹ç§°éƒ¨åˆ†ï¼‰</p>
<p><span class="math display">\[
\begin{split}
&amp;\boldsymbol{p}_n=\frac{P_c}{P_z}=[u_n,v_n,1]^T\\
\\
&amp;r = \sqrt{u_n^2+v_n^2}\\
\\
&amp;\theta_d = k_1\theta + k_2\theta^3 + k_3\theta^5+k_4\theta^7+k_5\theta^9+....
\end{split}\tag{5-1}
\]</span></p>
<p>å¾„å‘ç•¸å˜ååæ ‡å˜ä¸ºï¼š</p>
<p><span class="math display">\[
\begin{split}
u^{\prime} = \frac{\theta_d}{r}u_n\\
v^{\prime} = \frac{\theta_d}{r}v_n
\end{split}\tag{5-2}
\]</span></p>
<p>æœ€åå†è¿›è¡Œéå¯¹ç§°ç•¸å˜</p>
<p><span class="math display">\[
\begin{split}
&amp;u_d=u^{\prime}+\alpha v^{\prime}\\
&amp;v_d=v^{\prime}
\end{split}\tag{5-3}
\]</span></p>
<p>æœ€åå†ç»è¿‡å…¬å¼ï¼ˆ3-5ï¼‰å˜æ¢åˆ°å›¾åƒåæ ‡ç³»</p>
<h3 id="cmeiæ¨¡å‹">CMeiæ¨¡å‹</h3>
<p>CMeiæ¨¡å‹ç›¸æ¯”äºå…¶ä»–æ¨¡å‹æœ‰ä¸€ä¸ªè¾ƒå¤§ä¸åŒä¹‹å¤„åœ¨äºåœ¨ä»å•ä½çƒæŠ•å½±åˆ°å½’ä¸€åŒ–å¹³é¢æ—¶å°†ç›¸æœºå…‰å¿ƒå¾€åç§»åŠ¨äº†è·ç¦»<span class="math inline">\(\xi\)</span>ï¼Œæ€»ä½“çš„æŠ•å½±è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<figure>
<img src="./imgs/13-cmei_model.png" alt="" /><figcaption>CMeiæŠ•å½±æ¨¡å‹</figcaption>
</figure>
<p>ä¸Šå›¾å‡ºè‡ªå¼•ç”¨CMeiçš„ä¸€ç¯‡è®ºæ–‡ï¼šDesign and Calibration of an Omni-RGB+D Camera</p>
<h2 id="å…­ä»£ç å®ä¾‹">å…­ã€ä»£ç å®ä¾‹</h2>
<h3 id="å®ä¾‹ä¸€é’ˆå­”æŠ•å½±æ¨¡å‹å»ç•¸å˜">å®ä¾‹ä¸€ï¼šé’ˆå­”æŠ•å½±æ¨¡å‹å»ç•¸å˜</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># undistort image</span></span><br><span class="line">h,  w = img.shape[:<span class="number">2</span>]</span><br><span class="line">newcameramtx, roi = cv2.getOptimalNewCameraMatrix(K, distortions, (w,h), alpha, (w,h))</span><br><span class="line">undistorted_img = cv2.undistort(img, K, distortions, <span class="literal">None</span>, newcameramtx)</span><br><span class="line">x, y, w, h = roi</span><br><span class="line">undistorted_img = undistorted_img[y:y+h, x:x+w]</span><br><span class="line"></span><br><span class="line"><span class="comment"># undistort image points</span></span><br><span class="line"><span class="keyword">if</span> points2d.ndim == <span class="number">2</span>:</span><br><span class="line">    points2d = points2d[:, <span class="literal">None</span>, :]</span><br><span class="line">undistorted_points = cv2.undistortPoints(points2d, K, distortions, P=K)</span><br><span class="line">undistorted_points = undistorted_points.reshape(-<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å®ä¾‹äºŒcmeiæ¨¡å‹å»ç•¸å˜">å®ä¾‹äºŒï¼šCMeiæ¨¡å‹å»ç•¸å˜</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># undistort image</span></span><br><span class="line"><span class="keyword">if</span> newK:</span><br><span class="line">        K_new = np.zeros((<span class="number">3</span>,<span class="number">3</span>), np.float64)</span><br><span class="line">        h,w = img.shape[:<span class="number">2</span>]</span><br><span class="line">        K_new[<span class="number">0</span>, <span class="number">0</span>] = w/<span class="number">4</span></span><br><span class="line">        K_new[<span class="number">0</span>, <span class="number">2</span>] = w/<span class="number">2</span></span><br><span class="line">        K_new[<span class="number">1</span>, <span class="number">1</span>] = h/<span class="number">4</span></span><br><span class="line">        K_new[<span class="number">1</span>, <span class="number">2</span>] = h/<span class="number">2</span></span><br><span class="line">        K_new[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1.0</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">        K_new = <span class="literal">None</span></span><br><span class="line">undistorted_img = cv2.omnidir.undistortImage(</span><br><span class="line">img, K, distortions, Xi, cv2.omnidir.RECTIFY_PERSPECTIVE, Knew=K_new)</span><br><span class="line"></span><br><span class="line"><span class="comment"># undistort image points</span></span><br><span class="line"><span class="keyword">if</span> points2d.ndim == <span class="number">2</span>:</span><br><span class="line">    points2d = points2d[:, <span class="literal">None</span>, :]</span><br><span class="line">undistorted_points = cv2.omnidir.undistortPoints(points2d, K, distortions, Xi, <span class="literal">None</span>)</span><br><span class="line">undistorted_points = undistorted_points.squeeze()</span><br><span class="line"></span><br><span class="line">f0 = K_new[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">f1 = K_new[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">c0 = K_new[<span class="number">0</span>,<span class="number">2</span>]</span><br><span class="line">c1 = K_new[<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">undistorted_points[:, <span class="number">0</span>] = f0* undistorted_points[:, <span class="number">0</span>] + c0</span><br><span class="line">undistorted_points[:, <span class="number">1</span>] = f1 * undistorted_points[:, <span class="number">1</span>] + c1</span><br></pre></td></tr></table></figure>
<p><strong>PS</strong>:cv2::omnidir::undisortPointsçš„æ—§ç‰ˆæœ¬æœ‰bugï¼Œå‚è€ƒè¿™ä¸ª<a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib/issues/1612">issue</a>ã€‚omnidirç©ºé—´ç›®å‰è¿˜æ²¡æœ‰æˆä¸ºopencvçš„æ­£å¼ç¨³å®šæ¥å£ï¼Œå› æ­¤ç»´æŠ¤åœ¨opencv-contrib-pythonåŒ…ä¸­ï¼Œæœ€æ–°çš„åŒ…ï¼ˆ4.6.xï¼‰å·²ç»ä¿®å¤äº†bugã€‚ä¸€å®šè¦æ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æœ‰é‚£ä¸ªbugï¼ï¼ï¼ï¼</p>
<h3 id="å®ä¾‹ä¸‰kannalabrandtæ¨¡å‹å»ç•¸å˜">å®ä¾‹ä¸‰ï¼šKannalaBrandtæ¨¡å‹å»ç•¸å˜</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># You should replace these 3 lines with the output in calibration step</span></span><br><span class="line">DIM=XXX</span><br><span class="line">K=np.array(YYY)</span><br><span class="line">D=np.array(ZZZ)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">undistort</span>(<span class="params">img_path</span>):</span><br><span class="line">    img = cv2.imread(img_path)</span><br><span class="line">    h,w = img.shape[:<span class="number">2</span>]</span><br><span class="line">    map1, map2 = cv2.fisheye.initUndistortRectifyMap(K, D, np.eye(<span class="number">3</span>), K, DIM, cv2.CV_16SC2)</span><br><span class="line">    undistorted_img = cv2.remap(img, map1, map2, interpolation=cv2.INTER_LINEAR, borderMode=cv2.BORDER_CONSTANT)</span><br><span class="line">    cv2.imshow(<span class="string">&quot;undistorted&quot;</span>, undistorted_img)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">        undistort(p)</span><br></pre></td></tr></table></figure>
<h2 id="ç›¸æœºæ ‡å®šæ–¹æ³•">ç›¸æœºæ ‡å®šæ–¹æ³•</h2>
<p>æœ€ç»å…¸çš„æ˜¯ä½¿ç”¨å¼ æ­£å‹æ ‡å®šæ³•ã€‚<a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tr98-71.pdf">åŸæ–‡</a>;<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/94244568">ä¸­æ–‡è®²è§£</a></p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ol type="1">
<li><p><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/d9/d0c/group__calib3d.html#:~:text=Detailed%20Description">OpenCV:Camera Calibration</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://docs.opencv.org/2.4/doc/tutorials/calib3d/camera_calibration/camera_calibration.html">OpenCV2.4:Camera Calibration</a></p></li>
<li><p><a target="_blank" rel="noopener" href="http://michel.thoby.free.fr/Fisheye_history_short/Projections/Models_of_classical_projections.html">Models for the various classical lens projections</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Distortion_(optics)#Software_correction">Wiki:Distortion</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://sci-hub.st/10.1109/TPAMI.2006.153">KannalaBrandt:A Generic Camera Model and Calibration Method for Conventional, Wide-Angle, and Fish-Eye Lenses</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://sci-hub.st/10.1109/ROBOT.2007.364084">CMei: Single View Point Omnidirectional Camera Calibration from Planar Grids</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/db/d58/group__calib3d__fisheye.html">OpenCV::Fisheye</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.7.0/dd/d12/tutorial_omnidir_calib_main.html">OpenCV::Omnidir</a></p></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/05/31/slam-theory/lie-group-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/31/slam-theory/lie-group-01/" class="post-title-link" itemprop="url">SLAMåŸºç¡€â€”â€”æä»£æ•°åŸºç¡€æ¦‚å¿µåŠå…¬å¼</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-05-31 21:56:58" itemprop="dateCreated datePublished" datetime="2023-05-31T21:56:58+08:00">2023-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-06-14 11:31:48" itemprop="dateModified" datetime="2023-06-14T11:31:48+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/Theory/" itemprop="url" rel="index"><span itemprop="name">Theory</span></a>
        </span>
    </span>

  
    <span id="/2023/05/31/slam-theory/lie-group-01/" class="post-meta-item leancloud_visitors" data-flag-title="SLAMåŸºç¡€â€”â€”æä»£æ•°åŸºç¡€æ¦‚å¿µåŠå…¬å¼" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="SLAMåŸºç¡€â€”â€”æä»£æ•°åŸºç¡€æ¦‚å¿µåŠå…¬å¼" href="/2023/05/31/slam-theory/lie-group-01/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::2cf0b705b902423269f4cebef74df287" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="æç¾¤æä»£æ•°åŸºç¡€æ¦‚å¿µ">æç¾¤æä»£æ•°åŸºç¡€æ¦‚å¿µ</h2>
<h3 id="ç¾¤groups-æç¾¤liegroups">ç¾¤ï¼ˆGroupsï¼‰ &amp;&amp; æç¾¤ï¼ˆLieGroupsï¼‰</h3>
<h4 id="ç¾¤çš„å®šä¹‰">ç¾¤çš„å®šä¹‰</h4>
<p>ç¾¤æ˜¯ä¸€ç§ <strong><em>é›†åˆ</em></strong> åŠ ä¸Š <strong><em>ä¸€ç§è¿ç®—</em></strong> çš„ä»£æ•°ç»“æ„ï¼Œè¿™ç§è¿ç®—éœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼ˆå¯ä»¥ä¸ç”¨è®°ä½ï¼‰</p>
<p><strong>ä¾‹</strong> ï¼šæ—‹è½¬çŸ©é˜µï¼ˆé›†åˆï¼‰å’ŒçŸ©é˜µä¹˜æ³•ï¼ˆè¿ç®—ï¼‰ï¼ŒçŸ©é˜µä¹˜æ³•å¯¹äºæ—‹è½¬çŸ©é˜µå…·æœ‰å¾ˆè‰¯å¥½çš„æ€§è´¨ï¼ˆç¬¦åˆç¾¤è¿ç®—çš„å®šä¹‰ï¼‰ï¼Œäºæ˜¯æ—‹è½¬çŸ©é˜µæ˜¯ä¸€ç§ç¾¤ã€‚</p>
<h4 id="ç‰¹æ®Šæ­£äº¤ç¾¤">ç‰¹æ®Šæ­£äº¤ç¾¤</h4>
<p>ç‰¹æ®Šæ­£äº¤ç¾¤ï¼ˆSpecial Orthogonal Groupï¼‰è®°ä¸º<span class="math inline">\(SO(n)\)</span>ï¼Œåˆå«æ—‹è½¬çŸ©é˜µç¾¤ã€‚ ä¾‹ï¼š<strong><em>ä¸‰ç»´</em></strong> æ—‹è½¬çŸ©é˜µæ„æˆç‰¹æ®Šæ­£äº¤ç¾¤<span class="math inline">\(SO(3)\)</span></p>
<p><span class="math display">\[
SO(3) = \{R \in \mathbb{R}^{3\times 3}:R^{T}R=\mathbf{I},det(R)=1\}
\]</span></p>
<h4 id="ç‰¹æ®Šæ¬§å¼ç¾¤">ç‰¹æ®Šæ¬§å¼ç¾¤</h4>
<p>ç‰¹æ®Šæ¬§å¼ç¾¤è®°ä¸º<span class="math inline">\(SE(n)\)</span>ï¼Œå¯¹åº”<span class="math inline">\(n\)</span>ç»´çš„æ¬§å¼å˜æ¢ï¼ˆæ—‹è½¬åŠ å¹³ç§»ï¼‰</p>
<h4 id="æç¾¤">æç¾¤</h4>
<p>æç¾¤æ˜¯å…·æœ‰è¿ç»­ï¼ˆå…‰æ»‘ï¼‰æ€§è´¨çš„ç¾¤</p>
<p>ä¾‹ï¼šæ—‹è½¬å¯ä»¥è¿ç»­åœ°è¿›è¡Œï¼Œå¹³ç§»ä¹Ÿå¯ä»¥è¿ç»­åœ°è¿›è¡Œï¼Œæ‰€ä»¥<span class="math inline">\(SO(3)\)</span>ã€<span class="math inline">\(SE(3)\)</span>éƒ½æ˜¯æç¾¤</p>
<h3 id="æä»£æ•°">æä»£æ•°</h3>
<h4 id="åå¯¹ç§°çŸ©é˜µç¬¦å·">åå¯¹ç§°çŸ©é˜µç¬¦å·</h4>
<p>å¯¹äºä¸€ä¸ªä¸‰ç»´å‘é‡<span class="math inline">\(\boldsymbol{\phi}=[\phi_1,\phi_2,\phi_3]^T\)</span>ï¼Œè®°å…¶å¯¹åº”çš„åå¯¹ç§°çŸ©é˜µ<span class="math inline">\(\boldsymbol{\phi}^{\wedge}\in \mathbb{R}^{3\times3}\)</span>ï¼Œå…·æœ‰å¦‚ä¸‹å½¢å¼ã€‚ç¬¦å·<span class="math inline">\(\wedge\)</span>ç§°ä½œ<em>hat</em></p>
<p><span class="math display">\[
\boldsymbol\phi^{\wedge} = 
\begin{bmatrix}
\phi_1\\
\phi_2\\
\phi_3
\end{bmatrix}^{\wedge}
=\
\begin{bmatrix}
0&amp;-\phi_3&amp;\phi_2\\
\phi_3&amp;0&amp;-\phi_1\\
-\phi_2&amp;\phi_1&amp;0
\end{bmatrix}\tag{hat}
\]</span></p>
<p>åŒæ ·çš„ï¼Œä»»æ„ä¸€ä¸ªåå¯¹ç§°çŸ©é˜µé€šè¿‡<em>vee</em>æ“ä½œå¾—åˆ°å¯¹åº”çš„ä¸‰ç»´å‘é‡</p>
<p><span class="math display">\[
(\boldsymbol\phi^{\wedge})^{\vee}
=\
\begin{bmatrix}
0&amp;-\phi_3&amp;\phi_2\\
\phi_3&amp;0&amp;-\phi_1\\
-\phi_2&amp;\phi_1&amp;0
\end{bmatrix}^{\vee}
=\begin{bmatrix}
\phi_1\\
\phi_2\\
\phi_3
\end{bmatrix}\tag{vee}
\]</span></p>
<h4 id="æä»£æ•°ä¸æç¾¤çš„å…³ç³»">æä»£æ•°ä¸æç¾¤çš„å…³ç³»</h4>
<ul>
<li><p>æ¯ä¸ªæç¾¤éƒ½å¯¹åº”ä¸€ä¸ªæä»£æ•°ã€‚<span class="math inline">\(SO(3)\)</span>ç¾¤çš„æä»£æ•°æ˜¯<span class="math inline">\(\mathfrak{so}(3)\)</span></p></li>
<li><p>ä¸ºäº†ä¸é€ æˆç†è§£å›°éš¾ï¼Œè¿™é‡Œåªç”¨<span class="math inline">\(SO(3)\)</span>ç¾¤ä½œä¸ºè®²è§£ã€‚ï¼ˆç¬”è€…å‘ç°ï¼Œç”¨<span class="math inline">\(SO(3)\)</span>ç¾¤ä½œä¸ºä¾‹å­ï¼Œä¸çœ‹<span class="math inline">\(SE(3)\)</span>ç¾¤ç†è§£èµ·æ¥ä¼šæ›´å®¹æ˜“ï¼‰</p></li>
<li><p>ä¸ºä»€ä¹ˆè¦å¼•å…¥æä»£æ•°ï¼Ÿ ä¸€å¥è¯è¯´æ˜ï¼šåœ¨<span class="math inline">\(SO(3)\)</span>ç¾¤ä¸Šæ±‚å¯¼ä¸å¤ªå®¹æ˜“ï¼Œå› ä¸ºæ—‹è½¬çŸ©é˜µä¸Šçš„åŠ æ³•æ²¡æœ‰è‰¯å¥½æ€§è´¨ï¼ˆä¸¤ä¸ªæ—‹è½¬çŸ©é˜µçš„åŠ æ³•ä¸ä¸€å®šæ˜¯ä¸€ä¸ªæ—‹è½¬çŸ©é˜µ;å›å¿†å¯¼æ•°çš„å®šä¹‰ï¼Œè¾“å…¥çš„å¾®å°å˜åŒ–é€ æˆçš„è¾“å‡ºçš„æ”¹å˜é‡ï¼‰ï¼Œè€Œæ—‹è½¬çŸ©é˜µçš„ä¹˜ç§¯åœ¨å…¶ä¸­ä¸€è€…ä¸ºå¾®å°é‡çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹åº”åˆ°æä»£æ•°ç©ºé—´çš„çº¿æ€§å…³ç³»ã€‚åˆ©ç”¨è¿™ä¸€æ€§è´¨å¯ä»¥å¯¹æ—‹è½¬çŸ©é˜µè¿›è¡Œæ±‚å¯¼ã€‚æ—‹è½¬çŸ©é˜µçš„æ›´æ€§ä¹Ÿå¯ä»¥å¯¹åº”åˆ°æä»£æ•°ç©ºé—´ä¸Šçš„çº¿æ€§æ›´æ–°ã€‚åæ–‡ä¼šè¯¦ç»†è§£è¯´ã€‚</p></li>
<li><p>æä»£æ•°å¯¹åº”æç¾¤å•ä½å…ƒå¤„çš„åˆ‡ç©ºé—´ æ—‹è½¬çŸ©é˜µç¾¤çš„å•ä½å…ƒå°±æ˜¯å•ä½çŸ©é˜µã€‚æä»£æ•°å¯¹åº”æç¾¤å•ä½å…ƒå¤„çš„åˆ‡ç©ºé—´è¿™ä¸€ç‚¹åªæ˜¯ä¸¤è€…çš„æ€§è´¨ï¼Œä¸åæ–‡çš„æŒ‡æ•°/å¯¹æ•°æ˜ å°„æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚ï¼ˆç¬”è€…ä¸€å¼€å§‹æ€»æ˜¯è¯¯ä¼šæŒ‡æ•°/å¯¹æ•°æ˜ å°„åªèƒ½åœ¨æç¾¤å•ä½å…ƒå¤„è¿›è¡Œï¼‰</p></li>
</ul>
<h4 id="å¯¹æ•°æ˜ å°„logå’ŒæŒ‡æ•°æ˜ å°„exp">å¯¹æ•°æ˜ å°„ï¼ˆlogï¼‰å’ŒæŒ‡æ•°æ˜ å°„ï¼ˆexpï¼‰</h4>
<p>ã€Šè§†è§‰SLAMåå››è®²ã€‹ä¸­è¿™éƒ¨åˆ†å†…å®¹ï¼ˆç¬¬å››è®²ï¼‰æ˜¯é€šè¿‡æ—‹è½¬çŸ©é˜µæ±‚å¯¼å¼•å‡ºçš„ï¼Œä½†å…¶å®è¿™éƒ¨åˆ†çš„æ¨å¯¼åªæ˜¯å»ºç«‹ä¸€ä¸ªæ„Ÿæ€§çš„ç†è§£ã€‚æç¾¤æä»£æ•°çš„æŒ‡æ•°/å¯¹æ•°æ˜ å°„åº”è¯¥å…·æœ‰æ›´ä¸¥æ ¼çš„å®šä¹‰ã€‚æ‰€ä»¥è¿™éƒ¨åˆ†å†…å®¹å…¶å®ä¸è¦å¤ªè¿‡çº ç»“ã€‚</p>
<p><strong><em>å†æ¬¡å¼ºè°ƒ</em></strong>ï¼šè¿™éƒ¨åˆ†æ¨å¯¼åªæ˜¯ä¸ºäº†å»ºç«‹æ„Ÿæ€§è®¤è¯†</p>
<p>ç”±äºæ—‹è½¬çŸ©é˜µçš„æ€§è´¨ï¼š</p>
<p><span class="math display">\[
RR^T = \mathbf{I}
\]</span></p>
<p>ä¸Šå¼å¯¹æ—‹è½¬çŸ©é˜µæ±‚å¯¼ï¼ˆ<span class="math inline">\(\dot{R}\)</span>è¡¨ç¤º<span class="math inline">\(R\)</span>çš„å¯¼æ•°ï¼‰ï¼š</p>
<p><span class="math display">\[
\dot{R}R^T + R\dot{R}^T=\mathbf{0}
\]</span></p>
<p>ï¼ˆè¿™é‡Œå¯¹æ—‹è½¬çŸ©é˜µæ±‚å¯¼ï¼Œåº”è¯¥å°†å…¶çœ‹ä½œæ˜¯ä¸€ä¸ªå˜é‡ï¼Œåœ¨æ—¶åˆ»å˜åŒ–ï¼‰</p>
<p>å³ï¼š</p>
<p><span class="math display">\[
\dot{R}R^T = -R\dot{R}^T=-(\dot{R}R^T)^T
\]</span></p>
<p>ä¹Ÿå°±æ˜¯<span class="math inline">\(\dot{R}R^T\)</span>æ˜¯ä¸€ä¸ªåå¯¹ç§°çŸ©é˜µï¼Œæˆ‘ä»¬å°†å…¶è®°ä¸º<span class="math inline">\(\boldsymbol{\phi}^{\wedge}\)</span>ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š</p>
<p><span class="math display">\[
\begin{split}
\dot{R}R^T &amp;= \boldsymbol{\phi}^{\wedge}\\
\dot{R} &amp;= \boldsymbol{\phi}^{\wedge}R
\end{split}
\]</span></p>
<p>ä¸Šå¼æ˜¯å…³äº<span class="math inline">\(R\)</span>çš„ä¸€ä¸ªå¾®åˆ†æ–¹ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“</p>
<p><span class="math display">\[
R=\exp(\boldsymbol{\phi}^{\wedge})
\]</span></p>
<p>çš„æ—¶å€™ï¼Œåˆšå¥½æ»¡è¶³ä¸Šé¢çš„å¾®åˆ†æ–¹ç¨‹ã€‚åŒæ—¶ï¼Œå½“<span class="math inline">\(R=\mathbf{I}\)</span>æ—¶ï¼Œä¸Šé¢çš„å¾®åˆ†æ–¹ç¨‹åˆšå¥½æ˜¯<span class="math inline">\(\dot{R}=\boldsymbol{\phi}^{\wedge}\)</span>ï¼Œæ‰€ä»¥è¯´åå¯¹ç§°çŸ©é˜µç©ºé—´æ˜¯æ—‹è½¬çŸ©é˜µå•ä½å…ƒå¤„çš„åˆ‡å¹³é¢ï¼ˆå¯¼æ•°ï¼‰ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬ç›´æ¥åœ°å¼•å…¥å®šä¹‰ï¼šæŒ‡æ•°æ˜ å°„å°†æä»£æ•°ç©ºé—´æ˜ å°„åˆ°æç¾¤ç©ºé—´ï¼ŒæŒ‡æ•°æ˜ å°„å°†æç¾¤æ˜ å°„åˆ°æä»£æ•°ç©ºé—´ã€‚</p>
<p><span class="math display">\[
\begin{split}
\exp(\cdot):\mathfrak{so}(3)\rightarrow SO(3)\\
\log(\cdot):SO(3) \rightarrow \mathfrak{so}(3)
\end{split}
\]</span></p>
<h2 id="so3ä¸Šçš„å¯¹æ•°æ˜ å°„mathfrakso3çš„æŒ‡æ•°æ˜ å°„">SO(3)ä¸Šçš„å¯¹æ•°æ˜ å°„/<span class="math inline">\(\mathfrak{so}(3)\)</span>çš„æŒ‡æ•°æ˜ å°„</h2>
<h3 id="mathfrakso3çš„æŒ‡æ•°æ˜ å°„"><span class="math inline">\(\mathfrak{so}(3)\)</span>çš„æŒ‡æ•°æ˜ å°„</h3>
<p>ä»¤ä¸‰ç»´å‘é‡<span class="math inline">\(\boldsymbol{\phi}\)</span>çš„æ¨¡ä¸º<span class="math inline">\(\theta\)</span>ï¼Œæ–¹å‘å‘é‡ä¸º<span class="math inline">\(\boldsymbol{a}\)</span>ï¼Œå³</p>
<p><span class="math display">\[
\theta = ||\boldsymbol{\phi}||\\
\boldsymbol{a} = \frac{\boldsymbol{\phi}}{||\boldsymbol{\phi}||}
\]</span></p>
<p>ç»è¿‡ä¸€ç³»åˆ—çš„æ¨å¯¼ï¼Œå¯ä»¥å¾—åˆ°æŒ‡æ•°æ˜ å°„çš„å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
\begin{split}
\exp(\boldsymbol{\phi}^{\wedge}) &amp;= \exp(\theta\boldsymbol{a})\\
&amp;= \cos{\theta}\mathbf{I} + (1 - \cos{\theta})\boldsymbol{a}\boldsymbol{a}^T+\sin{\theta}\boldsymbol{a}^{\wedge}
\end{split}\tag{exp-1}
\]</span></p>
<p>ä¸Šé¢å…¬å¼çš„ä¸€ç§ç­‰ä»·å†™æ³•ï¼ˆä¸ä½¿ç”¨æ¨¡å’Œæ–¹å‘ä»£æ›¿ï¼‰ä¸ºï¼š</p>
<p><span class="math display">\[
\begin{split}
\exp(\boldsymbol{\phi}^{\wedge}) = \mathbf{I} + \frac{\sin{||\boldsymbol{\phi}||}}{||\boldsymbol{\phi}||} + \frac{1 - \cos{||\boldsymbol{\phi}||}}{||\boldsymbol{\phi}||^2}(\boldsymbol{\phi}^{\wedge})^2
\end{split}\tag{exp-2}
\]</span></p>
<p>ä¸Šé¢è¿™ä¸¤ä¸ªå…¬å¼å«åšç½—å¾·é‡Œæ ¼æ–¯ï¼ˆRodrigues' formulaï¼‰ï¼Œä¹Ÿæ˜¯å°† <strong><em>æ—‹è½¬å‘é‡</em></strong> å˜æ¢ä¸ºæ—‹è½¬çŸ©é˜µçš„å˜æ¢å…¬å¼ã€‚ä»ä¸Šé¢ä¸¤ä¸ªå…¬å¼æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ<span class="math inline">\(\mathfrak{so}(3)\)</span>æä»£æ•°ç©ºé—´å®é™…ä¸Šä¹Ÿæ˜¯ <strong><em>æ—‹è½¬å‘é‡</em></strong> ç»„æˆçš„ç©ºé—´ã€‚åˆå› ä¸ºæ—‹è½¬è§’çš„å‘¨æœŸä¸º<span class="math inline">\(2\pi\)</span>ï¼Œæ‰€ä»¥ä¸€ä¸ªæ—‹è½¬å‘é‡å¯ä»¥å¯¹åº”åˆ°ä¸€ä¸ªæ—‹è½¬çŸ©é˜µï¼Œä½†æ˜¯ä¸€ä¸ªæ—‹è½¬çŸ©é˜µä¼šå¯¹åº”åˆ°å¤šä¸ªæ—‹è½¬å‘é‡ï¼ˆæ»¡å°„ï¼‰ã€‚ä½†æ˜¯å¦‚æœå°†æ—‹è½¬è§’é™åˆ¶åœ¨<span class="math inline">\([-\pi,\pi)\)</span>ï¼Œåˆ™æ˜¯å•å°„ã€‚</p>
<h3 id="so3ä¸Šçš„å¯¹æ•°æ˜ å°„">SO(3)ä¸Šçš„å¯¹æ•°æ˜ å°„</h3>
<p>ä»ä¸Šé¢çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¦æŠŠæç¾¤<span class="math inline">\(SO(3)\)</span>æ˜ å°„åˆ°æä»£æ•°ï¼Œåªéœ€è¦ç”¨æ—‹è½¬çŸ©é˜µè®¡ç®—æ—‹è½¬çŸ¢é‡å³å¯ã€‚ä»æ—‹è½¬çŸ©é˜µ<span class="math inline">\(R\)</span>è®¡ç®—æ—‹è½¬è§’å…¬å¼ä¸ºï¼š</p>
<p><span class="math display">\[
\theta = \arccos \frac{tr(R)-1}{2}\tag{ln-01}
\]</span></p>
<p>åˆç”±äºæ—‹è½¬è½´ä½¿ç”¨æ—‹è½¬çŸ©é˜µæ—‹è½¬åæ–¹å‘ä¸å˜ï¼Œå³ï¼š</p>
<p><span class="math display">\[
R\boldsymbol{a} = \boldsymbol{a}\tag{ln-02}
\]</span></p>
<p>æ‰€ä»¥<strong>æ—‹è½¬è½´å¯¹åº”<span class="math inline">\(R\)</span>ç‰¹å¾å€¼ä¸º1çš„ç‰¹å¾å‘é‡</strong></p>
<p>è½´å‘é‡ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢å…¬å¼è®¡ç®—</p>
<p><span class="math display">\[
\log(R) = 
\frac{\theta \cdot (R-R^T)}{2sin(\theta)}\quad \text{with} \quad R\neq\mathbf{I}\tag{ln-03}
\]</span></p>
<h3 id="æŒ‡æ•°æ˜ å°„çš„ä¸€é˜¶è¿‘ä¼¼">æŒ‡æ•°æ˜ å°„çš„ä¸€é˜¶è¿‘ä¼¼</h3>
<p>æŒ‡æ•°æ˜ å°„çš„ä¸¥æ ¼å±•å¼€å½¢å¼ä¸º:</p>
<p><span class="math display">\[
\exp(\boldsymbol{\phi}^{\wedge}) = \sum^{\infty}_{n=0}\frac{1}{n!}(\boldsymbol{\phi}^{\wedge})^n
\]</span></p>
<p>å½“<span class="math inline">\(\boldsymbol{\phi}\)</span>æ˜¯å¾®å°é‡æ—¶ï¼Œå¿½ç•¥äºŒæ¬¡é¡¹åŠä»¥ä¸Šï¼Œå¾—åˆ°æŒ‡æ•°æ˜ å°„çš„ä¸€é˜¶è¿‘ä¼¼ï¼š</p>
<p><span class="math display">\[
\exp(\boldsymbol{\phi}^{\wedge})\approx \mathbf{I} + \boldsymbol{\phi}^{\wedge} \tag{exp-1st}
\]</span></p>
<p><strong><em>ä¸Šé¢è¿™ä¸ªå…¬å¼ç»å¸¸è¢«ä½¿ç”¨åˆ°ï¼Œè¦ç‰¢è®°</em></strong></p>
<h2 id="æç¾¤æä»£æ•°æ€»ç»“">æç¾¤æä»£æ•°æ€»ç»“</h2>
<ul>
<li>å¼•å…¥æä»£æ•°çš„åŸå› æ˜¯åœ¨SLAMä¸­å¸¸ç”¨çš„ç¾¤ï¼š<span class="math inline">\(SO(3),SE(3),Sim(3)\)</span>æ²¡æœ‰è‰¯å¥½å®šä¹‰çš„åŠ æ³•ï¼Œå› æ­¤åœ¨ä¼˜åŒ–çš„æ—¶å€™æ²¡æ³•ç›´æ¥å¾€ä¸Šæ›´æ–°ä¸€ä¸ªå¾®å°å¢é‡</li>
<li>å¦ä¸€ä¸ªåŸå› æ˜¯<span class="math inline">\(SO(3),SE(3),Sim(3)\)</span>è¿™äº›ç¾¤éƒ½æœ‰é¢å¤–çš„é™åˆ¶ï¼Œç›´æ¥ä¼˜åŒ–å°±å˜æˆäº†å¸¦çº¦æŸçš„ä¼˜åŒ–ï¼Œè€Œè½¬åˆ°æä»£æ•°ç©ºé—´åˆ™æ˜¯ä¸€ä¸ªæ— çº¦æŸçš„ä¼˜åŒ–é—®é¢˜</li>
<li>åœ¨åé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“æ—‹è½¬çŸ©é˜µä¹˜ä»¥ä¸€ä¸ªå¾®å°æ‰°åŠ¨å¯ä»¥å¯¹åº”åˆ°æä»£æ•°ç©ºé—´çš„è¿‘ä¼¼çº¿æ€§ç›¸åŠ ï¼Œè¿™ä¸ºä¼˜åŒ–å¸¦æ¥å¾ˆå¤§çš„å¥½å¤„</li>
<li>æä»£æ•°é€šè¿‡æŒ‡æ•°æ˜ å°„åˆ°æç¾¤ï¼Œæç¾¤é€šè¿‡å¯¹æ•°æ˜ å°„åˆ°æä»£æ•°</li>
<li>æä»£æ•°æ˜¯æç¾¤å•ä½å…ƒå¤„çš„åˆ‡å¹³é¢</li>
<li>ä¸è¦çº ç»“ä¸Šé¢çš„è¿™å¥è¯ï¼ï¼ï¼ï¼å¯¹æ•°æ˜ å°„/æŒ‡æ•°æ˜ å°„å¯ä»¥å¯¹æ•´ä¸ªæç¾¤/æä»£æ•°ç©ºé—´è¿›è¡Œæ˜ å°„ï¼ï¼ï¼</li>
</ul>
<h2 id="bchè¿‘ä¼¼">BCHè¿‘ä¼¼</h2>
<p>BCH(Baker-Campbell-Hausdorff)å…¬å¼è¡¨è¾¾ä¸¤ä¸ªæä»£æ•°æŒ‡æ•°æ˜ å°„ä¹˜ç§¯çš„å®Œæ•´å½¢å¼ï¼ˆå¾ˆå¤æ‚ï¼Œä¸ç”¨è®°ï¼‰ï¼Œä½†æ˜¯ä½†å¿½ç•¥é«˜é˜¶é¡¹ååˆ™ä¼šå‡ºç°ä¼˜ç¾çš„çº¿æ€§è¡¨è¾¾ã€‚</p>
<p>å½“æ—‹è½¬çŸ©é˜µ<span class="math inline">\(R\)</span>å·¦ä¹˜æˆ–è€…å³ä¹˜ä¸Šä¸€ä¸ªå¾®å°é‡<span class="math inline">\(\Delta{R}\)</span>æ—¶ï¼Œä¼šè¿‘ä¼¼ï¼ˆBCHè¿‘ä¼¼ï¼‰å¯¹åº”æä»£æ•°ç©ºé—´çº¿æ€§ç›¸åŠ ï¼Œè®°<span class="math inline">\(R\)</span>çš„æä»£æ•°ä¸º<span class="math inline">\(\boldsymbol{\phi}\)</span>ï¼Œ<span class="math inline">\(\Delta{R}\)</span>çš„æä»£æ•°ä¸º<span class="math inline">\(\Delta \boldsymbol{\phi}\)</span></p>
<p><strong>BCHè¿‘ä¼¼æœ‰å·¦ä¹˜å³ä¹˜ä¸¤ç§å½¢å¼ï¼Œç¬”è€…å‘ç°å­¦ä¹ çš„æ—¶å€™ä»¥ä¸€ç§å½¢å¼å»æ¨å¯¼å³å¯ï¼Œæ›´å®¹æ˜“ç†è§£ï¼Œä¸‹é¢ä»¥å³ä¹˜çš„å½¢å¼è¿›è¡Œè®²è§£ï¼ˆåå››è®²ä¸­æ˜¯ä»¥å·¦ä¹˜ä½œä¸ºè®²è§£ï¼‰</strong></p>
<h3 id="bchè¿‘ä¼¼å³ä¹˜å½¢å¼">BCHè¿‘ä¼¼å³ä¹˜å½¢å¼</h3>
<p><span class="math display">\[
\exp(\boldsymbol{\phi}^{\wedge})\exp(\boldsymbol{\Delta{\phi}}^{\wedge})=\exp\big(J_r^{-1}(\boldsymbol{\phi})\Delta{\boldsymbol{\phi}}+\boldsymbol{\phi}\big)\tag{BCH}
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(J_r(\boldsymbol{\phi})\)</span>ä¹˜ä¸ºå³ä¹˜é›…å„æ¯”ï¼š</p>
<p><span class="math display">\[
J_r(\boldsymbol{\phi}) = \mathbf{I}-\frac{1-\cos{||\boldsymbol{\phi}||}}{||\boldsymbol{\phi}||^2} + \frac{||\boldsymbol{\phi}||-\sin{||\boldsymbol{\phi}||}}{||\boldsymbol{\phi}||^3}(\boldsymbol{\phi}^{\wedge})^2\tag{BCH-Jr}
\]</span></p>
<p>ä¹Ÿå¯ä»¥å†™æˆè½´-è§’çš„å½¢å¼</p>
<p><span class="math display">\[
J_r{(\boldsymbol{\phi})} = \frac{\sin{\theta}}{\theta}\mathbf{I}+(1-\frac{\sin{\theta}}{\theta})\boldsymbol{a}\boldsymbol{a}^T-\frac{1-\cos{\theta}}{\theta}\boldsymbol{a}^{\wedge}
\]</span></p>
<p>ä¸Šé¢ä¸¤ç§ç­‰ä»·å…³ç³»çš„å˜æ¢ä¸­éœ€è¦ç”¨åˆ°ä¸€ä¸ªæ€§è´¨</p>
<p><span class="math display">\[
\boldsymbol{a}^{\wedge}\boldsymbol{a}^{\wedge} = \boldsymbol{a}\boldsymbol{a}^T - \mathbf{I}
\]</span></p>
<p>å¦å¤–</p>
<p><span class="math display">\[
J_r^{-1}(\boldsymbol{\phi})=\mathbf{I}+\frac{1}{2}\boldsymbol{\phi}^{\wedge}+\big(\frac{1}{||\boldsymbol{\phi}||^2}-\frac{1+\cos{||\boldsymbol{\phi}||}}{2||\boldsymbol{\phi}||\sin{||\boldsymbol{\phi}||}}\big)(\boldsymbol{\phi}^{\wedge})^2
\]</span></p>
<h3 id="bchè¿‘ä¼¼çš„å…¶ä»–è¡¨è¾¾å½¢å¼">BCHè¿‘ä¼¼çš„å…¶ä»–è¡¨è¾¾å½¢å¼</h3>
<p>BCHè¿‘ä¼¼æ˜¯ä¸ºäº†èƒ½å¤Ÿå°†<span class="math inline">\(SO(3)\)</span>ä¸Šçš„çŸ©é˜µä¹˜ç§¯å˜æˆæä»£æ•°ä¸Šçš„åŠ æ³•ï¼Œä¸‹é¢å‡ æ¡å…¬å¼åªæ˜¯å…¬å¼ï¼ˆBCHï¼‰çš„å…¶ä»–è¡¨è¾¾å½¢å¼ï¼Œåé¢ä¹Ÿä¼šé¢‘ç¹ç”¨åˆ°</p>
<p><span class="math display">\[
\exp\big((\boldsymbol{\phi}+\Delta{\boldsymbol{\phi}})^{\wedge}\big) = \exp(\boldsymbol{\phi}^{\wedge})\exp(J_r\Delta{\boldsymbol{\phi}}^{\wedge})\tag{BCH-2}
\]</span></p>
<h2 id="so3ä¸Šçš„æä»£æ•°æ±‚å¯¼"><span class="math inline">\(SO(3)\)</span>ä¸Šçš„æä»£æ•°æ±‚å¯¼</h2>
<p>åŠ å…¥æˆ‘ä»¬å¯¹ä¸€ä¸ªç©ºé—´ç‚¹<span class="math inline">\(\boldsymbol{p}\)</span>è¿›è¡Œæ—‹è½¬ï¼Œå¾—åˆ°<span class="math inline">\(R\boldsymbol{p}\)</span>ï¼Œè¦æ±‚ç›¸å¯¹äº<span class="math inline">\(R\)</span>çš„å¯¼æ•°ã€‚ç”±äº<span class="math inline">\(SO(3)\)</span>ä¸Šæ²¡æœ‰åŠ æ³•ï¼Œäºæ˜¯æˆ‘ä»¬æ²¡æ³•ç›´æ¥ä½¿ç”¨å¯¼æ•°çš„å®šä¹‰è¿›è¡Œè®¡ç®—ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°†<span class="math inline">\(R\)</span>æ˜ å°„åˆ°æä»£æ•°ç©ºé—´<span class="math inline">\(\boldsymbol{\phi}{\wedge}\)</span>ï¼Œå¹¶åœ¨æä»£æ•°ç©ºé—´è¿›è¡Œæ±‚å¯¼ï¼ˆSLAMåå››è®²å…¬å¼4.41ä½¿ç”¨BCHå·¦ä¹˜æ¨¡å‹æ¨å¯¼ï¼Œè¿™é‡Œä½¿ç”¨å³ä¹˜æ¨¡å‹æ¨å¯¼ï¼‰</p>
<h3 id="æä»£æ•°ç©ºé—´æ±‚å¯¼">æä»£æ•°ç©ºé—´æ±‚å¯¼</h3>
<p><span class="math display">\[
\begin{split}
\frac{\partial(R\boldsymbol{p})}{\partial{R}} &amp;= \frac{\partial{\big(\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}\big)}}{\partial{\boldsymbol{\phi}}}\\
&amp;\overset{1}{=}\lim_{\Delta{\boldsymbol{\phi}}\rightarrow0}\frac{\exp(\big(\boldsymbol{\phi}+\Delta{\boldsymbol{\phi}})^{\wedge}\big)\boldsymbol{p} - \exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{2}{=}\lim_{\Delta{\boldsymbol{\phi}}\rightarrow0}
\frac
{\exp(\boldsymbol{\phi}^{\wedge})\exp(J_r\Delta{\boldsymbol{\phi}^{\wedge}})\boldsymbol{p}-\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{3}{=}\lim_{\Delta{\boldsymbol{\phi}}\rightarrow0}
\frac
{\exp(\boldsymbol{\phi}^{\wedge})(\mathbf{I}+J_r\Delta{\boldsymbol{\phi}^{\wedge}})\boldsymbol{p}-\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{4}{=}\lim_{\Delta{\boldsymbol{\phi}}\rightarrow0}
\frac
{\exp(\boldsymbol{\phi}^{\wedge})J_r\Delta{\boldsymbol{\phi}^{\wedge}}\boldsymbol{p}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{5}{=}\lim_{\Delta{\boldsymbol{\phi}}\rightarrow0}
\frac
{-\exp(\boldsymbol{\phi}^{\wedge})J_r\boldsymbol{p}^{\wedge}\Delta{\boldsymbol{\phi}}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;=-RJ_r\boldsymbol{p}^{\wedge}
\end{split}
\]</span></p>
<p>ä¸Šå¼çš„æ¨å¯¼ä¸­ï¼Œç­‰å·1æ˜¯å¯¼æ•°çš„å®šä¹‰;ç­‰å·2ä½¿ç”¨BCHå³ä¹˜è¿‘ä¼¼å…¬å¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡å…¬å¼ï¼ˆBCH-2ï¼‰;ç­‰å·3æ˜¯æŒ‡æ•°æ˜ å°„çš„ä¸€é˜¶è¿‘ä¼¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡å…¬å¼ï¼ˆexp-1stï¼‰;ç­‰å·5åˆ©ç”¨äº†ä¸‹é¢çš„æ€§è´¨</p>
<p><span class="math display">\[
\boldsymbol{a}^{\wedge}\boldsymbol{b} = -\boldsymbol{b}^{\wedge}\boldsymbol{a}\tag{skew-prop}
\]</span></p>
<p>å°†ä¸Šé¢çš„ç»“æœè®°ä¸º <span class="math display">\[
\frac{\partial(R\boldsymbol{p})}{\partial{R}}=-RJ_r\boldsymbol{p}^{\wedge}\tag{dR-alg-R}
\]</span></p>
<p>å¦‚æœåœ¨ä¸Šé¢çš„æ¨å¯¼ä¸­ä½¿ç”¨å·¦ä¹˜æ¨¡å‹è¿›è¡Œæ¨å¯¼ï¼Œç»“æœä¼šç¨å¾®æœ‰ç‚¹ä¸åŒï¼š</p>
<p><span class="math display">\[
\frac{\partial(R\boldsymbol{p})}{\partial{R}}=(-R\boldsymbol{p})^{\wedge}J_l\tag{dR-alg-L}
\]</span></p>
<h3 id="æç¾¤ç©ºé—´æ±‚å¯¼">æç¾¤ç©ºé—´æ±‚å¯¼</h3>
<p>å¦ä¸€ç§æ›´å¸¸è§çš„åšæ³•æ˜¯åœ¨æç¾¤ä¸Šå¯¹<span class="math inline">\(R\)</span>è¿›è¡Œä¸€ä¸ªæ‰°åŠ¨<span class="math inline">\(\exp(\Delta{\boldsymbol{\phi}^{\wedge}})\)</span>ï¼Œè®¡ç®—ç»“æœç›¸å¯¹äºæ‰°åŠ¨çš„å˜åŒ–ç‡ã€‚SLAMåå››è®²ä¸­ä½¿ç”¨å·¦æ‰°åŠ¨æ¨å¯¼ï¼Œè¿™é‡Œä½¿ç”¨å³æ‰°åŠ¨æ¨å¯¼ä¸€ä¸‹</p>
<p><span class="math display">\[
\begin{split}
\frac{\partial(R\boldsymbol{p})}{\partial{R}}
&amp;=\lim_{\Delta{\boldsymbol{\phi}\rightarrow0}}
\frac
{\exp(\boldsymbol{\phi}^{\wedge})\exp(\Delta{\boldsymbol{\phi}^{\wedge}})\boldsymbol{p}-\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{1}{=}\lim_{\Delta{\boldsymbol{\phi}\rightarrow0}}
\frac
{\exp(\boldsymbol{\phi}^{\wedge})(\mathbf{I}+\Delta{\boldsymbol{\phi}^{\wedge}})\boldsymbol{p}-\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{2}{=}\lim_{\Delta{\boldsymbol{\phi}\rightarrow0}}
\frac
{\exp(\boldsymbol{\phi}^{\wedge})\Delta{\boldsymbol{\phi}^{\wedge}}\boldsymbol{p}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;\overset{3}{=}\lim_{\Delta{\boldsymbol{\phi}\rightarrow0}}
\frac
{-\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}^{\wedge}\Delta{\boldsymbol{\phi}}}
{\Delta{\boldsymbol{\phi}}}\\
\\
&amp;=-R\boldsymbol{p}^{\wedge}
\end{split}
\]</span></p>
<p>å…¶ä¸­ç­‰å·1ä½¿ç”¨æŒ‡æ•°æ˜ å°„çš„ä¸€é˜¶è¿‘ä¼¼ï¼Œä¹Ÿå°±æ˜¯å…¬å¼ï¼ˆexp-1stï¼‰;ç­‰å·3ä½¿ç”¨åå¯¹ç§°çŸ©é˜µçš„æ€§è´¨ï¼Œä¹Ÿå°±æ˜¯å…¬å¼ï¼ˆskew-propï¼‰ã€‚</p>
<p>å¦‚æœä½¿ç”¨å·¦æ‰°åŠ¨æ¨å¯¼ï¼Œç»“æœä¼šç¨æœ‰ä¸åŒï¼Œæˆ‘ä»¬å°†ä¸¤è€…è®°ä¸ºå¦‚ä¸‹</p>
<p>å³æ‰°åŠ¨æ¨¡å‹ï¼š</p>
<p><span class="math display">\[
\frac{\partial(R\boldsymbol{p})}{\partial{R}}=-R\boldsymbol{p}^{\wedge}\tag{dR-group-R}
\]</span></p>
<p>å·¦æ‰°åŠ¨æ¨¡å‹ï¼š</p>
<p><span class="math display">\[
\frac{\partial(R\boldsymbol{p})}{\partial{R}}=-(R\boldsymbol{p})^{\wedge}\tag{dR-group-L}
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/05/30/slam-theory/MAP2LSP_02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/30/slam-theory/MAP2LSP_02/" class="post-title-link" itemprop="url">SLAMåŸºç¡€â€”â€”å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆåº”ç”¨ç¯‡ï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-05-30 10:12:01" itemprop="dateCreated datePublished" datetime="2023-05-30T10:12:01+08:00">2023-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-06-14 11:53:54" itemprop="dateModified" datetime="2023-06-14T11:53:54+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/Theory/" itemprop="url" rel="index"><span itemprop="name">Theory</span></a>
        </span>
    </span>

  
    <span id="/2023/05/30/slam-theory/MAP2LSP_02/" class="post-meta-item leancloud_visitors" data-flag-title="SLAMåŸºç¡€â€”â€”å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆåº”ç”¨ç¯‡ï¼‰" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="SLAMåŸºç¡€â€”â€”å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆåº”ç”¨ç¯‡ï¼‰" href="/2023/05/30/slam-theory/MAP2LSP_02/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::996c42066e615cfa17c6dba93a63cf5f" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="ç†è®ºç¯‡å›é¡¾">ç†è®ºç¯‡å›é¡¾</h2>
<p>æ€»ç»“ä¸€ä¸‹ã€Šç†è®ºç¯‡ã€‹çš„æ¨ç†è¿‡ç¨‹ï¼š</p>
<ol type="1">
<li>SLAMåç«¯ä¼˜åŒ–çš„ä»»åŠ¡æ˜¯æœ€å¤§ä¼¼ç„¶å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨å·²çŸ¥è§‚æµ‹çš„æƒ…å†µä¸‹é€šè¿‡æœ€å¤§åŒ–ä¼¼ç„¶å‡½æ•°ç¡®å®šæœ€æœ‰å¯èƒ½çš„æœºå™¨äººä½å§¿</li>
<li>æœ€å¤§ä¼¼ç„¶åœ¨é«˜æ–¯åˆ†å¸ƒçš„æƒ…å†µä¸‹æœ€ç»ˆå¯ä»¥è½¬æ¢æˆä¸€ä¸ªäºŒæ¬¡å‹ï¼Œå…·ä½“å«ä¹‰æ˜¯æœ€å°åŒ–è§‚æµ‹å’Œæ¨¡å‹çš„è¯¯å·®ï¼ˆç»è¿‡ä¿¡æ¯çŸ©é˜µä¹Ÿå°±æ˜¯åæ–¹å·®å€’æ•°çš„åŠ æƒï¼‰</li>
</ol>
<p>ç”¨å…¬å¼å¯ä»¥å†™ä¸ºï¼š</p>
<p><span class="math display">\[
\begin{equation}
\begin{split}
\hat{x}_{MLE}
&amp;= \underset{x}{\operatorname{argmin}} \big(z-h(x)\big)^T\Sigma^{-1}\big(z-h(x)\big)\\
&amp;= \underset{x}{\operatorname{argmin}}||z - h(x)||^2_{\Sigma^{-1}}\\
&amp;= \underset{x}{\operatorname{argmin}}||e_z||^2_{\Sigma^{-1}}
\end{split}
\end{equation}
\tag{1}
\]</span></p>
<h2 id="æœ€å°äºŒä¹˜çš„æ ‡å‡†å½¢å¼">æœ€å°äºŒä¹˜çš„æ ‡å‡†å½¢å¼</h2>
<p>åœ¨å‰æ–‡çš„å…¬å¼ä¸­ï¼Œå‘é‡çš„ç¬¦å·æ²¡æœ‰åŠ ç²—ï¼Œä¸”æ¨å¯¼çš„è¿‡ç¨‹æ²¡æœ‰ç”¨æ­£å¼çš„ç¬¦å·ï¼Œè¿™é‡Œå…ˆå¯¹å‰é¢çš„ç»“æœåšæ›´æ ‡å‡†åŒ–çš„å¤è¿°ã€‚</p>
<p>ä»¤æœºå™¨äººæ¯ä¸€æ—¶åˆ»çš„ä½å§¿ä¸º<span class="math inline">\(\boldsymbol{x}_i, i\in [0,1,2,...)\)</span>ï¼Œæ¯ä¸€æ—¶åˆ»çš„è§‚æµ‹ä¸º<span class="math inline">\(\boldsymbol{z}_i,i\in[0,1,2,...)\)</span>ï¼Œè®°æœºå™¨äººå†å²è½¨è¿¹çš„ä½å§¿é›†åˆä¸º<span class="math inline">\(\boldsymbol{X},\boldsymbol{x}_i\in\boldsymbol{X}\)</span>ï¼Œåˆ™å…¬å¼ï¼ˆ1ï¼‰å¯ä»¥å†™ä¸ºï¼š</p>
<p><span class="math display">\[
\begin{split}
\hat{\boldsymbol{X}}_{MLE}
&amp;= \underset{\boldsymbol{x}_i}{\operatorname{argmin}}\sum_{i}\big(\boldsymbol{z}_i - \boldsymbol{h}(\boldsymbol{x}_i)\big)^T\boldsymbol{\Sigma}_i^{-1}\big(\boldsymbol{z}_i - \boldsymbol{h}(\boldsymbol{x}_i)\big)\\
&amp;=\underset{\boldsymbol{x}_i}{\operatorname{argmin}}\sum_{i}\boldsymbol{e}_i^T\boldsymbol{\Sigma}_i^{-1}\boldsymbol{e}_i
\end{split}\tag{2}
\]</span></p>
<p>ä¸Šé¢çš„å½¢å¼åˆå«åŠ æƒçš„å¹³æ–¹è¯¯å·®ï¼ˆWeighted Sum of Squared Errorï¼‰ï¼Œæƒé‡ç³»æ•°åœ¨è¿™é‡Œæ˜¯<span class="math inline">\(\boldsymbol{\Sigma}_i^-1\)</span>ï¼Œä¹Ÿå°±æ˜¯åæ–¹å·®çš„å€’æ•°ï¼Œç›´è§‚å«ä¹‰å°±æ˜¯å¯¹äºä¸ç¡®å®šçš„è§‚æµ‹ï¼ˆæ–¹å·®è¾ƒå¤§ï¼‰èµ‹äºˆè¾ƒä½çš„æƒé‡ã€‚æˆ‘ä»¬å¯ä»¥å¯¹<span class="math inline">\(\boldsymbol{e}_i\)</span>æå‰ä¹˜ä»¥ä¸€ä¸ªç³»æ•°<span class="math inline">\(L_i\)</span>ï¼Œ<span class="math inline">\(L_i\)</span>æ»¡è¶³<span class="math inline">\(\boldsymbol{\Sigma}_i^{-1}=\boldsymbol{L}_i\boldsymbol{L}_i^T\)</span>ï¼Œå¹¶è®°<span class="math inline">\(\bar{\boldsymbol{e}}_i=\boldsymbol{L}_i\boldsymbol{e}_i\)</span>ï¼Œåˆ™</p>
<p><span class="math display">\[
\begin{split}
\hat{\boldsymbol{X}}_{MLE}&amp;=\underset{\boldsymbol{x}_i}{\operatorname{argmin}}\sum_{i}||\bar{\boldsymbol{e}}_i||^2
\end{split}\tag{3}
\]</span></p>
<p>å…¬å¼ï¼ˆ3ï¼‰ç§°ä¸ºæœ€å°äºŒä¹˜çš„æ ‡å‡†å½¢å¼ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨SLAMä¸­ä¸€äº›ä¼˜åŒ–é—®é¢˜ä¸­æ¯”å¦‚BA,æ˜¯ç›´æ¥æ„é€ æœ€å°äºŒä¹˜é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰åŠ å…¥æƒé‡ã€‚è¿™å¹¶ä¸å½±å“æˆ‘ä»¬çš„ç†è§£ã€‚æœ€å°äºŒä¹˜é—®é¢˜ä»ç›´è§‚ä¸Šå°±æ˜¯è®©è¯¯å·®æœ€å°åŒ–ã€‚</p>
<h2 id="bundleadjustment">BundleAdjustment</h2>
<p>æˆ‘è§‰å¾—åœ¨è¿™é‡ŒåŠ å…¥BA(BundleAdjustment)é—®é¢˜çš„è®²è§£å¯ä»¥åŠ æ·±å¯¹è¿™éƒ¨åˆ†çš„å°è±¡å’Œç†è§£ã€‚BAåˆå«å…‰æŸæ³•å¹³å·®ï¼Œæˆ–è€…æ†ç»‘è°ƒæ•´ã€‚Bundleçš„æ„æ€æ˜¯åŒæ—¶å¯¹ç›¸æœºä½å§¿å’Œå…³é”®ç‚¹è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p><strong>PS</strong>ï¼šè¿™éƒ¨åˆ†å…¶å®ã€Šè§†è§‰SLAMåå››è®²ã€‹ç¬¬ä¹è®²è®²å¾—å¾ˆå¥½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å‚è€ƒåå››è®²çš„å†…å®¹ã€‚è¿™é‡Œä¸»è¦å’Œå‰æ–‡çš„å…¬å¼å»ºç«‹è”ç³»ï¼Œè®©è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹æ›´ä¸ºå®Œæ•´ã€‚</p>
<p>å‡è®¾æœºå™¨äººç§»åŠ¨ç»è¿‡ä¸‰ä¸ªç‚¹ï¼Œç›¸æœºçš„ä½å§¿åˆ†åˆ«ä¸º<span class="math inline">\(\boldsymbol{x}_1,\boldsymbol{x}_2, \boldsymbol{x}_3\)</span>ï¼Œç©ºé—´ä¸­æœ‰ä¸‰ä¸ªè·¯æ ‡ç‚¹<span class="math inline">\(\boldsymbol{p}_1,\boldsymbol{p}_2,\boldsymbol{p}_3\)</span></p>
<figure>
<img src="./imgs/01-BA.png" alt="" /><figcaption>BAé—®é¢˜ç¤ºä¾‹å›¾</figcaption>
</figure>
<p>å®šä¹‰ç›¸æœºæŠ•å½±æ–¹ç¨‹<span class="math inline">\(\pi(\cdot)\)</span>ï¼Œç›¸æœºæŠ•å½±æ–¹ç¨‹å°†ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ç‚¹è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»ç„¶åæŠ•å½±åˆ°åƒç´ åæ ‡ç³»ï¼š</p>
<p><span class="math display">\[
\pi(\boldsymbol{p}) = K\big(R\boldsymbol{p}+\boldsymbol{t}\big)
\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(K\)</span>æ˜¯ç›¸æœºå†…å‚ï¼Œ<span class="math inline">\(R,\boldsymbol{t}\)</span>æ˜¯ç›¸æœºä½å§¿</p>
<p>å…³é”®ç‚¹å¯ä»¥ç›´æ¥é€šè¿‡å›¾åƒè®¡ç®—å¾—åˆ°ï¼Œä¹Ÿå°±æ˜¯è§‚æµ‹<span class="math inline">\(\boldsymbol{z}_i := [u_i,v_i]^T\)</span></p>
<p>å°†æ‰€æœ‰æ—¶åˆ»çš„ä½å§¿ä»¥åŠæ¯ä¸ªä½å§¿èƒ½å¤Ÿè§‚æµ‹åˆ°çš„ç‰¹å¾ç‚¹éƒ½ç´¯åŠ èµ·æ¥ï¼Œå¹¶ç”¨æ ‡å‡†çš„äºŒæ¬¡å¹³æ–¹æŸå¤±å‡½æ•°è¡¨è¾¾ï¼Œåˆ™æ•´ä½“çš„ä»£ä»·å‡½æ•°ä¸º</p>
<p><span class="math display">\[
\sum_{i=1}^{M}\sum_{j=1}^{N}||\boldsymbol{e}_{ij}||^2=\sum_{i=1}^{M}\sum_{j=1}^{N}||\boldsymbol{z}_i-\pi(\boldsymbol{p}_j)||^2
\]</span></p>
<p>å°†ç›¸æœºä½å§¿<span class="math inline">\(\boldsymbol{x}_i\)</span>å’Œè·¯æ ‡ï¼ˆlandmarkï¼‰ç‚¹<span class="math inline">\(\boldsymbol{p}_j\)</span>å…±åŒå½“ä½œå˜é‡è¿›è¡Œä¼˜åŒ–ï¼Œå¾—åˆ°ä¼˜åŒ–æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
\begin{split}
\hat{\boldsymbol{X}},\hat{\boldsymbol{P}}
&amp;= \underset{\boldsymbol{x}_i, \boldsymbol{p}_j}{\operatorname{argmin}}\sum_{i=1}^{M}\sum_{j=1}^{N}v_{ij}||\boldsymbol{z}_i-\pi(\boldsymbol{p}_j)||^2
\end{split}\tag{3}
\]</span></p>
<p>å…¶ä¸­</p>
<ul>
<li><span class="math inline">\(M\)</span>æ˜¯ä½å§¿ç‚¹çš„æ•°é‡ï¼Œ<span class="math inline">\(N\)</span>æ˜¯è·¯æ ‡ç‚¹çš„æ•°é‡</li>
<li><span class="math inline">\(v_{ij}\)</span>æ˜¯ä¸€ä¸ªäºŒå…ƒå˜é‡ï¼Œå½“ç‚¹<span class="math inline">\(\boldsymbol{p}_j\)</span>èƒ½å¤Ÿè¢«ä½å§¿ç‚¹<span class="math inline">\(\boldsymbol{x}_i\)</span>è§‚å¯Ÿåˆ°æ—¶ï¼Œ<span class="math inline">\(v_{ij}=1\)</span>ï¼Œå¦åˆ™<span class="math inline">\(v_{ij}=0\)</span></li>
</ul>
<p>è‡³äºè¦å¦‚ä½•æ±‚è§£ä¸Šé¢çš„æœ€å°äºŒä¹˜å…¬å¼ï¼Œå°±æ˜¯éçº¿æ€§ä¼˜åŒ–äº†ï¼Œè¦è®²æ¸…æ¥šå¯èƒ½è¦å•å¼€ä¸€ç¯‡æ–‡ç« ã€‚ä½†æ˜¯ä»ä¸Šä¸€ç¯‡è¿˜æœ‰è¿™ä¸€ç¯‡çš„è®ºè¿°ï¼Œè¯»è€…åº”è¯¥è¦æ¸…æ™°åœ°å»ºç«‹ä»MAPé—®é¢˜åˆ°æœ€å°äºŒä¹˜é—®é¢˜çš„æ¨æ¼”è¿‡ç¨‹ï¼Œè¿™æ ·ä¹Ÿæ‰èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è®ºæ–‡é‡Œé¢‘ç¹å‡ºç°çš„MAP</p>
<h2 id="é²æ£’æ ¸å‡½æ•°">é²æ£’æ ¸å‡½æ•°</h2>
<p>è®©æˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹ä¸Šè¿°å…¬å¼ï¼ˆ3ï¼‰ï¼Œæ±‚è§£è¿™æ ·çš„ä¸€ä¸ªäºŒæ¬¡å‹ä¸€èˆ¬éœ€è¦ç”¨éçº¿æ€§ä¼˜åŒ–æ–¹æ³•ï¼Œä¼˜åŒ–è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠåˆ°å¯¹è¿™ä¸ªäºŒæ¬¡å‹æ±‚åå¯¼ã€‚è¿™æ ·å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ<span class="math inline">\(\boldsymbol{z}_i\)</span>ä¸<span class="math inline">\(\boldsymbol{p}_j\)</span>çš„åŒ¹é…å…³ç³»å‡ºç°é”™è¯¯ï¼Œæˆ–è€…<span class="math inline">\(\boldsymbol{z}_i\)</span>è®¡ç®—é”™è¯¯ï¼Œé‚£ä¹ˆäºŒæ¬¡å‹å°±ä¼šéå¸¸å¤§ã€‚è¿™æ ·åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯¼æ•°ä¼šè¢«é”™è¯¯é¡¹å æ®ä¸»è¦åœ°ä½ï¼Œè¿™æ ·æ›´æ–°çš„æ—¶å€™å°±å¾€é”™è¯¯çš„æ–¹å‘è¿›è¡Œæ›´æ–°ã€‚</p>
<p><strong>PS:åœ¨ä¸Šè¿°æè¿°çš„BAé—®é¢˜ä¸­ï¼Œ<span class="math inline">\(\boldsymbol{z}_i\)</span>é€šå¸¸æ˜¯å¯¹å›¾åƒè¿›è¡Œç‰¹å¾ç‚¹æ£€æµ‹å¾—å‡ºç‰¹å¾ç‚¹çš„ä½ç½®å’Œæè¿°å­ï¼Œ<span class="math inline">\(\boldsymbol{p}_j\)</span>æ˜¯åœ°å›¾ä¸­ç‚¹ï¼Œä¸¤è€…çš„åŒ¹é…å…³ç³»é€šå¸¸å¯ä»¥é€šè¿‡ç‰¹å¾ç‚¹åŒ¹é…çš„æ–¹å¼å¾—åˆ°ã€‚</strong></p>
<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠäºŒæ¬¡å‡½æ•°æ›¿æ¢ä¸ºå…¶ä»–å‡½æ•°ï¼Œä½¿å¾—åœ¨è¯¯å·®è¾ƒå¤§çš„åœ°æ–¹å‡½æ•°å€¼ä¸è‡³äºè¿‡å¤§å¯¼è‡´å¯¼æ•°è¿‡å¤§ã€‚è¿™äº›å‡½æ•°å°±å«é²æ£’æ ¸å‡½æ•°ï¼ˆRobust Kernelï¼‰ã€‚</p>
<h3 id="huberæ ¸å‡½æ•°">Huberæ ¸å‡½æ•°</h3>
<p>ä¸€ç§è¾ƒä¸ºå¸¸è§çš„æ ¸å‡½æ•°å«åšHuberæ ¸å‡½æ•°ï¼Œåœ¨å¾ˆå¤šè®ºæ–‡ä¸­éƒ½ä½¿ç”¨è¯¥å‡½æ•°ï¼Œå…¶å…·æœ‰å¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
H(e) = 
\begin{cases}
\frac{1}{2}e^2,&amp;||e||\leq \delta\\
\delta\left(||e||-\frac{1}{2}\delta\right),&amp;else
\end{cases}\tag{4}
\]</span></p>
<p>Huberæ ¸å‡½æ•°ä¸äºŒæ¬¡å‡½æ•°çš„å‡½æ•°æ›²çº¿å¦‚ä¸‹å›¾</p>
<figure>
<img src="./imgs/02-l2_huber.png" alt="" /><figcaption>Huberå‡½æ•°ä¸äºŒæ¬¡å‡½æ•°æ›²çº¿</figcaption>
</figure>
<h3 id="æ ¸å‡½æ•°çš„ç‰¹ç‚¹å’Œå…¶ä»–æ ¸å‡½æ•°">æ ¸å‡½æ•°çš„ç‰¹ç‚¹å’Œå…¶ä»–æ ¸å‡½æ•°</h3>
<p>ä»ä¸Šé¢çš„æè¿°ä¸­æˆ‘ä»¬å…¶å®ä¸éš¾å¾—å‡ºé²æ£’æ ¸å‡½æ•°åº”è¯¥å…·æœ‰çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol type="1">
<li>å…‰æ»‘ã€‚å³å¤„å¤„å¯å¯¼</li>
<li>å‡½æ•°å¢é•¿çš„é€Ÿåº¦è¦æ¯”äºŒæ¬¡å‡½æ•°æ…¢</li>
</ol>
<p>ä»Huberå‡½æ•°å…¬å¼ï¼ˆ4ï¼‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå½“<span class="math inline">\(||e||=\delta\)</span>çš„æ—¶å€™ï¼Œä¸Šä¸‹ä¸¤å¼ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤Huberå‡½æ•°æ˜æ˜¾æ˜¯ä¸€ä¸ªå…‰æ»‘çš„å‡½æ•°ã€‚</p>
<p>å¸¸è§çš„å…¶ä»–é²æ£’æ ¸å‡½æ•°è¿˜æœ‰Cauchyã€Tukeyæ ¸ç­‰ï¼Œä»ç½‘ä¸Šæ‰¾äº†ä¸€å¼ å„ä¸ªæ ¸å‡½æ•°å’ŒäºŒæ¬¡å‡½æ•°çš„å‡½æ•°æ›²çº¿å¯¹æ¯”å›¾</p>
<figure>
<img src="./imgs/03-robust_kernels.png" alt="" /><figcaption>ä¸åŒæ ¸å‡½æ•°çš„å‡½æ•°æ›²çº¿</figcaption>
</figure>
<h3 id="ä¸€äº›æ€è€ƒ">ä¸€äº›æ€è€ƒ</h3>
<p>é²æ£’æ ¸å‡½æ•°è®©æˆ‘è”æƒ³åˆ°äº†ç¥ç»ç½‘ç»œä¸­çš„æ¿€æ´»å‡½æ•°ï¼ŒSLAMä¸­çš„å›¾ä¼˜åŒ–ä¹Ÿè®©æˆ‘è§‰å¾—è·Ÿç¥ç»ç½‘ç»œçš„æ¢¯åº¦å›ä¼ æœ‰ç‚¹ç›¸ä¼¼ã€‚ç¥ç»ç½‘ç»œçš„è®­ç»ƒç›®æ ‡å…¶å®ä¹Ÿæ˜¯MAPé—®é¢˜ï¼ˆä»è®­ç»ƒé›†ä¸­ä¼°è®¡å‡ºæ ·æœ¬çš„åˆ†å¸ƒï¼Œå¹¶ä½¿ç”¨è¯¥åˆ†å¸ƒæ¥é¢„æµ‹æµ‹è¯•é›†ï¼‰ï¼Œè€Œä¸”å¾ˆå¤šçš„ç¥ç»ç½‘ç»œç›®æ ‡å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªäºŒæ¬¡å‹ã€‚ä¸è¿‡åŒºåˆ«æ¯”è¾ƒå¤§çš„æ˜¯ï¼Œç¥ç»ç½‘ç»œä¸­å¤§éƒ¨åˆ†æ“ä½œæ˜¯çº¿æ€§æ“ä½œï¼ˆå·ç§¯ã€å…¨è¿æ¥ï¼‰ï¼Œè€ŒSLAMä¸­å¾ˆå¤šæ“ä½œéƒ½æ˜¯éçº¿æ€§çš„ï¼ˆæ—‹è½¬ï¼‰ã€‚åœ¨å›¾ä¼˜åŒ–ä¸­çš„æ›´æ–°è¿‡ç¨‹ä½¿ç”¨éçº¿æ€§ä¼˜åŒ–æ–¹æ³•ï¼ˆæ¯”å¦‚é«˜æ–¯ç‰›é¡¿æ³•ï¼‰ä¹Ÿæ˜¯éœ€è¦åœ¨æ¯ä¸€æ­¥æ›´æ–°è¿‡ç¨‹ä¸­è¿‘ä¼¼ä¼°è®¡ç›®æ ‡å‡½æ•°å¯¹äºå˜é‡çš„åå¯¼æ•°ï¼Œè¿™ç‚¹ä¸ç¥ç»ç½‘ç»œçš„æ¢¯åº¦å›ä¼ æ˜¯ç±»ä¼¼çš„ã€‚</p>
<p>æ—¢ç„¶ä¸‰å±‚å…¨è¿æ¥å±‚çš„ç¥ç»ç½‘ç»œå°±å¯ä»¥æ‹Ÿåˆä»»æ„æ¬¡çš„å‡½æ•°ï¼Œé‚£ä¹ˆæ˜¯å¦æœ‰å¯èƒ½ç”¨ç¥ç»ç½‘ç»œæ¥åšSLAMçš„åç«¯ä¼˜åŒ–ï¼Ÿ</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/05/29/slam-theory/MAP2LSP_01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/29/slam-theory/MAP2LSP_01/" class="post-title-link" itemprop="url">SLAMåŸºç¡€â€”â€”å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆç†è®ºç¯‡ï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-05-29 10:12:01" itemprop="dateCreated datePublished" datetime="2023-05-29T10:12:01+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-06-14 11:37:30" itemprop="dateModified" datetime="2023-06-14T11:37:30+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/Theory/" itemprop="url" rel="index"><span itemprop="name">Theory</span></a>
        </span>
    </span>

  
    <span id="/2023/05/29/slam-theory/MAP2LSP_01/" class="post-meta-item leancloud_visitors" data-flag-title="SLAMåŸºç¡€â€”â€”å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆç†è®ºç¯‡ï¼‰" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="SLAMåŸºç¡€â€”â€”å¦‚ä½•ä»æœ€å¤§åéªŒæ¦‚ç‡åˆ°æœ€å°äºŒä¹˜ï¼ˆç†è®ºç¯‡ï¼‰" href="/2023/05/29/slam-theory/MAP2LSP_01/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::beb83704626c889ddf4360511dbc14eb" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="æœ€å¤§åéªŒæ¦‚ç‡">æœ€å¤§åéªŒæ¦‚ç‡</h2>
<h3 id="ç¬¦å·è¯´æ˜">ç¬¦å·è¯´æ˜</h3>
<p>æœ¬æ–‡çš„æ ‡è®°æ²¡æœ‰ç”¨ç²—ä½“è¡¨ç¤ºï¼Œä½†æ˜¯è¦è®°ä½æœ¬æ–‡çš„å˜é‡éƒ½æ˜¯ä»»æ„å¤šç»´å˜é‡</p>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<p>æœ€å¤§åéªŒæ¦‚ç‡ï¼ˆMAP:Maximum a Posteriorï¼‰å…·æœ‰ä»¥ä¸‹é€»è¾‘</p>
<ol type="1">
<li>æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯æƒ³è¦ä¼°è®¡ä¸€ä¸ªæœªçŸ¥é‡<span class="math inline">\(x\)</span>ï¼Œä»¤å…¶æ¦‚ç‡åˆ†å¸ƒä¸º<span class="math inline">\(p(x)\)</span>.</li>
<li>å¦‚æœæˆ‘ä»¬èƒ½å¤ŸçŸ¥é“<span class="math inline">\(p(x)\)</span>çš„å…·ä½“è¡¨è¾¾ï¼Œåˆ™<span class="math inline">\(x\)</span>çš„ä¼°è®¡å€¼åº”è¯¥ä½¿å¾—æ¦‚ç‡æœ€å¤§</li>
<li>å½“æˆ‘ä»¬çŸ¥é“ä¸€äº›ä¸<span class="math inline">\(x\)</span>æœ‰å…³çš„è§‚æµ‹ç»“æœ<span class="math inline">\(z\)</span>ï¼Œ<span class="math inline">\(p(x|z)\)</span>ç§°åš<span class="math inline">\(x\)</span>çš„åéªŒæ¦‚ç‡</li>
<li>äºæ˜¯æˆ‘ä»¬çš„ä¼°è®¡å¯ä»¥å˜æˆä½¿å¾—<span class="math inline">\(p(x|z)\)</span>æœ€å¤§åŒ–çš„<span class="math inline">\(x\)</span></li>
</ol>
<p>ä¸Šè¿°é—®é¢˜ç§°ä½œæœ€å¤§åéªŒæ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯åœ¨å·²çŸ¥è§‚æµ‹å€¼çš„æƒ…å†µä¸‹å¦‚ä½•æ±‚å–æœªçŸ¥é‡ã€‚ ä»å½¢å¼ä¸Šå¯ä»¥åšå¦‚ä¸‹å®šä¹‰ï¼š</p>
<p><span class="math display">\[
\hat{x}_{MAP}(z)=\underset{x}{\operatorname{argmax\ }}p(x|z)\tag{1}
\]</span></p>
<h3 id="å°†ä¸Šè¿°å®šä¹‰ä»£å…¥slamé—®é¢˜">å°†ä¸Šè¿°å®šä¹‰ä»£å…¥SLAMé—®é¢˜</h3>
<ol type="1">
<li><span class="math inline">\(x\)</span>å¯¹åº”æœºå™¨äººçš„ä½å§¿</li>
<li><span class="math inline">\(z\)</span>å¯¹åº”SLAMç³»ç»Ÿçš„è§‚æµ‹ï¼Œæ¯”å¦‚è·¯æ ‡ç‚¹ã€æ¿€å…‰é‡Œç¨‹è®¡çš„è¾“å‡ºã€è§†è§‰é‡Œç¨‹è®¡çš„è¾“å‡ºç­‰</li>
<li>SLAMçš„åç«¯ä¼˜åŒ–æœ€ç»ˆç›®æ ‡å°±æ˜¯æ±‚å–åœ¨ç»™å®šçš„è§‚æµ‹ä¸‹ï¼Œæœºå™¨äººçš„ä½å§¿ä¼°è®¡å€¼ï¼Œä¹Ÿå°±æ˜¯ä½¿å¾—åéªŒæ¦‚ç‡<span class="math inline">\(p(x|z)\)</span>æœ€å¤§åŒ–çš„ä½å§¿<span class="math inline">\(x\)</span></li>
</ol>
<h2 id="æœ€å¤§ä¼¼ç„¶ä¼°è®¡">æœ€å¤§ä¼¼ç„¶ä¼°è®¡</h2>
<h3 id="è´å¶æ–¯å®šç†">è´å¶æ–¯å®šç†</h3>
<p>ä¸ºäº†è®©æ²¡æœ‰åŸºç¡€çš„è¯»è€…æ›´å®¹æ˜“ç†é¡ºæ¨ç†çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è´å¶æ–¯å®šç†ï¼ˆBayes's theoremï¼‰</p>
<p>è´å¶æ–¯å®šä¹‰æè¿°éšæœºäº‹ä»¶Aå’ŒBçš„æ¡ä»¶æ¦‚ç‡çš„ä¸€ä¸ªå…³ç³»ï¼š <span class="math display">\[
P(A|B) = \frac{P(A)P(B|A)}{P(B)}\tag{Bayes&#39;s Theorem}
\]</span></p>
<ul>
<li><span class="math inline">\(P(A)\)</span>æ˜¯<span class="math inline">\(A\)</span>çš„å…ˆéªŒæ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶<span class="math inline">\(A\)</span>çš„æ¦‚ç‡åˆ†å¸ƒã€‚<span class="math inline">\(P(B)\)</span>åŒç†</li>
<li><span class="math inline">\(P(A|B)\)</span>æ˜¯äº‹ä»¶<span class="math inline">\(B\)</span>å‘ç”Ÿå<span class="math inline">\(A\)</span>çš„æ¡ä»¶æ¦‚ç‡ï¼Œä¹Ÿå«<span class="math inline">\(B\)</span>å‘ç”Ÿå<span class="math inline">\(A\)</span>çš„åéªŒæ¦‚ç‡</li>
<li><span class="math inline">\(P(A|B)\)</span>è¡¨ç¤ºçš„æ˜¯äº‹ä»¶<span class="math inline">\(B\)</span>æ˜¯ç»“æœï¼ŒAæ˜¯å› ï¼Œå°±æ˜¯åœ¨çŸ¥é“ç»“æœçš„æƒ…å†µä¸‹æ±‚åŸå› çš„æ¦‚ç‡</li>
<li><span class="math inline">\(P(B|A)\)</span>æ˜¯äº‹ä»¶<span class="math inline">\(A\)</span>å‘ç”Ÿå<span class="math inline">\(B\)</span>çš„æ¡ä»¶æ¦‚ç‡ã€‚ä½†æ˜¯åº”è¯¥ç†è§£å½“<span class="math inline">\(B\)</span>å›ºå®šå<span class="math inline">\(A\)</span>çš„<strong>ä¼¼ç„¶</strong>ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(P(B|A)=L(A|B)\)</span></li>
<li><span class="math inline">\(P(B|A)\)</span>æˆ–è€…<span class="math inline">\(L(A|B)\)</span>è¡¨ç¤ºå·²çŸ¥æœ‰äº‹ä»¶Bå‘ç”Ÿï¼Œè¿ç”¨ä¼¼ç„¶å‡½æ•°<span class="math inline">\(L(A|B)\)</span>ï¼Œæˆ‘ä»¬ä¼°è®¡æˆ–çŒœæµ‹<span class="math inline">\(A\)</span>çš„ä¸åŒå€¼çš„å¯èƒ½æ€§</li>
</ul>
<p><strong>æ³¨æ„ï¼šåœ¨ä¸Šé¢ä¸­<span class="math inline">\(Aã€B\)</span>æ˜¯æœ‰åŒºåˆ†çš„ï¼Œè™½ç„¶<span class="math inline">\(P(B|A)\)</span>çš„å½¢å¼ä¸æ¡ä»¶æ¦‚ç‡å‡½æ•°çš„å½¢å¼ç›¸åŒï¼Œä½†æ˜¯æˆ‘ä»¬å…³æ³¨çš„å˜é‡æ˜¯<span class="math inline">\(A\)</span></strong></p>
<p>å‚è€ƒï¼š 1. å…³äºè´å¶æ–¯å®šç†çš„æ¨å¯¼<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bayes%27_theorem#Statement_of_theorem">wiki</a> 2. å…³äºä¼¼ç„¶å‡½æ•°çš„ç†è§£<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BC%BC%E7%84%B6%E5%87%BD%E6%95%B0">wiki</a></p>
<h3 id="ä»æœ€å¤§åéªŒæ¦‚ç‡mapåˆ°æœ€å¤§ä¼¼ç„¶ä¼°è®¡mle">ä»æœ€å¤§åéªŒæ¦‚ç‡ï¼ˆMAPï¼‰åˆ°æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰</h3>
<p><strong>å›é¡¾</strong>ï¼šï¼ˆå¯¹ç†è§£å¾ˆé‡è¦ï¼Œæ‰€ä»¥å›é¡¾ä¸€ä¸‹ï¼‰åœ¨å…¬å¼ï¼ˆ1ï¼‰ä¸­ï¼Œ<span class="math inline">\(x\)</span>ä»£è¡¨æˆ‘ä»¬è¦ä¼°è®¡çš„æœºå™¨äººä½å§¿ï¼Œ<span class="math inline">\(z\)</span>ä»£è¡¨æˆ‘ä»¬çš„è§‚æµ‹ã€‚è¿™é‡Œçš„è§‚æµ‹æ˜¯ä¸€ä¸ªå®½æ³›çš„å®šä¹‰ï¼Œè·¯æ ‡ï¼ˆlandmarkï¼‰å¯ä»¥æ˜¯ä¸€ç§è§‚æµ‹ï¼Œå›¾åƒç‰¹å¾ç‚¹ä¹Ÿå¯ä»¥æ˜¯ä¸€ç§è§‚æµ‹ï¼Œæ¿€å…‰é‡Œç¨‹è®¡æˆ–è€…è§†è§‰é‡Œç¨‹è®¡çš„ç»“æœä¹Ÿå¯ä»¥æ˜¯ä¸€ç§è§‚æµ‹ã€‚ <strong>æ³¨æ„</strong>ï¼šåº”è¯¥æ˜¯ç°æœ‰äº†æœºå™¨äººå½“å‰çš„ä½å§¿ï¼Œç„¶ååœ¨å½“å‰ä½å§¿ä¸‹å¯¹å‘¨å›´ç¯å¢ƒè¿›è¡Œè§‚æµ‹ã€‚ä¹Ÿå°±æ˜¯å½“å‰ä½å§¿æ˜¯ <strong><em>å› </em></strong>ï¼Œè§‚æµ‹æ˜¯ <strong><em>æœ</em></strong></p>
<p>æ ¹æ®è´å¶æ–¯å®šç†ï¼Œæœ‰ï¼š</p>
<p><span class="math display">\[
\begin{split}
p(x|z) &amp;= \frac{p(z|x)p(x)}{p(z)}\\
&amp;\propto p(z|x)p(x)
\end{split}
\]</span></p>
<p>ä¸Šè¿°å…¬å¼ç»“æœçš„ç¬¬ä¸€é¡¹ç§°ä¸º <strong><em>ä¼¼ç„¶</em></strong>ï¼ˆlikelihoodï¼‰ï¼Œç¬¬äºŒé¡¹æ˜¯æ˜¯ <strong><em>å…ˆéªŒ</em></strong>ï¼ˆpriorï¼‰ ç”¨æ–‡å­—è§£é‡Šä¸€ä¸‹å°±æ˜¯ï¼Œç›´æ¥æ±‚ä½å§¿çš„æœ€å¤§åéªŒæ¦‚ç‡æ˜¯å¾ˆå›°éš¾çš„ï¼Œä½†æ˜¯æ ¹æ®è´å¶æ–¯æ³•åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥è½¬æ¢ä¸ºæ±‚å–ä¼¼ç„¶å’Œå…ˆéªŒçš„ä¹˜ç§¯çš„æœ€å¤§ï¼Œå³ä¸‹å¼</p>
<p><span class="math display">\[
\begin{split}
\hat{x}_{MAP} &amp;= \underset{x}{\operatorname{argmax\ }}p(x|z)\\
&amp;= \underset{x}{\operatorname{argmax\ }}p(z|x)p(x)\\
&amp;\approx \underset{x}{\operatorname{argmax\ }}p(z|x)
\end{split}\tag{2}
\]</span></p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰æœºå™¨äººä½å§¿çš„å…ˆéªŒ<span class="math inline">\(p(x)\)</span>ï¼Œäºæ˜¯ï¼Œå…¬å¼ï¼ˆ2ï¼‰å¯ä»¥è¿‘ä¼¼æˆåªæ±‚å–<strong>æœ€å¤§ä¼¼ç„¶(MLE,Maximum LIkelihood Estimation)</strong></p>
<p><span class="math display">\[
\hat{x}_{MLE} = \underset{x}{\operatorname{argmax\ }}p(z|x)\tag{3}
\]</span></p>
<h3 id="mapä¸mleçš„è”ç³»">MAPä¸MLEçš„è”ç³»</h3>
<p>åœ¨ä¸Šæ–‡å…¬å¼ï¼ˆ2ï¼‰ä¸­æˆ‘ä»¬ç›´æ¥å¿½ç•¥äº†å…ˆéªŒé¡¹<span class="math inline">\(p(x)\)</span>ï¼Œå¹¶åœ¨æœ€å¤§åéªŒæ¦‚ç‡å’Œæœ€å¤§ä¼¼ç„¶ä¸¤è€…é—´ç”¨äº†çº¦ç­‰å·ï¼Œé‚£ä¹ˆè¿™ä¸¤è€…é—´æ˜¯å¦æœ‰ä»€ä¹ˆå…¶ä»–å…³ç³»å‘¢ï¼Ÿ</p>
<p><span class="math display">\[
\begin{split}
\hat{x}_{MAP}
&amp;= \underset{x}{\operatorname{argmax\ }}p(x|z)\\
&amp;= \underset{x}{\operatorname{argmax\ }} \ln p(x|z)\\
&amp;= \underset{x}{\operatorname{argmax\ }} \ln p(z|x)p(x)\\
&amp;= \underset{x}{\operatorname{argmax\ }} \ln p(z|x) + \ln p(x)\\
\end{split}
\]</span></p>
<p>å¦‚æœå½“å…ˆéªŒæ¦‚ç‡<span class="math inline">\(p(x)\)</span>æ˜¯ä¸€ä¸ªå‡åˆ†åˆ†å¸ƒçš„æ—¶å€™ï¼Œä¸Šå¼å°±ä¼šå˜æˆï¼š</p>
<p><span class="math display">\[
\begin{split}
\hat{x}_{MAP}
&amp;= \underset{x}{\operatorname{argmax\ }} \ln p(z|x) + \ln p(x)\\
&amp;= \underset{x}{\operatorname{argmax\ }} \ln p(z|x) + constant\\
&amp;= \underset{x}{\operatorname{argmax\ }} \ln p(z|x)
\end{split}
\]</span></p>
<p><strong>ä¹Ÿå°±æ˜¯è¯´MLPå®é™…ä¸Šæ˜¯MAPä¸­ï¼Œå°†å…ˆéªŒæ¦‚ç‡åšå‡åŒ€åˆ†å¸ƒå‡è®¾çš„ç‰¹æ®Šæƒ…å†µ</strong> ä¸Šé¢è¿™å¥è¯å°±æ˜¯è¯´ï¼Œåœ¨æ²¡æœ‰ä»»ä½•å…¶ä»–æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º<span class="math inline">\(x\)</span>å–ä»»ä½•å€¼çš„æ¦‚ç‡éƒ½ä¸€æ ·ã€‚</p>
<p>å½“ç„¶ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è®¤ä¸ºSLAMåç«¯çš„é—®é¢˜å°±æ˜¯åœ¨ç»™å®šè§‚æµ‹çš„æƒ…å†µä¸‹ï¼Œæ±‚å–ä½å§¿çš„ä¼¼ç„¶</p>
<h3 id="æœ€å¤§ä¼¼ç„¶çš„è´Ÿå¯¹æ•°å½¢å¼">æœ€å¤§ä¼¼ç„¶çš„è´Ÿå¯¹æ•°å½¢å¼</h3>
<p>å…¬å¼ï¼ˆ3ï¼‰ä¸­ï¼Œå¯ä»¥å¯¹ä¼˜åŒ–ç›®æ ‡å–è´Ÿå¯¹æ•°ï¼ˆå¯¹æ•°å‡½æ•°æ˜¯å•è°ƒå‡½æ•°ï¼Œæœ€å¤§åŒ–å•è°ƒé€’å¢å‡½æ•°ç­‰ä»·äºæœ€å°åŒ–é€’å‡å‡½æ•°ï¼‰ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<p><span class="math display">\[
\begin{split}
\hat{x}_{MLE}
&amp;= \underset{x}{\operatorname{argmax\ }}p(z|x)\\
&amp;= \underset{x}{\operatorname{argmin\ }} - \ln p(z|x)
\end{split}\tag{4}
\]</span></p>
<p>æˆ‘ä»¬åæ–‡éƒ½ä¼šé‡‡ç”¨å…¬å¼ï¼ˆ4ï¼‰è¿™ç§å½¢å¼</p>
<h2 id="ä»æœ€å¤§ä¼¼ç„¶ä¼°è®¡åˆ°éçº¿æ€§æœ€å°äºŒä¹˜é—®é¢˜">ä»æœ€å¤§ä¼¼ç„¶ä¼°è®¡åˆ°éçº¿æ€§æœ€å°äºŒä¹˜é—®é¢˜</h2>
<h3 id="é«˜æ–¯åˆ†å¸ƒçš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡å½¢å¼">é«˜æ–¯åˆ†å¸ƒçš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡å½¢å¼</h3>
<p>å› ä¸ºé«˜æ–¯åˆ†å¸ƒæœ‰å¾ˆå¤šä¼˜ç¾çš„æ€§è´¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨SLAMä¸­å¤§é‡åœ°å‡è®¾å„ç§å˜é‡ç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œè¿™ä¸€å°èŠ‚å…ˆæ¨å¯¼é«˜æ–¯åˆ†å¸ƒçš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„å½¢å¼ï¼Œæ–¹ä¾¿åé¢ç›´æ¥ä½¿ç”¨ã€‚ <strong>PS:è¿™éƒ¨åˆ†çš„æ ‡è®°æ²¡æœ‰ç”¨ç²—ä½“è¡¨ç¤ºï¼Œä½†æ˜¯è¦è®°ä½è¿™é‡Œçš„å˜é‡éƒ½æ˜¯å¤šç»´å˜é‡</strong></p>
<p>å¯¹äºä¸€ä¸ªä»»æ„é«˜ç»´é«˜æ–¯åˆ†å¸ƒï¼š<span class="math inline">\(x \sim \mathcal{N}(\mu,\Sigma)\)</span>ï¼Œæ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š</p>
<p><span class="math display">\[
p(x) = \frac{1}{\sqrt{(2\pi)^N det(\Sigma)}}\exp\big(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\big)
\]</span></p>
<p>å¯¹ä¸Šè¿°å–è´Ÿå¯¹æ•°ï¼Œå¯å¾—ï¼š</p>
<p><span class="math display">\[
-\ln(p(x)) = \frac{1}{2}\ln\big((2\pi)^N\det(\Sigma)\big) + \frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\tag{5}
\]</span></p>
<p>ç”±äºä¸Šè¿°ç¬¬ä¸€é¡¹ä¸<span class="math inline">\(x\)</span>æ— å…³ï¼Œäºæ˜¯åœ¨æ±‚æœ€å°åŒ–çš„æ—¶å€™ç¬¬ä¸€é¡¹å¯ä»¥å¿½ç•¥ã€‚ä¸Šè¿°ç¬¬äºŒé¡¹ä¸­ï¼Œ<span class="math inline">\(\Sigma^{-1}\)</span>å«åš <strong><em>ä¿¡æ¯çŸ©é˜µ</em></strong> ,ä¸ºåæ–¹å·®çš„å€’æ•°</p>
<p><span class="math display">\[
ä¿¡æ¯çŸ©é˜µ := \Sigma^{-1}
\]</span></p>
<h3 id="slamä¼˜åŒ–ç›®æ ‡çš„æœ€å°äºŒä¹˜å½¢å¼">SLAMä¼˜åŒ–ç›®æ ‡çš„æœ€å°äºŒä¹˜å½¢å¼</h3>
<p>ä»¤æœºå™¨äººå½“å‰æ—¶åˆ»çš„å§¿æ€ä¸º<span class="math inline">\(x\)</span>,è§‚æµ‹äºå§¿æ€ä¹‹é—´çš„å…³ç³»ä½¿ç”¨å‡½æ•°<span class="math inline">\(h(x)\)</span>è¡¨è¾¾ã€‚åˆ™ï¼Œå¯¹äºè§‚æµ‹<span class="math inline">\(z\)</span>ï¼Œæœ‰å¦‚ä¸‹è§‚æµ‹æ¨¡å‹ï¼š</p>
<p><span class="math display">\[
z = h(x) + v
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(v\)</span>ä¸ºå™ªå£°é¡¹ï¼Œæˆ‘ä»¬å‡è®¾å™ªå£°é¡¹æœä»å‡ä¸ºä¸º0ï¼Œæ–¹å·®ä¸º<span class="math inline">\(Q\)</span>çš„é«˜æ–¯åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯</p>
<p><span class="math display">\[
v \sim \mathcal{N}(h(x), Q)
\]</span></p>
<p>äºæ˜¯ï¼Œè€Œå¯ä»¥å¾—åˆ°ï¼Œåœ¨çŠ¶æ€<span class="math inline">\(x\)</span>å³å·²çŸ¥é“çš„æƒ…å†µä¸‹ï¼Œè§‚æµ‹<span class="math inline">\(z\)</span>çš„æ¡ä»¶æ¦‚ç‡ï¼ˆä¹Ÿå°±æ˜¯ä¼¼ç„¶ï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒ</p>
<p><span class="math display">\[
z \sim \mathcal{N}(h(x), Q)
\]</span></p>
<p>ä¸ºäº†æ±‚å¾—<span class="math inline">\(x\)</span>ï¼Œæ±‚æœ€å¤§ä¼¼ç„¶ï¼Œæ ¹æ®å…¬å¼ï¼ˆ5ï¼‰ï¼Œå¹¶å¿½ç•¥ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹çš„<span class="math inline">\(\frac{1}{2}\)</span>ç³»æ•°ï¼Œåˆ™ï¼š</p>
<p><span class="math display">\[
\begin{split}
\hat{x}_{MLE}
&amp;=\underset{x}{\operatorname{argmax\ }} p(z|x)\\
&amp;=\underset{x}{\operatorname{argmin\ }} -\ln p(z|x)\\
&amp;=\underset{x}{\operatorname{argmin\ }} (z-h(x))^T\Sigma^{-1}(z-h(x))
\end{split}\tag{6}
\]</span></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œå…¬å¼ï¼ˆ6ï¼‰æ˜¯ä¸€ä¸ªäºŒæ¬¡å‹ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¿¡æ¯çŸ©é˜µ<span class="math inline">\(\Sigma^{-1}\)</span>åŠ æƒåçš„æ¬§å¼è·ç¦»ï¼ˆäºŒèŒƒæ•°ï¼‰ã€‚å…¶ä¸­çš„<span class="math inline">\(h(x)\)</span>æˆ‘ä»¬å¯ä»¥ç§°ä¸ºè§‚æµ‹æ¨¡å‹ï¼Œæè¿°æœºå™¨äººä½å§¿å’Œè§‚æµ‹ä¹‹é—´çš„å…³ç³»ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰è§‚æµ‹ä¸æ¨¡å‹ä¹‹é—´çš„è¯¯å·®å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
e_{z} = z - h(x)
\]</span></p>
<p>åˆ™ï¼Œå…¬å¼ï¼ˆ6ï¼‰å¯ä»¥å†™æˆ</p>
<p><span class="math display">\[
\begin{split}
\hat{x}_{MLE}
&amp;= \underset{x}{\operatorname{argmin\ }}\big(z-h(x)\big)^T\Sigma^{-1}\big(z-h(x)\big)\\
&amp;= \underset{x}{\operatorname{argmin\ }}||e_z||^2_{\Sigma^{-1}}
\end{split}\tag{7}
\]</span></p>
<p>å…¬å¼ï¼ˆ7ï¼‰çš„<span class="math inline">\(\Sigma_{-1}\)</span>ä¸‹æ ‡æŒ‡ä½¿ç”¨ä¿¡æ¯çŸ©é˜µè¿›è¡ŒåŠ æƒ</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/04/19/sensors/AllanVariance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/19/sensors/AllanVariance/" class="post-title-link" itemprop="url">æƒ¯æ€§æµ‹é‡å•å…ƒAllanæ–¹å·®åˆ†æè¯¦è§£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-04-19 15:37:57" itemprop="dateCreated datePublished" datetime="2023-04-19T15:37:57+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-05-18 16:49:48" itemprop="dateModified" datetime="2023-05-18T16:49:48+08:00">2023-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BC%A0%E6%84%9F%E5%99%A8%E6%A0%87%E5%AE%9A/" itemprop="url" rel="index"><span itemprop="name">ä¼ æ„Ÿå™¨æ ‡å®š</span></a>
        </span>
    </span>

  
    <span id="/2023/04/19/sensors/AllanVariance/" class="post-meta-item leancloud_visitors" data-flag-title="æƒ¯æ€§æµ‹é‡å•å…ƒAllanæ–¹å·®åˆ†æè¯¦è§£" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="æƒ¯æ€§æµ‹é‡å•å…ƒAllanæ–¹å·®åˆ†æè¯¦è§£" href="/2023/04/19/sensors/AllanVariance/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::aa4c05f956521692fdd7a55fc75da757" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up?tab=repositories">Zeal's Github</a></li>
</ul>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>åŸæœ¬ä»¥ä¸ºAllanæ–¹å·®åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•çš„æ–¹å·®è®¡ç®—æ–¹æ³•ï¼Œä½†æ˜¯ç»è¿‡ä¸¤å¤©çš„å„ç§æ¢ç´¢å’Œèµ„æ–™å­¦ä¹ ï¼Œå‘ç°è¿™ç©æ„çš„åŸç†è¿œæ¯”æƒ³è±¡ä¸­çš„å¤æ‚ã€‚è¯¦ç»†çš„å…¬å¼æ¨å¯¼éœ€è¦è®¾è®¡åˆ°éšæœºä¿¡å·çš„é¢‘è°±åˆ†æã€IMUå„ç§è¯¯å·®æ¨¡å‹ç­‰å†…å®¹ã€‚å¹¶ä¸”ï¼ŒAllanæ–¹å·®ä¸€å¼€å§‹ç”¨æ¥åˆ†æåŸå­é’Ÿæ™¶ä½“æŒ¯è¡é¢‘ç‡çš„è¯¯å·®åˆ†æï¼Œåç»­è¿™ç§åˆ†ææ–¹æ³•è¢«ç”¨åˆ°IMUçš„è¯¯å·®åˆ†æï¼Œå¹¶ä¸”IEEEä¹Ÿåˆ¶è®¢äº†ç›¸åº”æ ‡å‡†ï¼ˆè§<a target="_blank" rel="noopener" href="http://www.i2nav.com/ueditor/jsp/upload/file/20211008/1633700373874080110.pdf">å‚è€ƒèµ„æ–™1</a>ï¼‰ï¼Œè¿™ä¸€ç³»åˆ—çš„å‘å±•è¿‡ç¨‹å…¶å®å¾ˆé•¿ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸åŒçš„å®šä¹‰ã€‚ä»¥ä¸Šç§ç§ï¼Œè®©è¯»è€…æ”¾å¼ƒäº†æ‘¸æ¸…Allanæ–¹å·®çš„è¯¦ç»†æ¥é¾™å»è„‰å’Œå…¬å¼æ¨å¯¼ï¼Œæ¯•ç«Ÿï¼Œå·¥ç¨‹å¸ˆå’Œæ•°å­¦å®¶è¿˜æ˜¯æœ‰åŒºåˆ«çš„â€¦â€¦ä½†æ˜¯å…³äºAllanæ–¹å·®çš„è§£é‡Šå’Œåº”ç”¨ç½‘ä¸Šçš„åšæ–‡ä¹Ÿéƒ½ä¸å¤Ÿå…¨é¢ï¼Œå•çœ‹æŸä¸€ç¯‡æ–‡ç« å¾ˆéš¾è·å–å¯¹Allanæ–¹å·®çš„ç›´è§‚ç†è§£ï¼ˆæ²¡æœ‰æ‰¾åˆ°ä¸€ç¯‡å¾ˆå¥½çš„æ–‡ç« èƒ½å¤Ÿè¯´æ˜Allanæ–¹å·®çš„å®šä¹‰å’ŒåŒå¯¹æ•°æ›²çº¿ä¸åŒæ–œç‡æ®µå¯¹åº”çš„å™ªå£°é¡¹æ˜¯æ€ä¹ˆæ¥çš„ï¼‰ã€‚</p>
<p>æœ¬æ–‡å¯¹ä»¥ä¸‹å†…å®¹åšäº†æ¢³ç†ï¼š</p>
<ol type="1">
<li>IMUçš„å™ªå£°é¡¹åŠå…¶å«ä¹‰</li>
<li>Allanæ–¹å·®çš„å®šä¹‰å’Œæ¨å¯¼</li>
<li>å¯¹é™€èºä»ªçš„æ•°æ®è®¡ç®—Allanæ–¹å·®çš„æ–¹æ³•</li>
<li>Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿çš„å«ä¹‰å’Œåˆ†æ</li>
<li>å…³é”®æ¦‚å¿µè§£è¯»</li>
</ol>
<p><code>PS: ç¬”è€…æ°´å¹³æœ‰é™ï¼Œæœ¬æ–‡åªæ˜¯ç¬”è€…å¯¹Allanæ–¹å·®å­¦ä¹ çš„æ€»ç»“ï¼Œå¹¶ä¸æ˜¯ä¸€ç¯‡ä¸¥æ ¼çš„ç†è®ºæ¨å¯¼æ–‡ç« </code></p>
<h2 id="æƒ¯æ€§æµ‹é‡å•å…ƒimuinertial-measuremnt-unitè¯¯å·®é¡¹">æƒ¯æ€§æµ‹é‡å•å…ƒï¼ˆIMUï¼šInertial Measuremnt Unitï¼‰è¯¯å·®é¡¹</h2>
<p>è¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://hexagondownloads.blob.core.windows.net/public/Novatel/assets/Documents/Bulletins/APN064/APN064.pdf">å‚è€ƒèµ„æ–™2</a></p>
<img src="./imgs/01-imu-axis.png" title="fig:" alt="IMUæ¨¡å‹" />
<center>
IMUæ¨¡å‹
</center>
<p>IMUçš„è¾“å‡ºå¯ä»¥çœ‹ä¸Šå›¾ï¼Œå…¸å‹çš„å…­è½´IMUè¾“å‡ºä¸‰ä¸ªè½´çš„åŠ é€Ÿåº¦å’Œä¸‰ä¸ªè½´çš„è§’é€Ÿåº¦ã€‚å¯¹åŠ é€Ÿåº¦åšç§¯åˆ†å¯ä»¥å¾—åˆ°é€Ÿåº¦ã€å†åšä¸€æ¬¡ç§¯åˆ†å¯ä»¥å¾—åˆ°ä½ç§»ï¼›å¯¹è§’é€Ÿåº¦ç§¯åˆ†å¯ä»¥å¾—åˆ°è§’åº¦ã€‚</p>
<p>ç”µå­å™¨ä»¶è¾“å‡ºéƒ½ä¼šæœ‰è¯¯å·®ï¼Œåˆå«å™ªå£°ã€‚IMUçš„å™ªå£°é¡¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<img src="./imgs/02-imu-errors.png" alt="IMUè¯¯å·®ç¤ºæ„å›¾" /> <cneter>IMUè¯¯å·®ç¤ºæ„å›¾
</center>
<ol type="1">
<li>é›¶åï¼ˆBiasï¼‰ï¼Œå•ä½<code>deg/hr,m/s^2</code> é›¶åè¿™ä¸ªè¯ä¼¼ä¹ä¸å¤ªå‡†ç¡®ï¼Œå› ä¸ºåœ¨éé›¶è¾“å‡ºæ—¶ä¹Ÿä¼šæœ‰åå·®ã€‚å¦‚æœæŠŠIMUçš„è¾“å‡ºå½“ä½œä¸€ä¸ªéµå¾ªé«˜æ–¯åˆ†å¸ƒçš„éšæœºä¿¡å·ï¼Œåœ¨é™æ­¢æ—¶è¯¥éšæœºä¿¡å·çš„å‡å€¼åº”è¯¥æ˜¯é›¶ï¼Œä½†æ˜¯ç”±äºbiasï¼Œè¯¥å‡å€¼å¹¶ä¸æ˜¯0ã€‚è§ä¸Šé¢çš„<code>IMUè¯¯å·®ç¤ºæ„å›¾</code>å¯ä»¥è¾ƒå¥½åœ°ç†è§£ã€‚è¦æ³¨æ„çš„æ˜¯é›¶åæ˜¯ä¼šéšç€æ—¶é—´æ”¹å˜çš„ï¼Œå› æ­¤åœ¨å¾ˆå¤šå¡å°”æ›¼æ»¤æ³¢æ¨¡å‹ä¸­ä¼šæŠŠBiaså½“ä½œä¸€ä¸ªçŠ¶æ€é‡ã€‚</li>
<li>é›¶åå¯é‡å¤æ€§ï¼ˆBias Repeatabilityï¼‰ï¼Œå•ä½<code>deg/hr,m/s^2</code> æ¯æ¬¡ä¸Šç”µé›¶åçš„ç¨³å®šç¨‹åº¦ã€‚</li>
<li>é›¶åç¨³å®šæ€§ï¼ˆBias Stabilityï¼‰ï¼Œå•ä½<code>deg/hr/hr,m/s^2/hr</code> æœ‰æ—¶ä¹Ÿå«é›¶åä¸ç¨³å®šæ€§ï¼ˆBias Instabilityï¼‰ã€‚æè¿°é›¶åçš„ç¨³å®šç¨‹åº¦ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºé›¶åçš„å™ªå£°ã€‚ï¼ˆæœ‰äº›æ–‡ç« ä¹Ÿä¼šå«åšé›¶åçš„è§’åº¦éšæœºæ¸¸èµ°ï¼‰ã€‚</li>
<li>æ¯”ä¾‹å› å­ï¼ˆScale Factorï¼‰ æ¯”å¦‚æ¯”ä¾‹å› å­æ˜¯1.2,é‚£ä¹ˆå½“çœŸå€¼æ˜¯10m/s<sup>2çš„æ—¶å€™ï¼ŒIMUçš„è¾“å‡ºå¯èƒ½æ˜¯12m/s</sup>2ã€‚</li>
<li>è§’åº¦éšæœºæ¸¸èµ°ï¼ˆARW:Angle Random Walkï¼‰ï¼Œå•ä½ï¼š<span class="math inline">\(deg/\sqrt{hr}\)</span>,<span class="math inline">\(m/s/\sqrt{hr}\)</span> è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒéš¾ç†è§£çš„é‡ï¼Œå®é™…ä¸Šç¬”è€…ä¹Ÿæ²¡æ³•å®Œå…¨ç†è§£ã€‚ç®€å•ç†è§£å°±æ˜¯å½“ä¿¡å·å åŠ ä¸Šä¸€ä¸ªç™½å™ªå£°ä¹‹åï¼Œå¯¹è¯¥ä¿¡å·çš„ç§¯åˆ†å°±åŒ…å«äº†ç™½å™ªå£°çš„ç§¯åˆ†ï¼Œç™½å™ªå£°çš„ç§¯åˆ†ä¸å†æ˜¯ä¸€ä¸ªç™½å™ªå£°ï¼Œè€Œæ˜¯ä¸€ä¸ªé©¬å°”ç§‘å¤«æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶çš„å™ªå£°æ˜¯ä¸Šä¸€æ—¶åˆ»çš„å™ªå£°åŠ ä¸Šä¸€ä¸ªç™½å™ªå£°ã€‚é‚£ä¹ˆæ”¾åœ¨è¿™é‡Œï¼Œå¯¹äºé™€èºä»ªçš„è¾“å‡ºï¼ˆè§’é€Ÿåº¦ï¼‰ä¸€èˆ¬æ˜¯ç”¨æ¥åšç§¯åˆ†å¾—åˆ°è§’åº¦ï¼Œé‚£ä¹ˆè§’é€Ÿåº¦çš„ç™½å™ªå£°çš„ç§¯åˆ†å°±ä¼šå¾—åˆ°è§’åº¦çš„åå·®ï¼Œå› æ­¤å«åšè§’åº¦éšæœºæ¸¸èµ°ã€‚æœ‰æ—¶å€™è§’åº¦éšæœºæ¸¸èµ°çš„å€¼åˆå«åšç™½å™ªå£°å¼ºåº¦ï¼Œæ¯”å¦‚åœ¨<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/IMU-Noise-Model">kalibr:IMU-Noise-Model</a>ä¸­å°±æœ‰è¿™æ ·çš„æè¿°ï¼š &gt; White Noise Terms: The parameters for the "white noise" processes are often specified in the datasheet of the sensor manufacturer. A bit misleading, they are commonly denoted as angular random walk in case of the gyro, and velocity random walk for the accel</li>
<li>é€Ÿç‡éšæœºæ¸¸èµ°ï¼ˆRRW:Rate Random Walkï¼‰ ä¸è§’åº¦éšæœºæ¸¸èµ°ç±»ä¼¼ï¼Œé€Ÿç‡éšæœºæ¸¸èµ°å¯ä»¥çœ‹ä½œæ˜¯è§’åŠ é€Ÿåº¦çš„è¯¯å·®ç§¯åˆ†å¯¼è‡´çš„è§’é€Ÿåº¦çš„è¯¯å·®ã€‚é€Ÿç‡éšæœºæ¸¸èµ°å¯¹åº”çš„æ˜¯é™€èºä»ªåœ¨é•¿æ—¶é—´ä¸‹æ‰ä¼šå‘ç”Ÿæ”¹å˜çš„è¯¯å·®é¡¹ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥è¿‘ä¼¼å½“ä½œ<code>Bias</code>ä½¿ç”¨ã€‚åœ¨<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/IMU-Noise-Model">kalibr:IMU-Noise-Model</a>ä¸­ä½¿ç”¨é€Ÿç‡éšæœºæ¸¸èµ°ç³»æ•°å½“ä½œé›¶åå‚æ•°ã€‚</li>
</ol>
<h3 id="è§’åº¦éšæœºæ¸¸èµ°arwangle-random-walkv.s.-è§’é€Ÿç‡éšæœºæ¸¸èµ°arrw">è§’åº¦éšæœºæ¸¸èµ°ï¼ˆARW:Angle Random Walkï¼‰v.s. è§’é€Ÿç‡éšæœºæ¸¸èµ°ï¼ˆARRWï¼‰</h3>
<p>è¿™ä¸ªå¾ˆå®¹æ˜“å¼„æ··æ·†çš„ä¸€ä¸ªæ¦‚å¿µã€‚å¯¹åº”åˆ°åŠ é€Ÿåº¦è®¡ä¸Šåº”è¯¥å«é€Ÿåº¦éšæœºæ¸¸èµ°å’ŒåŠ é€Ÿåº¦éšæœºæ¸¸èµ°ã€‚å› ä¸ºè®²è§£Allanæ–¹å·®çš„æ—¶å€™ä¸€èˆ¬ä¼šä»¥é™€èºä»ªä¸ºç¤ºä¾‹ï¼Œå› æ­¤åœ¨æ–‡ä¸­å¯èƒ½åªå‡ºç°è§’åº¦éšæœºæ¸¸èµ°å’Œè§’é€Ÿç‡éšæœºæ¸¸èµ°ã€‚è§’é€Ÿç‡éšæœºæ¸¸èµ°åˆä¼šè¢«ç®€å†™æˆé€Ÿç‡éšæœºæ¸¸èµ°ï¼Œæ¯”å¦‚å‚è€ƒèµ„æ–™1çš„IEEEæ ‡å‡†ã€‚ä¸‹é¢è¿™æ®µç™¾åº¦ç™¾ç§‘çš„æè¿°åè€Œæ¸…æ™°ï¼š &gt; è§’é€Ÿç‡ä¼ æ„Ÿå™¨çš„æ€§èƒ½å‚æ•°ä¸­åŒ…å«è§’åº¦éšæœºæ¸¸èµ°ï¼ˆARWï¼‰å’Œè§’é€Ÿç‡éšæœºæ¸¸èµ°ï¼ˆARRWï¼‰ï¼Œå‰è€…åæ˜ äº†è§’é€Ÿç‡ä¿¡å·ä¸­ç™½å™ªå£°çš„ç‰¹æ€§ï¼Œç§¯åˆ†åè¡¨ç°ä¸ºè§’åº¦éšæœºæ¸¸èµ°ï¼›åè€…ä¸ºè§’é€Ÿç‡æœ¬èº«çš„éšæœºæ¸¸èµ°ï¼Œå¯è®¤ä¸ºæ˜¯è§’åŠ é€Ÿåº¦ç™½å™ªå£°çš„ç§¯åˆ†ç»“æœã€‚</p>
<h2 id="allanæ–¹å·®">Allanæ–¹å·®</h2>
<p>Allanæ–¹å·®åˆå«é˜¿ä¼¦æ–¹å·®ï¼Œå¯ä»¥ç”¨Allanæ–¹å·®ç”¨æ¥æè¿°ç‰©ç†å™¨ä»¶çš„ä¸åŒå™ªå£°å‚æ•°ã€‚Allanæ–¹å·®ç›¸æ¯”äºæ™®é€šçš„æ–¹å·®å…·æœ‰æ›´å¥½çš„æè¿°é•¿æ—¶é—´è¯¯å·®çš„ä¼˜åŠ¿ï¼ˆå…·ä½“ä¹Ÿä¸å¤ªæ¸…æ¥šï¼‰ã€‚Allanæ–¹å·®ç°åœ¨å¥½åƒåŸºæœ¬è¢«ç”¨æ¥å½“ä½œIMUå™ªå£°æ ‡å®šçš„æ ‡å‡†æ–¹æ³•äº†ã€‚</p>
<h3 id="æ•°æ®æ–¹å·®">æ•°æ®æ–¹å·®</h3>
<figure>
<img src="./imgs/03-variance.png" alt="" /><figcaption>æ•°æ®æ–¹å·®åŠæ ‡å‡†å·®è®¡ç®—æ–¹æ³•</figcaption>
</figure>
<p>ï¼ˆä¸Šå›¾å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="http://www.i2nav.com/index/newListDetail_zw?newskind_id=13a8654e060c40c69e5f3d4c13069078&amp;newsinfo_id=c2bb31af75944e5ab665dc23b60b5fba">æ–°æ‰‹å…¥é—¨ç³»åˆ—3â€”â€”Allanæ–¹å·®åˆ†ææ–¹æ³•çš„ç›´è§‚ç†è§£</a>ï¼‰</p>
<p>ç³»æ•°<span class="math inline">\(\frac{1}{N-1}\)</span>ä½¿å¾—è¿™æ ·è®¡ç®—å‡ºæ¥çš„æ–¹å·®æ˜¯æ•°æ®æ–¹å·®çš„æ— åä¼°è®¡ï¼ˆæ¦‚ç‡ç»Ÿè®¡åŸç†ï¼‰ã€‚</p>
<h3 id="å¯¹ä¸åŒæ—¶é—´å°ºåº¦ä¸Šçš„è¯¯å·®åˆ»ç”»">å¯¹ä¸åŒæ—¶é—´å°ºåº¦ä¸Šçš„è¯¯å·®åˆ»ç”»</h3>
<p>ä¸Šé¢çš„æ•°æ®æ–¹å·®è®¡ç®—æ–¹æ³•å¯¹æ•°æ®çš„æ•´ä¸ªåºåˆ—è®¡ç®—è¯¯å·®æ°´å¹³ï¼Œæ— æ³•ç»†åˆ†å‡ºä¸åŒæ—¶é—´å°ºåº¦ä¸Šçš„è¯¯å·®æ³¢åŠ¨æƒ…å†µã€‚ä¸ºäº†èƒ½å¤Ÿåˆ»ç”»ä¸åŒæ—¶é—´å‘¨æœŸä¸‹æ•°æ®çš„æ³¢åŠ¨æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¯¹æ•°æ®åˆ†å—ï¼Œå¯¹æ¯å—æ•°æ®å–å¹³å‡ä½œä¸ºè¯¥å—æ•°æ®çš„ä»£è¡¨ã€‚å‡è®¾åŸå§‹æ•°æ®çš„é‡‡æ ·æ—¶é—´æ˜¯<span class="math inline">\(\tau_0\)</span>ï¼Œæ¯3ä¸ªæ•°æ®åˆ†æˆä¸€å—ï¼Œåˆ™æ¯å—çš„é—´éš”æ—¶é—´<span class="math inline">\(\tau = 3\tau_0\)</span>ã€‚åˆ†å—ä¹‹åï¼Œæˆ‘ä»¬å†å°†<span class="math inline">\(M\)</span>ä¸ªæ•°æ®å—è®¡ç®—æ–¹å·®ï¼Œæœ€åæ±‚è¿™ä¸ªæ–¹å·®çš„æ•°å­¦æœŸæœ›ï¼Œä½œä¸ºæˆ‘ä»¬æœ€åçš„æ–¹å·®</p>
<figure>
<img src="./imgs/04-general-covariance.png" alt="" /><figcaption>é€šç”¨æ ·æœ¬æ–¹å·®è®¡ç®—æ–¹æ³•</figcaption>
</figure>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
\sigma^2_{g}(M,\tau)
&amp;=&amp;
&lt;\sigma^2(M,\tau)&gt;\\
&amp;=&amp;
&lt;\frac{1}{M-1}\sum^M_{i=1}\big(\bar{y}_i-\frac{1}{M}\sum^M_{j=1}\bar{y}_j\big)^2&gt;\\
\end{array}
\end{split}\tag{1}
\]</span></p>
<p>ä¸Šå¼ä¸­<span class="math inline">\(&lt;\cdot&gt;\)</span>è¡¨ç¤ºæ±‚ç»Ÿè®¡å¹³å‡ï¼ˆæœŸæœ›ï¼‰</p>
<h3 id="allanæ–¹å·®å®šä¹‰">Allanæ–¹å·®å®šä¹‰</h3>
<p>Allanæ–¹å·®æ˜¯ä¸Šè¿°é€šç”¨æ ·æœ¬æ–¹å·®åˆ†æåœ¨<span class="math inline">\(M=2\)</span>æ—¶çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œä¹Ÿå°±æ˜¯åœ¨å…¬å¼ï¼ˆ1ï¼‰ä¸­ä»¤<span class="math inline">\(M=2\)</span></p>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
\sigma^2(\tau)
&amp;=&amp;
&lt;\sigma^2(2,\tau)&gt;\\
&amp;=&amp;
&lt;\sum^2_{i=1}\big(\bar{y}_i-\frac{1}{2}\sum^2_{j=1}\bar{y}_j\big)^2&gt;\\
&amp;=&amp;
&lt;\frac{1}{2}(\bar{y}_2-\bar{y}_1)^2&gt;\\
&amp;=&amp;
\frac{1}{2}&lt;(\bar{y}_2-\bar{y}_1)^2&gt;
\end{array}
\end{split}\tag{2}
\]</span></p>
<p>æ³¨æ„ï¼ŒAllanæ–¹å·®æ˜¯<span class="math inline">\(\tau\)</span>çš„å‡½æ•°</p>
<figure>
<img src="./imgs/05-allan-covariance.png" alt="" /><figcaption>Allanæ–¹å·®å®šä¹‰</figcaption>
</figure>
<h3 id="è§’é€Ÿåº¦çš„allanæ–¹å·®è®¡ç®—">è§’é€Ÿåº¦çš„Allanæ–¹å·®è®¡ç®—</h3>
<p>è¿™é‡Œåªæ¨å¯¼ä¸€ç§æ–¹å¼ï¼Œæ ¹æ®<a target="_blank" rel="noopener" href="http://www.i2nav.com/ueditor/jsp/upload/file/20211008/1633700373874080110.pdf">IEEE Standard</a></p>
<p>ä»¤é™€èºä»ªçš„è§’åº¦è¾“å‡ºä¸º<span class="math inline">\(\Omega(t^\prime)\)</span>ï¼Œåˆ™è§’åº¦ä¸º</p>
<p><span class="math display">\[
\theta(t)=\int^t\Omega(t^\prime)dt^\prime
\]</span></p>
<p>å¯¹äºç¦»æ•£æ—¶é—´å½¢å¼ï¼Œæ—¶é—´ç‚¹<span class="math inline">\(t=k\tau_0,k=1,2,3,...,N\)</span>ã€‚å…¶ä¸­<span class="math inline">\(\tau_0\)</span>æ˜¯é™€èºä»ªçš„è¾“å‡ºæ—¶é—´é—´éš”ï¼Œ<span class="math inline">\(N\)</span>ä¸ºæ€»ä½“æ ·æœ¬æ•°é‡ã€‚åˆ™ï¼Œåœ¨æ—¶é—´æ®µ<span class="math inline">\(t_k\)</span>åˆ°<span class="math inline">\(t_k+\tau\)</span>ä¹‹é—´ï¼Œè§’é€Ÿåº¦çš„å¹³å‡å€¼æ˜¯ï¼š</p>
<p><span class="math display">\[
\bar{\Omega}_k(\tau)=\frac{\theta_{k+m}-\theta_k}{\tau}\tag{3}
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(\tau=m\tau_0\)</span></p>
<p>å°†å…¬å¼ï¼ˆ3ï¼‰å¸¦å…¥ä¸Šæ–‡Allanæ–¹å·®çš„å®šä¹‰å…¬å¼ï¼ˆ2ï¼‰ä¸­å¯ä»¥å¾—åˆ°ï¼š</p>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
\sigma^2(\tau)
&amp;=&amp;
\frac{1}{2}&lt;(\bar{\Omega }_{k+m}-\bar{\Omega }_k)^2&gt;\\
&amp;=&amp;
\frac{1}{2\tau^2}&lt;(\theta_{k+2m}-2\theta_{k+m}+\theta_k)^2&gt;
\end{array}
\end{split}\tag{4}
\]</span></p>
<p>å°†å…¬å¼ï¼ˆ4ï¼‰çš„æœŸæœ›ä»£æ›¿ä¸ºåœ¨æ•´ä¸ªæ•°æ®æ ·æœ¬ï¼ˆæ•°é‡ä¸ºNï¼‰ä¸Šæ±‚å¹³å‡ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
\sigma^2(\tau)
&amp;=&amp;
\frac{1}{2\tau^2(N-2m)}\sum^{N-2m}_{k=1}(\theta_{k+2m}-2\theta_{k+m}+\theta_k)^2
\end{array}
\end{split}\tag{5}
\]</span></p>
<h3 id="é‡å åˆ†æ®µæ³•è®¡ç®—allanæ–¹å·®">é‡å åˆ†æ®µæ³•è®¡ç®—Allanæ–¹å·®</h3>
<p>è¿™éƒ¨åˆ†ä¸»è¦å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://telesens.co/wp-content/uploads/2017/05/AllanVariance5087-1.pdf">Allan Variance: Noise Analysis for Gyroscopes</a> åœ¨å…¬å¼ï¼ˆ5ï¼‰ä¸­ï¼Œå¯¹æ¯<span class="math inline">\(m\)</span>ä¸ªåŸå§‹æ•°æ®ä½œä¸ºä¸€æ®µã€‚åˆ‡å‰²æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œåœ¨å›¾<code>Allanæ–¹å·®å®šä¹‰</code>ä¸­ï¼Œæ¯æ®µæ•°æ®éƒ½ä¸é‡å ã€‚å¦ä¸€ç§åˆ†å‰²æ–¹æ³•æ˜¯è®©æ¯æ®µæ•°æ®éƒ½é‡å ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure>
<img src="./imgs/06-overlapping-sample.png" alt="" /><figcaption>é‡å é‡‡æ ·è®¡ç®—Allanæ–¹å·®</figcaption>
</figure>
<p>ä¸Šå›¾ä¸­<span class="math inline">\(m=3\)</span>ï¼Œä¹Ÿå°±æ˜¯æ¯4ä¸ªåŸå§‹æ•°æ®ä½œä¸ºä¸€ç»„ï¼Œç»„ä¸ç»„ä¹‹å‰ç›¸å·®<span class="math inline">\(\tau_0\)</span>é•¿åº¦ã€‚</p>
<p>Allanæ–¹å·®çš„è®¡ç®—æ–¹å¼ä¸å…¬å¼ï¼ˆ5ï¼‰ä¿æŒä¸€è‡´ã€‚</p>
<h2 id="allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿">Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿</h2>
<p>æ ¹æ®å…¬å¼ï¼ˆ5ï¼‰ï¼ŒAllanæ–¹å·®æ˜¯æ—¶é—´å‘¨æœŸ<span class="math inline">\(\tau=m\tau_0\)</span>çš„å‡½æ•°ï¼Œæˆ‘ä»¬æ ¹æ®ä¸åŒçš„<span class="math inline">\(\tau\)</span>ï¼Œè®¡ç®—å‡ºå¯¹åº”çš„Allanæ–¹å·®ï¼Œå¹¶å°†<span class="math inline">\(log_{10}(\tau)\)</span>ä½œä¸ºxï¼Œ<span class="math inline">\(log_{10}(\sigma(\tau))\)</span>ä½œä¸ºyï¼Œç”»å‡ºæ›²çº¿ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<figure>
<img src="./imgs/07-allan-log-curve.png" alt="" /><figcaption>Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿</figcaption>
</figure>
<p>æ³¨æ„ï¼Œyè½´æ˜¯Allanæ–¹å·®çš„å¼€æ ¹ï¼Œåˆå«Allan</p>
<p>Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿å¯ä»¥ç”¨ä¸åŒæ–œç‡çš„ç›´çº¿æ‹Ÿåˆï¼Œä¸åŒæ–œç‡éƒ¨åˆ†çš„ç›´çº¿ä»£è¡¨ä¸åŒçš„å«ä¹‰ã€‚</p>
<p>è¿™é‡Œè®²è¿°ä¸€ä¸‹å¦‚ä½•ä»åŒå¯¹æ•°æ›²çº¿åˆ†æä¿¡å·çš„ä¸åŒè¯¯å·®æˆåˆ†ï¼ˆä»¥é™€èºä»ªä¸ºä¾‹ï¼‰</p>
<h3 id="è§’åº¦éšæœºæ¸¸èµ°ç™½å™ªå£°å¼ºåº¦">è§’åº¦éšæœºæ¸¸èµ°/ç™½å™ªå£°å¼ºåº¦</h3>
<p>è§’åº¦éšæœºæ¸¸èµ°å¯¹åº”åˆ°åŒå¯¹æ•°æ›²çº¿ä¸­æ–œç‡ä¸º<span class="math inline">\(-\frac{1}{2}\)</span>çš„ç›´çº¿ï¼Œå–å€¼å¯ä»¥ç›´æ¥è¯»å–<span class="math inline">\(\tau=1\)</span>å¤„çš„å€¼ã€‚</p>
<h3 id="é›¶åä¸ç¨³å®šæ€§">é›¶åä¸ç¨³å®šæ€§</h3>
<p>é›¶åä¸ç¨³å®šæ€§å¯¹åº”åŒå¯¹æ•°æ›²çº¿ä¸­æ–œç‡ä¸º0çš„ç›´çº¿ï¼Œä¹Ÿå°±æ˜¯åŒå¯¹æ•°æ›²çº¿ä¸­æœ€å°å€¼ä½ç½®ã€‚</p>
<h3 id="é€Ÿç‡éšæœºæ¸¸èµ°">é€Ÿç‡éšæœºæ¸¸èµ°</h3>
<p>é€Ÿç‡éšæœºæ¸¸èµ°å¯¹åº”åŒå¯¹æ•°æ›²çº¿ä¸­æ–œç‡ä¸º<span class="math inline">\(\frac{1}{2}\)</span>çš„ç›´çº¿ï¼Œå–å€¼æ—¶å–è¯¥ç›´çº¿ä¸<span class="math inline">\(\tau=3\)</span>çš„äº¤ç‚¹ã€‚</p>
<p>ä¸Šé¢ä¸‰ä¸ªè¯¯å·®é¡¹æ˜¯æˆ‘ä»¬ç”¨å¾—æ¯”è¾ƒå¤šçš„è¯¯å·®é¡¹ï¼Œç”»æˆå›¾å¦‚ä¸‹ï¼š</p>
<figure>
<img src="./imgs/08-display-of-errors-in-curve.png" alt="" /><figcaption>ä¸‰ç§è¯¯å·®é¡¹åœ¨åŒå¯¹æ•°æ›²çº¿ä¸­çš„ç¤ºæ„å›¾</figcaption>
</figure>
<h3 id="ä¸ºä»€ä¹ˆä¸åŒçš„æ–œç‡å¯¹åº”ä¸åŒçš„è¯¯å·®é¡¹">ä¸ºä»€ä¹ˆä¸åŒçš„æ–œç‡å¯¹åº”ä¸åŒçš„è¯¯å·®é¡¹ï¼Ÿï¼Ÿ</h3>
<p>è¯´å®è¯ï¼Œç¬”è€…å¯¹è¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸€çŸ¥åŠè§£ï¼Œè¯´å®è¯ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å®Œå…¨å¼„æ˜ç™½ï¼Œé‡Œé¢æ¶‰åŠåˆ°æ—¶åŸŸä¿¡å·åˆ†æå¤ªå¤šåŸºç¡€çŸ¥è¯†äº†ã€‚è¿™é‡Œæ ¹æ®<a target="_blank" rel="noopener" href="http://www.i2nav.com/ueditor/jsp/upload/file/20211008/1633700373874080110.pdf">IEEE Standard</a>é‡Œä¸€äº›å†…å®¹æ ¹æ®è‡ªå·±çš„ç†è§£ç®€å•è®²è¿°ä¸€ä¸‹ã€‚ å™ªå£°çš„åŒè¾¹åŠŸç‡è°±å¯†åº¦(PSD:Power Sepctral Density)ä¸Allanæ–¹å·®æœ‰å¦‚ä¸‹å…³ç³»ï¼š</p>
<figure>
<img src="./imgs/09-psd-2-allan.png" alt="" /><figcaption>åŠŸç‡è°±å¯†åº¦ä¸Allanæ–¹å·®çš„å…³ç³»</figcaption>
</figure>
<p>ä¸Šå¼ä¸­å¯ä»¥çœ‹ä½œAllanæ–¹å·®æ˜¯å™ªå£°èƒ½é‡ç»è¿‡ä¸€ä¸ª<span class="math inline">\(sin^4(x)/(x)^2\)</span>ä¸ºè½¬ç§»å‡½æ•°çš„æ»¤æ³¢å™¨ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç”±Allanæ–¹å·®è®¡ç®—å†³å®šçš„ã€‚è¿™ä¸ªæ»¤æ³¢å™¨çš„å¸¦å®½è·Ÿ<span class="math inline">\(\tau\)</span>æœ‰å…³ï¼Œå› æ­¤ï¼Œä¸åŒçš„<span class="math inline">\(\tau\)</span>å¯¹åº”çš„Allanæ–¹å·®æ¥åˆ†æå™ªå£°çš„ä¸åŒé¢‘æ®µç‰¹æ€§ã€‚</p>
<p>ä»¥ç™½å™ªå£°ä¸ºä¾‹ï¼Œå…¶åŠŸç‡è°±å¯†åº¦ä¸º</p>
<figure>
<img src="./imgs/10-white-noise-psd.png" alt="" /><figcaption>ç™½å™ªå£°PSD</figcaption>
</figure>
<p>å°†å…¶å¸¦å…¥<code>åŠŸç‡è°±å¯†åº¦ä¸Allanæ–¹å·®å…³ç³»</code>çš„å…¬å¼ä¸­ï¼Œå¹¶è¿›è¡Œå…¬å¼ä¸­çš„ç§¯åˆ†ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœ:</p>
<figure>
<img src="./imgs/11-white-noise-psd-integrated.png" alt="" /><figcaption>ç™½å™ªå£°PSDè½¬æ¢æˆAllanæ–¹å·®</figcaption>
</figure>
<p>å¯¹ä¸Šå¼ <span class="math inline">\(\sigma^2\big(\tau\big)=\frac{N^2}{\tau}\)</span> å¼€æ ¹åæ±‚å¯¹æ•°åå¯ä»¥å¾—åˆ°</p>
<p><span class="math display">\[
log(\sigma(\tau)) = N - \frac{1}{2}log(\tau)
\]</span></p>
<p>åˆšå¥½å¯ä»¥å¾—åˆ°ä¸€æ¡æ–œç‡ä¸º<span class="math inline">\(-\frac{1}{2}\)</span>çš„ç›´çº¿ï¼Œä¸”å½“<span class="math inline">\(\tau=1\)</span>çš„æ—¶å€™å¯ä»¥å¾—åˆ°<span class="math inline">\(N\)</span>ã€‚è¿™ä¹Ÿå¯¹åº”äº†ä¸Šæ–‡ä¸­ä»Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿ä¸­æ±‚è§’åº¦éšæœºæ¸¸èµ°çš„æ–¹å¼ã€‚</p>
<h2 id="åº”ç”¨é‡ç‚¹">åº”ç”¨é‡ç‚¹</h2>
<h3 id="ä¸åŒçš„imuå»ºæ¨¡æ–¹å¼éœ€è¦ä¸åŒçš„ç³»æ•°">ä¸åŒçš„IMUå»ºæ¨¡æ–¹å¼éœ€è¦ä¸åŒçš„ç³»æ•°</h3>
<p>å¼ºè°ƒè¿™ä¸€ç‚¹æ˜¯å› ä¸º<a target="_blank" rel="noopener" href="https://github.com/gaowenliang/imu_utils">imu_utils</a>å·¥å…·æ ‡å®šçš„è¾“å‡ºç»“æœå’Œ<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr">kalibr</a>çš„æ¨¡å‹è¦æ±‚æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p><strong>åœ¨GTSAMä¸­</strong></p>
<p>åœ¨GTSAMä¸­ä½¿ç”¨IMUFactoræ—¶éœ€è¦IMUçš„å‡ ä¸ªå‚æ•°ï¼š</p>
<ol type="1">
<li>IMUé›¶åBiasçš„åˆå§‹å€¼ã€‚ä½†æ˜¯è¿™ä¸ªå‚æ•°å¯ä»¥å…ˆè®¾ç½®ä¸º0,åç»­é€æ­¥æ›´æ–°ã€‚ï¼ˆBiasæ˜¯IMUFactorä¸­çš„ä¸€ä¸ªå˜é‡ï¼Œä¼šéšæ—¶é—´æ”¹å˜ï¼‰ã€‚</li>
<li>IMUåŠ é€Ÿåº¦ï¼ˆ3è½´ï¼‰å’Œé™€èºä»ªï¼ˆ3è½´ï¼‰çš„å™ªå£°å‚æ•°ã€‚</li>
<li>IMUåŠ é€Ÿåº¦ï¼ˆ3è½´ï¼‰å’Œé™€èºä»ªï¼ˆ3è½´ï¼‰çš„Biaså™ªå£°å‚æ•°ã€‚</li>
</ol>
<p>ä¸Šé¢2ã€3ä¸¤ç‚¹çš„å‚æ•°å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/gaowenliang/imu_utils">imu_utils</a>çš„æ ‡å®šç»“æœã€‚</p>
<p>å…¶ä¸­ç¬¬2ç‚¹å¯¹åº”çš„æ˜¯Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿ï¼ˆåæ–‡è¯¦ç»†è®²è§£ï¼‰ä¸­æ–œç‡ä¸º<code>-1/2</code>çš„ç›´çº¿ä¸ <span class="math inline">\(\tau =1s\)</span>çš„äº¤ç‚¹ï¼ˆIEEEæ ‡å‡†ï¼‰ã€‚ï¼ˆå¯ä»¥ç›´æ¥å–åŒå¯¹æ•°æ›²çº¿ <span class="math inline">\(\tau = 1s\)</span>å¤„çš„å€¼ï¼Œå› ä¸º"æ®è¯´"æƒ¯æ€§å•å…ƒåœ¨1Hzçš„æ—¶å€™å¯¹åº”çš„å™ªå£°å¼ºåº¦ä¸»è¦ç”±ç™½å™ªå£°å¼ºåº¦å·¦å³ã€‚è¿™æ®µè¯å‡ºè‡ª<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/IMU-Noise-Model">kalibr:IMU-Noise-Model</a>ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/gaowenliang/imu_utils">imu_utils</a>ä¹Ÿæ˜¯ç›´æ¥å–è¿™ä¸€ç‚¹çš„å€¼ï¼‰ &gt;This is only true since the noise power in most inertial sensors is dominated by "white noise" at a frequency of approximately 1Hz.</p>
<p>ç¬¬3ç‚¹æè¿°çš„æ˜¯Biasçš„ä¸ç¨³å®šæ€§ï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿå«Biaséšæœºæ¸¸èµ°ã€‚è¿™ä¸ªå‚æ•°å¯¹åº”çš„æ˜¯<code>Bias [In]Stability</code>ã€‚Bias Stabilityå¯ä»¥ç›´æ¥ä»Allanæ–¹å·®åŒå¯¹æ•°æ›²çº¿ä¸­è¯»å‡ºæ¥ï¼ˆåæ–‡è¯¦è§£ï¼‰</p>
<p>ä¹‹æ‰€ä»¥GTSAMéœ€è¦è¿™äº›å‚æ•°æ˜¯å› ä¸ºGTSAMä¸­å¯¹IMUçš„å»ºæ¨¡æ–¹æ³•è·Ÿå¤§éƒ¨åˆ†ç®—æ³•ç›¸åŒï¼Œéƒ½æ˜¯æŠŠIMUçš„Biaså½“ä½œçŠ¶æ€ï¼Œè®¤ä¸ºBiasä¼šéšç€æ—¶é—´å˜åŒ–è€Œç¼“æ…¢æ”¹å˜ï¼ˆè¿™ä¹Ÿæ˜¯è¾ƒä¸ºæ­£ç¡®çš„åšæ³•ï¼‰ã€‚å› æ­¤éœ€è¦æ ‡å®šå‡ºBiasçš„ç¨³å®šæ€§ã€‚</p>
<p><strong>åœ¨[kalibr]ä¸­</strong> åœ¨[kalibr]ä¸­å¯¹IMUçš„å»ºæ¨¡æ˜¯ä½¿ç”¨ä¸‹é¢çš„å…¬å¼ï¼š</p>
<p><span class="math display">\[\tilde{w}(t) = w(t)+b(t)+n(t)\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(w(t)\)</span>ä»£è¡¨çœŸå€¼ï¼Œ<span class="math inline">\(b(t)\)</span>æ˜¯Biasï¼Œ<span class="math inline">\(n(t)\)</span>æ˜¯å™ªå£°ã€‚å› æ­¤åœ¨[kalibr]ä¸­ä½¿ç”¨è§’åº¦éšæœºæ¸¸èµ°ç³»æ•°ä½œä¸º<span class="math inline">\(n(t)\)</span>ã€‚åŒæ—¶ä½¿ç”¨è§’é€Ÿç‡éšæœºæ¸¸èµ°ä½œä¸º<span class="math inline">\(b(t)\)</span>ã€‚ä¸€å¼€å§‹å¯¹è¿™ç‚¹å¾ˆè¿·æƒ‘ï¼Œä¸ºä»€ä¹ˆè§’é€Ÿç‡éšæœºæ¸¸èµ°å¯ä»¥ç”¨æ¥ä½œä¸º<span class="math inline">\(b(t)\)</span>ã€‚åé¢æˆ‘åœ¨ä¸€ä¸ªissueçš„å›ç­”ä¸­å¾—åˆ°ç­”æ¡ˆï¼š<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/issues/63">issues63</a>ã€‚[kalibr]å¯¹IMUçš„å»ºæ¨¡å½¢å¼å®é™…ä¸Šæ˜¯ä¸å¤Ÿå‡†ç¡®çš„ï¼Œå› ä¸ºè¿™é‡Œå°†<span class="math inline">\(b(t)\)</span>å½“ä½œä¸€ä¸ªæ’å®šçš„é‡æ±‚è§£ï¼Œå®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªéšç€æ—¶é—´ç¼“æ…¢å˜åŒ–çš„é‡ã€‚è€Œè§’é€Ÿç‡éšæœºæ¸¸èµ°åˆ™å¯ä»¥éƒ¨åˆ†ç”¨åŠ›åˆ»ç”»è¿™ä¸€åå·®ã€‚<code>äº‹å®ä¸Šè¿˜æ˜¯å¾ˆéš¾ç†è§£</code></p>
<h3 id="å•ä½">å•ä½</h3>
<blockquote>
<p>First, it is important to realize that Hertz (Hz) is defined as the inverse of seconds, which means that a noise density specification of XÂ°/s/âˆšHz is exactly equivalent to an angle random walk specification of XÂ°/âˆšs with no conversion necessary. å‡ºè‡ªï¼šhttps://www.vectornav.com/resources/inertial-navigation-primer/specifications--and--error-budgets/specs-imuspecs</p>
</blockquote>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<p>ã€1ã€‘<a target="_blank" rel="noopener" href="http://www.i2nav.com/ueditor/jsp/upload/file/20211008/1633700373874080110.pdf">IEEE Standard Specification Format Guide and Test Procedure for Single-Axis Laser Gyros, AnnexC, IEEE Std 647-1995, 1995</a></p>
<p>ã€2ã€‘<a target="_blank" rel="noopener" href="https://hexagondownloads.blob.core.windows.net/public/Novatel/assets/Documents/Bulletins/APN064/APN064.pdf">IMU Errors and Their Effects</a></p>
<p>ã€3ã€‘<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/IMU-Noise-Model">kalibr:IMU-Noise-Model</a></p>
<p>ã€4ã€‘<a target="_blank" rel="noopener" href="https://github.com/gaowenliang/imu_utils">imu_utils</a></p>
<p>ã€5ã€‘<a target="_blank" rel="noopener" href="http://www.i2nav.com/index/newListDetail_zw?newskind_id=13a8654e060c40c69e5f3d4c13069078&amp;newsinfo_id=c2bb31af75944e5ab665dc23b60b5fba">æ–°æ‰‹å…¥é—¨ç³»åˆ—3â€”â€”Allanæ–¹å·®åˆ†ææ–¹æ³•çš„ç›´è§‚ç†è§£</a></p>
<p>ã€6ã€‘<a target="_blank" rel="noopener" href="https://telesens.co/wp-content/uploads/2017/05/AllanVariance5087-1.pdf">Allan Variance: Noise Analysis for Gyroscopes</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/11/lio_sam/mapOptimization-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-04-11 22:00:19" itemprop="dateCreated datePublished" datetime="2023-04-11T22:00:19+08:00">2023-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-20 22:08:03" itemprop="dateModified" datetime="2023-04-20T22:08:03+08:00">2023-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/04/11/lio_sam/mapOptimization-doc/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£" href="/2023/04/11/lio_sam/mapOptimization-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::fddca820098456617fc64b80ba797a81" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="åç«¯ä¼˜åŒ–">åç«¯ä¼˜åŒ–</h2>
<figure>
<img src="./imgs/Design-Pipelines-mapOpt.png" alt="" /><figcaption>Simple-LIO-SAMæ€»ä½“æµç¨‹å›¾</figcaption>
</figure>
<p>è¿™æ˜¯<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>å››å¤§éƒ¨åˆ†ï¼ˆç‚¹äº‘å»ç•¸å˜ã€ç‰¹å¾æå–ã€é¢„ç§¯åˆ†ã€åç«¯ä¼˜åŒ–ï¼‰ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªæ¨¡å—äº†ï¼Œå®Œå…¨å¼„æ‡‚è¿™ä¸ªæ¨¡å—ä¹Ÿå°±ç¦»å®Œå…¨ç†è§£<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸è¿œäº†ã€‚ è¿™ä¸ªæ¨¡å—è´Ÿè´£SLAMæ¡†æ¶ä¸­çš„åç«¯ä¼˜åŒ–ï¼Œç”±äº<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ä½¿ç”¨å›¾ä¼˜åŒ–ä½œä¸ºåç«¯ä¼˜åŒ–ç®—æ³•ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ç¬”è€…ä¹Ÿä¼šç§°è¿™ä¸ªæ¨¡å—ä¸ºå›¾ä¼˜åŒ–æ¨¡å—ã€‚ä½†æ˜¯è¿™ä¸ªæ¨¡å—çš„ ä½œç”¨ä¸å•å•æ˜¯è´Ÿè´£åç«¯ä¼˜åŒ–ï¼Œè¿˜æœ‰1ï¼‰ã€å…¨å±€åœ°å›¾å¯è§†åŒ–ï¼›2ï¼‰ã€å›ç¯æ£€æµ‹ç­‰åŠŸèƒ½ã€‚</p>
<p>è¿™ä¸ªæ¨¡å—ä¸€å…±æœ‰ä¸‰ä¸ªä¸»è¦çº¿ç¨‹æ‰§è¡Œå…·ä½“åŠŸèƒ½ï¼Œä¸‰ä¸ªçº¿ç¨‹åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>é›·è¾¾é‡Œç¨‹è®¡åŠåç«¯ä¼˜åŒ–çº¿ç¨‹</li>
</ol>
<p>è¿™ä¸ªçº¿ç¨‹ä¸»è¦è´Ÿè´£æ‰§è¡Œé›·è¾¾åˆ°åœ°å›¾çš„åŒ¹é…ï¼Œå¾—åˆ°è¾ƒä¸ºå‡†ç¡®çš„é›·è¾¾é‡Œç¨‹è®¡ï¼Œç„¶åå°†é›·è¾¾é‡Œç¨‹è®¡ã€å›ç¯æ£€æµ‹å› å­åŠ å…¥å› å­å›¾è¿›è¡Œä¼˜åŒ–ï¼Œå¾—åˆ°å…¨å±€ä¼˜åŒ–çš„å…³é”®å¸§ä½å§¿ã€‚</p>
<ol start="2" type="1">
<li>å›ç¯æ£€æµ‹çº¿ç¨‹</li>
</ol>
<p>å›ç¯æ£€æµ‹ä½¿ç”¨è¾ƒä¸ºè´¹æ—¶çš„ICPç®—æ³•ï¼Œå› æ­¤ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è¿è¡Œã€‚å½“æ£€æµ‹åˆ°åˆé€‚çš„å›ç¯å› å­åï¼Œä¼šåŠ å…¥å…¨å±€ç¼“å­˜é˜Ÿåˆ—ï¼Œåœ¨é›·è¾¾é‡Œç¨‹è®¡çº¿ç¨‹ä¸­è¢«åŠ å…¥å› å­å›¾ä¼˜åŒ–ã€‚</p>
<ol start="3" type="1">
<li>å…¨å±€åœ°å›¾å¯è§†åŒ–çº¿ç¨‹</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­å¯¹äºåœ°å›¾çš„å­˜å‚¨æ ¼å¼æ˜¯é€šè¿‡ä¸€ç³»åˆ—å…³é”®å¸§çš„ç‚¹äº‘å’Œä½å§¿å­˜å‚¨ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸€æ•´ä¸ªç‚¹äº‘å­˜å‚¨ã€‚ä¸ºäº†èƒ½å¤Ÿä»¥è¾ƒä½çš„é¢‘ç‡å‘å¸ƒå…¨å±€åœ°å›¾ï¼Œåç«¯ä¼˜åŒ–æ¨¡å—å•ç‹¬æœ‰ä¸€ä¸ªçº¿ç¨‹ å¯¹å†å²å…³é”®å¸§çš„ç‚¹äº‘æ ¹æ®æœ€æ–°çš„ä½å§¿è½¬æ¢åˆ°åœ°å›¾åæ ‡ç³»ï¼Œç„¶åå°†èåˆåçš„å…¨å±€ç‚¹äº‘åœ°å›¾å‘å¸ƒå‡ºå»ã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸‰ä¸ªçº¿ç¨‹çš„ä¸»è¦æµç¨‹å’Œæ–¹æ³•</p>
<h2 id="é›·è¾¾é‡Œç¨‹è®¡åŠåç«¯ä¼˜åŒ–çº¿ç¨‹">é›·è¾¾é‡Œç¨‹è®¡åŠåç«¯ä¼˜åŒ–çº¿ç¨‹</h2>
<p>è¿™ä¸ªçº¿ç¨‹çš„æµç¨‹ä¸»è¦å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure>
<img src="./imgs/Design-mapOptimization-top.png" alt="" /><figcaption>é›·è¾¾é‡Œç¨‹è®¡åŠåç«¯ä¼˜åŒ–çº¿ç¨‹æµç¨‹å›¾</figcaption>
</figure>
<p>è¿™ä¸ªçº¿ç¨‹æ˜¯ç‚¹äº‘çš„å›è°ƒå‡½æ•°ï¼Œç‚¹äº‘æ¥è‡ª<code>FeatureExtraction</code>æ¨¡å—è¾“å‡ºçš„ç»è¿‡ç‰¹å¾æå–åçš„ç‚¹äº‘ã€‚æ•´ä¸ªå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä»£ç å¦‚ä¸‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‰¹å¾ç‚¹äº‘å›è°ƒå‡½æ•°ï¼Œä¹Ÿæ˜¯æ•´ä¸ªæ¨¡å—æ ¸å¿ƒçš„è®¡ç®—å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">laserCloudInfoHandler</span><span class="params">(<span class="type">const</span> spl_lio_sam::msg::CloudInfo::SharedPtr msgIn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æå–å½“å‰ç‚¹äº‘æ—¶é—´æˆ³</span></span><br><span class="line">    timeLaserInfoStamp = msgIn-&gt;header.stamp;</span><br><span class="line">    timeLaserInfoCur = <span class="built_in">stamp2Sec</span>(msgIn-&gt;header.stamp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æå–å½“å‰ç‚¹äº‘çš„ç‰¹å¾è§’ç‚¹å’Œç‰¹å¾å¹³é¢ç‚¹</span></span><br><span class="line">    cloudInfo = *msgIn;</span><br><span class="line">    pcl::<span class="built_in">fromROSMsg</span>(msgIn-&gt;cloud_corner,  *laserCloudCornerCur);</span><br><span class="line">    pcl::<span class="built_in">fromROSMsg</span>(msgIn-&gt;cloud_surface, *laserCloudSurfCur);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * ä¸€å…±ä¸‰ä¸ªçº¿ç¨‹ä½¿ç”¨åˆ°è¿™æŠŠé”</span></span><br><span class="line"><span class="comment">        * 1. é›·è¾¾é‡Œç¨‹è®¡çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="comment">        * 2. å‘å¸ƒå…¨å±€åœ°å›¾çº¿ç¨‹ï¼Œæ‰§è¡Œå…³é”®å¸§ç‚¹äº‘æ‹·è´è½¬æ¢æ“ä½œ</span></span><br><span class="line"><span class="comment">        * 3. å›ç¯æ£€æµ‹çº¿ç¨‹ï¼Œæ‰§è¡Œå…³é”®å¸§å§¿æ€æ‹·è´æ“ä½œ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•ä¸Šä¸€å¸§çš„æ—¶é—´æˆ³ï¼Œä¸¤å¸§ä¹‹é—´æ—¶é—´é—´éš”å¤§äºmappingProcessIntervalæ‰ä¼šè¿›è¡Œå¤„ç†</span></span><br><span class="line">    <span class="type">static</span> <span class="type">double</span> timeLastProcessing = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (timeLaserInfoCur - timeLastProcessing &gt;= mappingProcessInterval)</span><br><span class="line">    &#123;</span><br><span class="line">        timeLastProcessing = timeLaserInfoCur;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰å¸§ä½å§¿åˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;updateInitialGuess&quot;</span>);</span><br><span class="line">        <span class="built_in">updateInitialGuess</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„å»ºå±€éƒ¨åœ°å›¾</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;extractSurroundingKeyFrames&quot;</span>);</span><br><span class="line">        <span class="built_in">extractSurroundingKeyFrames</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹å½“å‰å¸§ç‚¹äº‘åšé™é‡‡æ ·</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;downsampleCurrentScan&quot;</span>);</span><br><span class="line">        <span class="built_in">downsampleCurrentScan</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†å½“å‰å¸§ç‚¹äº‘åŒ¹é…åˆ°æ„å»ºçš„å±€éƒ¨åœ°å›¾ï¼Œä¼˜åŒ–å½“å‰ä½å§¿</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;scan2MapOptimization&quot;</span>);</span><br><span class="line">        <span class="built_in">scan2MapOptimization</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—æ˜¯å¦å°†å½“å‰å¸§é‡‡çº³ä¸ºå…³é”®å¸§ï¼ŒåŠ å…¥å› å­å›¾ä¼˜åŒ–</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;saveKeyFramesAndFactor&quot;</span>);</span><br><span class="line">        <span class="built_in">saveKeyFramesAndFactor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“æ–°çš„å›ç¯å› å­æˆ–è€…GPSå› å­åŠ å…¥å› å­å›¾æ—¶ï¼Œå¯¹å†å²å¸§æ‰§è¡Œä½å§¿æ›´æ–°</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;correctPoses&quot;</span>);</span><br><span class="line">        <span class="built_in">correctPoses</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å¸ƒæ¿€å…‰å†ç¨‹è®¡</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;publishOdometry&quot;</span>);</span><br><span class="line">        <span class="built_in">publishOdometry</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å¸ƒå½“å‰å¸§å¯¹é½åˆ°åœ°å›¾åæ ‡ç³»çš„ç‚¹äº‘å’Œå®Œæ•´è½¨è¿¹</span></span><br><span class="line">        <span class="built_in">RCLCPP_DEBUG</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;publishFrames&quot;</span>);</span><br><span class="line">        <span class="built_in">publishFrames</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é›·è¾¾é‡Œç¨‹è®¡çš„æœ€é«˜é¢‘ç‡">é›·è¾¾é‡Œç¨‹è®¡çš„æœ€é«˜é¢‘ç‡</h3>
<p>é›·è¾¾é‡Œç¨‹è®¡å¹¶ä¸æ˜¯å¯¹æ¯ä¸€å¸§ç‚¹äº‘éƒ½è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ—¶é—´é˜ˆå€¼çš„åˆ¤æ–­</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (timeLaserInfoCur - timeLastProcessing &gt;= mappingProcessInterval)</span><br></pre></td></tr></table></figure>
<p><code>mappingProcessInterval</code>çš„é»˜è®¤å‚æ•°æ˜¯0.15sï¼Œæ‰€ä»¥åœ¨é»˜è®¤å‚æ•°ä¸‹ï¼Œé›·è¾¾é‡Œç¨‹è®¡ä¸ä¼šè¶…è¿‡1/0.15Hz</p>
<h3 id="ç‚¹äº‘åŒ¹é…çš„åˆå§‹å€¼">ç‚¹äº‘åŒ¹é…çš„åˆå§‹å€¼</h3>
<p>åŸºæœ¬æ‰€æœ‰çš„ç²¾ç»†ç‚¹äº‘åŒ¹é…éƒ½éœ€è¦ä¸€ä¸ªè¾ƒå¥½çš„åˆå€¼ã€‚<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­çš„ç‚¹äº‘åŒ¹é…ä½¿ç”¨é«˜æ–¯ç‰›é¡¿ç®—æ³•ä¼˜åŒ–å½“å‰å¸§ç‚¹äº‘åˆ°å±€éƒ¨åœ°å›¾çš„è·ç¦»ï¼ˆå…·ä½“ç®—æ³•è§æœ¬é¡¹ç›®åšå®¢çš„ç›¸å…³æ–‡ç« ï¼‰ï¼ŒåŸºäºæœ€å°äºŒä¹˜æ³•çš„ç‚¹äº‘åŒ¹é…æ›´éœ€è¦ä¸€ä¸ªä¼˜è‰¯çš„åˆå€¼ã€‚ å›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨<code>ImageProjection</code>ä¹Ÿå°±æ˜¯ç‚¹äº‘å»ç•¸å˜æ¨¡å—çš„å†…å®¹ï¼Œåœ¨ç‚¹äº‘å»ç•¸å˜æ¨¡å—ï¼Œé™¤äº†å¯¹ç‚¹äº‘åšè¿åŠ¨ç•¸å˜æ ¡æ­£ä¹‹å¤–ï¼Œè¿˜ä»IMUåŸå§‹è¾“å‡ºçš„è§’åº¦å’Œé¢„ç§¯åˆ†æ¨¡å—çš„è¾“å‡ºæ‰¾åˆ°ä¸å½“å‰å¸§ç‚¹äº‘æ—¶é—´æœ€ç›¸è¿‘çš„æ•°æ®ï¼ŒåŠ å…¥å‘å¸ƒçš„æ¶ˆæ¯ä¸­è·Ÿéšç‚¹äº‘ä¸€èµ·å‘å¸ƒã€‚</p>
<p>åœ¨åç«¯ä¼˜åŒ–æ¨¡å—ä¸­ï¼Œä¼šä¼˜å…ˆåˆ¤æ–­æ¥æ”¶çš„æ¶ˆæ¯ä¸­æ˜¯å¦æœ‰è®¾ç½®å¥½çš„é¢„ç§¯åˆ†æ•°æ®ï¼Œè‹¥æœ‰ï¼Œåˆ™ä½¿ç”¨è¯¥æ•°æ®ä½œä¸ºè¯¥å¸§ç‚¹äº‘çš„åˆå§‹å€¼ï¼Œå¦åˆ™ï¼Œä½¿ç”¨IMUçš„è§’åº¦å¢é‡ä½œä¸ºåˆå§‹å€¼ã€‚å½“ç„¶ï¼Œç‰¹æ®Šæƒ…å†µæ˜¯ç¬¬ä¸€å¸§çš„æ—¶å€™ä¼šä½¿ç”¨IMUè¾“å‡ºçš„è§’åº¦ä½œä¸ºåˆå§‹å€¼ã€‚</p>
<figure>
<img src="./imgs/Design-mapOptimization-initialGuess.png" alt="" /><figcaption>ç‚¹äº‘åŒ¹é…åˆå§‹å€¼é€‰å–</figcaption>
</figure>
<p>è¿™é‡Œæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œåˆå§‹å€¼æ˜¯é€šè¿‡è®¡ç®—å½“å‰å¸§çš„ä½å§¿å’Œä¸Šä¸€å¸§çš„ç¼“å­˜ä½å§¿è®¡ç®—ä½å§¿å¢é‡ï¼Œç„¶åå°†è¯¥å¢é‡åº”ç”¨åˆ°ä¸Šä¸€å¸§ä¼˜åŒ–åçš„é‡Œç¨‹è®¡ç»“æœã€‚</p>
<p><span class="math display">\[
T_{incre} = \hat{T}_{pre}^{-1}\hat{T}_{cur}\\
\bar{T}_{cur} = T^{opt}_{pre}T_{incre}
\]</span></p>
<p>ä»¥ä½¿ç”¨é¢„ç§¯åˆ†æ•°æ®ä½œä¸ºåˆå§‹å€¼ä¸ºä¾‹ï¼Œä¸Šé¢å…¬å¼ä¸­çš„<span class="math inline">\(\hat{T}_{pre},\hat{T}_{cur}\)</span>åˆ†åˆ«æ˜¯ä¸Šä¸€æ¬¡ç¼“å­˜å’Œå½“å‰çš„æ¶ˆæ¯ä¸­åŒ…å«çš„é¢„ç§¯åˆ†ä½å§¿ï¼›<span class="math inline">\(T_{incre}\)</span>è®¡ç®—é™¤äº†ä»ä¸Šä¸€å¸§åˆ°å½“å‰å¸§çš„ä½å§¿å¢é‡ï¼›<span class="math inline">\(T^{opt}_{pre}\)</span>æ˜¯ä¸Šä¸€å¸§ç»è¿‡ç‚¹äº‘åŒ¹é…ã€å›¾ä¼˜åŒ–ä¹‹åçš„é‡Œç¨‹è®¡ç»“æœï¼›<span class="math inline">\(\bar{T}_{cur}\)</span>åˆ™æ˜¯æœ€ç»ˆé‡‡ç”¨çš„å½“å‰å¸§ç‚¹äº‘çš„ä¼°è®¡å€¼ã€‚</p>
<h3 id="æ„å»ºå±€éƒ¨ç‚¹äº‘åœ°å›¾">æ„å»ºå±€éƒ¨ç‚¹äº‘åœ°å›¾</h3>
<figure>
<img src="./imgs/Design-mapOptimization-localMap.png" alt="" /><figcaption>æ„å»ºå±€éƒ¨ç‚¹äº‘åœ°å›¾</figcaption>
</figure>
<p>å±€éƒ¨ç‚¹äº‘åœ°å›¾ç®€å•è¯´å°±æ˜¯æ ¹æ®æœ€åä¸€å¸§å…³é”®å¸§ï¼Œæ‰¾åˆ°å…¶ç©ºé—´ã€æ—¶é—´é™„è¿‘çš„ä¸€äº›å…¶ä»–å…³é”®å¸§ï¼Œå°†è¿™äº›å…³é”®å¸§çš„ç‚¹äº‘éƒ½ä½¿ç”¨å¯¹åº”çš„ä½å§¿è½¬æ¢åˆ°åœ°å›¾åæ ‡ç³»ä¸‹ï¼Œèåˆæˆåœ°å›¾åæ ‡ç³»ä¸‹çš„å±€éƒ¨åœ°å›¾ï¼Œåé¢è¿™ä¸ªå±€éƒ¨åœ°å›¾å°±æ˜¯ç‚¹äº‘åŒ¹é…çš„ç›®æ ‡ç‚¹äº‘ã€‚è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ä¸€äº›å‡ ä½•è®¡ç®—ã€‚</p>
<h3 id="ç‚¹äº‘åŒ¹é…">ç‚¹äº‘åŒ¹é…</h3>
<p>è¿™éƒ¨åˆ†ç”¨çš„ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œå…·ä½“å‚è€ƒæœ¬é¡¹ç›®çš„å¦ä¸€ç¯‡æ–‡ç« <a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a>ã€‚ åªè¦æ˜ç™½ï¼Œç»è¿‡è¿™ä¸ªæ­¥éª¤åï¼Œåœ¨ç¬¬ä¸€æ­¥è®¾ç½®çš„ç‚¹äº‘ä½å§¿åˆå§‹å€¼å·²ç»è¢«ç‚¹äº‘åŒ¹é…ç®—æ³•æ›´æ–°ä¸ºæ›´å‡†ç¡®çš„ä½å§¿ã€‚</p>
<figure>
<img src="./imgs/Design-mapOptimization-scan2Map.png" alt="" /><figcaption>ç‚¹äº‘åŒ¹é…</figcaption>
</figure>
<h3 id="å› å­å›¾æ„å»ºåŠä¼˜åŒ–">å› å­å›¾æ„å»ºåŠä¼˜åŒ–</h3>
<p>è¿™ä¸ªæ­¥éª¤ç¨å¾®æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å…ˆç†ä¸€ä¸‹ç›®å‰æ‰‹å¤´æœ‰ä»€ä¹ˆï¼š</p>
<ol type="1">
<li>ç»è¿‡ç‚¹äº‘åŒ¹é…æ ¡æ­£åçš„å½“å‰å¸§çš„ä½å§¿</li>
<li>å›ç¯æ£€æµ‹å¾—åˆ°çš„æŸä¸€å¸§å…³é”®å¸§åˆ°å¦ä¸€å¸§å…³é”®å¸§çš„ç›¸å¯¹ä½å§¿ï¼ˆè¿™ä¸ªéƒ¨åˆ†åœ¨å›ç¯æ£€æµ‹çº¿ç¨‹è¿›è¡Œï¼Œè¿™é‡Œåªéœ€è¦å½“ä½œç°æœ‰æ•°æ®å³å¯ï¼‰</li>
<li>gpsé‡Œç¨‹è®¡ï¼ˆç”±äºè¿™éƒ¨åˆ†éœ€è¦é¢å¤–çš„è®¡ç®—ï¼Œæš‚ä¸”å¿½ç•¥gpsçš„è¾“å…¥ï¼‰</li>
</ol>
<p>PS:è¿™éƒ¨åˆ†éœ€è¦<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒæœ¬é¡¹ç›®çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”GTSAMå¿«é€Ÿå…¥é—¨</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªä½å§¿å…³ç³»æ„å»ºå› å­å›¾ï¼Œå¹¶ä½¿ç”¨å› å­å›¾ä¼˜åŒ–ç®—æ³•è¿›è¡Œæ•´ä½“çš„ä¼˜åŒ–ï¼Œå¾—åˆ°å…¨å±€ä¼˜åŒ–ä¸‹çš„å…³é”®å¸§ä½å§¿</p>
<figure>
<img src="./imgs/Design-mapOptimization-graphOpt01.png" alt="" /><figcaption>å› å­å›¾æ„å»ºæµç¨‹å›¾</figcaption>
</figure>
<p><strong>å…³é”®å¸§çš„é€‰æ‹©</strong></p>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„é›·è¾¾å¸§éƒ½ä¼šè¢«å½“ä½œå…³é”®å¸§ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä½¿ç”¨ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹æ¡ˆåˆ¤æ–­æ˜¯å¦å°†å½“å‰å¸§é‡‡çº³ä¸ºå…³é”®å¸§ï¼šåªæœ‰ä¸ä¸Šä¸€å¸§å…³é”®å¸§çš„ä½å§¿ç›¸å·®è¶³å¤Ÿå¤§æ‰ä¼šé‡‡çº³ä¸ºå…³é”®å¸§ã€‚</p>
<p><strong>æ·»åŠ æ¿€å…‰é‡Œç¨‹è®¡å› å­</strong></p>
<figure>
<img src="./imgs/Design-mapOptimization-graphOpt-odomFactor.png" alt="" /><figcaption>æ¿€å…‰é‡Œç¨‹è®¡å› å­</figcaption>
</figure>
<p><strong>å›ç¯å› å­</strong></p>
<figure>
<img src="./imgs/Design-mapOptimization-graphOpt-loopFactor.png" alt="" /><figcaption>æ·»åŠ å›ç¯å› å­</figcaption>
</figure>
<p><strong>è®¾ç½®å› å­å›¾åˆå€¼å¹¶ä¼˜åŒ–</strong></p>
<figure>
<img src="./imgs/Design-mapOptimization-graphOpt-optimization.png" alt="" /><figcaption>å› å­å›¾ä¼˜åŒ–</figcaption>
</figure>
<h3 id="æ›´æ–°å†å²å…³é”®å¸§ä½å§¿">æ›´æ–°å†å²å…³é”®å¸§ä½å§¿</h3>
<p>å½“æœ‰æ–°çš„å›ç¯è¢«æ£€æµ‹åˆ°ï¼Œè¯¥å›ç¯å…³ç³»è¢«åŠ å…¥å› å­å›¾è¿›è¡Œä¼˜åŒ–ã€‚ç”±äºå›ç¯å…³ç³»æ˜¯ä¸€ç§å¾ˆå¼ºçº¦æŸæ€§çš„è§‚æµ‹ï¼Œå› æ­¤ï¼Œåœ¨è§‚æµ‹åˆ°æ–°çš„å›ç¯ä¹‹åï¼Œå› å­å›¾ä¼˜åŒ–å¯¹å†å²å…³é”®å¸§çš„ä½å§¿å˜åŒ–ä¼šæ¯”è¾ƒå¤§ï¼Œå› æ­¤éœ€è¦å¯¹å†å²å…³é”®å¸§çš„ä½å§¿ä¸€èµ·åšä¸€æ¬¡æ›´æ–°ã€‚</p>
<figure>
<img src="./imgs/Design-mapOptimization-updatePath.png" alt="" /><figcaption>æ›´æ–°å†å²ä½å§¿</figcaption>
</figure>
<h3 id="å‘å¸ƒé‡Œç¨‹è®¡åŠå¯è§†åŒ–ç‚¹äº‘">å‘å¸ƒé‡Œç¨‹è®¡åŠå¯è§†åŒ–ç‚¹äº‘</h3>
<p>åœ¨åŸå§‹çš„<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä»£ç ä¸­è¿™éƒ¨åˆ†è¿˜æœ‰è¾ƒå¤šå¤„ç†ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰å¤ªå¤šä½œç”¨ã€‚åœ¨æœ¬é¡¹ç›®ä»£ç <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">spl</a>ä¸­ï¼Œå·²ç»å»é™¤äº†å†—ä½™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†å°±åªæ˜¯å°†è®¡ç®—å‡ºæ¥çš„æ¿€å…‰é‡Œç¨‹è®¡å¾€å¤–å‘å¸ƒã€‚</p>
<h2 id="å›ç¯æ£€æµ‹çº¿ç¨‹">å›ç¯æ£€æµ‹çº¿ç¨‹</h2>
<p>å›ç¯æ£€æµ‹æ˜¯SLAMä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªç¯èŠ‚ã€‚é€šè¿‡æ£€æŸ¥å½“å‰ä½ç½®æ˜¯å¦å·²ç»æ˜¯åˆ°è¾¾è¿‡çš„ä½ç½®ï¼Œå¹¶å¯¹é‡å¤åˆ°è¾¾çš„ä½ç½®åŒ¹é…è®¡ç®—ä½å§¿ã€‚å¦‚ä¸‹å›¾ä¸­ï¼Œ<span class="math inline">\(x_5\)</span>ä¸<span class="math inline">\(x_2\)</span>å¤Ÿæˆå›ç¯ï¼Œ<span class="math inline">\(f_5(x_5,x_2)\)</span>æ˜¯ä¸¤ä¸ªä½ç½®é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»ã€‚é€šè¿‡å›ç¯ä¹‹é—´çš„çº¦æŸï¼Œå¯¹å› å­å›¾ä¼˜åŒ–å™¨æä¾›å¾ˆå¼ºçš„ä¿¡æ¯ï¼Œä½¿å¾—æ•´ä½“çš„ä½å§¿ä¼°è®¡è¾¾åˆ°å…¨å±€æœ€ä¼˜çš„çŠ¶æ€ã€‚</p>
<figure>
<img src="./imgs/loopClosure.png" alt="" /><figcaption>å›ç¯å› å­</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­å›ç¯æ£€æµ‹ä½¿ç”¨ICPç®—æ³•ï¼Œè®¡ç®—æœ€æ–°çš„å…³é”®å¸§ä¸å¯èƒ½å½¢æˆå›ç¯çš„ä½ç½®çš„ç‚¹äº‘åŒ¹é…ï¼Œå¹¶åªæœ‰åœ¨åŒ¹é…åˆ†æ•°éå¸¸å¥½çš„æƒ…å†µä¸‹æ‰é‡‡çº³è¿™ä¸ªå›ç¯ç»“æœã€‚ç”±äºè¿™éƒ¨åˆ†æ˜¯æ¯”è¾ƒè€—è´¹è®¡ç®—æ—¶é—´çš„ï¼Œå¹¶ä¸”ï¼Œå›ç¯å…³ç³»åªéœ€è¦ä»¥æ¯”è¾ƒä½çš„çŠ¶æ€åŠ å…¥å› å­å›¾å³å¯ï¼Œå› æ­¤ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>çš„<code>mapOptimization.cpp</code>ä¸­æ˜¯ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æ‰§è¡Œå›ç¯æ£€æµ‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> MO = std::<span class="built_in">make_shared</span>&lt;mapOptimization&gt;(options);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›ç¯æ£€æµ‹ç‹¬ç«‹çº¿ç¨‹</span></span><br><span class="line"><span class="function">std::thread <span class="title">loopthread</span><span class="params">(&amp;mapOptimization::loopClosureThread, MO)</span></span>;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹å†…éƒ¨ä¹Ÿé»˜è®¤è¢«è®¾ä¸ºè¾ƒä½çš„æ‰§è¡Œé¢‘ç‡ï¼ˆé»˜è®¤1Hzï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å›ç¯æ£€æµ‹ç‹¬ç«‹çº¿ç¨‹</span></span><br><span class="line"><span class="comment">  * 1. ç”±äºå›ç¯æ£€æµ‹ä¸­ç”¨åˆ°äº†ç‚¹äº‘åŒ¹é…ï¼Œè¾ƒä¸ºè€—æ—¶ï¼Œæ‰€ä»¥ç‹¬ç«‹ä¸ºå•ç‹¬çš„çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line"><span class="comment">  * 2. æ–°çš„å›ç¯å…³ç³»è¢«æ£€æµ‹å‡ºæ¥æ—¶è¢«ä¸»çº¿ç¨‹åŠ å…¥å› å­å›¾ä¸­ä¼˜åŒ–</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loopClosureThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (loopClosureEnableFlag == <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤ 1</span></span><br><span class="line">    <span class="function">rclcpp::Rate <span class="title">rate</span><span class="params">(loopClosureFrequency)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        <span class="built_in">performLoopClosure</span>();</span><br><span class="line">        <span class="built_in">visualizeLoopClosure</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å›ç¯æ£€æµ‹çº¿ç¨‹çš„æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<figure>
<img src="./imgs/Design-mapOptimization-loopThread.png" alt="" /><figcaption>å›ç¯æ£€æµ‹çº¿ç¨‹æµç¨‹å›¾</figcaption>
</figure>
<h3 id="å¯»æ‰¾å›ç¯å¯¹åº”çš„å¸§">å¯»æ‰¾å›ç¯å¯¹åº”çš„å¸§</h3>
<p>å½“å¼€å§‹å¯»æ‰¾æ–°çš„å›ç¯å…³ç³»æ—¶ï¼Œä¼šæ ¹æ®æœ€åä¸€å¸§å…³é”®å¸§æ‰¾åˆ°æ˜¯å¦æœ‰åˆé€‚çš„å¯¹åº”å¸§ä½œä¸ºå›ç¯å¸§ã€‚ä¸»è¦é€šè¿‡ä¸¤ä¸ªçº¦æŸï¼š</p>
<ol type="1">
<li>ç©ºé—´ä½ç½®æœ€è¿‘ï¼ˆä½¿ç”¨kdtreeåšè·ç¦»æ£€ç´¢ï¼‰</li>
<li>æ—¶é—´è·ç¦»å¤Ÿè¿œï¼ˆå»é™¤æ—¶é—´è¿‡è¿‘çš„å¸§ï¼‰</li>
</ol>
<p>è¿™ä¸ªéƒ¨åˆ†ä¸»è¦æ˜¯å‡½æ•°<code>detectLoopClosureDistance</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief æ ¹æ®ä½ç½®å…³ç³»å¯»æ‰¾å½“å‰å¸§ä¸å¯¹åº”å¸§çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">  * 1. å°†æœ€åä¸€å¸§å…³é”®å¸§ä½œä¸ºå½“å‰å¸§ï¼Œå¦‚æœå½“å‰å¸§å·²ç»åœ¨å›ç¯å¯¹åº”å…³ç³»ä¸­ï¼Œåˆ™è¿”å›ï¼ˆå·²ç»å¤„ç†è¿‡è¿™ä¸€å¸§äº†ï¼‰ã€‚å¦‚æœæ‰¾åˆ°çš„å›ç¯å¯¹åº”å¸§ç›¸å·®æ—¶é—´è¿‡çŸ­ä¹Ÿè¿”å›falseã€‚å›ç¯å…³ç³»ç”¨ä¸€ä¸ªå…¨å±€mapç¼“å­˜</span></span><br><span class="line"><span class="comment">  * 2. å¯¹å…³é”®å¸§3Dä½å§¿æ„å»ºkdæ ‘ï¼Œå¹¶ç”¨å½“å‰å¸§ä½ç½®ä»kdæ ‘å¯»æ‰¾è·ç¦»æœ€è¿‘çš„å‡ å¸§ï¼ŒæŒ‘é€‰æ—¶é—´é—´éš”æœ€è¿œçš„é‚£ä¸€å¸§ä½œä¸ºåŒ¹é…å¸§</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * @param latestID ä¼ å‡ºå‚æ•°ï¼Œæ‰¾åˆ°çš„å½“å‰å¸§ç´¢å¼•ï¼Œå®é™…å°±æ˜¯ç”¨æœ€åä¸€å¸§å…³é”®å¸§</span></span><br><span class="line"><span class="comment">  * @param closestID ä¼ å‡ºå‚æ•°ï¼Œæ‰¾åˆ°çš„å½“å‰å¸§å¯¹åº”çš„åŒ¹é…å¸§</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">detectLoopClosureDistance</span><span class="params">(<span class="type">int</span> *latestID, <span class="type">int</span> *closestID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> loopKeyCur = copy_cloudKeyPoses3D-&gt;<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> loopKeyPre = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®è®¤æœ€åä¸€å¸§å…³é”®å¸§æ²¡æœ‰è¢«åŠ å…¥è¿‡å›ç¯å…³ç³»ä¸­</span></span><br><span class="line">    <span class="keyword">auto</span> it = loopIndexContainer.<span class="built_in">find</span>(loopKeyCur);</span><br><span class="line">    <span class="keyword">if</span> (it != loopIndexContainer.<span class="built_in">end</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å…³é”®å¸§çš„3Dä½ç½®æ„å»ºkdtreeï¼Œå¹¶æ£€ç´¢ç©ºé—´ä½ç½®ç›¸è¿‘çš„å…³é”®å¸§</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; pointSearchIndLoop;</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; pointSearchSqDisLoop;</span><br><span class="line">    kdtreeHistoryKeyPoses-&gt;<span class="built_in">setInputCloud</span>(copy_cloudKeyPoses3D);</span><br><span class="line">    <span class="comment">// å¯»æ‰¾ç©ºé—´è·ç¦»ç›¸è¿‘çš„å…³é”®å¸§</span></span><br><span class="line">    kdtreeHistoryKeyPoses-&gt;<span class="built_in">radiusSearch</span>(copy_cloudKeyPoses3D-&gt;<span class="built_in">back</span>(), historyKeyframeSearchRadius, pointSearchIndLoop, pointSearchSqDisLoop, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¡®ä¿ç©ºé—´è·ç¦»ç›¸è¿‘çš„å¸§æ˜¯è¾ƒä¹…å‰é‡‡é›†çš„ï¼Œæ’é™¤æ˜¯å‰é¢å‡ ä¸ªå…³é”®å¸§</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)pointSearchIndLoop.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> id = pointSearchIndLoop[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(copy_cloudKeyPoses6D-&gt;points[id].time - timeLaserInfoCur) &gt; historyKeyframeSearchTimeDiff)</span><br><span class="line">        &#123;</span><br><span class="line">            loopKeyPre = id;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä½ç½®å…³ç³»ã€æ—¶é—´å…³ç³»éƒ½ç¬¦åˆè¦æ±‚çš„å…³é”®å¸§ï¼Œåˆ™è¿”å›false</span></span><br><span class="line">    <span class="keyword">if</span> (loopKeyPre == <span class="number">-1</span> || loopKeyCur == loopKeyPre)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    *latestID = loopKeyCur;</span><br><span class="line">    *closestID = loopKeyPre;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="æ„å»ºå±€éƒ¨åœ°å›¾">æ„å»ºå±€éƒ¨åœ°å›¾</h3>
<p>æ‰¾åˆ°åŒ¹é…çš„å…³é”®å¸§idåï¼Œä¼šåœ¨è¯¥å…³é”®å¸§çš„å‘¨å›´æŠ½å–å…¶ä»–å…³é”®å¸§æ„å»ºå±€éƒ¨ç‚¹äº‘åœ°å›¾ã€‚è¿™ä¸ªæ­¥éª¤è·Ÿé›·è¾¾é‡Œç¨‹è®¡çº¿ç¨‹ä¸­çš„å±€éƒ¨åœ°å›¾æ„å»ºæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p>
<h3 id="ç‚¹äº‘åŒ¹é…-1">ç‚¹äº‘åŒ¹é…</h3>
<p>è¿™é‡Œä½¿ç”¨ICPç›´æ¥å¯¹<code>curKeyframeCloud</code>(æœ€åä¸€å¸§å…³é”®å¸§)å’Œ<code>preKeyframeCloud</code>(å›ç¯å¯¹åº”å¸§å‘¨å›´æ„å»ºçš„ç‚¹äº‘åœ°å›¾)åšç‚¹äº‘åŒ¹é…ï¼Œå¹¶å¾—å‡ºå½“å‰å¸§åˆ°å›ç¯å¸§çš„è½¬æ¢çŸ©é˜µ<span class="math inline">\(T_{cur}^{pre}\)</span></p>
<h3 id="æ·»åŠ å›ç¯å…³ç³»åˆ°é˜Ÿåˆ—">æ·»åŠ å›ç¯å…³ç³»åˆ°é˜Ÿåˆ—</h3>
<p>ç”±äºå›ç¯å…³ç³»æ£€æµ‹è·Ÿå› å­å›¾ä¼˜åŒ–æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸ºäº†é¿å…å¤æ‚çš„çº¿ç¨‹åŒæ­¥å…³ç³»ï¼Œåœ¨å›ç¯çº¿ç¨‹ä¸­ç”¨å‡ ä¸ªé˜Ÿåˆ—å°†å›ç¯å…³ç³»ç¼“å­˜ï¼Œåœ¨é›·è¾¾é‡Œç¨‹è®¡çº¿ç¨‹ä¸­ä»è¿™å‡ ä¸ªé˜Ÿåˆ—æå–ç›¸åº”çš„å›ç¯å…³ç³»åŠ å…¥å› å­å›¾ã€‚è¿™é‡Œä¸»è¦ç¼“å­˜å‡ ä¸ªå†…å®¹ï¼š1ï¼‰ã€å›ç¯ç´¢å¼•ï¼›2ï¼‰ã€å›ç¯å…³ç³»çš„ä½å§¿è½¬æ¢çŸ©é˜µï¼ˆä¹Ÿå°±æ˜¯ICPçš„ç»“æœï¼‰ï¼›3ï¼‰ã€å™ªå£°å› å­ï¼ˆæ ¹æ®åŒ¹é…çš„åˆ†æ•°è®¡ç®—çš„å™ªå£°ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9. å°†å›ç¯ç´¢å¼•ã€å›ç¯é—´ç›¸å¯¹ä½å§¿ã€å›ç¯å™ªå£°æ¨¡å‹åŠ å…¥å…¨å±€å˜é‡</span></span><br><span class="line">mtx.<span class="built_in">lock</span>();</span><br><span class="line">loopIndexQueue.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(loopKeyCur, loopKeyPre));</span><br><span class="line">loopPoseQueue.<span class="built_in">push_back</span>(poseFrom.<span class="built_in">between</span>(poseTo));</span><br><span class="line">loopNoiseQueue.<span class="built_in">push_back</span>(constraintNoise);</span><br><span class="line">mtx.<span class="built_in">unlock</span>();</span><br></pre></td></tr></table></figure>
<h2 id="å…¨å±€åœ°å›¾å¯è§†åŒ–çº¿ç¨‹">å…¨å±€åœ°å›¾å¯è§†åŒ–çº¿ç¨‹</h2>
<p>è¿™ä¸ªçº¿ç¨‹ä¸»è¦æ˜¯å°†æ‰€æœ‰å†å²å…³é”®å¸§ï¼Œä½¿ç”¨å…³é”®å¸§çš„ä½å§¿ï¼Œå…¨éƒ¨è½¬æ¢åˆ°åœ°å›¾åæ ‡ç³»ä¸‹ï¼Œæ„å»ºä¸€ä¸ªå…¨å±€åœ°å›¾ï¼Œå¹¶å‘å¸ƒã€‚è¿™ä¸ªçº¿ç¨‹å®Œå…¨æ˜¯ä¸ºäº†å¯è§†åŒ–ï¼ŒåŒæ—¶ï¼Œå¤„ç†æ‰€æœ‰çš„å…³é”®å¸§ä¹Ÿéœ€è¦å¾ˆå¤§è®¡ç®—é‡ï¼Œå› æ­¤ï¼Œè¿™ä¸ªçº¿ç¨‹ä¹Ÿè¢«é»˜è®¤é™åˆ¶åœ¨5Hzçš„é¢‘ç‡ä¸‹æ‰§è¡Œã€‚ä¸»è¦æ“ä½œå°±æ˜¯ç‚¹äº‘åæ ‡ç³»è½¬æ¢ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚å‡½æ•°æ˜¯<code>publishGlobalMap</code> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å‘å¸ƒå…¨å±€åœ°å›¾ç‚¹äº‘ï¼Œåœ¨å…¨å±€åœ°å›¾å¯è§†åŒ–çº¿ç¨‹ä¸­è°ƒç”¨</span></span><br><span class="line"><span class="comment">  * 1. å¯¹æ‰€æœ‰å…³é”®å¸§3Dä½å§¿æ„å»ºKDæ ‘</span></span><br><span class="line"><span class="comment">  * 2. ä»¥æœ€åä¸€å¸§å…³é”®å¸§ä¸ºç´¢å¼•æ‰¾å‡ºä¸€å®šåŠå¾„èŒƒå›´å†…çš„æ‰€æœ‰å…³é”®å¸§</span></span><br><span class="line"><span class="comment">  * 3. å¯¹æ‰¾å‡ºçš„å…³é”®å¸§æ•°é‡åšé™é‡‡æ ·</span></span><br><span class="line"><span class="comment">  * 4. å¯¹æ‰€æœ‰å…³é”®å¸§çš„ç‚¹äº‘åšæ‹¼æ¥ï¼ˆæŠ•å½±åˆ°åœ°å›¾åæ ‡ç³»ï¼‰</span></span><br><span class="line"><span class="comment">  * 5. å¯¹åœ°å›¾ç‚¹äº‘åšé™é‡‡æ ·</span></span><br><span class="line"><span class="comment">  * 6. å‘å¸ƒå…¨å±€åœ°å›¾ç‚¹äº‘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">publishGlobalMap</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/06/lio_sam/pcdRegistration-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-04-06 23:17:19" itemprop="dateCreated datePublished" datetime="2023-04-06T23:17:19+08:00">2023-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-20 22:01:43" itemprop="dateModified" datetime="2023-04-20T22:01:43+08:00">2023-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/04/06/lio_sam/pcdRegistration-doc/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£" href="/2023/04/06/lio_sam/pcdRegistration-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::6bd455643b6442d6e43dd9a0a5cd9a7a" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­æ¿€å…‰å†ç¨‹è®¡çš„ç‚¹äº‘åŒ¹é…æ–¹æ³•æ²¿ç”¨è‡ª<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>ï¼Œè¿™ä¸ªåŸºäºç‚¹åˆ°çº¿å’Œç‚¹åˆ°é¢è·ç¦»æ±‚è§£æœ€å°äºŒä¹˜é—®é¢˜çš„æ–¹æ³•èµ·å§‹è¢«ç”¨åˆ°å¾ˆå¤šæ¡†æ¶ï¼ŒåŒ…æ‹¬<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>,<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>,<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">Lego-LOAM</a>,å„ç§LOAMçš„å˜ç§ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>åŠå…¶å˜ç§ã€‚è¿™æ®µç‚¹äº‘åŒ¹é…ä»£ç å¯ä»¥è¯´è¢«é‡ç”¨äº†å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯å„ä¸ªè®ºæ–‡å¯¹è¿™éƒ¨åˆ†çš„æè¿°å®é™…ä¸Šå¾ˆå°‘æˆ–è€…åŸºæœ¬çœç•¥ï¼Œ<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>åŸå§‹è®ºæ–‡å¯¹è¿™éƒ¨åˆ†çš„æè¿°ä¸å®é™…çš„ä»£ç å®ç°å·®åˆ«æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´å¦‚æœæƒ³çœŸæ­£çœ‹æ‡‚è¿™æ®µä»£ç è¿˜æ˜¯æŒºéš¾çš„ã€‚è¿™ç¯‡æ–‡ç« è¯¦ç»†åœ°å‰–æè¿™éƒ¨åˆ†çš„åŸç†ã€å®ç°ã€ä»¥åŠä¸è®ºæ–‡ä¸­ä¸åŒä¹‹å¤„ã€‚è¿™é‡Œé¢å”¯ä¸€æœ‰ä¸€ç‚¹è¿˜æ²¡æœ‰ææ¸…æ¥šçš„æ˜¯å¯¹äº <a href="#Degenerate">é«˜æ–¯çŸ©é˜µé€€åŒ–</a>éƒ¨åˆ†çš„å®ç°ã€‚</p>
<p>ç”±äºæœ¬æ–‡ä¸»è¦æ˜¯æƒ³è®²æ˜ç™½åœ¨ä¸Šè¿°è¿™äº›SLAMæ¡†æ¶ä¸­ç‚¹äº‘åŒ¹é…çš„å®ç°ï¼Œå› æ­¤å¯¹äºæœ€å°äºŒä¹˜é—®é¢˜çš„æ±‚è§£ä¸ä¼šè¯¦ç»†å±•å¼€ï¼Œéœ€è¦è¿™éƒ¨åˆ†çŸ¥è¯†å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/113946848">æœ€å°äºŒä¹˜é—®é¢˜æ±‚è§£çš„å››ç§è§£æ³•</a>æˆ–è€…ã€Šè§†è§‰SLAMåå››è®²ã€‹ä¸­å…³äºæœ€å°äºŒä¹˜é—®é¢˜æ±‚è§£çš„ç« èŠ‚ã€‚</p>
<h2 id="ç‚¹äº‘-å±€éƒ¨åœ°å›¾åŒ¹é…æµç¨‹scan-2-map">ç‚¹äº‘-å±€éƒ¨åœ°å›¾åŒ¹é…æµç¨‹Scan-2-Map</h2>
<p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ï¼Œå¯¹äºæ¯ä¸€å¸§ç‚¹äº‘<span class="math inline">\(\mathbb{F}_i\)</span>ä¼šå…ˆè¿›è¡Œç‰¹å¾ç‚¹æå–ã€‚ç‰¹å¾ç‚¹åŒ…æ‹¬çº¿ç‰¹å¾ç‚¹å’Œå¹³é¢ç‰¹å¾ç‚¹ï¼ˆå…·ä½“æ–¹æ³•å‚è€ƒæœ¬åšå®¢æ–‡ç« ï¼š<a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a>)ã€‚æˆ‘ä»¬è®°æå–åçš„çº¿ç‰¹å¾ç‚¹äº‘ä¸º<span class="math inline">\(F^e_i\)</span>ï¼Œå¹³é¢ç‰¹å¾ç‚¹äº‘ä¸º<span class="math inline">\(F^p_i\)</span>ã€‚</p>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´å<span class="math inline">\(1,2,3,...,i-1\)</span>åï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸€ç³»åˆ—å…³é”®å¸§çš„çº¿ç‰¹å¾ç‚¹äº‘<span class="math inline">\(F^e_1,F^e_2,F^e_3,...,F^e_{i-1}\)</span>å’Œå¹³é¢ç‰¹å¾ç‚¹äº‘<span class="math inline">\(F^p_1,F^p_2,F^p_3,...,F^p_{i-1}\)</span>ï¼Œä»¥åŠè¿™äº›å…³é”®å¸§å¯¹åº”çš„ä½å§¿<span class="math inline">\(T_1,T_2,T_3,...,T_{i-1}\)</span>. åŒæ—¶å¯¹äºç‚¹äº‘<span class="math inline">\(\mathbb{F}_i\)</span>ï¼Œæˆ‘ä»¬é€šè¿‡IMUé‡Œç¨‹è®¡è¿˜å¯ä»¥è·å¾—è¯¥å¸§ç‚¹äº‘çš„åˆå§‹ä½å§¿ä¼°è®¡<span class="math inline">\(\hat{T}_i\)</span>ï¼Œè¿™ä¸ªä½å§¿ä¼°è®¡<span class="math inline">\(\hat{T}_i\)</span>å…¶å®å°±æ˜¯æˆ‘ä»¬è¦ä¼˜åŒ–çš„é‡ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ï¼Œæ¿€å…‰é‡Œç¨‹è®¡åŒ¹é…çš„æ˜¯å½“å‰å¸§ç‚¹äº‘å’Œå±€éƒ¨åœ°å›¾ã€‚å±€éƒ¨åœ°å›¾æ˜¯é€šè¿‡å½“å‰å¸§ç©ºé—´ä»¥åŠæ—¶é—´è¿‘é‚»çš„å…¶ä»–å…³é”®å¸§æ„å»ºçš„ã€‚ <img src="./imgs/Design-mapOptimization-scan2MapOpt.png" alt="scan2MapOptimization" /></p>
<p>å¯¹äºä»»ä½•ä¸€å¸§ç‚¹äº‘ä»¥åŠå¯¹åº”çš„ä½å§¿ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç‚¹äº‘è½¬æ¢åˆ°åœ°å›¾åæ ‡ç³»ï¼š <span class="math display">\[\mathbb{F}^m_i = R_i\mathbb{F}_i+t_i\]</span> å…¶ä¸­<span class="math inline">\(m\)</span>ä¸Šæ ‡æŒ‡çš„æ˜¯åœ°å›¾åæ ‡ç³»ï¼Œ<span class="math inline">\(R_i\)</span>å’Œ<span class="math inline">\(t_i\)</span>æ˜¯ä½å§¿<span class="math inline">\(T_i\)</span>ä¸­çš„æ—‹è½¬çŸ©é˜µå’Œå¹³ç§»å‘é‡ã€‚</p>
<p>å¯¹é€‰æ‹©ä¸ºæ„å»ºå±€éƒ¨åœ°å›¾çš„å…³é”®å¸§åˆ†åˆ«åº”ç”¨ä¸Šå¼å¹¶ç´¯åŠ èµ·æ¥ï¼ˆå®é™…ç´¯åŠ åä¼šè¿›è¡Œä½“ç´ é™é‡‡æ ·ï¼‰åå°±æ„æˆå±€éƒ¨åœ°å›¾<span class="math inline">\(M^e_i\)</span>å’Œ<span class="math inline">\(M^p_i\)</span>ï¼Œ<span class="math inline">\(e\)</span>å’Œ<span class="math inline">\(p\)</span>ä¸‹æ ‡è¡¨ç¤ºedgeå’Œplannerã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬å¯¹å½“å‰å¸§çš„ç‰¹å¾ç‚¹äº‘<span class="math inline">\(F^e_i\)</span>å’Œ<span class="math inline">\(F^p_i\)</span>åº”ç”¨ä½å§¿çš„åˆå§‹ä¼°è®¡<span class="math inline">\(\hat{T}_i\)</span>å¯ä»¥å¾—åˆ°åœ¨è¿‘ä¼¼åœ°å›¾åæ ‡ç³»ä¸‹çš„ç‚¹äº‘ã€‚ä¸ºäº†æ–¹ä¾¿åé¢å™è¿°ï¼Œè¿™é‡Œçœç•¥åæ ‡ç³»å’Œå…³é”®å¸§ç´¢å¼•çš„ä¸Šä¸‹æ ‡ã€‚é‡ç”³ä¸€ä¸‹æˆ‘ä»¬çš„è¾“å…¥ï¼š</p>
<ol type="1">
<li>åœ°å›¾åæ ‡ç³»ä¸‹çš„å±€éƒ¨ç‚¹äº‘åœ°å›¾<span class="math inline">\(M^e\)</span>å’Œ<span class="math inline">\(M^p\)</span></li>
<li>é›·è¾¾åæ ‡ç³»ä¸‹çš„å½“å‰å¸§ç‰¹å¾ç‚¹äº‘<span class="math inline">\(F^e\)</span>å’Œ<span class="math inline">\(F^p\)</span></li>
<li>å½“å‰å¸§çš„åˆå§‹ä½å§¿ä¼°è®¡<span class="math inline">\(\hat{T}_i=[\hat{R}_i,\hat{t}_i]\)</span></li>
</ol>
<p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ä¼˜åŒ–ä½å§¿<span class="math inline">\(T_i\)</span>ä½¿å¾—ç”¨è¿™ä¸ªä½å§¿å°†<span class="math inline">\(F^e\)</span>å’Œ<span class="math inline">\(F^p\)</span>è½¬æ¢åˆ°åœ°å›¾åæ ‡ç³»åä¸åœ°å›¾ç‚¹äº‘çš„åŒ¹é…ç¨‹åº¦æœ€å¥½ã€‚</p>
<h2 id="å‡ ä½•ç›¸å…³çŸ¥è¯†">å‡ ä½•ç›¸å…³çŸ¥è¯†</h2>
<h3 id="ç‚¹åˆ°çº¿è·ç¦»">ç‚¹åˆ°çº¿è·ç¦»</h3>
<h4 id="è®ºæ–‡ä¸­è®¡ç®—æ–¹æ³•">è®ºæ–‡ä¸­è®¡ç®—æ–¹æ³•</h4>
<figure>
<img src="./imgs/LOAM-fig7.png" alt="" /><figcaption>LOAMè®ºæ–‡å›¾7ï¼šå±•ç¤ºå¦‚ä½•æ ¹æ®å½“å‰å¸§çš„è¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹åœ¨å±€éƒ¨åœ°å›¾ä¸­æ‰¾åˆ°å¯¹åº”çš„çº¿å’Œå¹³é¢</figcaption>
</figure>
<p>ä¸Šå›¾çš„å­å›¾ï¼ˆaï¼‰å±•ç¤ºå¦‚ä½•å¯¹å½“å‰å¸§è¾¹ç¼˜ç‚¹ç‚¹é›†<span class="math inline">\(F^e\)</span>ä¸­çš„æ¯ä¸€ä¸ªç‚¹ä»å±€éƒ¨åœ°å›¾<span class="math inline">\(M^e\)</span>ä¸­æ‰¾åˆ°å¯¹åº”çš„ç›´çº¿ã€‚å¯¹äºæ¯ä¸€ä¸ªè¾¹ç¼˜ç‚¹<span class="math inline">\(P^{F^e}_i \in F^e\)</span>ï¼Œä»å±€éƒ¨åœ°å›¾çš„è¾¹ç¼˜ç‚¹é›†åˆ<span class="math inline">\(M^e\)</span>ä¸­æ‰¾åˆ°æœ€è¿‘ç‚¹<span class="math inline">\(P^{M^e}_j\)</span>ï¼Œæ©˜è‰²çº¿æ˜¯ç‚¹<span class="math inline">\(j\)</span>æ‰€åœ¨çš„æ¿€å…‰çº¿æŸï¼Œè“è‰²çº¿æ˜¯å‰åç›¸è¿‘çš„å¦å¤–ä¸¤æ¡æ¿€å…‰çº¿æŸã€‚ä»å‰åä¸¤æ¡æ¿€å…‰çº¿æŸï¼ˆè“è‰²çº¿ï¼‰æ‰¾å‡ºä¸<span class="math inline">\(e_i\)</span>è·ç¦»æœ€è¿‘çš„ç‚¹ï¼Œå¹¶é€‰æ‹©ä¸¤è€…ä¸­è·ç¦»æ›´å°çš„ç‚¹ä½œä¸ºç‚¹<span class="math inline">\(P^{M^e}_l\)</span>ï¼Œåˆ™ç»è¿‡ç‚¹<span class="math inline">\(P^{M^e}_j\)</span>ã€<span class="math inline">\(P^{M^e}_l\)</span>ç»„æˆçš„çº¿ä¸ºç‚¹<span class="math inline">\(P^{F^e}_i\)</span>å¯¹åº”çš„ç›´çº¿ã€‚é‚£ä¹ˆé—®é¢˜å°±è½¬åŒ–ä¸ºç‚¹<span class="math inline">\(P^{F^e}_i\)</span>åˆ°ç»è¿‡ç‚¹<span class="math inline">\(P^{M^e}_j\)</span>ã€<span class="math inline">\(P^{M^e}_l\)</span>çš„ç›´çº¿çš„è·ç¦»ã€‚</p>
<p>è¯¥è·ç¦»è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
d_{e}=\frac{|(P^{F^e}_i - P^{M^e}_j)\times (P^{F^e}_i - P^{M^e}_l)|}{|(P^{M^e}_j - P^{M^e}_l)|}\tag{1}
\]</span></p>
<p>å…¬å¼ï¼ˆ1ï¼‰ä¸­åˆ†å­éƒ¨åˆ†è®¡ç®—çš„æ˜¯å‘é‡<span class="math inline">\((P^{F^e}_i - P^{M^e}_j)\)</span>å’Œ<span class="math inline">\((P^{F^e}_i - P^{M^e}_l)\)</span>çš„å‰ç§¯çš„æ¨¡é•¿ã€‚ä¸¤ä¸ªå‘é‡çš„å‰ç§¯æ˜¯ä¸€ä¸ªå‘é‡ï¼Œæ–¹å‘äºä¸¤ä¸ªå‘é‡æ„æˆçš„å¹³é¢å‚ç›´ï¼Œæ¨¡é•¿ç­‰äºä¸¤ä¸ªå‘é‡ç»„æˆçš„å¹³è¡Œå››è¾¹å½¢é¢ç§¯ã€‚å…¬å¼ï¼ˆ1ï¼‰çš„åˆ†æ¯ä»£è¡¨çš„æ˜¯è¯¥å¹³è¡Œå››è¾¹å½¢å¯¹è§’çº¿çš„é•¿åº¦ã€‚å› æ­¤åˆ†å­é™¤ä»¥åˆ†æ¯å°±ç­‰äºç›´çº¿å¤–ä¸€ç‚¹åˆ°ç›´çº¿çš„è·ç¦»ã€‚</p>
<h4 id="ä»£ç ä¸­è®¡ç®—æ–¹æ³•">ä»£ç ä¸­è®¡ç®—æ–¹æ³•</h4>
<p>åœ¨è®ºæ–‡ä¸­å¯¹<span class="math inline">\(F^e\)</span>çš„ç‚¹æ‰¾åˆ°<span class="math inline">\(M^e\)</span>å¯¹åº”çš„ç›´çº¿æ˜¯é€šè¿‡æ‰¾åˆ°ä¸¤ä¸ªè·ç¦»æœ€è¿‘çš„ç‚¹ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­æ˜¯æ‰¾åˆ°è·ç¦»æœ€è¿‘çš„5ä¸ªç‚¹ï¼Œç„¶åè®¡ç®—è¿™5ä¸ªç‚¹çš„åæ–¹å·®ï¼Œå¯¹åæ–¹å·®åšç‰¹å¾å€¼åˆ†è§£ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ä¸ºä¸»æ–¹å‘ï¼Œå¹¶åˆ¤æ–­è¿™5ä¸ªç‚¹çš„åˆ†å¸ƒæ˜¯å¦æ¥è¿‘ç›´çº¿çš„è¦æ±‚ã€‚ ä»£ç ä¸­å¯»æ‰¾ç‚¹åˆ°å±€éƒ¨åœ°å›¾çš„å¯¹åº”ç›´çº¿ï¼Œç„¶åè®¡ç®—è·ç¦»å’Œæ³•å‘é‡ä¸»è¦æ˜¯åœ¨<code>mapOptimization</code>ä¸­çš„å‡½æ•°<code>cornerOptimization</code>ä¸­å®Œæˆã€‚</p>
<ol type="1">
<li>å¯¹ç‚¹é›†<span class="math inline">\(F^e\)</span>ä¸­çš„ç‚¹ä»å±€éƒ¨åœ°å›¾<span class="math inline">\(M^e\)</span>ä¸­æ‰¾åˆ°æœ€è¿‘5ä¸ªç‚¹</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»å±€éƒ¨åœ°å›¾ï¼ˆå·²ç»æå‰è®¾ç½®å¥½kdtreeï¼‰ä¸­æ‰¾åˆ°æœ€è¿‘çš„5ä¸ªç‚¹</span></span><br><span class="line"><span class="comment">// pointSelä¸ºæ£€ç´¢ç‚¹</span></span><br><span class="line"><span class="comment">// pointSearchIndå­˜å‚¨æ£€ç´¢ç»“æœçš„5ä¸ªç‚¹åœ¨åŸå§‹ç‚¹äº‘ä¸­çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">// pointSearchSqDiså­˜å‚¨æ£€ç´¢å‡ºçš„5ä¸ªç‚¹ä¸æ£€ç´¢ç‚¹çš„è·ç¦»çš„å¹³æ–¹</span></span><br><span class="line">kdtreeCornerFromMap-&gt;<span class="built_in">nearestKSearch</span>(pointSel, <span class="number">5</span>, pointSearchInd, pointSearchSqDis);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>è®¡ç®—è¿™5ä¸ªç‚¹çš„åæ–¹å·®çŸ©é˜µ</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cx,cy,czæ˜¯æ£€ç´¢å‡ºçš„5ä¸ªç‚¹çš„ä¸­å¿ƒåæ ‡</span></span><br><span class="line"><span class="type">float</span> cx = <span class="number">0</span>, cy = <span class="number">0</span>, cz = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">    cx += laserCloudCornerFromMapDS-&gt;points[pointSearchInd[j]].x;</span><br><span class="line">    cy += laserCloudCornerFromMapDS-&gt;points[pointSearchInd[j]].y;</span><br><span class="line">    cz += laserCloudCornerFromMapDS-&gt;points[pointSearchInd[j]].z;</span><br><span class="line">&#125;</span><br><span class="line">cx /= <span class="number">5</span>; cy /= <span class="number">5</span>;  cz /= <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åæ–¹å·®çŸ©é˜µæ˜¯å¯¹ç§°çŸ©é˜µ</span></span><br><span class="line"><span class="type">float</span> a11 = <span class="number">0</span>, a12 = <span class="number">0</span>, a13 = <span class="number">0</span>, a22 = <span class="number">0</span>, a23 = <span class="number">0</span>, a33 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">    <span class="type">float</span> ax = laserCloudCornerFromMapDS-&gt;points[pointSearchInd[j]].x - cx;</span><br><span class="line">    <span class="type">float</span> ay = laserCloudCornerFromMapDS-&gt;points[pointSearchInd[j]].y - cy;</span><br><span class="line">    <span class="type">float</span> az = laserCloudCornerFromMapDS-&gt;points[pointSearchInd[j]].z - cz;</span><br><span class="line"></span><br><span class="line">    a11 += ax * ax; a12 += ax * ay; a13 += ax * az;</span><br><span class="line">    a22 += ay * ay; a23 += ay * az;</span><br><span class="line">    a33 += az * az;</span><br><span class="line">&#125;</span><br><span class="line">a11 /= <span class="number">5</span>; a12 /= <span class="number">5</span>; a13 /= <span class="number">5</span>; a22 /= <span class="number">5</span>; a23 /= <span class="number">5</span>; a33 /= <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨åæ–¹å·®çš„å€¼åˆ°matA1</span></span><br><span class="line">matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">0</span>) = a11; matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">1</span>) = a12; matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">2</span>) = a13;</span><br><span class="line">matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>, <span class="number">0</span>) = a12; matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>, <span class="number">1</span>) = a22; matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>, <span class="number">2</span>) = a23;</span><br><span class="line">matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">2</span>, <span class="number">0</span>) = a13; matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">2</span>, <span class="number">1</span>) = a23; matA1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">2</span>, <span class="number">2</span>) = a33;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>è®¡ç®—ç›´çº¿æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯ç‰¹å¾å€¼åˆ†è§£ï¼Œæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ä¸ºæ•°æ®ä¸»æ–¹å‘</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹åæ–¹å·®çŸ©é˜µåšç‰¹å¾å€¼åˆ†è§£ï¼Œæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡æ˜¯è¿™5ä¸ªç‚¹çš„ä¸»æ–¹å‘</span></span><br><span class="line">cv::<span class="built_in">eigen</span>(matA1, matD1, matV1);</span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>è®¡ç®—ç‚¹åˆ°ç›´çº¿è·ç¦»</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥ä¸‹éƒ¨åˆ†æ˜¯åœ¨è®¡ç®—å½“å‰ç‚¹pointSelåˆ°æ£€ç´¢å‡ºçš„ç›´çº¿çš„è·ç¦»å’Œæ–¹å‘ï¼Œå¦‚æœè·ç¦»å¤Ÿè¿‘ï¼Œåˆ™è®¤ä¸ºåŒ¹é…æˆåŠŸï¼Œå¦åˆ™è®¤ä¸ºåŒ¹é…å¤±è´¥</span></span><br><span class="line"><span class="comment">// x0,y0,z0æ˜¯ç›´çº¿å¤–ä¸€ç‚¹</span></span><br><span class="line"><span class="type">float</span> x0 = pointSel.x;</span><br><span class="line"><span class="type">float</span> y0 = pointSel.y;</span><br><span class="line"><span class="type">float</span> z0 = pointSel.z;</span><br><span class="line"><span class="comment">// matV1çš„ç¬¬ä¸€è¡Œå°±æ˜¯5ä¸ªç‚¹å½¢æˆçš„ç›´çº¿çš„æ–¹å‘ï¼Œcx,cy,czæ˜¯5ä¸ªç‚¹çš„ä¸­å¿ƒç‚¹</span></span><br><span class="line"><span class="comment">// å› æ­¤ï¼Œx1,y1,z1å’Œx2,y2,z2æ˜¯ç»è¿‡ä¸­å¿ƒç‚¹çš„ç›´çº¿ä¸Šçš„å¦å¤–ä¸¤ä¸ªç‚¹ï¼Œä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»æ˜¯0.2ç±³</span></span><br><span class="line"><span class="type">float</span> x1 = cx + <span class="number">0.1</span> * matV1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="type">float</span> y1 = cy + <span class="number">0.1</span> * matV1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"><span class="type">float</span> z1 = cz + <span class="number">0.1</span> * matV1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"><span class="type">float</span> x2 = cx - <span class="number">0.1</span> * matV1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="type">float</span> y2 = cy - <span class="number">0.1</span> * matV1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"><span class="type">float</span> z2 = cz - <span class="number">0.1</span> * matV1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™è¾¹æ˜¯åœ¨æ±‚[(x0-x1),(y0-y1),(z0-z1)]ä¸[(x0-x2),(y0-y2),(z0-z2)]å‰ä¹˜å¾—åˆ°çš„å‘é‡çš„æ¨¡é•¿</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ¨¡é•¿æ˜¯ç”±0.2*V1[0]å’Œç‚¹[x0,y0,z0]æ„æˆçš„å¹³è¡Œå››è¾¹å½¢çš„é¢ç§¯</span></span><br><span class="line"><span class="comment">// å‚ç›´äº0,1,2ä¸‰ç‚¹æ„æˆçš„å¹³é¢çš„å‘é‡[XXX,YYY,ZZZ] = [(y0-y1)(z0-z2)-(y0-y2)(z0-z1),-(x0-x1)(z0-z2)+(x0-x2)(z0-z1),(x0-x1)(y0-y2)-(x0-x2)(y0-y1)]</span></span><br><span class="line"><span class="type">float</span> a012 = <span class="built_in">sqrt</span>(((x0 - x1)*(y0 - y2) - (x0 - x2)*(y0 - y1)) * ((x0 - x1)*(y0 - y2) - (x0 - x2)*(y0 - y1)) </span><br><span class="line">                + ((x0 - x1)*(z0 - z2) - (x0 - x2)*(z0 - z1)) * ((x0 - x1)*(z0 - z2) - (x0 - x2)*(z0 - z1)) </span><br><span class="line">                + ((y0 - y1)*(z0 - z2) - (y0 - y2)*(z0 - z1)) * ((y0 - y1)*(z0 - z2) - (y0 - y2)*(z0 - z1)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// l12è¡¨ç¤ºçš„æ˜¯0.2*(||V1[0]||)</span></span><br><span class="line"><span class="comment">// ç‚¹x1,y1,z1åˆ°ç‚¹x2,y2,z2çš„è·ç¦»</span></span><br><span class="line"><span class="type">float</span> l12 = <span class="built_in">sqrt</span>((x1 - x2)*(x1 - x2) + (y1 - y2)*(y1 - y2) + (z1 - z2)*(z1 - z2));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ±‚å‰ä¹˜ç»“æœ[la&#x27;,lb&#x27;,lc&#x27;]=[(x1-x2),(y1-y2),(z1-z2)]x[XXX,YYY,ZZZ]</span></span><br><span class="line"><span class="comment">// [la,lb,lc]=[la&#x27;,lb&#x27;,lc&#x27;]/a012/l12</span></span><br><span class="line"><span class="comment">// LLL=[la,lb,lc]æ˜¯0.2*V1[0]è¿™æ¡é«˜ä¸Šçš„å•ä½æ³•å‘é‡ã€‚||LLL||=1ï¼›</span></span><br><span class="line"><span class="type">float</span> la = ((y1 - y2)*((x0 - x1)*(y0 - y2) - (x0 - x2)*(y0 - y1)) </span><br><span class="line">          + (z1 - z2)*((x0 - x1)*(z0 - z2) - (x0 - x2)*(z0 - z1))) / a012 / l12;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> lb = -((x1 - x2)*((x0 - x1)*(y0 - y2) - (x0 - x2)*(y0 - y1)) </span><br><span class="line">            - (z1 - z2)*((y0 - y1)*(z0 - z2) - (y0 - y2)*(z0 - z1))) / a012 / l12;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> lc = -((x1 - x2)*((x0 - x1)*(z0 - z2) - (x0 - x2)*(z0 - z1)) </span><br><span class="line">            + (y1 - y2)*((y0 - y1)*(z0 - z2) - (y0 - y2)*(z0 - z1))) / a012 / l12;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ld2å°±æ˜¯ç‚¹pointSel(x0,y0,z0)åˆ°ç›´çº¿çš„è·ç¦»</span></span><br><span class="line"><span class="type">float</span> ld2 = a012 / l12;</span><br></pre></td></tr></table></figure>
<h3 id="ç‚¹åˆ°é¢è·ç¦»">ç‚¹åˆ°é¢è·ç¦»</h3>
<h4 id="è®ºæ–‡ä¸­è®¡ç®—æ–¹æ³•-1">è®ºæ–‡ä¸­è®¡ç®—æ–¹æ³•</h4>
<p>å†æ¬¡è´´å‡ºè®ºæ–‡ä¸­çš„å›¾</p>
<figure>
<img src="./imgs/LOAM-fig7.png" alt="" /><figcaption>LOAMè®ºæ–‡å›¾7ï¼šå±•ç¤ºå¦‚ä½•æ ¹æ®å½“å‰å¸§çš„è¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹åœ¨å±€éƒ¨åœ°å›¾ä¸­æ‰¾åˆ°å¯¹åº”çš„çº¿å’Œå¹³é¢</figcaption>
</figure>
<p>ä¸è®¡ç®—ç‚¹åˆ°ç›´çº¿çš„è·ç¦»ç±»ä¼¼ï¼Œå¯¹äºä¸€ä¸ªå¹³é¢ç‚¹<span class="math inline">\(P^{F^p}_i \in F^p\)</span>ï¼Œä»å±€éƒ¨åœ°å›¾å¹³é¢ç‚¹é›†<span class="math inline">\(M^p\)</span>ä¸­æ‰¾åˆ°æœ€è¿‘ç‚¹<span class="math inline">\(P^{M^p}_j\)</span>ï¼Œå†ä»è¯¥ç‚¹æ‰€åœ¨çš„æ¿€å…‰çº¿æŸæ‰¾åˆ°å¦ä¸€ä¸ªç‚¹<span class="math inline">\(P^{M^p}_l\)</span>ä»¥åŠå‰åä¸¤æ¡æ¿€å…‰çº¿æŸä¸­æ‰¾åˆ°å¦å¤–ä¸€ä¸ªæœ€è¿‘ç‚¹<span class="math inline">\(P^{M^p}_m\)</span>ï¼Œè¿™æ ·å°±ç¡®ä¿äº†ä¸‰ä¸ªç‚¹ä¸ä¼šå…±çº¿ã€‚ é‚£ä¹ˆé—®é¢˜å°±è½¬åŒ–ä¸ºå·²çŸ¥ç»è¿‡ä¸‰ä¸ªç‚¹<span class="math inline">\(P^{M^p}_{jlm}\)</span>çš„å¹³é¢ï¼Œæ±‚å¹³é¢å¤–ä¸€ç‚¹<span class="math inline">\(P^{F^p}_i\)</span>åˆ°è¯¥å¹³é¢çš„è·ç¦» é¦–å…ˆï¼Œæ ¹æ®ä¸‰ä¸ªç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—è¯¥å¹³é¢çš„æ³•å‘é‡ï¼Œå¹¶å½’ä¸€åŒ–ä¸ºå•ä½æ³•å‘é‡</p>
<p><span class="math display">\[
n_{jlm}=(P^{M^p}_j - P^{M^p}_l)\times (P^{M^p}_j - P^{M^p}_m)
\]</span></p>
<p><span class="math display">\[
n_{jlm} = \frac{n_{jlm}}{|n_{jlm}|}
\]</span></p>
<p>äºæ˜¯ï¼Œç‚¹åˆ°å¹³é¢çš„è·ç¦»ä¸º <span class="math display">\[
d_p = |(P^{F^p}_i - P^{M^p}_j)n_{jlm}|\tag{2}
\]</span></p>
<h4 id="ä»£ç ä¸­è®¡ç®—æ–¹æ³•-1">ä»£ç ä¸­è®¡ç®—æ–¹æ³•</h4>
<p>åœ¨ä»£ç ä¸­ï¼Œä¹Ÿæ˜¯å…ˆæ ¹æ®ç‚¹<span class="math inline">\(P^{F^p}_i\)</span>ä»å±€éƒ¨åœ°å›¾å¹³é¢ç‚¹é›†ä¸­æ‰¾åˆ°æœ€è¿‘çš„5ä¸ªç‚¹ï¼Œç„¶åå¯¹è¿™5ä¸ªç‚¹ç”¨æœ€å°äºŒä¹˜æ³•ï¼ˆæ±‚è§£è¶…å®šæ–¹ç¨‹ï¼‰å¾—åˆ°æ‹Ÿåˆå¹³é¢çš„æ³•å‘é‡ã€‚å¾—åˆ°å¹³é¢æ–¹ç¨‹åå°±å¯ä»¥ç›´æ¥è®¡ç®—ç‚¹åˆ°å¹³é¢çš„è·ç¦»äº†ã€‚è¿™éƒ¨åˆ†ä»£ç åœ¨<code>mapOptimization.cpp</code>ä¸­<code>surfOptimization</code>å‡½æ•°</p>
<ol type="1">
<li>ä»å±€éƒ¨åœ°å›¾æ‰¾åˆ°è·ç¦»æœ€è¿‘çš„5ä¸ªç‚¹</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸è¾¹ç¼˜ç‚¹æ‰¾ç›´çº¿ä¸€æ ·ï¼Œä»å±€éƒ¨åœ°å›¾çš„å¹³é¢ç‚¹é›†ä¸­æ‰¾åˆ°ä¸pointSelè·ç¦»æœ€è¿‘çš„5ä¸ªç‚¹</span></span><br><span class="line">kdtreeSurfFromMap-&gt;<span class="built_in">nearestKSearch</span>(pointSel, <span class="number">5</span>, pointSearchInd, pointSearchSqDis);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>æ±‚è§£æ–¹ç¨‹Ax+By+Cz+1=0æ–¹ç¨‹</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹é¢çš„è¿‡ç¨‹è¦æ±‚è§£Ax+By+Cz+1=0çš„å¹³é¢æ–¹ç¨‹</span></span><br><span class="line"><span class="comment">// ç”±äºæœ‰5ä¸ªç‚¹ï¼Œå› æ­¤æ˜¯æ±‚è§£è¶…å®šæ–¹ç¨‹</span></span><br><span class="line"><span class="comment">// å‡è®¾5ä¸ªç‚¹éƒ½åœ¨å¹³é¢ä¸Šï¼Œåˆ™matA0æ˜¯ç³»æ•°çŸ©é˜µï¼ŒmatB0æ˜¯ç­‰å·å³è¾¹çš„å€¼ï¼ˆéƒ½æ˜¯-1ï¼‰ï¼›matX0æ˜¯æ±‚å‡ºæ¥çš„Aï¼ŒBï¼ŒC</span></span><br><span class="line">Eigen::Matrix&lt;<span class="type">float</span>, <span class="number">5</span>, <span class="number">3</span>&gt; matA0;</span><br><span class="line">Eigen::Matrix&lt;<span class="type">float</span>, <span class="number">5</span>, <span class="number">1</span>&gt; matB0;</span><br><span class="line">Eigen::Vector3f matX0;</span><br><span class="line"></span><br><span class="line">matA0.<span class="built_in">setZero</span>();</span><br><span class="line">matB0.<span class="built_in">fill</span>(<span class="number">-1</span>);</span><br><span class="line">matX0.<span class="built_in">setZero</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">    <span class="built_in">matA0</span>(j, <span class="number">0</span>) = laserCloudSurfFromMapDS-&gt;points[pointSearchInd[j]].x;</span><br><span class="line">    <span class="built_in">matA0</span>(j, <span class="number">1</span>) = laserCloudSurfFromMapDS-&gt;points[pointSearchInd[j]].y;</span><br><span class="line">    <span class="built_in">matA0</span>(j, <span class="number">2</span>) = laserCloudSurfFromMapDS-&gt;points[pointSearchInd[j]].z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œæ˜¯æ±‚è§£matA0XmatX0 = matB0æ–¹ç¨‹</span></span><br><span class="line">matX0 = matA0.<span class="built_in">colPivHouseholderQr</span>().<span class="built_in">solve</span>(matB0);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>æ±‚ç‚¹åˆ°å¹³é¢è·ç¦»</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> pa = <span class="built_in">matX0</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="type">float</span> pb = <span class="built_in">matX0</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="type">float</span> pc = <span class="built_in">matX0</span>(<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"><span class="type">float</span> pd = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ï¼ˆpa,pb,pc)æ˜¯å¹³é¢çš„æ³•å‘é‡ï¼Œè¿™é‡Œæ˜¯å¯¹æ³•å‘é‡è§„ä¸€åŒ–ï¼Œå˜æˆå•ä½æ³•å‘é‡</span></span><br><span class="line"><span class="type">float</span> ps = <span class="built_in">sqrt</span>(pa * pa + pb * pb + pc * pc);</span><br><span class="line">pa /= ps; pb /= ps; pc /= ps; pd /= ps;</span><br></pre></td></tr></table></figure>
<h2 id="æœ€å°äºŒä¹˜é—®é¢˜æ±‚è§£">æœ€å°äºŒä¹˜é—®é¢˜æ±‚è§£</h2>
<p>ä»å‰é¢ä¸¤æ­¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€äº›è¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹åˆ°å±€éƒ¨åœ°å›¾çš„è·ç¦»å’Œè·ç¦»å‘é‡ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ä¼˜åŒ–è¿™äº›è·ç¦»ã€‚ç”±äºæˆ‘ä»¬ç°åœ¨æœ‰6ä¸ªæœªçŸ¥æ•°ï¼Œä¹Ÿå°±æ˜¯ä½å§¿çš„6ä¸ªè‡ªç”±åº¦<span class="math inline">\(T_i=[t_x,t_y,t_z,roll,pitch,yaw]\)</span>ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç‚¹è¶…è¿‡6ä¸ªï¼Œå› æ­¤æ˜¯æ±‚è§£æœ€å°äºŒä¹˜é—®é¢˜ã€‚</p>
<p>æœ€å°äºŒä¹˜é—®é¢˜æ˜¯æœ€ä¼˜åŒ–é‡Œçš„åŸºç¡€é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å±•å¼€å…¬å¼æ¨å¯¼äº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/113946848">æœ€å°äºŒä¹˜é—®é¢˜æ±‚è§£çš„å››ç§è§£æ³•</a>ã€‚</p>
<p>å¸¸è§çš„æ±‚è§£æœ€å°äºŒä¹˜é—®é¢˜æœ‰é«˜æ–¯ç‰›é¡¿æ³•ï¼ˆGauss-Newton Methodï¼‰å’Œåˆ—æ¸©ä¼¯æ ¼é©¬å¤¸å…‹æ³•ï¼ˆLevernberg-Marquateï¼‰ï¼Œåè€…æ˜¯å‰è€…çš„æ”¹è¿›ã€‚<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>è®ºæ–‡é‡Œé¢è™½ç„¶ç”¨çš„æ˜¯LMç®—æ³•ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­å®é™…ç”¨çš„æ˜¯GNç®—æ³•ã€‚è¿™é‡Œåªå¼ºè°ƒGNç®—æ³•çš„æ ¸å¿ƒæ€è·¯ã€‚</p>
<p><code>GN</code>ç®—æ³•ä¹Ÿæ˜¯è¿­ä»£æ›´æ–°çš„ç®—æ³•ï¼Œæ¯ä¸€æ­¥é‡ç‚¹åœ¨ä¸æ±‚å‡ºæœªçŸ¥é‡çš„æ›´æ–°æ–¹å‘å’Œæ­¥é•¿ï¼Œæ¯ä¸€æ­¥å°†æ›´è¡Œå‘é‡å åŠ åˆ°æœªçŸ¥é‡ä¸Šï¼Œè®©ç›®æ ‡å‡½æ•°é€æ¸æ”¶æ•›ã€‚ åœ¨è¿™é‡Œï¼ŒæœªçŸ¥é‡æ˜¯ä½å§¿<span class="math inline">\(T_i\)</span>ï¼Œç›®æ ‡å‡½æ•°æ˜¯ç‚¹åˆ°ç›´çº¿ç‚¹åˆ°å¹³é¢è·ç¦»<span class="math inline">\(\mathbb{d}\)</span>ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€æ­¥è¿­ä»£ä¸­è¦æ‰¾åˆ°ä¸€ä¸ª<span class="math inline">\(\Delta{T}_i\)</span>ï¼Œæ›´æ–°æœªçŸ¥é‡<span class="math inline">\(T_i = T_i + \Delta{T}_i\)</span>ï¼Œå¹¶ä½¿å¾—è·ç¦»<span class="math inline">\(\mathbb{b}\)</span>é€æ¸ä¸‹é™ã€‚</p>
<p>åœ¨é«˜æ–¯ç‰›é¡¿æ³•ä¸­ï¼Œæ›´æ–°å‘é‡çš„æ˜¯é€šè¿‡æ±‚è§£å¢é‡æ–¹ç¨‹å¾—åˆ°</p>
<p><span class="math display">\[
J(x)J(x)^T\Delta{x}=-J(x)f(x)\tag{3}
\]</span></p>
<p>å…¬å¼ï¼ˆ3ï¼‰å°±æ˜¯é«˜æ–¯ç‰›é¡¿æ³•çš„å¢é‡æ–¹ç¨‹ï¼Œ<span class="math inline">\(J(x)\)</span>æ˜¯é›…å…‹æ¯”çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡å‡½æ•°ç›¸å¯¹äºæœªçŸ¥é‡çš„åå¯¼ï¼›<span class="math inline">\(f(x)\)</span>æ˜¯ç›®æ ‡å‡½æ•°ï¼›<span class="math inline">\(\Delta{x}\)</span>å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„å¢é‡ã€‚</p>
<h2 id="ä»£ç ä¸­ç‚¹äº‘åŒ¹é…ç®—æ³•åŸºäºgnç®—æ³•">ä»£ç ä¸­ç‚¹äº‘åŒ¹é…ç®—æ³•ï¼ˆåŸºäºGNç®—æ³•ï¼‰</h2>
<p>è¿™éƒ¨åˆ†å†…å®¹å¯¹äºæ•°å­¦å…¬å¼æ¨å¯¼éƒ¨åˆ†ä¸»è¦å‚è€ƒ<a target="_blank" rel="noopener" href="https://wykxwyc.github.io/2019/08/01/The-Math-Formula-in-LeGO-LOAM/#lmoptimization%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96%E8%BF%AD%E4%BB%A3%E8%AE%A1%E7%AE%97">wykxwyc.github.io</a>ï¼Œä½†æ˜¯åŸæ–‡ä¸­å¯¹äºæ—‹è½¬çŸ©é˜µå¯¹æ¬§æ‹‰è§’çš„æ±‚å¯¼ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œä¸ä»£ç å¯¹ä¸ä¸Šã€‚</p>
<h3 id="æ¬§æ‹‰è§’è½¬æ—‹è½¬çŸ©é˜µ">æ¬§æ‹‰è§’è½¬æ—‹è½¬çŸ©é˜µ</h3>
<p>ä»£ç ä¸­å¯¹è§’åº¦çš„è¡¨è¾¾ä½¿ç”¨æ¬§æ‹‰è§’è¡¨è¾¾ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆå°†æ¬§æ‹‰è§’è½¬æ¢ä¸ºæ—‹è½¬çŸ©é˜µå½¢å¼ã€‚è®°<span class="math inline">\(x,y,z\)</span>è½´çš„è§’åº¦ä¸º<span class="math inline">\(\alpha,\beta,\gamma\)</span></p>
<p><span class="math display">\[
\begin{split}
R_{\alpha}=
\begin{bmatrix}
1&amp;0&amp;0\\
0&amp;\cos\alpha&amp;-\sin\alpha\\
0&amp;\sin\alpha&amp;\cos\alpha
\end{bmatrix}
\end{split}
\]</span></p>
<p><span class="math display">\[
\begin{split}
R_{\beta}=
\begin{bmatrix}
\cos\beta&amp;0&amp;\sin\beta\\
0&amp;1&amp;0\\
-\sin\beta&amp;0&amp;\cos\beta
\end{bmatrix}
\end{split}
\]</span></p>
<p><span class="math display">\[
\begin{split}
R_{\gamma}=
\begin{bmatrix}
\cos\gamma&amp;-\sin\gamma&amp;0\\
\sin\gamma&amp;\cos\gamma&amp;0\\
0&amp;0&amp;1\\
\end{bmatrix}
\end{split}
\]</span></p>
<p><strong>PS:</strong> ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬åœ¨åé¢çš„æ¨å¯¼ä¸­ä½¿ç”¨<span class="math inline">\(c_1,c_2,c_3\)</span>è¡¨ç¤º<span class="math inline">\(\cos\alpha,\cos\beta,\cos\gamma\)</span>ï¼Œç”¨<span class="math inline">\(s_1,s_2,s_3\)</span>è¡¨ç¤º<span class="math inline">\(\sin\alpha,\sin\beta,\sin\gamma\)</span></p>
<p>æ ¹æ®ä¸Šé¢è½¬æ¢å…³ç³»ï¼Œä½¿ç”¨<span class="math inline">\(Z-X-Y\)</span>é¡ºåºï¼Œå°†æ¬§æ‹‰è§’è½¬æ¢ä¸ºæ—‹è½¬çŸ©é˜µå¦‚ä¸‹</p>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
R
&amp;=&amp;R_yR_xR_z\\
&amp;=&amp;
\begin{bmatrix}
c_2&amp;0&amp;s_2\\
0&amp;1&amp;0\\
-s_2&amp;0&amp;c_2
\end{bmatrix}
\begin{bmatrix}
1&amp;0&amp;0\\
0&amp;c_1&amp;-s_1\\
0&amp;s_1&amp;c_1
\end{bmatrix}
\begin{bmatrix}
c_3&amp;-s_3&amp;0\\
s_3&amp;c_3&amp;0\\
0&amp;0&amp;1
\end{bmatrix}\\
&amp;=&amp;
\begin{bmatrix}
c_2c_3+s_1s_2s_3&amp;-c_2s_3+s_1s_2c_3&amp;c_1s_2\\
c_1s_3&amp;c_1c_3&amp;-s_1\\
-s_2c_3+s_1c_2s_3&amp;s_2s_3+s_1c_2c_3&amp;c_1c_2
\end{bmatrix}
\end{array}
\end{split}
\]</span></p>
<hr />
<h3 id="æ—‹è½¬çŸ©é˜µå¯¹æ¬§æ‹‰è§’æ±‚åå¯¼">æ—‹è½¬çŸ©é˜µå¯¹æ¬§æ‹‰è§’æ±‚åå¯¼</h3>
<p>æœ‰äº†ä¸Šé¢æ¬§æ‹‰è§’è½¬æ—‹è½¬çŸ©é˜µçš„å…¬å¼ä¹‹åï¼Œæ±‚æ—‹è½¬çŸ©é˜µç›¸å¯¹äºæ¬§æ‹‰è§’çš„åå¯¼å°±å®¹æ˜“å¤šäº†ï¼Œå…ˆæ±‚<span class="math inline">\(R\)</span>ç›¸å¯¹äºè§’<span class="math inline">\(\alpha\)</span>çš„åå¯¼</p>
<p><span class="math display">\[
\begin{split}
\frac{\partial R}{\partial \alpha} = 
\begin{bmatrix}
c_1s_2s_3&amp;c_1s_2c_3&amp;-s_1s_2\\
-s_1s_3&amp;-s_1c_3&amp;-c_1\\
c_1c_2s_3&amp;c_1c_2c_3&amp;-s_1c_2
\end{bmatrix}
\end{split}
\]</span></p>
<p>å†æ±‚<span class="math inline">\(R\)</span>ç›¸å¯¹äº<span class="math inline">\(\beta\)</span>çš„åå¯¼</p>
<p><span class="math display">\[
\begin{split}
\frac{\partial R}{\partial \beta} = 
\begin{bmatrix}
-s_2c_3+s_1c_2s_3&amp;s_2s_3+s_1c_2c_3&amp;c_1c_2\\
0&amp;0&amp;0\\
-c_2c_3-s_1s_2s_3&amp;c_2s_3-s_1s_2c_3&amp;-c_1s_2
\end{bmatrix}
\end{split}
\]</span></p>
<p>æœ€åæ±‚<span class="math inline">\(R\)</span>ç›¸å¯¹äº<span class="math inline">\(\gamma\)</span>çš„åå¯¼</p>
<p><span class="math display">\[
\begin{split}
\frac{\partial R}{\partial \gamma} = 
\begin{bmatrix}
-c_2s_3+s_1s_2c_3&amp;-c_2c_3-s_1s_2s_3&amp;0\\
c_1c_3&amp;-c_1s_3&amp;0\\
s_2s_3+s_1c_2c_3&amp;s_2c_3-s_1c_2s_3&amp;0
\end{bmatrix}
\end{split}
\]</span></p>
<hr />
<h3 id="ç›®æ ‡å‡½æ•°å¯¹ä½å§¿æ±‚é›…å…‹æ¯”çŸ©é˜µ">ç›®æ ‡å‡½æ•°å¯¹ä½å§¿æ±‚é›…å…‹æ¯”çŸ©é˜µ</h3>
<p><strong>æ—¶åˆ»ç‰¢è®°ï¼šä½å§¿<span class="math inline">\(T_i=[t_x,t_y,t_z,\alpha,\beta,\gamma]=[R,t]\)</span>æ˜¯æˆ‘ä»¬è¦æ±‚çš„é‡</strong></p>
<p>å¯¹äºå½“å‰å¸§ç‰¹å¾ç‚¹<span class="math inline">\(F^e,F^p\)</span>ä¸­çš„ä¸€ä¸ªç‚¹<span class="math inline">\(P_i=[p_x,p_y,p_z]\)</span>ï¼ˆè¿™é‡Œæ²¡æœ‰åŒºåˆ†è¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹ï¼Œå› ä¸ºä¸¤è€…çš„åå¯¼å…¬å¼ä¸€æ ·ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°<span class="math inline">\(G(\cdot)\)</span>å°†å…¶ä»é›·è¾¾åæ ‡ç³»è½¬æ¢åˆ°å±€éƒ¨åæ ‡ç³»(mä¸Šæ ‡è¡¨ç¤ºåœ°å›¾åæ ‡ç³»)</p>
<p><span class="math display">\[
P^m_i=G(P_i,T_i)=R\cdot P_i+t
\]</span></p>
<p>æˆ‘ä»¬ä½¿ç”¨å‡½æ•°<span class="math inline">\(D(\cdot)\)</span>è¡¨ç¤ºè¯¥ç‚¹åˆ°å±€éƒ¨åœ°å›¾çš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡å‡½æ•°</p>
<p><span class="math display">\[
loss=D(G(P_i,T_i),Map) = d
\]</span></p>
<p>ä¸Šå¼ä¸­<span class="math inline">\(d\)</span>å¯¹äºè¾¹ç¼˜ç‚¹ä»£è¡¨ç‚¹åˆ°ç›´çº¿è·ç¦»ï¼Œå¯¹äºå¹³é¢ç‚¹è¡¨ç¤ºç‚¹åˆ°å¹³é¢è·ç¦»</p>
<p><strong>è¯¯å·®å¯¹æ—‹è½¬æ±‚åå¯¼</strong></p>
<p>è¿™é‡Œä»¥<span class="math inline">\(x\)</span>è½´çš„æ—‹è½¬<span class="math inline">\(\alpha\)</span>ä¸ºä¾‹</p>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
\frac{\partial loss}{\partial \alpha}
&amp;=&amp;
\frac{\partial D\left(G(P_i,T_i),Map\right)}{\partial \alpha}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial G}{\partial \alpha}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial R\cdot P_i+t}{\partial \alpha}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial R\cdot P_i}{\partial \alpha}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial R}{\partial \alpha}\cdot P_i
\end{array}
\end{split}\tag{4}
\]</span></p>
<p><strong>è¯¯å·®å¯¹å¹³ç§»æ±‚åå¯¼</strong></p>
<p>è¿™é‡Œä»¥<span class="math inline">\(x\)</span>è½´çš„å¹³ç§»<span class="math inline">\(t_x\)</span>ä¸ºä¾‹</p>
<p><span class="math display">\[
\begin{split}
\begin{array}{rcl}
\frac{\partial loss}{\partial t_x}
&amp;=&amp;
\frac{\partial D\left(G(P_i,T_i),Map\right)}{\partial t_x}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial G}{\partial t_x}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial R\cdot P_i+t}{\partial t_x}\\
&amp;=&amp;
\frac{\partial D}{\partial G}\cdot \frac{\partial R\cdot P_i}{\partial \alpha} + \frac{\partial D}{\partial G}\cdot\frac{\partial t}{\partial t_x}\\
&amp;=&amp;
0+\frac{\partial D}{\partial G}\cdot\frac{\partial t}{\partial t_x}\\
&amp;=&amp;
\frac{\partial D}{\partial G}
\end{array}
\end{split}\tag{5}
\]</span></p>
<p><strong>æ±‚è§£<span class="math inline">\(\frac{\partial D}{\partial G}\)</span></strong></p>
<p>åœ¨ä¸Šé¢è¯¯å·®å¯¹æ—‹è½¬æ±‚åå¯¼ä¸­æ—‹è½¬çŸ©é˜µå¯¹æ¬§æ‹‰è§’æ±‚åå¯¼<span class="math inline">\(\frac{\partial R}{\partial \alpha}\)</span>å·²ç»åœ¨å‰é¢çš„ç« èŠ‚æ¨å¯¼è¿‡äº†ã€‚å…¬å¼(4)(5)è¿˜æœ‰ä¸€ä¸ªæœªçŸ¥é‡å°±æ˜¯<span class="math inline">\(\frac{\partial D}{\partial G}\)</span></p>
<p><span class="math display">\[
\frac{\partial D}{\partial G} = \frac{\partial d}{\partial P^m_i}
\]</span></p>
<p>ä¹Ÿå°±æ˜¯è¯´<span class="math inline">\(\frac{\partial D}{\partial G}\)</span>æ±‚çš„æ˜¯æŸå¤±å‡½æ•°ä¹Ÿå°±æ˜¯ç‚¹åˆ°çº¿å’Œç‚¹åˆ°é¢çš„è·ç¦»ç›¸å¯¹äºç‚¹ï¼ˆåœ°å›¾åæ ‡ç³»ä¸‹ï¼‰çš„åå¯¼æ•°ã€‚è¿™ç‚¹å¯ä»¥ç†è§£æˆæ±‚ä¸€ä¸ªç§»åŠ¨æ–¹å‘ï¼Œä½¿å¾—è®©ç‚¹<span class="math inline">\(P^m_i\)</span>æ²¿ç€è¿™ä¸ªæ–¹å‘ç§»åŠ¨ï¼ŒæŸå¤±å‡½æ•°ä¸Šå‡å¾—æœ€å¿«ã€‚å¾ˆå®¹æ˜“æƒ³åˆ°è¿™ä¸ªæ–¹å‘å°±æ˜¯æ³•çº¿æ–¹å‘ï¼ˆå¯¹äºç‚¹åˆ°ç›´çº¿çš„æƒ…å†µåˆ™æ˜¯ç›´çº¿çš„å‚çº¿æ–¹å‘ï¼‰ å› æ­¤</p>
<p><span class="math display">\[
\frac{\partial D}{\partial G} = \frac{\partial d}{\partial P^m_i}=\big(\frac{\partial d}{\partial x}, \frac{\partial d}{\partial y}, \frac{\partial d}{\partial z}\big)=(n_x,n_y,n_z)
\]</span></p>
<h3 id="ä»£ç ä¸­é›…å…‹æ¯”çŸ©é˜µçš„è®¡ç®—">ä»£ç ä¸­é›…å…‹æ¯”çŸ©é˜µçš„è®¡ç®—</h3>
<p>è¿™éƒ¨åˆ†è®¡ç®—ä¸»è¦åœ¨<code>mapOptimization.cpp</code>ä¸­çš„<code>LMOptimization</code>å‡½æ•°ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>è¿™éƒ¨åˆ†ä»£ç è®¡ç®—ä¸­è¿˜åŠ äº†åæ ‡ç³»çš„è½¬æ¢ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œè¿™éƒ¨åˆ†ä»£ç å¯ä»¥çœ‹<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>çš„ä»£ç ï¼Œæ˜¯å®Œå…¨ä¸€æ ·çš„</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—ä¸‰è½´æ¬§æ‹‰è§’çš„sinã€cosï¼Œåé¢ä½¿ç”¨æ—‹è½¬çŸ©é˜µå¯¹æ¬§æ‹‰è§’æ±‚å¯¼ä¸­ä¼šä½¿ç”¨åˆ°</span></span><br><span class="line"><span class="comment">// lidar -&gt; camera</span></span><br><span class="line"><span class="type">float</span> srx = <span class="built_in">sin</span>(transformTobeMapped[<span class="number">1</span>]);</span><br><span class="line"><span class="type">float</span> crx = <span class="built_in">cos</span>(transformTobeMapped[<span class="number">1</span>]);</span><br><span class="line"><span class="type">float</span> sry = <span class="built_in">sin</span>(transformTobeMapped[<span class="number">2</span>]);</span><br><span class="line"><span class="type">float</span> cry = <span class="built_in">cos</span>(transformTobeMapped[<span class="number">2</span>]);</span><br><span class="line"><span class="type">float</span> srz = <span class="built_in">sin</span>(transformTobeMapped[<span class="number">0</span>]);</span><br><span class="line"><span class="type">float</span> crz = <span class="built_in">cos</span>(transformTobeMapped[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// laserCloudOriæ˜¯åœ¨cornerOptimizationã€surfOptimizationä¸¤ä¸ªå‡½æ•°ä¸­æ‰¾åˆ°çš„æœ‰åŒ¹é…å…³ç³»çš„</span></span><br><span class="line"><span class="comment">// è§’ç‚¹å’Œå¹³é¢ç‚¹ï¼Œå¦‚æœæ‰¾åˆ°çš„å¯ä¾›ä¼˜åŒ–çš„ç‚¹æ•°å¤ªå°‘ï¼Œåˆ™è·³è¿‡æ­¤æ¬¡ä¼˜åŒ–</span></span><br><span class="line"><span class="type">int</span> laserCloudSelNum = laserCloudOri-&gt;<span class="built_in">size</span>();</span><br><span class="line"><span class="keyword">if</span> (laserCloudSelNum &lt; <span class="number">50</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// matAæ˜¯JacobiansçŸ©é˜µJ</span></span><br><span class="line"><span class="function">cv::Mat <span class="title">matA</span><span class="params">(laserCloudSelNum, <span class="number">6</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function">cv::Mat <span class="title">matAt</span><span class="params">(<span class="number">6</span>, laserCloudSelNum, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function">cv::Mat <span class="title">matAtA</span><span class="params">(<span class="number">6</span>, <span class="number">6</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="comment">// matBæ˜¯ç›®æ ‡å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è·ç¦»</span></span><br><span class="line"><span class="function">cv::Mat <span class="title">matB</span><span class="params">(laserCloudSelNum, <span class="number">1</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function">cv::Mat <span class="title">matAtB</span><span class="params">(<span class="number">6</span>, <span class="number">1</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="comment">// matXæ˜¯é«˜æ–¯-ç‰›é¡¿æ³•è®¡ç®—å‡ºçš„æ›´æ–°å‘é‡</span></span><br><span class="line"><span class="function">cv::Mat <span class="title">matX</span><span class="params">(<span class="number">6</span>, <span class="number">1</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function">cv::Mat <span class="title">matP</span><span class="params">(<span class="number">6</span>, <span class="number">6</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">PointType pointOri, coeff;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; laserCloudSelNum; i++) &#123;</span><br><span class="line">    <span class="comment">// åæ ‡ç³»è½¬æ¢è¿™éƒ¨åˆ†å¯ä»¥ä¸ç”¨çœ‹ï¼Œæ²¡æœ‰ä»€ä¹ˆä½œç”¨</span></span><br><span class="line">    <span class="comment">// lidar -&gt; camera</span></span><br><span class="line">    pointOri.x = laserCloudOri-&gt;points[i].y;</span><br><span class="line">    pointOri.y = laserCloudOri-&gt;points[i].z;</span><br><span class="line">    pointOri.z = laserCloudOri-&gt;points[i].x;</span><br><span class="line">    <span class="comment">// lidar -&gt; camera</span></span><br><span class="line">    coeff.x = coeffSel-&gt;points[i].y;</span><br><span class="line">    coeff.y = coeffSel-&gt;points[i].z;</span><br><span class="line">    coeff.z = coeffSel-&gt;points[i].x;</span><br><span class="line">    coeff.intensity = coeffSel-&gt;points[i].intensity;</span><br><span class="line">    <span class="comment">// in camera</span></span><br><span class="line">    <span class="comment">// æ±‚é›…å…‹æ¯”çŸ©é˜µçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ±‚ç›®æ ‡å‡½æ•°ï¼ˆç‚¹åˆ°çº¿ã€å¹³é¢çš„è·ç¦»ï¼‰ç›¸å¯¹äºtx,ty,tz,rx,ry,rzçš„å¯¼æ•°</span></span><br><span class="line">    <span class="comment">// å…·ä½“çš„å…¬å¼æ¨å¯¼çœ‹ä»“åº“READMEä¸­æœ¬é¡¹ç›®åšå®¢ï¼Œé«˜æ–¯ç‰›é¡¿æ³•æ–¹ç¨‹ï¼šJ^&#123;T&#125;J\Delta&#123;x&#125; = -Jf(x)ï¼Œ\Delta&#123;x&#125;å°±æ˜¯è¦æ±‚è§£çš„æ›´æ–°å‘é‡matX</span></span><br><span class="line">    <span class="comment">// arxæ˜¯ç›®æ ‡å‡½æ•°ç›¸å¯¹äºrollçš„å¯¼æ•°</span></span><br><span class="line">    <span class="type">float</span> arx = (crx*sry*srz*pointOri.x + crx*crz*sry*pointOri.y - srx*sry*pointOri.z) * coeff.x</span><br><span class="line">              + (-srx*srz*pointOri.x - crz*srx*pointOri.y - crx*pointOri.z) * coeff.y</span><br><span class="line">              + (crx*cry*srz*pointOri.x + crx*cry*crz*pointOri.y - cry*srx*pointOri.z) * coeff.z;</span><br><span class="line">    <span class="comment">// aryæ˜¯ç›®æ ‡å‡½æ•°ç›¸å¯¹äºpitchçš„å¯¼æ•°</span></span><br><span class="line">    <span class="type">float</span> ary = ((cry*srx*srz - crz*sry)*pointOri.x </span><br><span class="line">              + (sry*srz + cry*crz*srx)*pointOri.y + crx*cry*pointOri.z) * coeff.x</span><br><span class="line">              + ((-cry*crz - srx*sry*srz)*pointOri.x </span><br><span class="line">              + (cry*srz - crz*srx*sry)*pointOri.y - crx*sry*pointOri.z) * coeff.z;</span><br><span class="line">    <span class="comment">// arzæ˜¯ç›®æ ‡å‡½æ•°ç›¸å¯¹äºyawçš„å¯¼æ•°</span></span><br><span class="line">    <span class="type">float</span> arz = ((crz*srx*sry - cry*srz)*pointOri.x + (-cry*crz-srx*sry*srz)*pointOri.y)*coeff.x</span><br><span class="line">              + (crx*crz*pointOri.x - crx*srz*pointOri.y) * coeff.y</span><br><span class="line">              + ((sry*srz + cry*crz*srx)*pointOri.x + (crz*sry-cry*srx*srz)*pointOri.y)*coeff.z;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    åœ¨æ±‚ç‚¹åˆ°ç›´çº¿çš„è·ç¦»æ—¶ï¼Œcoeffè¡¨ç¤ºçš„æ˜¯å¦‚ä¸‹å†…å®¹</span></span><br><span class="line"><span class="comment">    [la,lb,lc]è¡¨ç¤ºçš„æ˜¯ç‚¹åˆ°ç›´çº¿çš„å‚ç›´è¿çº¿æ–¹å‘ï¼Œsæ˜¯é•¿åº¦</span></span><br><span class="line"><span class="comment">    coeff.x = s * la;</span></span><br><span class="line"><span class="comment">    coeff.y = s * lb;</span></span><br><span class="line"><span class="comment">    coeff.z = s * lc;</span></span><br><span class="line"><span class="comment">    coeff.intensity = s * ld2;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åœ¨æ±‚ç‚¹åˆ°å¹³é¢çš„è·ç¦»æ—¶ï¼Œcoeffè¡¨ç¤ºçš„æ˜¯</span></span><br><span class="line"><span class="comment">    [pa,pb,pc]è¡¨ç¤ºè¿‡å¤–ç‚¹çš„å¹³é¢çš„æ³•å‘é‡ï¼Œsæ˜¯çº¿çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">    coeff.x = s * pa;</span></span><br><span class="line"><span class="comment">    coeff.y = s * pb;</span></span><br><span class="line"><span class="comment">    coeff.z = s * pc;</span></span><br><span class="line"><span class="comment">    coeff.intensity = s * pd2;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// lidar -&gt; camera</span></span><br><span class="line">    matA.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">0</span>) = arz;</span><br><span class="line">    matA.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">1</span>) = arx;</span><br><span class="line">    matA.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">2</span>) = ary;</span><br><span class="line">    <span class="comment">// ç›®æ ‡å‡½æ•°ç›¸å¯¹äºtxçš„å¯¼æ•°ç­‰äºæ³•å‘é‡çš„x</span></span><br><span class="line">    matA.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">3</span>) = coeff.z;</span><br><span class="line">    <span class="comment">// ç›®æ ‡å‡½æ•°ç›¸å¯¹äºtyçš„å¯¼æ•°ç­‰äºæ³•å‘é‡çš„y</span></span><br><span class="line">    matA.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">4</span>) = coeff.x;</span><br><span class="line">    <span class="comment">// ç›®æ ‡å‡½æ•°ç›¸å¯¹äºtzçš„å¯¼æ•°ç­‰äºæ³•å‘é‡çš„z</span></span><br><span class="line">    matA.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">5</span>) = coeff.y;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// matBå­˜å‚¨çš„æ˜¯ç›®æ ‡å‡½æ•°ï¼ˆè·ç¦»ï¼‰çš„è´Ÿå€¼ï¼Œå› ä¸ºï¼šJ^&#123;T&#125;J\Delta&#123;x&#125; = -Jf(x)</span></span><br><span class="line">    matB.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, <span class="number">0</span>) = -coeff.intensity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ›´æ–°">æ›´æ–°</h3>
<p>å¾—åˆ°é›…å…‹æ¯”çŸ©é˜µåå°±å¯ä»¥ç›´æ¥æ±‚è§£é«˜æ–¯-ç‰›é¡¿æ³•é‡Œçš„å¢é‡æ–¹ç¨‹</p>
<p><span class="math display">\[
J(x)J(x)^T\Delta{x}=-J(x)f(x)\tag{3}
\]</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cv::<span class="built_in">transpose</span>(matA, matAt);</span><br><span class="line">matAtA = matAt * matA;</span><br><span class="line">matAtB = matAt * matB;</span><br><span class="line"><span class="comment">// æ±‚è§£é«˜æ–¯-ç‰›é¡¿æ³•ä¸­çš„å¢é‡æ–¹ç¨‹ï¼šJ^&#123;T&#125;J\Delta&#123;x&#125; = -Jf(x)ï¼Œè¿™é‡Œè§£å‡ºæ¥çš„matXå°±æ˜¯æ›´æ–°å‘é‡</span></span><br><span class="line"><span class="comment">// matAæ˜¯é›…å…‹æ¯”çŸ©é˜µJ</span></span><br><span class="line"><span class="comment">// matAtBæ˜¯ä¸Šé¢ç­‰å¼ä¸­ç­‰å·çš„å³è¾¹ï¼Œè´Ÿå·åœ¨matBèµ‹å€¼çš„æ—¶å€™å·²ç»åŠ å…¥</span></span><br><span class="line">cv::<span class="built_in">solve</span>(matAtA, matAtB, matX, cv::DECOMP_QR);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å¢é‡matXå åŠ åˆ°å˜é‡ï¼ˆä½å§¿ï¼‰transformTobeMappedä¸­</span></span><br><span class="line">transformTobeMapped[<span class="number">0</span>] += matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">transformTobeMapped[<span class="number">1</span>] += matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">transformTobeMapped[<span class="number">2</span>] += matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">transformTobeMapped[<span class="number">3</span>] += matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">transformTobeMapped[<span class="number">4</span>] += matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">4</span>, <span class="number">0</span>);</span><br><span class="line">transformTobeMapped[<span class="number">5</span>] += matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">5</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="é«˜æ–¯çŸ©é˜µé€€åŒ–">é«˜æ–¯çŸ©é˜µé€€åŒ–</h3>
<div id="Degenerate">

</div>
<p>è¿™éƒ¨åˆ†ä»£ç å…¶å®æœ‰ä¸€å°æ®µæ²¡åŠæ³•å®Œå…¨ç†è§£ï¼Œå°±æ˜¯åœ¨è¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£æ—¶ä¼šå¯¹è¿‘ä¼¼HessiançŸ©é˜µåšæ˜¯å¦é€€åŒ–çš„çš„åˆ¤æ–­ï¼Œç„¶åå¯¹é€€åŒ–çš„æ–¹å‘è¿›è¡Œå¤„ç†ï¼Œæœ€åå¯¹å¢é‡è¿›è¡Œé‡æ–°åŠ æƒã€‚ä½†æ˜¯å®åœ¨æ²¡æœ‰æ‰¾åˆ°è¿™ç§ç”¨æ³•çš„å‡ºå¤„ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿­ä»£ï¼Œåˆ¤æ–­æ±‚è§£å‡ºæ¥çš„è¿‘ä¼¼HessiançŸ©é˜µï¼Œä¹Ÿå°±æ˜¯J^&#123;T&#125;J:=matAtAæ˜¯å¦é€€åŒ–</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¿™éƒ¨åˆ†çš„è®¡ç®—è¯´å®è¯æ²¡æœ‰æ‰¾åˆ°å¾ˆå¥½çš„ç†è®ºå‡ºå¤„ï¼Œè¿™é‡Œåªèƒ½å¤§æ¦‚è¯´ä¸€ä¸‹è¿™æ®µä»£ç æƒ³è¦åšçš„äº‹æƒ…</span></span><br><span class="line"><span class="comment">    * è¿™é‡Œç”¨matAtAä¹Ÿå°±æ˜¯é«˜æ–¯-ç‰›é¡¿ä¸­çš„è¿‘ä¼¼æµ·ç‘Ÿï¼ˆHessianï¼‰çŸ©é˜µHã€‚æ±‚è§£å¢é‡æ–¹ç¨‹ï¼šJ^&#123;T&#125;J\Delta&#123;x&#125; = -Jf(x)</span></span><br><span class="line"><span class="comment">    * è¦æ±‚H:=J^&#123;T&#125;Jå¯é€†ï¼Œä½†Hä¸ä¸€å®šå¯é€†ã€‚ä¸‹é¢çš„ä»£ç é€šè¿‡Hçš„ç‰¹å¾å€¼åˆ¤æ–­Hæ˜¯å¦é€€åŒ–ï¼Œå¹¶å°†é€€åŒ–çš„æ–¹å‘æ¸…é›¶matV2ã€‚è€Œååˆæ ¹æ®</span></span><br><span class="line"><span class="comment">    * matV.inv()*matV2ä½œä¸ºæ›´æ–°å‘é‡çš„æƒé‡ç³»æ•°ï¼ŒmatVæ˜¯Hçš„ç‰¹å¾å‘é‡çŸ©é˜µã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (iterCount == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">cv::Mat <span class="title">matE</span><span class="params">(<span class="number">1</span>, <span class="number">6</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">matV</span><span class="params">(<span class="number">6</span>, <span class="number">6</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">matV2</span><span class="params">(<span class="number">6</span>, <span class="number">6</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹è¿‘ä¼¼HessiançŸ©é˜µåšç‰¹å¾å€¼åˆ†è§£ï¼ŒmatEæ˜¯ç‰¹å¾å€¼ï¼ŒmatVæ˜¯ç‰¹å¾å‘é‡ã€‚opencvçš„matVä¸­æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç‰¹å¾å‘é‡</span></span><br><span class="line">    cv::<span class="built_in">eigen</span>(matAtA, matE, matV);</span><br><span class="line">    matV.<span class="built_in">copyTo</span>(matV2);</span><br><span class="line"></span><br><span class="line">    isDegenerate = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">float</span> eignThre[<span class="number">6</span>] = &#123;<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">5</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (matE.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, i) &lt; eignThre[i]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">6</span>; j++) &#123;</span><br><span class="line">                matV2.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            isDegenerate = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    matP = matV.<span class="built_in">inv</span>() * matV2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ç¬¬ä¸€æ¬¡è¿­ä»£åˆ¤æ–­åˆ°æµ·ç‘ŸçŸ©é˜µé€€åŒ–ï¼Œåé¢ä¼šä½¿ç”¨è®¡ç®—å‡ºæ¥çš„æƒé‡matPå¯¹å¢é‡matXåšåŠ æƒç»„åˆ</span></span><br><span class="line"><span class="keyword">if</span> (isDegenerate)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">matX2</span><span class="params">(<span class="number">6</span>, <span class="number">1</span>, CV_32F, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line">    matX.<span class="built_in">copyTo</span>(matX2);</span><br><span class="line">    matX = matP * matX2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ”¶æ•›æ¡ä»¶åˆ¤æ–­">æ”¶æ•›æ¡ä»¶åˆ¤æ–­</h3>
<p>å½“å¢é‡æ­¥é•¿è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œè®¤ä¸ºä¼˜åŒ–å·²ç»æ”¶æ•›ï¼Œå› æ­¤å¯ä»¥è·³å‡ºåç»­è¿­ä»£ã€‚è¿™é‡Œç”¨å¢é‡ä¸­çš„è§’åº¦å¢é‡å’Œå¹³ç§»å¢é‡çš„å¹…åº¦åšåˆ¤æ–­ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—rollã€pitchã€yawçš„è¿­ä»£æ­¥é•¿</span></span><br><span class="line"><span class="type">float</span> deltaR = <span class="built_in">sqrt</span>(</span><br><span class="line">                    <span class="built_in">pow</span>(pcl::<span class="built_in">rad2deg</span>(matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">0</span>)), <span class="number">2</span>) +</span><br><span class="line">                    <span class="built_in">pow</span>(pcl::<span class="built_in">rad2deg</span>(matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>, <span class="number">0</span>)), <span class="number">2</span>) +</span><br><span class="line">                    <span class="built_in">pow</span>(pcl::<span class="built_in">rad2deg</span>(matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">2</span>, <span class="number">0</span>)), <span class="number">2</span>));</span><br><span class="line"><span class="comment">// è®¡ç®—txï¼Œtyï¼Œtzçš„è¿­ä»£æ­¥é•¿</span></span><br><span class="line"><span class="type">float</span> deltaT = <span class="built_in">sqrt</span>(</span><br><span class="line">                    <span class="built_in">pow</span>(matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">3</span>, <span class="number">0</span>) * <span class="number">100</span>, <span class="number">2</span>) +</span><br><span class="line">                    <span class="built_in">pow</span>(matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">4</span>, <span class="number">0</span>) * <span class="number">100</span>, <span class="number">2</span>) +</span><br><span class="line">                    <span class="built_in">pow</span>(matX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">5</span>, <span class="number">0</span>) * <span class="number">100</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœè¿­ä»£çš„æ­¥é•¿è¾¾åˆ°è®¾å®šé˜ˆå€¼ï¼Œåˆ™è®¤ä¸ºå·²ç»æ”¶æ•›</span></span><br><span class="line"><span class="keyword">if</span> (deltaR &lt; <span class="number">0.05</span> &amp;&amp; deltaT &lt; <span class="number">0.05</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// converged</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/30/lio_sam/imuPreintegration-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-30 20:55:54" itemprop="dateCreated datePublished" datetime="2023-03-30T20:55:54+08:00">2023-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-20 21:47:44" itemprop="dateModified" datetime="2023-04-20T21:47:44+08:00">2023-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/30/lio_sam/imuPreintegration-doc/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—" href="/2023/03/30/lio_sam/imuPreintegration-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::447e7d053e8cf00fca42d617e062a049" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="imué¢„ç§¯åˆ†">IMUé¢„ç§¯åˆ†</h2>
<figure>
<img src="./imgs/Design-Pipelines-IMU.png" alt="" /><figcaption>Simple-LIO-SAMæ€»ä½“æµç¨‹å›¾</figcaption>
</figure>
<p><code>IMUé¢„ç§¯åˆ†æ¨¡å—</code>æ— è®ºåœ¨VIOæˆ–è€…LIOä¸­éƒ½æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¨¡å—ã€‚VIOæˆ–è€…LIOä¸­çš„<code>I</code>ï¼Œä¹Ÿå°±æ˜¯<code>Inertial</code>æŒ‡çš„æ˜¯æƒ¯æ€§å•å…ƒï¼ŒåŸºæœ¬ä¸Šåœ¨è¿™ç±»SLAMæ¡†æ¶é‡ŒæŒ‡çš„å°±æ˜¯IMUé‡Œç¨‹è®¡ã€‚ IMUå¯ä»¥è¾“å‡ºè½¦è¾†åæ ‡ç³»ä¸‹çš„ä¸‰è½´åŠ é€Ÿåº¦ã€ä¸‰è½´è§’é€Ÿåº¦ã€ä¸‰è½´åœ°ç£è®¡ï¼ˆä¹è½´IMUï¼‰ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒåŠ é€Ÿåº¦çš„ç§¯åˆ†æ˜¯é€Ÿåº¦ã€é€Ÿåº¦çš„ç§¯åˆ†æ˜¯è·ç¦»ï¼Œè§’é€Ÿåº¦çš„ç§¯åˆ†æ˜¯è§’åº¦ï¼Œåœ°ç£è®¡å¯ä»¥è®¡ç®—ä¸åœ°ç£åŒ—æçš„åè§’ï¼Œå› æ­¤ï¼Œå¦‚æœIMUçš„è¾“å‡ºæ˜¯å‡†ç¡®çš„è¯ï¼Œä½¿ç”¨IMUåŸå§‹æ•°æ®å¹¶è¿›è¡Œç§¯åˆ†å°±å¯ä»¥å¾—åˆ°è½¦è¾†çš„ä½å§¿ã€‚ç„¶è€Œï¼Œç›®å‰æ— è®ºå¤šä¹ˆé«˜ç²¾åº¦çš„IMUï¼Œéƒ½å¾ˆéš¾åœ¨è¾ƒé•¿æ—¶é—´ä¸‹ä¿æŒè¾ƒé«˜çš„å‡†ç¡®åº¦ï¼Œè€Œä¸”ç§¯åˆ†ä¼šå¯¹è¯¯å·®ä¹Ÿè¿›è¡Œç§¯åˆ†ï¼Œå¯¼è‡´IMUé‡Œç¨‹è®¡åªèƒ½ç”¨æ¥åšçŸ­æ—¶é—´å†…çš„ä½å§¿æ ¡æ­£ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ˜¯IMUé‡Œç¨‹è®¡å’Œæ¿€å…‰é›·è¾¾é‡Œç¨‹è®¡ç´§è€¦åˆçš„SLAMæ¡†æ¶ã€‚â€œç´§è€¦åˆâ€ä¸‰ä¸ªå­—åœ¨IMUé¢„ç§¯åˆ†æ¨¡å—å¾—åˆ°æ˜æ˜¾çš„è¡¨è¾¾ã€‚å¦‚æœç”¨ä¸€å¥è¯è¯´æ˜IMUé¢„ç§¯åˆ†æ¨¡å—çš„ä½œç”¨ï¼Œé‚£å°±æ˜¯ï¼šåˆ©ç”¨IMUæ•°æ®ï¼Œä¸ºè½¦è¾†ä½å§¿æä¾›ä¸€ä¸ªè¾ƒå¥½çš„ä½å§¿åˆå§‹ä¼°è®¡ã€‚ç”±äºç›®å‰çš„æ¿€å…‰é›·è¾¾å¤§éƒ¨åˆ†æ˜¯10Hzï¼Œéƒ¨åˆ†å¯ä»¥è¾¾åˆ°20Hzä»¥ä¸Šï¼Œå› æ­¤ï¼Œåœ¨ä¸¤å¸§é›·è¾¾ç‚¹äº‘æœŸé—´ï¼Œè½¦è¾†ä¼šå‘ç”Ÿæ—‹è½¬å’Œä½ç§»ï¼Œå¦‚æœæ—‹è½¬å’Œä½ç§»å¾ˆå°ï¼Œé‚£ä¹ˆç‚¹äº‘åŒ¹é…å°±èƒ½å¤Ÿå•ç‹¬ç®—å‡ºä¸€ä¸ªè¾ƒå‡†ç¡®çš„é‡Œç¨‹è®¡ï¼ˆåœ¨è¿åŠ¨ç¼“æ…¢çš„æƒ…å†µä¸‹ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>å³ä½¿å»é™¤äº†IMUé¢„ç§¯åˆ†ä¹Ÿå¯ä»¥å·¥ä½œï¼Œåªéœ€è¦ä¸å¯åŠ¨<code>ImuPreintegration</code>èŠ‚ç‚¹å³å¯ï¼‰ã€‚ä½†æ˜¯å¦‚æœæ—‹è½¬å’Œä½ç§»è¾ƒå¤§ï¼Œç‚¹äº‘åŒ¹é…å°±å¾ˆå¯èƒ½å¤±è´¥ã€‚IMUä¸€èˆ¬æ‹¥æœ‰è¾ƒé«˜é¢‘ç‡ï¼ˆ200Hzä»¥ä¸Šï¼‰ï¼Œå› æ­¤å¯ä»¥ä¸ºä¸¤å¸§é›·è¾¾ç‚¹äº‘çš„åŒ¹é…æä¾›è¾ƒå¥½çš„åˆå§‹ä½å§¿å€¼ã€‚</p>
<p>å‰é¢æåˆ°å•çº¯åˆ©ç”¨IMUæ•°æ®åšç§¯åˆ†ï¼Œæ—¶é—´ä¸€é•¿ç´¯ç§¯è¯¯å·®ä¼šå¾ˆå¤§ï¼Œæ— æ³•æä¾›è‰¯å¥½çš„åˆå§‹ä½å§¿ä¼°è®¡ï¼Œå› æ­¤éœ€è¦èåˆå…¶ä»–ä¼ æ„Ÿå™¨æ ¡æ­£IMUç§¯åˆ†ç®—æ³•ã€‚åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ï¼Œé€šè¿‡ä¸æ–­ä»æ¿€å…‰é‡Œç¨‹è®¡è·å–æœ€æ–°çš„é‡Œç¨‹è®¡ä¿¡æ¯ï¼Œä½œä¸ºIMUç§¯åˆ†ç®—æ³•çš„è§‚æµ‹æ¥è¾¾åˆ°æ ¡æ­£IMUç§¯åˆ†ç®—æ³•çš„ç›®çš„ã€‚</p>
<p><em>PSï¼šæ­¤éƒ¨åˆ†ä»£ç å¾ˆå¤§ç¨‹åº¦åˆ©ç”¨äº†<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ï¼Œå› æ­¤ï¼Œéœ€è¦æå‰é˜…è¯»æœ¬é¡¹ç›®<a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></em></p>
<h2 id="imué¢„ç§¯åˆ†æ¨¡å—çš„æ•´ä½“æ¡†æ¶æµç¨‹å›¾">IMUé¢„ç§¯åˆ†æ¨¡å—çš„æ•´ä½“æ¡†æ¶æµç¨‹å›¾</h2>
<figure>
<img src="./imgs/Design-imuPreintegration-top01.png" title="é¢„ç§¯åˆ†æ¨¡å—æµç¨‹å›¾" alt="" /><figcaption>Simple-LIO-SAMé¢„ç§¯åˆ†æ¨¡å—æ•´ä½“æ¡†æ¶æµç¨‹å›¾</figcaption>
</figure>
<h2 id="é›¶åä¼°è®¡å’Œimué‡Œç¨‹è®¡">é›¶åä¼°è®¡å’ŒIMUé‡Œç¨‹è®¡</h2>
<p>è¿™ä¸ªæ¨¡å—å®¹æ˜“è®©äººçœ‹æ™•çš„åœ°æ–¹åœ¨äºæ¨¡å—é‡Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ç¼“å­˜IMUåŸå§‹æ•°æ®ï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªIMUé¢„ç§¯åˆ†å™¨ã€‚ä¹‹æ‰€ä»¥éœ€è¦æœ‰ä¸¤ä¸ªé¢„ç§¯åˆ†å™¨çš„åŸå› åœ¨äºï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ä¸­å¯¹äºIMUçš„é¢„ç§¯åˆ†ï¼Œåœ¨é¢„æµ‹æ—¶ï¼ˆpredictï¼‰éœ€è¦æŒ‡æ˜ä¸Šä¸€æ—¶åˆ»çš„<code>bias</code>ï¼Œä¹Ÿå°±æ˜¯IMUçš„é›¶åã€‚é€šå¸¸è¿™ä¸ª<code>bias</code>ä¼šéšç€æ—¶é—´æ…¢æ…¢æ”¹å˜ï¼Œå› æ­¤ä¸èƒ½ç”¨ç¦»çº¿æ ‡å®šçš„æ•°æ®ç›´æ¥ä½¿ç”¨ã€‚äºæ˜¯ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆLaserHandlerï¼‰ä¼šåˆ©ç”¨æ¿€å…‰é‡Œç¨‹è®¡å½“ä½œé¢å¤–çš„è§‚æµ‹é‡ï¼Œä¸æ–­ä¼°è®¡æœ€æ–°çš„<code>bias</code>å€¼ã€‚è€Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆImuHandlerï¼‰åˆ™å¯ä»¥ä¸€ç›´åˆ©ç”¨æœ€æ–°çš„<code>bias</code>å€¼å¯¹å®æ—¶æ¥æ”¶åˆ°çš„IMUæ•°æ®åšç§¯åˆ†ï¼Œå¹¶å‘å¸ƒä¸ºIMUé‡Œç¨‹è®¡ã€‚</p>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ç”¨æ¥åšé›¶åä¼°è®¡çš„é˜Ÿåˆ—å’Œé¢„ç§¯åˆ†å™¨å«åš<strong>ä¼˜åŒ–é˜Ÿåˆ—</strong>å’Œ<strong>ä¼˜åŒ–é¢„ç§¯åˆ†å™¨</strong>ï¼›å°†ç”¨æ¥å®æ—¶å¯¹IMUæ•°æ®ç§¯åˆ†å¹¶å‘å¸ƒIMUé‡Œç¨‹è®¡çš„é˜Ÿåˆ—å’Œé¢„ç§¯åˆ†å™¨å«åš<strong>IMUé˜Ÿåˆ—</strong>å’Œ<strong>IMUé¢„ç§¯åˆ†å™¨</strong>ã€‚</p>
<p>ä¸€å›¾èƒœåƒè¨€ï¼Œä¸‹é¢è¿™å¹…å›¾æè¿°äº†ä¸¤ä¸ªé˜Ÿåˆ—æ˜¯å¦‚ä½•è¢«è€¦åˆèµ·æ¥è¾“å‡ºæ›´ä¸ºå‡†ç¡®çš„IMUé¢„ç§¯åˆ†ç»“æœã€‚å…¶ä¸­<code>imuQueOpt</code>æ˜¯ä¼˜åŒ–é˜Ÿåˆ—ï¼Œ<code>imuQueImu</code>æ˜¯IMUé˜Ÿåˆ—ï¼Œä¸¤è€…å‘½ä»¤ä¸ä»£ç ä¸­ä¸€è‡´ã€‚</p>
<figure>
<img src="./imgs/TwoImuQues.png" alt="" /><figcaption>ä¸¤ä¸ªIMUé˜Ÿåˆ—åŠçº¿ç¨‹äº¤äº’å›¾</figcaption>
</figure>
<h2 id="é›¶åä¼°è®¡çº¿ç¨‹å³odometryhandler">é›¶åä¼°è®¡çº¿ç¨‹â€”â€”å³odometryHandler</h2>
<p>è¿™ä¸ªå›è°ƒå‡½æ•°å æ®äº†é¢„ç§¯åˆ†æ¨¡å—å¤§éƒ¨åˆ†å†…å®¹ï¼Œè€Œä¸”æœ‰è¾ƒå¤šçš„é‡ç½®æ¡ä»¶å’Œä¸<code>imuHandler</code>çº¿ç¨‹åŒæ­¥çš„æ“ä½œï¼Œæ¯”è¾ƒå®¹æ˜“å¼„æ··ã€‚</p>
<p>è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨æ¥æ”¶åˆ°æ–°çš„ä¸€å¸§é›·è¾¾é‡Œç¨‹è®¡ï¼ˆå‘è‡ª<code>MapOptimization</code>æ¨¡å—ï¼‰ï¼Œä¸»è¦æ“ä½œä¸Šå›¾ä¸­çš„<code>imuQueOpt</code>å’Œ<code>ä¼˜åŒ–é¢„ç§¯åˆ†å™¨</code>ã€‚æ¯å½“èŠ‚ç‚¹æ–°æ”¶åˆ°ä¸€å¸§é›·è¾¾é‡Œç¨‹è®¡æ—¶ï¼Œå°±ä¼šæ‰§è¡Œ<code>é¢„ç§¯åˆ†æ¨¡å—æµç¨‹å›¾</code>ä¸­å·¦ä¾§çš„ä¸€ç³»åˆ—æ“ä½œã€‚ä¸»è¦ç›®çš„å°±æ˜¯åˆ©ç”¨é›·è¾¾é‡Œç¨‹è®¡åšè§‚æµ‹æ•°æ®ï¼Œå®æ—¶æ›´æ–°IMUçš„åå·®<code>bias</code>ã€‚åŒæ—¶ï¼Œæ›´æ–°è¿‡çš„<code>bias</code>ä¼šä¼ é€’åˆ°<code>IMUé¢„ç§¯åˆ†å™¨</code>ã€‚</p>
<h3 id="ç³»ç»Ÿåˆå§‹åŒ–">ç³»ç»Ÿåˆå§‹åŒ–</h3>
<figure>
<img src="./imgs/Design-imuPreintegration-sysinit.png" alt="" /><figcaption>ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹</figcaption>
</figure>
<p>å½“æ¥æ”¶åˆ°ç¬¬ä¸€å¸§é›·è¾¾é‡Œç¨‹è®¡æ—¶ï¼Œéœ€è¦å¯¹ç³»ç»Ÿåšåˆå§‹åŒ–æ“ä½œã€‚ä¸»è¦åŒ…æ‹¬å› å­å›¾ã€å› å­å›¾ä¼˜åŒ–å™¨ã€ä¸¤ä¸ªé¢„ç§¯åˆ†å™¨çš„åˆå§‹åŒ–ã€‚ç”±äºåˆå§‹åŒ–æ“ä½œéœ€è¦å°†ç¬¬ä¸€å¸§é›·è¾¾é‡Œç¨‹è®¡çš„ä½å§¿ä½œä¸ºå…ˆéªŒå› å­ï¼Œå› æ­¤ä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ã€‚</p>
<h3 id="åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡ç½®å› å­å›¾">åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡ç½®å› å­å›¾</h3>
<figure>
<img src="./imgs/Design-imuPreintegration-reset.png" alt="" /><figcaption>é‡ç½®ç³»ç»Ÿ</figcaption>
</figure>
<p>ä¸ºäº†ä¿è¯æ‹¥æœ‰è¶³å¤Ÿçš„å®æ—¶æ€§ï¼ˆé¢„ç§¯åˆ†æ¨¡å—éœ€è¦ä¸IMUé¢‘ç‡ä¿æŒä¸€è‡´ï¼‰ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>çš„é¢„ç§¯åˆ†æ¨¡å—åœ¨å› å­å›¾ä¸­é‡Œç¨‹è®¡å› å­æ•°é‡å¤§äº100æ—¶ä¼šé‡ç½®å› å­å›¾ä¸ä¼˜åŒ–å™¨ã€‚æ“ä½œä¸»è¦æ˜¯ä»å½“å‰çš„å› å­å›¾ä¼˜åŒ–å™¨æ‹¿å‡ºæœ€æ–°ç»“æœï¼Œå¹¶å½“ä½œå…ˆéªŒå› å­æ„é€ æ–°çš„å› å­å›¾ã€‚</p>
<h3 id="å¯¹ä¼˜åŒ–é˜Ÿåˆ—ä¸­imuåŸå§‹æ•°æ®è¿›è¡Œç§¯åˆ†">å¯¹ä¼˜åŒ–é˜Ÿåˆ—ä¸­IMUåŸå§‹æ•°æ®è¿›è¡Œç§¯åˆ†</h3>
<figure>
<img src="./imgs/Design-imuPreintegration-integraOpt.png" alt="" /><figcaption>ç§¯åˆ†ä¼˜åŒ–é˜Ÿåˆ—</figcaption>
</figure>
<p>è¿™é‡Œè¦é‡æ–°å›é¡¾ä¸Šæ–‡çš„<code>çº¿ç¨‹äº¤äº’å›¾</code>ã€‚é›¶åä¼°è®¡çº¿ç¨‹çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºIMUé‡Œç¨‹è®¡çº¿ç¨‹æä¾›æœ€æ–°çš„<code>bias</code>ä¼°è®¡ï¼Œå› æ­¤æ¯å½“åˆ°è¾¾æ–°çš„ä¸€å¸§é›·è¾¾é‡Œç¨‹è®¡ï¼Œæ„å‘³ç€æœ‰æ–°çš„è§‚æµ‹åˆ°è¾¾ï¼Œ<code>bias</code>å°±å¯ä»¥è¿›è¡Œæ›´æ–°ã€‚äºæ˜¯éœ€è¦å¯¹ä¼˜åŒ–é˜Ÿåˆ—ä¸­åœ¨å½“å‰é›·è¾¾é‡Œç¨‹è®¡æ—¶é—´ä¹‹å‰çš„IMUåŸå§‹æ•°æ®ç”¨IMUé¢„ç§¯åˆ†å™¨è¿›è¡Œç§¯åˆ†ï¼Œç„¶åæ„é€ IMUå› å­ã€‚å°†IMUå› å­å’Œé›·è¾¾é‡Œç¨‹è®¡åŠ å…¥å› å­å›¾ä¼˜åŒ–ï¼Œå¾—å‡ºæœ€æ–°çš„<code>bias</code>ä¼°è®¡ã€‚</p>
<h3 id="å› å­å›¾ä¼˜åŒ–">å› å­å›¾ä¼˜åŒ–</h3>
<figure>
<img src="./imgs/Design-imuPreintegration-factorgraph.png" alt="" /><figcaption>å› å­å›¾ä¼˜åŒ–éƒ¨åˆ†</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>å¯ä»¥ä½¿ç”¨IMUé¢„ç§¯åˆ†å™¨æ„é€ IMUå› å­ã€‚åˆ©ç”¨<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>å¯ä»¥ç”¨å› å­å›¾ä¼˜åŒ–å‡º<code>é€Ÿåº¦</code>,<code>IMU bias</code>,<code>ä½å§¿</code>çš„ä¼°è®¡ã€‚å…¶ä¸­<code>IMU bias</code>æ˜¯æˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨çš„å†…å®¹ã€‚</p>
<h3 id="ä¼ é€’ä¼˜åŒ–ç»“æœ">ä¼ é€’ä¼˜åŒ–ç»“æœ</h3>
<figure>
<img src="./imgs/Design-imuPreintegration-setBias.png" alt="" /><figcaption>ä¼ é€’ä¼˜åŒ–ç»“æœ</figcaption>
</figure>
<p>ä½¿ç”¨å› å­å›¾ä¼˜åŒ–å‡ºæœ€æ–°çš„IMU bias ä¹‹åï¼Œå®é™…ä¸Šè¿˜æœ‰ä¼˜åŒ–åçš„ä½å§¿ï¼Œè¿™ä¸ªä½å§¿å’ŒIMUåå·®ä¼šç”¨æ¥é‡ç½®å¦å¤–ä¸€ä¸ªé¢„ç§¯åˆ†å™¨â€”â€”<code>IMUé¢„ç§¯åˆ†å™¨</code>ã€‚IMUé¢„ç§¯åˆ†å™¨æ˜¯åœ¨å¦ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¢«ä¸»è¦ä½¿ç”¨ï¼Œå›é¡¾<code>çº¿ç¨‹äº¤äº’å›¾</code>çš„ä¸‹åŠéƒ¨åˆ†å’Œ<code>æ¨¡å—æµç¨‹å›¾</code>çš„å³ä¾§æµç¨‹ã€‚åŒæ—¶ï¼Œè®¾ç½®å®Œ<code>IMUé¢„ç§¯åˆ†å™¨</code>ä¹‹åï¼Œä¼šå°†<code>imuQueImu</code>ä¸­å‰©ä½™çš„å…¶ä»–IMUåŸå§‹æ•°æ®æ”¾å…¥<code>IMUé¢„ç§¯åˆ†å™¨</code>åšç§¯åˆ†ï¼Œè¿™æ ·<code>IMUé¢„ç§¯åˆ†å™¨</code>å°±ä¸€ç›´ä¿æŒæœ€æ–°çŠ¶æ€ï¼Œåœ¨<code>imuHandler</code>ä¸­å¯ä»¥å®æ—¶ç§¯åˆ†å¹¶å‘å¸ƒIMUé‡Œç¨‹è®¡ã€‚</p>
<h2 id="imué‡Œç¨‹è®¡çº¿ç¨‹å³imuhandler">IMUé‡Œç¨‹è®¡çº¿ç¨‹â€”â€”å³imuHandler</h2>
<p>è¿™ä¸ªå›è°ƒå‡½æ•°æ¯”èµ·odometryHandlerå°±è¦ç®€å•å¾ˆå¤šã€‚è¿™ä¸ªå›è°ƒå‡½æ•°çš„ä¸»è¦åŠŸèƒ½å°±åªæœ‰ä¸¤ä¸ªï¼š</p>
<p>1ã€ä¸æ–­åœ°å°†æ–°æ”¶åˆ°çš„IMUæ•°æ®å¡å…¥ä¸¤ä¸ªæ”¾ç½®IMUåŸå§‹æ•°æ®çš„é˜Ÿåˆ—â€”â€”<code>çº¿ç¨‹äº¤äº’å›¾</code>ä¸­çš„imuQueOptå’ŒimuQueImuï¼› 2ã€ä½¿ç”¨<code>IMUé¢„ç§¯åˆ†å™¨</code>å¯¹æ”¶åˆ°çš„IMUæ•°æ®åšç§¯åˆ†ï¼Œå¹¶å°†ç»“æœä½œä¸ºIMUé‡Œç¨‹è®¡å‘å¸ƒã€‚</p>
<p>ä¸»è¦æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<figure>
<img src="./imgs/Design-imuPreintegration-imuHandler.png" alt="" /><figcaption>IMUé‡Œç¨‹è®¡çº¿ç¨‹</figcaption>
</figure>
<p>è¿™ä¸ªå›è°ƒå‡½æ•°æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å†èµ˜è¿°ã€‚</p>
<h2 id="ä»£ç è¦ç‚¹">ä»£ç è¦ç‚¹</h2>
<h3 id="åæ ‡ç³»è½¬æ¢">åæ ‡ç³»è½¬æ¢</h3>
<p>IMUé¢„ç§¯åˆ†æ¨¡å—ä¸­ä»£ç æ¶‰åŠåˆ°å¤šæ¬¡åæ ‡ç³»è½¬æ¢ã€‚ä¸»è¦æ˜¯è¦æ˜ç™½IMUç§¯åˆ†çš„åŸç†å’Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­åæ ‡ç³»çš„è½¬æ¢å…³ç³»ã€‚å…³äºåæ ‡ç³»æœ‰å‡ ä¸ªæ³¨æ„è¦ç‚¹ï¼š</p>
<p><strong>1. æ‰€æœ‰IMUåŸå§‹æ•°æ®éƒ½ä¼šå…ˆæ—‹è½¬åˆ°ä¸é›·è¾¾çš„åæ ‡ç³»æœå‘ä¸€è‡´åå†è¿›è¡Œå¤„ç†</strong></p>
<p>åœ¨<code>imuHandler</code>ä¸­æ¯æ”¶åˆ°ä¸€ä¸ªIMUæ•°æ®å°±å…ˆæ—‹è½¬å†å­˜æ”¾ã€‚<a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM/blob/dda6459aaf79913ab27d1950ccac14e07ce8ec71/src/imuPreintegration.cpp#L555-L556">code</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†IMUæ•°æ®æ—‹è½¬åˆ°lidarçš„æ—‹è½¬æœå‘</span></span><br><span class="line">sensor_msgs::msg::Imu thisImu = <span class="built_in">imuConverter</span>(*imu_raw);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜IMUæ•°æ®</span></span><br><span class="line">imuQueOpt.<span class="built_in">push_back</span>(thisImu);</span><br><span class="line">imuQueImu.<span class="built_in">push_back</span>(thisImu);</span><br></pre></td></tr></table></figure>
<p><strong>2. é‡Œç¨‹è®¡éƒ½æ˜¯å¯¹é½åˆ°é›·è¾¾åæ ‡ç³»</strong></p>
<p>æ‰€æœ‰åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ¡†æ¶ä¸­å‘å¸ƒå‡ºæ¥çš„é‡Œç¨‹è®¡ï¼Œæ— è®ºæ˜¯IMUé‡Œç¨‹è®¡æˆ–è€…æ˜¯é›·è¾¾é‡Œç¨‹è®¡ï¼Œåº¦é‡çš„éƒ½æ˜¯é›·è¾¾åœ¨åœ°å›¾åæ ‡ç³»ä¸‹çš„ä½å§¿ã€‚ä½†æ˜¯åœ¨IMUé¢„ç§¯åˆ†æ¨¡å—çš„é›¶åä¼°è®¡çº¿ç¨‹ä¸­ï¼Œä½¿ç”¨IMUæ•°æ®åšç§¯åˆ†ï¼Œåˆéœ€è¦ä½¿ç”¨é›·è¾¾é‡Œç¨‹è®¡ä½œä¸ºè§‚æµ‹ï¼Œä¸¤è€…è¦åŒæ—¶åŠ å…¥å› å­å›¾ä¸­ï¼Œæ‰€ä»¥å¿…é¡»ç»Ÿä¸€ä¸¤è€…çš„åæ ‡ç³»ã€‚IMUåŸå§‹æ•°æ®åœ¨ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªæ³¨æ„è¦ç‚¹å·²ç»æ—‹è½¬åˆ°å¯¹é½é›·è¾¾çš„æ–¹å‘ï¼Œä¸¤è€…ä¹‹é—´è¿˜å·®ä¸€ä¸ªå¹³ç§»ã€‚å› æ­¤ï¼Œåœ¨æ¥æ”¶åˆ°é›·è¾¾é‡Œç¨‹è®¡æ—¶ï¼Œä¼šå…ˆå¹³ç§»åˆ°æ—‹è½¬åçš„IMUåæ ‡ç³»ï¼Œæœ€åå†å¹³ç§»å›æ¥ã€‚ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM/blob/dda6459aaf79913ab27d1950ccac14e07ce8ec71/src/imuPreintegration.cpp#L298-L300">é›·è¾¾é‡Œç¨‹è®¡å¹³ç§»åˆ°æ—‹è½¬åçš„IMUåæ ‡ç³»ä»£ç </a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–å› å­å›¾çš„priorçŠ¶æ€</span></span><br><span class="line"><span class="comment">// å°†é›·è¾¾é‡Œç¨‹è®¡ä½å§¿å¹³ç§»åˆ°IMUåæ ‡ç³»ï¼Œåªæ˜¯åšäº†å¹³ç§»</span></span><br><span class="line">prevPose_ = lidarPose.<span class="built_in">compose</span>(lidar2Imu);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM/blob/dda6459aaf79913ab27d1950ccac14e07ce8ec71/src/imuPreintegration.cpp#L585-L587">å°†IMUé‡Œç¨‹è®¡å¯¹é½åˆ°é›·è¾¾åæ ‡ç³»ä»£ç </a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†IMUé‡Œç¨‹è®¡å®Œå…¨å¯¹é½åˆ°é›·è¾¾ï¼ˆå‰©ä¸‹ä¸€ä¸ªå¹³ç§»å…³ç³»ï¼‰</span></span><br><span class="line">gtsam::Pose3 imuPose = gtsam::<span class="built_in">Pose3</span>(currentState.<span class="built_in">quaternion</span>(), currentState.<span class="built_in">position</span>());</span><br><span class="line">gtsam::Pose3 lidarPose = imuPose.<span class="built_in">compose</span>(imu2Lidar);</span><br></pre></td></tr></table></figure>
<h3 id="æ—¶é—´åŒæ­¥">æ—¶é—´åŒæ­¥</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ¡†æ¶ä¸­å„ä¸ªæ¨¡å—éƒ½æ˜¯è¿›è¡Œå¼‚æ­¥é€šä¿¡ï¼ˆros topicï¼‰ï¼Œå› æ­¤åœ¨æ¯ä¸ªæ¨¡å—é‡Œé¢éƒ½æœ‰å‡ ä¸ªé˜Ÿåˆ—ä¿å­˜æ•°æ®ï¼Œå¤„ç†çš„æ—¶å€™å†æ ¹æ®æ—¶é—´æˆ³åšåŒæ­¥ã€‚IMUé¢„ç§¯åˆ†æ¨¡å—ä¸­æœ‰å¤šä¸ªåœ°æ–¹å¯¹æ•°æ®åšäº†æ—¶é—´æˆ³åŒæ­¥ã€‚ æ¯”å¦‚åœ¨æ›´æ–°å®Œ<code>bias</code>ä¹‹åï¼Œå¯¹IMUé˜Ÿåˆ—åšç§¯åˆ†æ—¶ï¼Œä¼šå…ˆæŠ›å¼ƒæ—©äºæœ€æ–°çš„é›·è¾¾é‡Œç¨‹è®¡æ—¶é—´ä¹‹å‰çš„æ•°æ®ã€‚<a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM/blob/dda6459aaf79913ab27d1950ccac14e07ce8ec71/src/imuPreintegration.cpp#L480-L486">code link</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ ·å…ˆåšIMUæ•°æ®é˜Ÿåˆ—å’Œé›·è¾¾é‡Œç¨‹è®¡çš„æ—¶é—´åŒæ­¥</span></span><br><span class="line"><span class="type">double</span> lastImuQT = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">while</span> (!imuQueImu.<span class="built_in">empty</span>() &amp;&amp; <span class="built_in">stamp2Sec</span>(imuQueImu.<span class="built_in">front</span>().header.stamp) &lt; currentLidarOdomTime - <span class="type">sync_t</span>)</span><br><span class="line">&#123;</span><br><span class="line">    lastImuQT = <span class="built_in">stamp2Sec</span>(imuQueImu.<span class="built_in">front</span>().header.stamp);</span><br><span class="line">    imuQueImu.<span class="built_in">pop_front</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/27/lio_sam/gtsam-quickstart/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-27 21:28:48" itemprop="dateCreated datePublished" datetime="2023-03-27T21:28:48+08:00">2023-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-20 21:33:14" itemprop="dateModified" datetime="2023-04-20T21:33:14+08:00">2023-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/27/lio_sam/gtsam-quickstart/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨" href="/2023/03/27/lio_sam/gtsam-quickstart/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::0d35c30bd7aedf439c2d1184605769ac" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>å…¶ä¸­çš„ä¸¤å¤§æ¨¡å—<code>ImuPreintegration</code>å’Œ<code>MapOptimization</code>éƒ½ä¾èµ–äº†å› å­å›¾ä¼˜åŒ–æ¡†æ¶â€”â€”<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ã€‚ ä¸ºäº†ç¡®ä¿æœ¬é¡¹ç›®çš„è‡ªæ´½æ€§ä»¥åŠåé¢ç« èŠ‚è®²è§£çš„å±•å¼€ï¼Œä¸ä»‹ç»ä¸€ä¸‹å› å­å›¾åç«¯ä¼˜åŒ–ç®—æ³•ä¼¼ä¹è¯´ä¸è¿‡å»ã€‚ä½†æ˜¯ç¬”è€…ç›®å‰å¯¹å› å­å›¾çš„åŸç†è¿˜æ²¡æœ‰è¿›è¡Œéå¸¸è¯¦ç»†çš„æ¨å¯¼ï¼Œå› æ­¤è¿™éƒ¨åˆ† å†…å®¹ä¼šåå‘å¦‚ä½•å¯¹<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>å¿«é€Ÿå…¥é—¨ã€‚å½“ç„¶ï¼Œæœ€å¿«é€Ÿçš„å…¥é—¨æ–¹å¼å°±æ˜¯å®Œæ•´åœ°é˜…è¯»ä¸€é<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>çš„å®˜æ–¹æ•™ç¨‹ã€‚è¿™éƒ¨åˆ†ç« èŠ‚åªæ˜¯æ‹™åŠ£åœ°è¿›è¡ŒçŸ¥è¯†çš„æ¬è¿ï¼Œå½“ç„¶ä¸æ˜¯ç›´æ¥å°† <a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>çš„æ•™ç¨‹ç›´æ¥ç¿»è¯‘è¿‡æ¥ã€‚æœ¬ç« èŠ‚ä¼šä»‹ç»<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>å¿«é€Ÿå…¥é—¨çš„çŸ¥è¯†ï¼ŒåŒæ—¶è®²è§£<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>æä¾›çš„<code>examples</code>ä¸­è·Ÿ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>è”ç³»è¾ƒä¸ºç´§å¯†çš„ä¸€ä¸¤ä¸ªï¼ŒåŒæ—¶æŒ‡æ˜<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­çš„ç”¨æ³•å‡ºå¤„ã€‚ è‡³å°‘é˜…è¯»å®Œæœ¬ç« èŠ‚ååº”è¯¥èƒ½å¤Ÿå¯¹å› å­å›¾æœ‰åŸºæœ¬çš„è®¤è¯†ï¼Œå¹¶ä¸”èƒ½å¤Ÿçœ‹æ‡‚<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­å¯¹<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>çš„ä½¿ç”¨</p>
<h2 id="slamåç«¯å›¾ä¼˜åŒ–">SLAMåç«¯â€”â€”å›¾ä¼˜åŒ–</h2>
<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>è®©æˆ‘ä»¬å…ˆå›å½’é—®é¢˜æœ¬èº«ã€‚åœ¨SLAMä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰å¤šä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯è·å–ä¸€æ¡æœ€å‡†ç¡®çš„è½¨è¿¹ï¼Œç„¶åä½¿ç”¨è¿™æ¡å‡†ç¡®çš„è½¨è¿¹å®æ—¶æ„å»ºåœ°å›¾ã€‚åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹è¾“å…¥ï¼š</p>
<ol type="1">
<li>IMUæ•°æ®ï¼›</li>
<li>ç‚¹äº‘æ•°æ®ï¼›</li>
<li>GPSæ•°æ®ï¼ˆå¯é€‰ï¼‰ï¼›</li>
<li>å›ç¯æ£€æµ‹ï¼›</li>
</ol>
<p>æˆ‘ä»¬çš„é—®é¢˜æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›æ•°æ®è®¡ç®—å‡ºä¸€æ¡æœ€å‡†ç¡®çš„å†å²è½¨è¿¹ï¼Œä½¿ç”¨è¯¥è½¨è¿¹å°±å¯ä»¥å°†å¯¹åº”çš„ç‚¹äº‘æŠ•å½±åˆ°åœ°å›¾åæ ‡ç³»ï¼Œä»¥æ­¤æ¥å»ºç«‹ä¸€ä¸ªç‚¹äº‘æ ¼å¼åœ°å›¾ã€‚ ï¼ˆPSï¼šè¿™åªæ˜¯SLAMçš„ä¸€ä¸ªå½¢å¼ï¼Œå°±æ˜¯ä¼˜åŒ–å‡ºä¸€æ¡å…‰æ»‘å‡†ç¡®çš„è½¨è¿¹ï¼Œè¿™ä¹Ÿæ˜¯åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œå› æ­¤æœ¬æ–‡ä»¥è¿™ç§ç±»å‹ä½œä¸ºè®²è§£ï¼‰</p>
<h3 id="éçº¿æ€§ä¼˜åŒ–">éçº¿æ€§ä¼˜åŒ–</h3>
<p>åœ¨SLAMé¢†åŸŸåç«¯ä¼˜åŒ–çš„ä¸€ä¸ªåˆ†æ”¯æ˜¯<code>æ»¤æ³¢å™¨æ–¹æ³•</code>ï¼Œä¸»è¦ä»¥æ‰©å±•å¡å°”æ›¼æ»¤æ³¢æ–¹æ³•ä¸ºä¸»ï¼Œé‡‡ç”¨éšé©¬å°”ç§‘å¤«å‡è®¾ï¼Œåªä¿å­˜ä¸Šä¸€æ¬¡çŠ¶æ€ï¼Œå¹¶é€šè¿‡å½“å‰è¾“å…¥é¢„æµ‹å½“å‰çŠ¶æ€ï¼Œå¶å°”é€šè¿‡è§‚æµ‹ä¿®æ­£çŠ¶æ€ã€‚å…·ä½“å¯è§æœ¬åšå®¢çš„<a href="https://zeal-up.github.io/2023/03/13/kalman_filter/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%88%B0%E4%BA%92%E8%A1%A5%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/">å¡å°”æ›¼æ»¤æ³¢ç›¸å…³æ–‡ç« </a></p>
<p>ç›®å‰çš„åç«¯ä¼˜åŒ–ä¸»è¦ä»¥å„ç§éçº¿æ€§ä¼˜åŒ–æ–¹æ³•ä¸ºä¸»ï¼ŒæŠŠæ‰¹é‡çš„ä½å§¿åŠ å…¥ç›®æ ‡æ–¹ç¨‹ï¼ˆprojective functionï¼‰ä¸€èµ·ä¼˜åŒ–ï¼Œå¾—åˆ°å…·æœ‰æ›´å¥½çš„å…¨å±€æ€§è´¨çš„è§£ã€‚</p>
<p><span class="math display">\[
\mathbf{x}^* = \argmin_{\mathbf{x}}\mathbb{F}(\mathbf{x})
\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(\mathbb{F}\)</span>æ˜¯å†å²è½¨è¿¹å¼•å…¥çš„å„ä¸ªè¯¯å·®ä¹‹å’Œ</p>
<p><span class="math display">\[
\mathbb{F}(\mathbf{x}) = \sum\mathbf{e}(x_i,c_{ij},x_j)
\]</span></p>
<p><span class="math inline">\(x_i,x_j\)</span>æ˜¯å†å²æ—¶åˆ»çš„ä½å§¿ï¼Œ<span class="math inline">\(c_{ij}\)</span>æ˜¯ä¸¤è€…ä¹‹é—´çš„çº¦æŸï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯è§‚æµ‹æˆ–è€…è¾“å…¥ï¼‰</p>
<p><strong>PSï¼šå†é‡ç”³ä¸€å¥ï¼ŒSLAMåç«¯ä½“ç³»å¾ˆåºå¤§ï¼Œä¸æ˜¯ä¸€ç¯‡æ–‡ç« èƒ½è¯´æ¸…æ¥šçš„ï¼Œç¬”è€…ç›®å‰ä¹Ÿè¿˜æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ã€‚ç›®å‰åªæ±‚èƒ½å¤Ÿç¨å¾®è®²æ¸…æ¥š<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­æ˜¯æ€ä¹ˆè¢«ä½¿ç”¨çš„å³å¯ã€‚</strong></p>
<p>ä¸ºäº†æ±‚è§£éçº¿æ€§æ–¹ç¨‹åœ¨ä¸åŒçš„SLAMä»»åŠ¡ä¸­çš„ç‰¹ç‚¹ï¼Œåˆå‘å±•å‡ºå„ç§ä¸åŒçš„ä¼˜åŒ–æ–¹å¼ï¼Œæ¯”å¦‚VIOä¸­æœ‰Bundle Adjustmentï¼Œæœ‰å…¶ä»–å«PoseGraphçš„ï¼Œè¿˜æœ‰<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ä¸­ä½¿ç”¨çš„FactorGraphã€‚ ç®€å•ç†è§£å°±æ˜¯è¿™äº›éƒ½æ˜¯éçº¿æ€§æ–¹ç¨‹å’Œæ±‚è§£åœ¨ä¸åŒçš„ä»»åŠ¡åœºæ™¯ä¸­çš„ç»†åˆ†ã€‚åé¢æœ‰æœºä¼šå†å•ç‹¬åˆ—ä¸€ç¯‡æ–‡ç« è®²è§£è¿™äº›åç«¯ä¼˜åŒ–æ–¹æ³•æŠŠã€‚</p>
<figure>
<img src="./imgs/introToBA.png" alt="" /><figcaption>ä¸€å›¾è¯´æ˜BA</figcaption>
</figure>
<h3 id="å›¾ä¼˜åŒ–">å›¾ä¼˜åŒ–</h3>
<p><strong>ä»¥ä¸‹å†…å®¹å¤§é‡å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-repo/doc/gtsam.pdf</a></strong></p>
<p>ä¸ºäº†æ‰¹é‡ä¼˜åŒ–å†å²ä½å§¿<span class="math inline">\(\mathbf{x} = \{x_0, x_1, x_2, ... x_i\}\)</span>ï¼Œç ”ç©¶è€…å°†å›¾è®ºå¼•å…¥SLAMåç«¯ä¼˜åŒ–ã€‚æ¯ä¸€ä¸ªæœºå™¨çš„ä½å§¿<span class="math inline">\(x_i\)</span>æ˜¯å›¾ä¸­çš„é¡¶ç‚¹ï¼›é€šè¿‡å„ç§é‡Œç¨‹è®¡è®¡ç®—ï¼Œæ¯”å¦‚è¿ç»­ä½å§¿é—´çš„IMUç§¯åˆ†ç»“æœæˆ–è€…ç‚¹äº‘åŒ¹é…ç»“æœï¼Œæˆä¸ºä¸¤ä¸ªä½å§¿<span class="math inline">\(x_i,x_j\)</span>ä¹‹é—´çš„è¾¹ï¼›å¯¹äºä¸€äº›é¢å¤–çš„è§‚æµ‹ï¼Œæ¯”å¦‚GPSæ•°æ®ï¼Œæˆä¸ºè¿æ¥é¡¶ç‚¹çš„ä¸€å…ƒè¾¹ï¼ˆåªæœ‰ä¸€ç«¯è¿æ¥åˆ°é¡¶ç‚¹ï¼‰ã€‚æ¯”å¦‚ä¸‹å›¾(å¼•ç”¨è‡ªï¼š<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-Hands-on Introduction</a>)</p>
<figure>
<img src="./imgs/egForFactorGraph.png" alt="" /><figcaption>FactorGraph</figcaption>
</figure>
<h2 id="gtsam">GTSAM</h2>
<p>GTSAMä½¿ç”¨å› å­å›¾ï¼ˆFactorGraphï¼‰ä½œä¸ºé€šç”¨çš„å›¾é—®é¢˜æè¿°æ¡†æ¶ï¼Œå¹¶ä¸ºå„ç§æœºå™¨äººä»»åŠ¡æä¾›å®ç°å¥½çš„ä¼˜åŒ–ç®—æ³•APIï¼Œä½¿å¾—ç ”ç©¶è€…å¿«é€Ÿå¼€å‘åç«¯ä¼˜åŒ–æ¡†æ¶ã€‚</p>
<p><strong>å›¾ä¼˜åŒ–ï¼ˆGraphOptimizationï¼‰vs. <a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ä¸­ä½¿ç”¨çš„å› å­å›¾ä¼˜åŒ–ï¼ˆFactorGraph Optimizationï¼‰åŒºåˆ« vs. BA</strong></p>
<ol type="1">
<li><strong>å›¾ä¼˜åŒ–</strong>ä¼¼ä¹ä¸€èˆ¬æŒ‡ä½å§¿å›¾ï¼ˆPoseGraphï¼‰çš„ä¼˜åŒ–ï¼Œå›¾ä¸­çš„é¡¶ç‚¹éƒ½æ˜¯æœºå™¨äººçš„ä½å§¿</li>
<li><strong>BA</strong>(Bundle Adjustment)ä¼¼ä¹ä¸€èˆ¬æŒ‡åœ¨è§†è§‰SLAMä¸­å¯¹åœ°æ ‡ï¼ˆLandmarksï¼‰å’Œä½å§¿åŒæ—¶ä¼˜åŒ–çš„æ–¹æ³•</li>
<li><strong>GTSAM</strong>çš„å› å­å›¾é™¤äº†èƒ½å¤Ÿæ„å»ºä½å§¿å›¾ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å°†é€Ÿåº¦ã€åå·®ã€IMUé¢„ç§¯åˆ†ç­‰å½“ä½œé¡¶ç‚¹å’Œè¾¹åŠ å…¥å›¾ä¸­ã€‚å¦å¤–ï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>æ¡†æ¶å®ç°äº†iSAMå’ŒiSAM2ä¸¤ä¸ªé€’å¢å¼ä¼˜åŒ–å™¨</li>
</ol>
<h3 id="é‡è¦æ¦‚å¿µ">é‡è¦æ¦‚å¿µ</h3>
<p><strong>å˜é‡ï¼ˆvariablesï¼‰</strong>ï¼šå› å­å›¾ä¸­çš„æ¯ä¸€ä¸ªé¡¶ç‚¹æ˜¯ä¸€ä¸ªä»£æ±‚çš„å˜é‡ã€‚å‡è®¾æˆ‘ä»¬åªéœ€è¦æ±‚è§£æ¯ä¸€ä¸ªæ—¶åˆ»çš„æœºå™¨äººå§¿æ€ï¼Œé‚£ä¹ˆæ¯ä¸ªé¡¶ç‚¹å°±æ˜¯è¯¥æ—¶åˆ»çš„æœºå™¨äººä½å§¿ï¼Œå¦‚ä¸Šå›¾ä¸­çš„<span class="math inline">\({X_1,X_2,X_3}\)</span></p>
<p><strong>å€¼ï¼ˆvaluesï¼‰</strong>ï¼šå€¼æ˜¯æ¯ä¸ªå˜é‡æ•°å€¼ã€‚åœ¨è°ƒç”¨ä¼˜åŒ–å™¨å¯¹å› å­å›¾åšä¼˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆä¸ºæ¯ä¸ªå˜é‡è®¾ç½®åˆå§‹å€¼ï¼Œä¼˜åŒ–ç»“æŸåå†ä»ä¼˜åŒ–å™¨ä¸­æ‹¿å‡ºæ¯ä¸ªå˜é‡ä¼˜åŒ–åçš„å€¼ã€‚</p>
<p><strong>å› å­ï¼ˆfactorsï¼‰</strong>ï¼šå› å­æ˜¯å› å­å›¾ä¸­çš„è¾¹ï¼Œæ¯æ¡è¾¹éƒ½å¯ä»¥è§†ä¸ºä¸€ä¸ªå› å­ï¼Œæ¯ä¸ªå› å­åˆå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¦æŸã€‚æ¯”å¦‚è¿ç»­ä¸¤ä¸ªä½å§¿ä¹‹é—´å¯ä»¥ç”±IMUè®¡ç®—å‡ºä¸¤ä¸ªä½å§¿çš„å˜æ¢ï¼Œè¯¥å˜æ¢ä½œä¸ºä¸€æ¡è¾¹åŠ å…¥å› å­å›¾è¿æ¥ä¸¤ä¸ªå˜é‡ï¼ˆ<code>äºŒå…ƒå› å­ï¼šbinary factor</code>ï¼‰ï¼›åˆæˆ–è€…åœ¨æŸä¸ªæ—¶åˆ»æœ‰GPSæ•°æ®è¾“å…¥ï¼ŒGPSæ•°æ®æ˜¯ä¸€ä¸ªè§‚æµ‹ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå› å­åŠ å…¥å› å­å›¾ï¼Œè¿™æ—¶å€™GPSçš„è¾¹åªæœ‰ä¸€ç«¯è¿æ¥åˆ°å˜é‡ï¼ˆ<code>ä¸€å…ƒå› å­ï¼šunary factor</code>ï¼‰ã€‚</p>
<p><strong>å› å­å›¾ï¼ˆfactor graphï¼‰</strong>ï¼šå› å­å›¾ç”±é¡¶ç‚¹ï¼ˆå˜é‡ï¼‰å’Œå› å­ï¼ˆè¾¹ï¼‰æ„æˆã€‚</p>
<p><strong>ä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰</strong>ï¼šå› å­å›¾åªæ˜¯å»ºæ¨¡äº†SLAMçš„å†å²ä½å§¿å’Œè¾“å…¥ä¸è§‚æµ‹é—´çš„å…³ç³»ï¼Œå¦‚ä½•æ±‚è§£è¿™ä¸ªå› å­å›¾ä¹Ÿå°±æ˜¯å¦‚ä½•è®¾ç½®å˜é‡ä½¿å¾—æ•´ä¸ªå›¾æœ€ç¬¦åˆæ‰€æœ‰çš„çº¦æŸï¼ˆè¯¯å·®æœ€å°ï¼‰åˆ™éœ€è¦ç”¨åˆ°ä¼˜åŒ–å™¨ã€‚é™¤äº†æœ€å¸¸è§çš„æ±‚è§£éçº¿æ€§é—®é¢˜çš„<code>Gaussian-Newton</code>å’Œ<code>Levenberg-Marquardt</code>ä¼˜åŒ–å™¨ä¹‹å¤–ï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>è¿˜å®ç°äº†ä¸¤ä¸ªå¢é‡å¼ä¼˜åŒ–å™¨<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess08tro.pdf">iSAM</a>,<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess12ijrr.pdf">iSAM2</a></p>
<p><strong>é”®ï¼ˆKeysï¼‰</strong>ï¼šå¾€å› å­å›¾æ·»åŠ å› å­éœ€è¦æŒ‡å®šè¯¥å› å­è¿æ¥åˆ°å“ªäº›å˜é‡ã€‚GTSAMä¸­ä½¿ç”¨é”®æ¥æŒ‡æ˜ã€‚ä¸€å…ƒå› å­éœ€è¦æŒ‡æ˜å…¶è¿æ¥åˆ°ç¬¬å‡ ä¸ªå˜é‡ï¼›äºŒå…ƒå› å­éœ€è¦æŒ‡æ˜å…¶è¿æ¥åˆ°å“ªä¸¤ä¸ªå˜é‡ã€‚å› å­å›¾ä¸­æ¯ä¸ªå˜é‡çš„é”®éƒ½åº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚ä¸ºäº†æ–¹ä¾¿åœ¨å¤šç§å˜é‡ç±»å‹çš„æƒ…å†µä¸‹æŒ‡æ˜é”®ï¼ŒGTSAMæä¾›<code>Symbols</code>æ¥è®©ç”¨æˆ·æ–¹ä¾¿ç”Ÿæˆä¸åŒå˜é‡ç±»å‹çš„é”®å€¼ã€‚ï¼ˆé”®ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œä½†å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼‰</p>
<h3 id="gtsamä¾‹å­æœ€å°ä¾‹å­">GTSAMä¾‹å­â€”â€”æœ€å°ä¾‹å­</h3>
<p>æœ¬å°èŠ‚å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-Hands-on Introduction</a>â€”ç¬¬2ç«  ä»¥æ„å»ºå¹¶æ±‚è§£ä¸‹é¢å› å­å›¾ä¸ºä¾‹</p>
<figure>
<img src="./imgs/gtsam-minExample.png" alt="" /><figcaption>GTSAMæœ€å°ä¾‹å­å› å­å›¾ç¤ºæ„</figcaption>
</figure>
<p>ä¸Šå›¾ä¸­<span class="math inline">\(x_1,x_2,x_3\)</span>ä¸ºæœºå™¨äººä¸‰ä¸ªæ—¶åˆ»çš„ä½å§¿ï¼›<span class="math inline">\(f_0\)</span>ä¸ºç¬¬ä¸€ä¸ªæ—¶åˆ»æœºå™¨äººä½å§¿çš„è§‚æµ‹ï¼›<span class="math inline">\(f_1,f_2\)</span>ä¸ºæ—¶åˆ»1-2å’Œæ—¶åˆ»2-3ä¹‹é—´çš„é‡Œç¨‹è®¡ä¼°è®¡ã€‚<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/examples/OdometryExample.cpp">ä»£ç </a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„å»ºä¸€ä¸ªç©ºçš„éçº¿æ€§å› å­å›¾</span></span><br><span class="line">NonlinearFactorGraph graph;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºå…ˆéªŒå› å­ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„f_0</span></span><br><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨äºŒç»´å§¿æ€ï¼ˆx,y,thetaï¼‰ç®€åŒ–é—®é¢˜</span></span><br><span class="line"><span class="function">Pose2 <span class="title">priorMean</span><span class="params">(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line"><span class="comment">// é«˜æ–¯å™ªå£°ï¼Œä»£è¡¨æˆ‘ä»¬å¯¹è¯¥å› å­çš„ä¸ç¡®å®šæ€§</span></span><br><span class="line"><span class="keyword">auto</span> priorNoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(<span class="built_in">Vector3</span>(<span class="number">0.3</span>, <span class="number">0.3</span>, <span class="number">0.1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å…ˆéªŒå› å­åŠ å…¥å› å­å›¾</span></span><br><span class="line"><span class="comment">// å…¶ä¸­çš„1è¡¨ç¤ºè¯¥å› å­è¿æ¥åˆ°ç¬¬1ä¸ªå˜é‡</span></span><br><span class="line">graph.<span class="built_in">add</span>(<span class="built_in">PriorFactor</span>&lt;Pose2&gt;(<span class="number">1</span>, priorMean, priorNoise));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºé‡Œç¨‹è®¡å› å­ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„f_1,f_2</span></span><br><span class="line"><span class="comment">// å¾€å‰ç§»åŠ¨2ç±³ï¼Œyè½´ä¸ä¾¿ï¼Œthetaä¸å˜</span></span><br><span class="line"><span class="function">Pose2 <span class="title">odometry</span><span class="params">(<span class="number">2.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line"><span class="keyword">auto</span> odometryNoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(<span class="built_in">Vector3</span>(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†é‡Œç¨‹è®¡å› å­åŠ å…¥å› å­å›¾</span></span><br><span class="line"><span class="comment">// 1,2ä»£è¡¨è¯¥é‡Œç¨‹è®¡çº¦æŸæ˜¯ä»å˜é‡1åˆ°å˜é‡2</span></span><br><span class="line">graph.<span class="built_in">add</span>(<span class="built_in">BetweenFactor</span>&lt;Pose2&gt;(<span class="number">1</span>, <span class="number">2</span>, odometry, odometryNoise));</span><br><span class="line"><span class="comment">// æ·»åŠ ç›¸åŒçš„å› å­åˆ°å˜é‡2å’Œå˜é‡3ä¹‹é—´</span></span><br><span class="line">graph.<span class="built_in">add</span>(<span class="built_in">BetweenFactor</span>&lt;Pose2&gt;(<span class="number">2</span>, <span class="number">3</span>, odometry, odometryNoise));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å„ä¸ªå˜é‡çš„åˆå§‹å€¼</span></span><br><span class="line">Values initial;</span><br><span class="line">initial.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="built_in">Pose2</span>(<span class="number">0.5</span>, <span class="number">0.0</span>, <span class="number">0.2</span>));</span><br><span class="line">initial.<span class="built_in">insert</span>(<span class="number">2</span>, <span class="built_in">Pose2</span>(<span class="number">2.3</span>, <span class="number">0.1</span>, <span class="number">-0.2</span>));</span><br><span class="line">initial.<span class="built_in">insert</span>(<span class="number">3</span>, <span class="built_in">Pose2</span>(<span class="number">4.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ä¼˜åŒ–å™¨å¹¶ä½¿ç”¨è®¾å®šå¥½çš„åˆå§‹å€¼å¯¹å› å­å›¾ä¼˜åŒ–</span></span><br><span class="line">Values result = <span class="built_in">LevenberMarquardtOptimizer</span>(graph, initial).<span class="built_in">optimize</span>();</span><br></pre></td></tr></table></figure>
<h3 id="gtsamä¾‹å­imué¢„ç§¯åˆ†åŠimufactor">GTSAMä¾‹å­â€”â€”IMUé¢„ç§¯åˆ†åŠImuFactor</h3>
<p>åœ¨ç›®å‰çš„SLAMï¼Œæ— è®ºæ˜¯VIOè¿˜æ˜¯LIOï¼Œå‰ç«¯éƒ½éœ€è¦IMUåšç§¯åˆ†å¾—åˆ°ä¸€ä¸ªä½å§¿çš„åˆå§‹ä¼°è®¡ã€‚<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ä¸­å®ç°äº†ä¸€ä¸ªIMUé¢„ç§¯åˆ†ç®—æ³•ï¼Œå¹¶å¯ä»¥å°†å…¶ç›´æ¥åŠ å…¥å› å­å›¾ä¸­åšä¼˜åŒ–ã€‚è¿™åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ä¹Ÿè¢«ä½¿ç”¨åˆ°ã€‚ æœ¬ä¾‹å­å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/examples/ImuFactorsExample2.cpp">GTSAM-repo/examples/ImuFactorExample2.cpp</a>ï¼Œä¸ºäº†è¯´æ˜<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ä¸­IMUé¢„ç§¯åˆ†å™¨åŠ<code>ImuFactor</code>çš„ç”¨æ³•ï¼Œå¯¹è¯¥ä¾‹å­è¿›è¡Œç®€åŒ–ã€‚æœ€åæ„å»ºå‡ºçš„å› å­å›¾å¦‚ä¸‹ï¼ˆä¸ºäº†å¯è§†åŒ–ï¼Œäººå·¥è°ƒæ•´äº†å¸ƒå±€ï¼‰ï¼š</p>
<figure>
<img src="./imgs/ImuFactorGraph.png" alt="" /><figcaption>ä½¿ç”¨ImuFactoræ„å»ºçš„å› å­å›¾</figcaption>
</figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç ï¼Œå®Œæ•´ä»£ç è§ä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IMU é¢„ç§¯åˆ†å™¨</span></span><br><span class="line"><span class="comment">// è®¾ç½®é¢„ç§¯åˆ†å™¨çš„å™ªå£°å‚æ•°ï¼Œè¿™äº›å™ªå£°å‚æ•°ä¸€èˆ¬æ¥è‡ªIMUçš„ç¦»çº¿æ ‡å®šç»“æœ</span></span><br><span class="line"><span class="keyword">auto</span> params = PreintegrationParams::<span class="built_in">MakeSharedU</span>(kGravity);</span><br><span class="line">params-&gt;<span class="built_in">setAccelerometerCovariance</span>(I_3x3 * <span class="number">0.1</span>);</span><br><span class="line">params-&gt;<span class="built_in">setGyroscopeCovariance</span>(I_3x3 * <span class="number">0.1</span>);</span><br><span class="line">params-&gt;<span class="built_in">setIntegrationCovariance</span>(I_3x3 * <span class="number">0.1</span>);</span><br><span class="line">params-&gt;<span class="built_in">setUse2ndOrderCoriolis</span>(<span class="literal">false</span>);</span><br><span class="line">params-&gt;<span class="built_in">setOmegaCoriolis</span>(<span class="built_in">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"><span class="comment">// è®¾ç½®IMUé¢„ç§¯åˆ†å™¨</span></span><br><span class="line"><span class="function">PreintegratedImuMeasurements <span class="title">accum</span><span class="params">(params)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ä¸€ä¸ªéçº¿æ€§å› å­å›¾</span></span><br><span class="line">NonlinearFactorGraph newgraph;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å› å­å›¾çš„åˆå§‹å€¼å’Œä¼˜åŒ–ç»“æœ</span></span><br><span class="line">Values initialEstimate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ä½å§¿çš„å…ˆéªŒå› å­</span></span><br><span class="line"><span class="comment">// å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡x0çš„ä¸€å…ƒå› å­</span></span><br><span class="line"><span class="comment">// å™ªå£°è®¾ç½®ä¸ºrollã€pitchã€yawæœ‰0.1radçš„æ ‡å‡†å·®ï¼Œxï¼Œyï¼Œzæœ‰30cmçš„æ ‡å‡†å·®</span></span><br><span class="line"><span class="keyword">auto</span> noise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(</span><br><span class="line">    (<span class="built_in">Vector</span>(<span class="number">6</span>) &lt;&lt; Vector3::<span class="built_in">Constant</span>(<span class="number">0.1</span>), Vector3::<span class="built_in">Constant</span>(<span class="number">0.3</span>)).<span class="built_in">finished</span>());</span><br><span class="line"><span class="comment">// å°†ä½å§¿çš„å…ˆéªŒå› å­åŠ å…¥å› å­å›¾ä¸­</span></span><br><span class="line">newgraph.<span class="built_in">addPrior</span>(<span class="built_in">X</span>(<span class="number">0</span>), pose_0, noise);</span><br><span class="line"><span class="comment">// å°†ä½å§¿0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">initialEstimate.<span class="built_in">insert</span>(<span class="built_in">X</span>(<span class="number">0</span>), pose_0);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®IMUåå·®çš„å…ˆéªŒå› å­</span></span><br><span class="line"><span class="comment">// å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡b0çš„ä¸€å…ƒå› å­</span></span><br><span class="line">Key biasKey = <span class="built_in">Symbol</span>(<span class="string">&#x27;b&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">auto</span> biasnoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(Vector6::<span class="built_in">Constant</span>(<span class="number">0.1</span>));</span><br><span class="line">newgraph.<span class="built_in">addPrior</span>(biasKey, imuBias::<span class="built_in">ConstantBias</span>(), biasnoise);</span><br><span class="line"><span class="comment">// å°†IMUåå·®b0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">initialEstimate.<span class="built_in">insert</span>(biasKey, imuBias::<span class="built_in">ConstantBias</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®é€Ÿåº¦çš„å…ˆéªŒå› å­</span></span><br><span class="line"><span class="comment">// å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡v0çš„ä¸€å…ƒå› å­</span></span><br><span class="line"><span class="comment">// è¿™é‡Œè®¾ç½®åˆå§‹é€Ÿåº¦ä¸º0ï¼šVector3(0,0,0)</span></span><br><span class="line"><span class="keyword">auto</span> velnoise = noiseModel::Diagonal::<span class="built_in">Sigmas</span>(<span class="built_in">Vector3</span>(<span class="number">0.01</span>, <span class="number">0.01</span>, <span class="number">0.01</span>));</span><br><span class="line">newgraph.<span class="built_in">addPrior</span>(<span class="built_in">V</span>(<span class="number">0</span>), <span class="built_in">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>), velnoise);</span><br><span class="line"><span class="comment">// å°†é€Ÿåº¦v0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">initialEstimate.<span class="built_in">insert</span>(<span class="built_in">V</span>(<span class="number">0</span>), <span class="built_in">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äºæœºå™¨äººçš„æ‰€æœ‰ä½å§¿æ—¶åˆ»ï¼ˆå…³é”®å¸§ï¼‰</span></span><br><span class="line"><span class="keyword">for</span> (i in N_steps)</span><br><span class="line">&#123;</span><br><span class="line">  biasKey++;</span><br><span class="line">  Symbol b1 = biasKey - <span class="number">1</span>;</span><br><span class="line">  Symbol b2 = biasKey;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®iæ—¶åˆ»çš„ä½å§¿åˆå§‹å€¼</span></span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(<span class="built_in">X</span>(i), pose_i);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹äºä¸¤ä¸ªæ—¶åˆ»ä¹‹é—´çš„æ‰€æœ‰IMUæ•°æ®è¿›è¡Œç§¯åˆ†</span></span><br><span class="line">  <span class="keyword">for</span> (j in N_imu_queue)</span><br><span class="line">  &#123;</span><br><span class="line">    accum.<span class="built_in">integrateMeasurement</span>(measuredAcc, measuredOmega, <span class="type">delta_t</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨é¢„ç§¯åˆ†å™¨æ„å»ºIMUå› å­ï¼Œå¹¶åŠ å…¥å› å­å›¾ä¸­</span></span><br><span class="line">  <span class="comment">// IMUå› å­éœ€è¦æŒ‡å®šæœ¬æ¬¡ç§¯åˆ†çš„è¿‡ç¨‹è¿æ¥äº†å“ªä¸¤ä¸ªä½å§¿Xï¼Œé€Ÿåº¦Vä»¥åŠå½“å‰çš„åå·®ä¼°è®¡ï¼Œå› æ­¤ä¹Ÿå«`5-way factor`</span></span><br><span class="line">  <span class="function">ImuFactor <span class="title">imufac</span><span class="params">(X(i - <span class="number">1</span>), V(i - <span class="number">1</span>), X(i), V(i), biasKey, accum)</span></span>;</span><br><span class="line">  newgraph.<span class="built_in">add</span>(imufac);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ ä¸¤ä¸ªæ—¶åˆ»ä¹‹é—´IMUåå·®å› å­</span></span><br><span class="line">  <span class="keyword">auto</span> f = std::make_shared&lt;BetweenFactor&lt;imuBias::ConstantBias&gt; &gt;(</span><br><span class="line">            b1, b2, imuBias::<span class="built_in">ConstantBias</span>(), cov);</span><br><span class="line">  newgraph.<span class="built_in">add</span>(f);</span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(biasKey, imuBias::<span class="built_in">ConstantBias</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†é€Ÿåº¦çš„åˆå§‹å€¼åŠ å…¥åˆå§‹å€¼é›†åˆï¼Œæ³¨æ„ï¼Œè¿™é‡ŒåŠ å…¥çš„æ˜¯GroundTruthçš„é€Ÿåº¦ï¼Œåªæ˜¯ä¸ºäº†åšç¤ºä¾‹</span></span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(<span class="built_in">V</span>(i), linear_velocity_vector);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡å€¼IMUé¢„ç§¯åˆ†å™¨</span></span><br><span class="line">  accum.<span class="built_in">resetIntegration</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨LMä¼˜åŒ–å™¨å¯¹å› å­å›¾è¿›è¡Œä¼˜åŒ–å¹¶è·å–ä¼˜åŒ–ç»“æœ</span></span><br><span class="line">result = <span class="built_in">LevenbergMarquardtOptimizer</span>(newgraph, initialEstimate).<span class="built_in">optimize</span>();</span><br></pre></td></tr></table></figure>
<details class="note info no-icon"><summary><p>IMUé¢„ç§¯åˆ†åŠIMUå› å­å®Œæ•´ä»£ç </p>
</summary>
<figure class="highlight plaintext">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre>
</td>
<td class="code">
<pre><span class="line">/**</span><br><span class="line"> * @file ImuFactorExample2</span><br><span class="line"> * @brief Test example for using GTSAM ImuFactor and ImuCombinedFactor with ISAM2. Simplify and add graphviz by Zeal</span><br><span class="line"> * @author Robert Truax</span><br><span class="line"> * @author Zeal</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;gtsam/geometry/PinholeCamera.h&gt;</span><br><span class="line">#include &lt;gtsam/geometry/Cal3_S2.h&gt;</span><br><span class="line">#include &lt;gtsam/inference/Symbol.h&gt;</span><br><span class="line">#include &lt;gtsam/navigation/ImuBias.h&gt;</span><br><span class="line">#include &lt;gtsam/navigation/ImuFactor.h&gt;</span><br><span class="line">#include &lt;gtsam/navigation/Scenario.h&gt;</span><br><span class="line">#include &lt;gtsam/nonlinear/ISAM2.h&gt;</span><br><span class="line">#include &lt;gtsam/nonlinear/LevenbergMarquardtOptimizer.h&gt;</span><br><span class="line">#include &lt;gtsam/slam/BetweenFactor.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">using namespace gtsam;</span><br><span class="line"></span><br><span class="line">// Shorthand for velocity and pose variables</span><br><span class="line">using symbol_shorthand::V;</span><br><span class="line">using symbol_shorthand::X;</span><br><span class="line"></span><br><span class="line">const double kGravity = 9.81;</span><br><span class="line"></span><br><span class="line">/* ************************************************************************* */</span><br><span class="line">int main(int argc, char* argv[]) &#123;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  // èµ·ç‚¹</span><br><span class="line">  Pose3 pose_0(Rot3::Rodrigues(0, 0, 0), Point3(0,0,0));</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä¸€ä¸ªå§¿æ€ä»¿çœŸå™¨ï¼Œå§¿æ€æ²¿ç€yè½´ä»¥5m/sçš„é€Ÿåº¦å‰è¿›ï¼Œæ²¡æœ‰è§’åº¦å˜åŒ–</span><br><span class="line">  Vector3 angular_velocity_vector(0, 0, 0);</span><br><span class="line">  Vector3 linear_velocity_vector(0, 5, 0);</span><br><span class="line">  auto scenario = ConstantTwistScenario(angular_velocity_vector,</span><br><span class="line">                                        linear_velocity_vector, pose_0);</span><br><span class="line">  // è®¾ç½®ä»¿çœŸæ­¥é•¿ä¸º1s</span><br><span class="line">  double delta_t = 1.0;</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä¸€ä¸ªéçº¿æ€§å› å­å›¾</span><br><span class="line">  NonlinearFactorGraph newgraph;</span><br><span class="line"></span><br><span class="line">  // å£°æ˜å› å­å›¾çš„åˆå§‹å€¼å’Œä¼˜åŒ–ç»“æœ</span><br><span class="line">  Values initialEstimate, result;</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä½å§¿çš„å…ˆéªŒå› å­</span><br><span class="line">  // å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡x0çš„ä¸€å…ƒå› å­</span><br><span class="line">  // å™ªå£°è®¾ç½®ä¸ºrollã€pitchã€yawæœ‰0.1radçš„æ ‡å‡†å·®ï¼Œxï¼Œyï¼Œzæœ‰30cmçš„æ ‡å‡†å·®</span><br><span class="line">  auto noise = noiseModel::Diagonal::Sigmas(</span><br><span class="line">      (Vector(6) &lt;&lt; Vector3::Constant(0.1), Vector3::Constant(0.3)).finished());</span><br><span class="line">  // å°†ä½å§¿çš„å…ˆéªŒå› å­åŠ å…¥å› å­å›¾ä¸­</span><br><span class="line">  newgraph.addPrior(X(0), pose_0, noise);</span><br><span class="line">  // å°†ä½å§¿0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span><br><span class="line">  initialEstimate.insert(X(0), pose_0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // è®¾ç½®IMUåå·®çš„å…ˆéªŒå› å­</span><br><span class="line">  // å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡b0çš„ä¸€å…ƒå› å­</span><br><span class="line">  Key biasKey = Symbol(&#x27;b&#x27;, 0);</span><br><span class="line">  auto biasnoise = noiseModel::Diagonal::Sigmas(Vector6::Constant(0.1));</span><br><span class="line">  newgraph.addPrior(biasKey, imuBias::ConstantBias(), biasnoise);</span><br><span class="line">  // å°†IMUåå·®b0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span><br><span class="line">  initialEstimate.insert(biasKey, imuBias::ConstantBias());</span><br><span class="line">  </span><br><span class="line">  // è®¾ç½®é€Ÿåº¦çš„å…ˆéªŒå› å­</span><br><span class="line">  // å¯¹åº”åˆ°ä¸Šå›¾ä¸­è¿æ¥åˆ°å˜é‡v0çš„ä¸€å…ƒå› å­</span><br><span class="line">  // è¿™é‡Œè®¾ç½®åˆå§‹é€Ÿåº¦ä¸º0ï¼šVector3(0,0,0)</span><br><span class="line">  auto velnoise = noiseModel::Diagonal::Sigmas(Vector3(0.01, 0.01, 0.01));</span><br><span class="line">  newgraph.addPrior(V(0), Vector3(0,0,0), velnoise);</span><br><span class="line">  // å°†é€Ÿåº¦v0çš„åˆå§‹å€¼åŠ å…¥åˆå§‹ä¼°è®¡é›†åˆ</span><br><span class="line">  initialEstimate.insert(V(0), Vector3(0,0,0));</span><br><span class="line"></span><br><span class="line">  // IMU é¢„ç§¯åˆ†å™¨</span><br><span class="line">  // è®¾ç½®é¢„ç§¯åˆ†å™¨çš„å™ªå£°å‚æ•°ï¼Œè¿™äº›å™ªå£°å‚æ•°ä¸€èˆ¬æ¥è‡ªIMUçš„ç¦»çº¿æ ‡å®šç»“æœ</span><br><span class="line">  auto params = PreintegrationParams::MakeSharedU(kGravity);</span><br><span class="line">  params-&gt;setAccelerometerCovariance(I_3x3 * 0.1);</span><br><span class="line">  params-&gt;setGyroscopeCovariance(I_3x3 * 0.1);</span><br><span class="line">  params-&gt;setIntegrationCovariance(I_3x3 * 0.1);</span><br><span class="line">  params-&gt;setUse2ndOrderCoriolis(false);</span><br><span class="line">  params-&gt;setOmegaCoriolis(Vector3(0, 0, 0));</span><br><span class="line">  // è®¾ç½®IMUé¢„ç§¯åˆ†å™¨</span><br><span class="line">  PreintegratedImuMeasurements accum(params);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // æ¨¡ä»¿æœºå™¨äººåœ¨è¿åŠ¨ï¼Œè¿™é‡Œä¸€å…±æœ‰3ä¸ªä½å§¿èŠ‚ç‚¹0,1,2</span><br><span class="line">  // åœ¨è¿åŠ¨è¿‡ç¨‹ä¸­æ¨¡æ‹ŸIMUé¢„ç§¯åˆ†ï¼Œå¹¶å°†IMUå› å­ã€IMUåå·®å› å­åŠ å…¥å› å­å›¾ä¸­</span><br><span class="line">  for (size_t i = 0; i &lt; 3; ++i) &#123;</span><br><span class="line">    double t = i * delta_t;</span><br><span class="line">    if (i &gt; 0) &#123;  // è®¾ç½®ä½å§¿çš„åˆå§‹å€¼ï¼Œè¿™é‡Œæ˜¯é”™è¯¯ç¤ºèŒƒï¼Œä½¿ç”¨çœŸå€¼ä½œä¸ºåˆå§‹å€¼è®¾ç½®</span><br><span class="line">      auto pose_i = scenario.pose(t);</span><br><span class="line">      initialEstimate.insert(X(i), pose_i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ IMUå› å­å’ŒIMUåå·®å› å­</span><br><span class="line">    if (i &gt; 0) &#123;</span><br><span class="line">      // å‘¨æœŸæ€§æ·»åŠ IMUçš„åå·®å› å­ï¼›IMUçš„åå·®éœ€è¦ç”¨å…¶ä»–æ–¹å¼è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¦»çº¿æ ‡å®šçš„å‚æ•°ï¼ˆä¸€èˆ¬ä¸ä¼šï¼‰</span><br><span class="line">      if (i % 2 == 0) &#123;</span><br><span class="line">        // b1æ˜¯ä¸Šä¸€æ¬¡çš„IMUåå·®å˜é‡çš„é”®å€¼ï¼›b2æ˜¯æœ¬æ¬¡IMUåå·®çš„é”®å€¼</span><br><span class="line">        biasKey++;</span><br><span class="line">        Symbol b1 = biasKey - 1;</span><br><span class="line">        Symbol b2 = biasKey;</span><br><span class="line">        // æ·»åŠ ä¸¤ä¸ªIMUåå·®å˜é‡ä¹‹é—´çš„äºŒå…ƒå› å­</span><br><span class="line">        Vector6 covvec;</span><br><span class="line">        covvec &lt;&lt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1;</span><br><span class="line">        auto cov = noiseModel::Diagonal::Variances(covvec);</span><br><span class="line">        auto f = std::make_shared&lt;BetweenFactor&lt;imuBias::ConstantBias&gt; &gt;(</span><br><span class="line">            b1, b2, imuBias::ConstantBias(), cov);</span><br><span class="line">        newgraph.add(f);</span><br><span class="line">        // å°†å½“å‰çš„IMUåå·®å˜é‡çš„åˆå§‹ä¼°è®¡åŠ å…¥åˆå§‹å€¼é›†åˆ</span><br><span class="line">        initialEstimate.insert(biasKey, imuBias::ConstantBias());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // è¿™éƒ¨åˆ†æ‰æ˜¯é¢„ç§¯åˆ†å™¨è¿›è¡Œç§¯åˆ†çš„åœ°æ–¹</span><br><span class="line">      // æ¯æ¬¡ç§¯åˆ†æ¥æ”¶åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ä»¥åŠé—´éš”æ—¶é—´delta_t</span><br><span class="line">      Vector3 measuredAcc = scenario.acceleration_b(t);</span><br><span class="line">      Vector3 measuredOmega = scenario.omega_b(t);</span><br><span class="line">      accum.integrateMeasurement(measuredAcc, measuredOmega, delta_t);</span><br><span class="line"></span><br><span class="line">      // ä½¿ç”¨é¢„ç§¯åˆ†å™¨æ„å»ºIMUå› å­ï¼Œå¹¶åŠ å…¥å› å­å›¾ä¸­</span><br><span class="line">      // IMUå› å­éœ€è¦æŒ‡å®šæœ¬æ¬¡ç§¯åˆ†çš„è¿‡ç¨‹è¿æ¥äº†å“ªä¸¤ä¸ªä½å§¿Xï¼Œé€Ÿåº¦Vä»¥åŠå½“å‰çš„åå·®ä¼°è®¡ï¼Œå› æ­¤ä¹Ÿå«`5-way factor`</span><br><span class="line">      ImuFactor imufac(X(i - 1), V(i - 1), X(i), V(i), biasKey, accum);</span><br><span class="line">      newgraph.add(imufac);</span><br><span class="line"></span><br><span class="line">      // å°†é€Ÿåº¦çš„åˆå§‹å€¼åŠ å…¥åˆå§‹å€¼é›†åˆï¼Œæ³¨æ„ï¼Œè¿™é‡ŒåŠ å…¥çš„æ˜¯GroundTruthçš„é€Ÿåº¦ï¼Œåªæ˜¯ä¸ºäº†åšç¤ºä¾‹</span><br><span class="line">      initialEstimate.insert(V(i), linear_velocity_vector);</span><br><span class="line">      // é‡å€¼IMUé¢„ç§¯åˆ†å™¨</span><br><span class="line">      accum.resetIntegration();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // ä½¿ç”¨åˆå§‹å€¼ä¿å­˜å› å­å›¾</span><br><span class="line">  newgraph.saveGraph(&quot;ImuFactorsExample2_graphviz.dot&quot;, initialEstimate);</span><br><span class="line">  // æ‰“å°åˆ°å‘½ä»¤è¡Œ</span><br><span class="line">  newgraph.dot(cout, result);</span><br><span class="line"></span><br><span class="line">  // è°ƒç”¨LMä¼˜åŒ–å™¨å¯¹å› å­å›¾è¿›è¡Œä¼˜åŒ–å¹¶è·å–ä¼˜åŒ–ç»“æœ</span><br><span class="line">  result = LevenbergMarquardtOptimizer(newgraph, initialEstimate).optimize();</span><br><span class="line"></span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">/* ************************************************************************* */</span><br><span class="line"></span><br></pre>
</td>
</tr>
</table>
</figure>

</details>
<h3 id="gtsamä¾‹å­é€’å¢å¼ä¼˜åŒ–">GTSAMä¾‹å­â€”â€”é€’å¢å¼ä¼˜åŒ–</h3>
<p><a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>ä¸ä»…å†…ç½®äº†<code>Gaussian-Newton</code>å’Œ<code>Leverberg-Marquat</code>ä¸¤ä¸ªå¸¸è§çš„éçº¿æ€§ä¼˜åŒ–å™¨ï¼Œè¿˜å®ç°äº†<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess08tro.pdf">iSAM</a>å’Œ<a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~kaess/pub/Kaess12ijrr.pdf">iSAM2</a>ä¸¤ä¸ªé€’å¢å¼çš„ä¼˜åŒ–å™¨ã€‚ é€’å¢å¼ä¼˜åŒ–å™¨æ›´ç¬¦åˆSLAMä¸­å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŒç»­åŠ å…¥æ–°çš„ä½å§¿å’Œçº¦æŸï¼Œå¹¶æŒç»­è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">GTSAM-Hands-on Introduction</a>â€”â€”ç¬¬7ç« </p>
<p><a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/examples/VisualISAM2Example.cpp">example/VisualISAM2Example.cpp</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®iSAM2ä¼˜åŒ–å™¨</span></span><br><span class="line"><span class="function">ISAM2 <span class="title">isam</span><span class="params">(parameters)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å› å­å›¾å’Œåˆå§‹å€¼</span></span><br><span class="line">NonlinearFactorGraph graph;</span><br><span class="line">Values initialEstimate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">1</span>; i &lt; poses.<span class="built_in">size</span>(); ++i)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; relations.<span class="built_in">size</span>(); ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ å› å­</span></span><br><span class="line">    graph.<span class="built_in">add</span>(<span class="built_in">BetweenFactor</span>&lt;Pose3&gt;(i, j))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ åˆå§‹å€¼åˆ°åˆå§‹ä¼°è®¡é›†åˆ</span></span><br><span class="line">  initialEstimate.<span class="built_in">insert</span>(<span class="built_in">Symbol</span>(<span class="string">&#x27;x&#x27;</span>,i), initial_x[i]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å› å­å›¾åŠ å…¥ä¼˜åŒ–å™¨</span></span><br><span class="line">  isam.<span class="built_in">update</span>(graph, initialEstimate);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºå½“å‰å› å­å›¾å’Œåˆå§‹å€¼</span></span><br><span class="line">  <span class="comment">// å› å­å›¾å·²ç»åŠ å…¥ä¼˜åŒ–å™¨ï¼Œå› æ­¤éœ€è¦æ¸…ç©ºä¸ºä¸‹ä¸€æ¬¡å› å­å›¾åšå‡†å¤‡</span></span><br><span class="line">  graph.<span class="built_in">resize</span>(<span class="number">0</span>);</span><br><span class="line">  initialEstimate.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gtsamå­¦ä¹ è·¯å¾„">GTSAMå­¦ä¹ è·¯å¾„</h2>
<p><a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>å¯¹æ•´ä¸ªSLAMåç«¯é—®é¢˜éƒ½å°è£…å¾—å¾ˆå¥½ï¼Œå› æ­¤å¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸äº†è§£ä¼˜åŒ–ç»†èŠ‚çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„ä¼˜åŒ–ç®—æ³•ã€‚é™¤äº†å¯¹åç«¯ä¼˜åŒ–å’Œå›¾ä¼˜åŒ–è¿™äº›çŸ¥è¯†æŒæ¡å¤–ï¼Œ<a target="_blank" rel="noopener" href="https://gtsam.org/">GTSAM</a>çš„å­¦ä¹ ä¸»è¦è¿˜æ˜¯è¦<code>å­¦ä»¥è‡´ç”¨</code>ï¼Œ è¿™é‡Œåªæ˜¯ç®€å•åˆ—å‡ºç¬”è€…è§‰å¾—æ¯”è¾ƒåˆé€‚çš„èµ„æ–™é˜…è¯»å’Œå­¦ä¹ é¡ºåºã€‚</p>
<ol type="1">
<li>æœ¬æ–‡</li>
<li>GTSAMä»“åº“ä¸‹<code>doc</code>æ–‡ä»¶å¤¹ä¸­çš„<a target="_blank" rel="noopener" href="https://github.com/borglab/gtsam/blob/develop/doc/gtsam.pdf">gtsam.pdf</a></li>
<li>GTSAMä»“åº“ä¸‹<code>examples</code>æ–‡ä»¶å¤¹ä¸­çš„ä¸€äº›ä¾‹å­ï¼Œä¸»è¦æ˜¯å¯¹ç…§ä¸Šé¢çš„æ–‡æ¡£ä»¥åŠæœ¬æ–‡å‡ºç°çš„ä¾‹å­è¿›è¡Œé˜…è¯»è¿è¡Œ</li>
<li>æœ¬é¡¹ç›®åšå®¢ä¸­å…³äº<code>ImuPreintegration</code>å’Œ<code>MapOptimization</code>çš„è®²è§£</li>
<li>æœ¬é¡¹ç›®ä»£ç <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">spl</a>ä¸­<code>src/mapOptimization.cpp</code>å’Œ<code>src/imuPreintegration.cpp</code>ä»£ç </li>
</ol>
<h2 id="èµ„æ–™å‚è€ƒ">èµ„æ–™å‚è€ƒ</h2>
<ol type="1">
<li>å¯¹ç›®å‰å„ä¸ªå›¾ä¼˜åŒ–æ¡†æ¶ï¼ˆg2o,GTSAM,ceres,SE-Syncï¼‰ç­‰åšç»Ÿä¸€åˆ†æçš„ç»¼è¿°æ€§è®ºæ–‡ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://lamor.fer.hr/images/50036607/2021-ajuric-comparison-mipro.pdf">A Comparison of Graph OptimizationApproaches for Pose Estimation in SLAM</a></p>
<ol start="2" type="1">
<li>Introduction to Bundle Adjustment, ppt</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://vincentqin.gitee.io/blogresource-3/slam-summer-courses-CADCG-Lab/BA-haominLiu.pdf">Bundle Adjustment</a></p>
<ol start="3" type="1">
<li>å¯¹åŸºäºå›¾çš„SLAMåç«¯ä¼˜åŒ–ç®—æ³•çš„è®²è§£ï¼Œå¯¹SLAMçš„åç«¯é—®é¢˜åšæ¯”è¾ƒæ­£å¼çš„æè¿°ï¼Œæ¥è¿‘2000å¼•ç”¨</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://www2.informatik.uni-freiburg.de/~stachnis/pdf/grisetti10titsmag.pdf">A Tutorial on Graph-Based SLAM</a></p>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/22/lio_sam/featureExtraction-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-22 20:03:12" itemprop="dateCreated datePublished" datetime="2023-03-22T20:03:12+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-20 21:17:55" itemprop="dateModified" datetime="2023-04-20T21:17:55+08:00">2023-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/22/lio_sam/featureExtraction-doc/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—" href="/2023/03/22/lio_sam/featureExtraction-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::e84bd67344741c4da21c259e3e444c5d" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="ç‚¹äº‘ç‰¹å¾æå–">ç‚¹äº‘ç‰¹å¾æå–</h2>
<figure>
<img src="./imgs/Design-Pipelines-feature.png" alt="" /><figcaption>Simple-LIO-SAMæ€»ä½“æµç¨‹å›¾</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ²¿ç”¨<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>ã€<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>çš„åšæ³•ï¼Œä»åŸå§‹ç‚¹äº‘ä¸­æå–å‡ºè¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹ã€‚è¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹è¢«ä¸‹æ¸¸æ¨¡å—ç”¨æ¥åšç‚¹äº‘åŒ¹é…å’Œæ„å»ºåœ°å›¾ã€‚ ç‰¹å¾æå–æ¨¡å—æ˜¯æ¯”è¾ƒç®€å•çš„æ¨¡å—ï¼Œåªç›‘å¬æ¥è‡ª<code>ImageProjection</code>å‘å¸ƒå‡ºæ¥çš„å»ç•¸å˜åç‚¹äº‘ï¼ŒåŒæ—¶å°†æå–å‡ºçš„ç‰¹å¾ç‚¹äº‘å‘å¸ƒå‡ºå»ã€‚è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ol type="1">
<li>ç‰¹å¾ç‚¹çš„æå–æ ¹æ®ç‚¹çš„å¹³æ»‘åº¦ï¼Œè€Œå¹³æ»‘åº¦åˆ™é€šè¿‡æ¯ä¸ªç‚¹ä¸å‘¨å›´ç‚¹è·ç¦»çš„å¹³å‡å€¼åšè¿‘ä¼¼</li>
<li>å®é™…ä¸Šåœ¨æå–å®Œè¾¹ç¼˜ç‚¹å’Œå¹³é¢ç‚¹ä¹‹åï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>åœ¨ä»£ç é‡ŒåˆæŠŠæ‰€æœ‰éè¾¹ç¼˜ç‚¹çš„ç‚¹éƒ½åŠ å…¥äº†å¹³é¢ç‚¹é›†åˆã€‚è¿™æ˜¯æ¯”è¾ƒå¥‡æ€ªçš„åœ°æ–¹ã€‚ä»è¿™é‡Œçœ‹å‡ºä¹Ÿè®¸ç‰¹å¾æå–ä¹Ÿä¸æ˜¯å¿…è¦çš„ï¼Œ å› ä¸ºå¹³é¢ç‚¹å·²ç»åŒ…å«äº†å¤§éƒ¨åˆ†çš„ç‚¹äº‘ã€‚äº‹å®ä¸Šï¼Œåœ¨Githubçš„ä¸€ä¸ªä»“åº“<a target="_blank" rel="noopener" href="https://github.com/YJZLuckyBoy/liorf">liorf</a>ä¸­ï¼Œå°±å°†ç‰¹å¾æå–æ¨¡å—å»æ‰ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†è¯¥æ®µä¸­é™¤äº†è§’ç‚¹ä¹‹å¤–çš„ç‚¹åŠ å…¥å¹³é¢ç‚¹é›†åˆ</span></span><br><span class="line"><span class="comment">// ï¼ï¼ï¼ è¿™ç‚¹è®©æ­¥éª¤2æ„Ÿè§‰æ˜¯å¤šä½™çš„ï¼Œæœ€ç»ˆçš„ç»“æœå¯èƒ½åªæ˜¯åŸå§‹ç‚¹äº‘é™é‡‡æ ·ï¼Œå¯èƒ½ç‰¹å¾ç‚¹æå–ä¹Ÿæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">// cloudLabelæ ‡è¯†è¯¥ç‚¹çš„æ€§è´¨ï¼Œ-1ä¸ºå¹³é¢ç‚¹ï¼Œ0ä¸ºéç‰¹å¾ç‚¹ï¼Œ1ä¸ºè¾¹ç¼˜ç‚¹ã€‚</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = sp; k &lt;= ep; k++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (cloudLabel[k] &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        surfaceCloudScan-&gt;<span class="built_in">push_back</span>(extractedCloud-&gt;points[k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç‰¹å¾ç‚¹æå–åŸç†">ç‰¹å¾ç‚¹æå–åŸç†</h2>
<p>å…³äºç‰¹å¾ç‚¹æå–éƒ¨åˆ†<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>çš„è®ºæ–‡åŸºæœ¬ç•¥è¿‡ï¼Œå› ä¸ºè·Ÿ<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>çš„åšæ³•åŸºæœ¬ç›¸åŒã€‚æœ¬æ–‡å¯¹ç®—æ³•ä¸­ç‚¹äº‘ç‰¹å¾ç‚¹æå–åšè¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="è½¬æ¢åˆ°rangemat">è½¬æ¢åˆ°RangeMat</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ²¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>çš„åšæ³•ï¼Œå…ˆæŠŠä¸‰ç»´ç‚¹å…¨éƒ¨æŠ•å½±åˆ°äºŒç»´å›¾ç‰‡ï¼Œå›¾åƒåƒç´ ä¿å­˜æ¯ä¸ªç‚¹è·ç¦»åŸç‚¹çš„è·ç¦»ï¼Œç§°åš<code>RangeMat</code>ï¼Œ<code>RangeMat</code>æ˜¯è§„åˆ™çš„ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€æ¡æ¿€å…‰çº¿æŸæ‰«å°„360åº¦æ‰€äº§ç”Ÿçš„ç‚¹ï¼Œå› æ­¤åé¢ç”¨è¿™ä¸ª<code>RangeMat</code>åšç‰¹å¾æå–æ›´å¿«é€Ÿæ›´ç®€å•ã€‚ PSï¼šè¿™éƒ¨åˆ†æ˜¯åœ¨<code>ImageProjection</code>å°±å·²ç»å¤„ç†å¥½ï¼Œå¹¶ä¸”<code>RangeMat</code>ä¹Ÿè¢«å±•å¼€æˆä¸€ç»´å‘é‡å­˜å‚¨ã€‚</p>
<p>æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œåœ¨ä¸€äº›æ¿€å…‰é›·è¾¾ä¸­ï¼Œ<code>RangeMat</code>æ˜¯å¯ä»¥ç›´æ¥ä»é›·è¾¾é©±åŠ¨æä¾›çš„æ¥å£æ‹¿åˆ°ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰é›·è¾¾éƒ½æä¾›è¿™æ ·çš„APIã€‚æ®ç¬”è€…çš„äº†è§£ï¼Œousterçš„é›·è¾¾é©±åŠ¨APIå°±æä¾›ç›´æ¥è·å–<code>RangeMat</code>çš„åŠŸèƒ½ã€‚</p>
<h3 id="å¹³æ»‘åº¦ä¼°è®¡">å¹³æ»‘åº¦ä¼°è®¡</h3>
<p>ç‰¹å¾ç‚¹æå–é€šè¿‡æ¯ä¸ªç‚¹çš„å¹³æ»‘åº¦æ¥æå–ï¼Œå¹³æ»‘åº¦é«˜äºæŸä¸ªé˜ˆå€¼çš„è®¤ä¸ºæ˜¯è¾¹ç¼˜ç‚¹ï¼›å¹³æ»‘åº¦å°äºæŸä¸ªé˜ˆå€¼çš„è®¤ä¸ºæ˜¯å¹³é¢ç‚¹ã€‚ è€Œå¹³æ»‘åº¦çš„ä¼°è®¡åˆ™é€šè¿‡æ¯ä¸€ä¸ªç‚¹åœ¨è¯¥æ¿€å…‰çº¿æˆåƒçš„å‰åå‡ ä¸ªç‚¹çš„å¹³å‡è·ç¦»ä»£æ›¿ã€‚ æˆ‘ä»¬ä»¤æ—¶é—´<span class="math inline">\(t\)</span>çš„ç‚¹äº‘ä¸º<span class="math inline">\(P_t = \{p_i, i \in |P_t|\}\)</span>ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥æ ¹æ®æ¯ä¸ªç‚¹çš„åæ ‡ç®—å‡ºæ¯ä¸ªç‚¹è·ç¦»åŸç‚¹çš„è·ç¦»<span class="math inline">\(r_i\)</span>ï¼Œå¯¹äºæ¯ä¸ªç‚¹ï¼Œæˆ‘ä»¬å–å…¶åŒä¸€æ¡æ¿€å…‰çº¿ä¸Šå‰å5ä¸ªç‚¹æ„æˆé›†åˆ<span class="math inline">\(S\)</span>ï¼Œåˆ™ï¼Œç‚¹<span class="math inline">\(p_i\)</span>çš„å¹³æ»‘åº¦å¯ä»¥è¿™æ ·è®¡ç®—ï¼š</p>
<p><span class="math display">\[
c = \frac{1}{|S|\cdot||r_i||}\left|\left|\sum_{j\in S,j\neq i}(r_j-r_i)\right|\right|
\]</span></p>
<h3 id="åˆ†æ®µæå–åŠç‰¹å¾ç‚¹æ•°é‡æ•°é‡é™åˆ¶">åˆ†æ®µæå–åŠç‰¹å¾ç‚¹æ•°é‡æ•°é‡é™åˆ¶</h3>
<p>ä¸ºäº†è®©ç‰¹å¾ç‚¹åˆ†å¸ƒæ›´å‡åŒ€ï¼Œé‡‡ç”¨ç±»ä¼¼<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>ï¼Œå°†æ•´ä¸ª360çš„å›¾åƒåœ¨æ°´å¹³æ–¹å‘åˆ†æˆ6ä¸ªå­å›¾åƒï¼Œåœ¨æ¯ä¸ªå­å›¾åƒä¸­è¿›è¡Œç‰¹å¾ç‚¹æå–ã€‚å¹¶ä¸”ï¼Œå¯¹äºæ¯ä¸€ä¸ªå­å›¾åƒä¸­çš„æ¯ä¸€æ¡æ¿€å…‰çº¿æŸï¼Œä¼šé™åˆ¶è¾¹ç¼˜ç‚¹æ•°é‡ä¸è¶…è¿‡20ä¸ªï¼Œå¹³é¢ç‚¹çš„æ•°é‡åˆ™æ²¡æœ‰é™åˆ¶ã€‚</p>
<h3 id="ç‰¹æ®Šæƒ…å†µ">ç‰¹æ®Šæƒ…å†µ</h3>
<p><strong>æœ‰3ç§ç‰¹æ®Šæƒ…å†µä¸èƒ½å°†è¯¥ç‚¹è®¾ç½®ä¸ºè¾¹ç¼˜ç‚¹ï¼š</strong></p>
<ol type="1">
<li>å½“ä¸€ä¸ªç‚¹è¢«é€‰æ‹©ä¸ºç‰¹å¾ç‚¹ï¼Œåˆ™æŠŠè¯¥ç‚¹å·¦å³5ä¸ªç‚¹éƒ½æ’é™¤åœ¨ç‰¹å¾ç‚¹é€‰å–èŒƒå›´</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹è¯¥è§’ç‚¹å·¦å³å„5ä¸ªç‚¹ï¼Œå¦‚æœä¸¤ç‚¹ä¹‹é—´çš„åˆ—ç´¢å¼•å·®è·å°äº10ï¼Œåˆ™æŠ›å¼ƒå‘¨å›´çš„ç‚¹ï¼Œé¿å…é‡å¤å¯¹åŒä¸€å—åŒºåŸŸæå–è§’ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= <span class="number">5</span>; l++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> columnDiff = std::<span class="built_in">abs</span>(<span class="built_in">int</span>(cloudInfo.point_col_ind[ind + l] - cloudInfo.point_col_ind[ind + l - <span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">if</span> (columnDiff &gt; <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    cloudNeighborPicked[ind + l] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">-1</span>; l &gt;= <span class="number">-5</span>; l--)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> columnDiff = std::<span class="built_in">abs</span>(<span class="built_in">int</span>(cloudInfo.point_col_ind[ind + l] - cloudInfo.point_col_ind[ind + l + <span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">if</span> (columnDiff &gt; <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    cloudNeighborPicked[ind + l] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>å½“è¯¥ç‚¹å¯èƒ½æ˜¯ç”±äºé®æŒ¡å¯¼è‡´è¢«é€‰æ‹©ä¸ºè¾¹ç¼˜ç‚¹</li>
</ol>
<figure>
<img src="./imgs/illegal_feature_point.png" alt="" /><figcaption>ä¸åˆæ ¼çš„ç‰¹å¾ç‚¹(from LOAM)</figcaption>
</figure>
<p>å¦‚ä¸Šå›¾ï¼ˆbï¼‰æ‰€ç¤ºï¼Œç‚¹Aæ˜¯ç”±äºè¢«å¹³é¢é®æŒ¡è€Œäº§ç”Ÿçš„è¾¹ç¼˜ç‚¹ï¼Œå½“è§†è§’å˜åŒ–åï¼Œç‚¹Aå°±ä¸å†æ˜¯è¾¹ç¼˜ç‚¹ã€‚ è¿™ä¸ªé€»è¾‘çš„åˆ¤æ–­ä¹Ÿæ˜¯é€šè¿‡ç‚¹ä¸å…¶å‘¨å›´ç‚¹çš„rangeå·®è·åˆ¤æ–­ã€‚å¦‚æœæ˜¯ç”±äºé®æŒ¡äº§ç”Ÿçš„è¾¹ç¼˜ç‚¹ï¼Œåˆ™å…¶ä¸å·¦è¾¹æˆ–è€…å³è¾¹ä¼šå­˜åœ¨è·ç¦»çš„çªå˜ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// featureExtraction.cpp&gt;markOccludedPoints</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">markOccludedPoints</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cloudSize = extractedCloud-&gt;points.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// æ ‡è®°è¢«é®æŒ¡çš„ç‚¹å’Œä¸æ¿€å…‰æŸå¹³è¡Œçš„ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">5</span>; i &lt; cloudSize - <span class="number">6</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ ‡è®°è¢«é®æŒ¡çš„ç‚¹</span></span><br><span class="line">        <span class="type">float</span> depth1 = cloudInfo.point_range[i];</span><br><span class="line">        <span class="type">float</span> depth2 = cloudInfo.point_range[i+<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> columnDiff = std::<span class="built_in">abs</span>(<span class="built_in">int</span>(cloudInfo.point_col_ind[i+<span class="number">1</span>] - cloudInfo.point_col_ind[i]));</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªç‚¹çš„åˆ—ç´¢å¼•ç›¸å·®10ä¸ªåƒç´ ä¹‹å†…ï¼Œè®¤ä¸ºæ˜¯åŒä¸€å—åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">if</span> (columnDiff &lt; <span class="number">10</span>)&#123;</span><br><span class="line">            <span class="comment">// å½“å‰ç‚¹è·ç¦»å¤§äºå³ç‚¹è·ç¦»0.3ç±³ï¼Œè®¤ä¸ºå½“å‰ç‚¹åŠå·¦è¾¹6ä¸ªç‚¹æ— æ•ˆ</span></span><br><span class="line">            <span class="keyword">if</span> (depth1 - depth2 &gt; <span class="number">0.3</span>)&#123;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">4</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i] = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// å½“å‰ç‚¹è·ç¦»å°äºå³è¾¹ç‚¹è·ç¦»0.3ç±³ï¼Œè®¤ä¸ºå³è¾¹6ä¸ªç‚¹æ— æ•ˆ</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (depth2 - depth1 &gt; <span class="number">0.3</span>)&#123;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">4</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">                cloudNeighborPicked[i + <span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ‡è®°å¹³è¡Œä¸æ¿€å…‰æŸçš„ç‚¹</span></span><br><span class="line">        <span class="type">float</span> diff1 = std::<span class="built_in">abs</span>(<span class="built_in">float</span>(cloudInfo.point_range[i<span class="number">-1</span>] - cloudInfo.point_range[i]));</span><br><span class="line">        <span class="type">float</span> diff2 = std::<span class="built_in">abs</span>(<span class="built_in">float</span>(cloudInfo.point_range[i+<span class="number">1</span>] - cloudInfo.point_range[i]));</span><br><span class="line">        <span class="comment">// å½“å‰ç‚¹ä¸å·¦å³ä¸¤ç‚¹çš„è·ç¦»å‡å¤§äºé˜ˆå€¼ï¼Œè®¤ä¸ºå½“å‰ç‚¹æ˜¯å¤„äºå¹³è¡Œé¢çš„ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (diff1 &gt; <span class="number">0.02</span> * cloudInfo.point_range[i] &amp;&amp; diff2 &gt; <span class="number">0.02</span> * cloudInfo.point_range[i])</span><br><span class="line">            cloudNeighborPicked[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>å½“ç‚¹å¤„äºè·Ÿæ¿€å…‰çº¿å¹³è¡Œçš„å¹³é¢ä¸Šæ—¶ï¼Œä¹Ÿå¯èƒ½è¢«è®¤ä¸ºæ—¶è¾¹ç¼˜ç‚¹ï¼Œä¹Ÿéœ€è¦æ’é™¤ å¦‚ä¸Šå›¾ä¸­çš„(a)æ‰€ç¤ºï¼Œç‚¹Bä½äºä¸€ä¸ªè·Ÿæ¿€å…‰çº¿è¾ƒä¸ºå¹³è¡Œçš„é¢ä¸Šï¼Œæ¿€å…‰çº¿æ‰«è¿‡å»ï¼Œå‰åå‡ ä¸ªç‚¹çš„è·ç¦»å·®è·ä¼šå¾ˆå¤§ï¼Œå› æ­¤åœ¨å¤„ç†æ—¶å¯èƒ½ä¼šè¢«è®¤ä¸ºæ˜¯è¾¹ç¼˜ç‚¹ã€‚è¿™äº›ç‚¹ä¹Ÿéœ€è¦åšæ ‡è®°ï¼Œä¸è¦è®¾ç½®ä¸ºè¾¹ç¼˜ç‚¹ã€‚</li>
</ol>
<h2 id="ç‰¹å¾ç‚¹æå–æµç¨‹">ç‰¹å¾ç‚¹æå–æµç¨‹</h2>
<p>ç”±äºè¿™éƒ¨åˆ†ä»£ç å’ŒåŸç†éƒ½æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œåªè¯´ä¸€ä¸‹ç‰¹å¾æå–çš„æµç¨‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief</span></span><br><span class="line"><span class="comment">* cloudInfoè¯é¢˜çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½éƒ½æ˜¯é¡ºåºè¿›è¡Œ</span></span><br><span class="line"><span class="comment">* 1. æ¥æ”¶åˆ°ä»imageProjectionä¸­å‘å¸ƒå‡ºçš„ä¸€ä¸ªå»ç•¸å˜ç‚¹äº‘ä¿¡æ¯cloudInfo(è‡ªå®šä¹‰æ ¼å¼)</span></span><br><span class="line"><span class="comment">* 2. å¯¹æ¯ä¸ªç‚¹è®¡ç®—æ›²ç‡ã€‚è®¡ç®—æ—¶æ˜¯è®¡ç®—å‘¨å›´ç‚¹çš„å¹³å‡è·ç¦»ç”¨æ¥ä½œä¸ºæ›²ç‡çš„æ›¿ä»£</span></span><br><span class="line"><span class="comment">* 3. æ ‡è®°é®æŒ¡ç‚¹å’Œä¸æ¿€å…‰å¹³è¡Œçš„ç‚¹ï¼Œåç»­è¿™äº›ç‚¹ä¸èƒ½é‡‡çº³ä¸ºç‰¹å¾ç‚¹</span></span><br><span class="line"><span class="comment">* 4. ç‰¹å¾æå–ã€‚åˆ†åˆ«åšè§’ç‚¹ï¼ˆæ›²ç‡å¤§ï¼‰å’Œå¹³é¢ç‚¹ï¼ˆæ›²ç‡å°ï¼‰ç‰¹å¾ç‚¹æå–</span></span><br><span class="line"><span class="comment">* 5. æ•´åˆä¿¡æ¯ï¼Œå‘å¸ƒå®Œæ•´æ•°æ®åŒ…</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* @param msgIn ä»å»ç•¸å˜æ¨¡å—æ¥å—çš„æ•°æ®åŒ…</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">laserCloudInfoHandler</span><span class="params">(<span class="type">const</span> spl_lio_sam::msg::CloudInfo::SharedPtr msgIn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç¼“å­˜å…¨å±€å˜é‡ï¼Œåé¢çš„å‡½æ•°å¯ä»¥ç›´æ¥è¯»å–cloudInfoå’ŒcloudHeaderè¿›è¡Œå¤„ç†</span></span><br><span class="line">cloudInfo = *msgIn;</span><br><span class="line">cloudHeader = msgIn-&gt;header;</span><br><span class="line"><span class="comment">// æŠŠros2 PointCloud2è½¬æˆPCLæ ¼å¼ï¼Œæ–¹ä¾¿åé¢å¤„ç†</span></span><br><span class="line">pcl::<span class="built_in">fromROSMsg</span>(msgIn-&gt;cloud_deskewed, *extractedCloud);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—ç‚¹äº‘æ¯ä¸€ä¸ªç‚¹æ›²ç‡</span></span><br><span class="line"><span class="built_in">calculateSmoothness</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‡è®°é®æŒ¡ç‚¹å’Œä¸æ¿€å…‰å¹³è¡Œçš„ç‚¹ï¼Œåç»­è¿™äº›ç‚¹ä¸èƒ½é‡‡çº³ä¸ºç‰¹å¾ç‚¹</span></span><br><span class="line"><span class="built_in">markOccludedPoints</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹å¾æå–ã€‚åˆ†åˆ«åšè§’ç‚¹ï¼ˆæ›²ç‡å¤§ï¼‰å’Œå¹³é¢ç‚¹ï¼ˆæ›²ç‡å°ï¼‰ç‰¹å¾ç‚¹æå–</span></span><br><span class="line"><span class="built_in">extractFeatures</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´åˆä¿¡æ¯ï¼Œå‘å¸ƒå®Œæ•´æ•°æ®åŒ…</span></span><br><span class="line"><span class="built_in">publishFeatureCloud</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/22/lio_sam/imageProjection-doc/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-22 15:55:36" itemprop="dateCreated datePublished" datetime="2023-03-22T15:55:36+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-19 22:54:00" itemprop="dateModified" datetime="2023-04-19T22:54:00+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/22/lio_sam/imageProjection-doc/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—" href="/2023/03/22/lio_sam/imageProjection-doc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::92a09cadad63fefbcbc8404aeb27c1f1" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="æ€»è¿°">æ€»è¿°</h2>
<figure>
<img src="./imgs/Design-Pipelines-image.png" alt="" /><figcaption>Simple-LIO-SAMæ€»ä½“æµç¨‹å›¾</figcaption>
</figure>
<p>ç‚¹äº‘å»ç•¸å˜æ¨¡å—ï¼ˆimageProjection.cppæ–‡ä»¶ï¼Œæ–‡ä»¶å‘½ååº”è¯¥æ˜¯ç»§æ‰¿äº†<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>ï¼Œå…¶å®æˆ‘è§‰å¾—åº”è¯¥å«åšæ•°æ®é¢„å¤„ç†æ¨¡å—æ›´åˆé€‚ï¼‰ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨</p>
<ol type="1">
<li>å»é™¤æ¿€å…‰é›·è¾¾ç‚¹äº‘çš„è¿åŠ¨ç•¸å˜</li>
<li>æ£€ç´¢æ¯ä¸€å¸§ç‚¹äº‘å¯¹åº”çš„IMUè¾“å‡ºè§’åº¦ã€IMUé‡Œç¨‹è®¡ä½å§¿ï¼ˆå‘å¸ƒè‡ªImuPreintegrationï¼‰ï¼Œä»¥ä¾¿MapOptimizationæ¨¡å—ç”¨è¿™äº›ä¿¡æ¯ä½œä¸ºè¯¥å¸§ç‚¹äº‘çš„åˆå§‹ä½å§¿</li>
<li>è½¬æ¢ç‚¹äº‘æ ¼å¼ï¼Œè®¡ç®—<code>Range</code>å­—æ®µï¼Œæ–¹ä¾¿ç‰¹å¾æå–æ¨¡å—è¿›è¡Œè¾¹ç¼˜ç‚¹ã€å¹³é¢ç‚¹æå–</li>
</ol>
<p>ä»<code>æ€»ä½“æµç¨‹å›¾</code>ä¸éš¾çœ‹å‡ºï¼Œç‚¹äº‘å»ç•¸å˜æ¨¡å—æ˜¯æ•´ä¸ªç®—æ³•æ¡†æ¶çš„å…¥å£ã€‚ç‚¹äº‘å»ç•¸å˜æ¨¡å—çš„æ€»ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<figure>
<img src="./imgs/Design-imageProjection-pipeline.png" alt="" /><figcaption>ç‚¹äº‘å»ç•¸å˜æ¨¡å—æµç¨‹å›¾</figcaption>
</figure>
<h2 id="æ¶ˆæ¯è®¢é˜…åŠå‘å¸ƒ">æ¶ˆæ¯è®¢é˜…åŠå‘å¸ƒ</h2>
<figure>
<img src="./imgs/Design-Node%26%26Topics-imageProjection.png" alt="" /><figcaption>å»ç•¸å˜æ¨¡å—çš„æ¶ˆæ¯è®¢é˜…åŠå‘å¸ƒ</figcaption>
</figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¨¡å—è®¢é˜…ç‚¹äº‘å’ŒIMUçš„åŸå§‹æ•°æ®ï¼Œè¾“å‡ºä¸€ä¸ªä»¥<code>CloudInfo</code>æ ¼å¼çš„topicã€‚ä¸‹é¢è¯¦ç»†è®²è§£<code>CloudInfo</code>è¿™ä¸ªæ•°æ®æ ¼å¼ã€‚</p>
<h2 id="cloudinfoæ•°æ®ç±»å‹">CloudInfoæ•°æ®ç±»å‹</h2>
<p>ç»è¿‡å»ç•¸å˜çš„ç‚¹äº‘é€šè¿‡ç®—æ³•è‡ªå®šä¹‰çš„æ•°æ®æ ¼å¼<a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM/blob/main/msg/CloudInfo.msg">Simple-LIO-SAM/msg/CloudInfo.msg</a>å‘å¸ƒï¼›ç‰¹å¾æå–æ¨¡å—ä¹Ÿæ˜¯å°†ç‰¹å¾ç‚¹æ”¾å…¥è¿™ä¸ªè‡ªå®šä¹‰æ•°æ®æ ¼å¼å‘å¸ƒã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cloud Info</span></span><br><span class="line"><span class="string">std_msgs/Header</span> <span class="string">header</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è¿›è¡Œç‚¹äº‘å»ç•¸å˜æ—¶ï¼ŒæŠŠrangeæ•°æ®å±•å¼€æˆä¸€ç»´å‘é‡</span></span><br><span class="line"><span class="comment"># ringä»£è¡¨ç¬¬å‡ æ¡æ¿€å…‰çº¿æ•°ï¼Œæ¯”å¦‚16çº¿çš„æ¿€å…‰é›·è¾¾æœ‰16ä¸ªring</span></span><br><span class="line"><span class="comment"># start_ring_indexè®°å½•ç¬¬ä¸€ä¸ªringåœ¨ä¸€ç»´å‘é‡ä¸­çš„èµ·å§‹ç´¢å¼•</span></span><br><span class="line"><span class="comment"># end_ring_indexè®°å½•ç¬¬ä¸€ä¸ªringåœ¨ä¸€ç»´å‘é‡ä¸­çš„ç»“æŸç´¢å¼•</span></span><br><span class="line"><span class="string">int32[]</span> <span class="string">start_ring_index</span></span><br><span class="line"><span class="string">int32[]</span> <span class="string">end_ring_index</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•ä¸€ç»´çš„Rangeæ•°æ®ä¸­æ¯ä¸€ä¸ªç‚¹åœ¨åŸå§‹rangeå›¾ç‰‡ä¸­å±äºé‚£ä¸€ä¸ªåˆ—</span></span><br><span class="line"><span class="string">int32[]</span>  <span class="string">point_col_ind</span> <span class="comment"># point column index in range image</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰ç‚¹çš„rangeæ•°å€¼ï¼Œå±•å¼€ä¸ºä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="string">float32[]</span> <span class="string">point_range</span> <span class="comment"># point range </span></span><br><span class="line"></span><br><span class="line"><span class="string">int64</span> <span class="string">imu_available</span></span><br><span class="line"><span class="string">int64</span> <span class="string">odom_available</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Attitude for LOAM initialization</span></span><br><span class="line"><span class="comment"># ä»IMUåŸå§‹æ•°æ®è·å–çš„rollã€pitchã€yawè§’åˆå€¼</span></span><br><span class="line"><span class="comment"># å½“ä¸Šé¢çš„imu_avaliableä¸ºtrueï¼Œodom_availableä¸ºfalseçš„æ—¶å€™ï¼Œä¼šè¢«ç”¨æ¥</span></span><br><span class="line"><span class="comment"># å½“ä½œè¿™ä¸€å¸§ç‚¹äº‘çš„åˆå€¼</span></span><br><span class="line"><span class="string">float32</span> <span class="string">imu_roll_init</span></span><br><span class="line"><span class="string">float32</span> <span class="string">imu_pitch_init</span></span><br><span class="line"><span class="string">float32</span> <span class="string">imu_yaw_init</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initial guess from imu pre-integration</span></span><br><span class="line"><span class="comment"># ä»imuPreintegrationï¼ŒIMUé¢„ç§¯åˆ†æ¨¡å—è·å–çš„ä¸è¿™ä¸€å¸§é›·è¾¾æœ€æ¥è¿‘çš„åˆå§‹ä½å§¿</span></span><br><span class="line"><span class="comment"># å½“ä¸Šé¢çš„odom_availableæ ‡ç­¾è¢«ç½®ä¸ºtrueçš„æ—¶å€™ä¼šè¢«ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># ä¼˜å…ˆçº§æ¯”imu_xxx_inité«˜</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_x</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_y</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_z</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_roll</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_pitch</span></span><br><span class="line"><span class="string">float32</span> <span class="string">initial_guess_yaw</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Point cloud messages</span></span><br><span class="line"><span class="comment"># å»ç•¸å˜åçš„åŸå§‹ç‚¹äº‘</span></span><br><span class="line"><span class="comment"># åœ¨ç»è¿‡imageProjectionæ¨¡å—åï¼Œè¿™ä¸ªæ•°æ®å­—æ®µè¢«å¡«å……ã€‚åœ¨ç»è¿‡ç‰¹å¾æå–ä¹‹åè¿™ä¸ªå­—æ®µè¢«æ¸…ç©º</span></span><br><span class="line"><span class="string">sensor_msgs/PointCloud2</span> <span class="string">cloud_deskewed</span> </span><br><span class="line"><span class="comment"># featureExtractionæ¨¡å—æå–å‡ºçš„ç‚¹äº‘è¾¹ç¼˜ç‚¹</span></span><br><span class="line"><span class="string">sensor_msgs/PointCloud2</span> <span class="string">cloud_corner</span></span><br><span class="line"><span class="comment"># featureExtractionæ¨¡å—æå–å‡ºçš„ç‚¹äº‘å¹³é¢ç‚¹</span></span><br><span class="line"><span class="string">sensor_msgs/PointCloud2</span> <span class="string">cloud_surface</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦æ˜¯å‰é¢å‡ ä¸ªæ•°ç»„ç±»å‹ä¼šæ¯”è¾ƒéš¾ç†è§£ï¼Œä¸»è¦æ˜¯è¦çŸ¥é“åœ¨å»ç•¸å˜æ¨¡å—ä¸­ï¼Œå°†æ‰€æœ‰ç‚¹çš„<code>range</code>ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯ç‚¹è·ç¦»é›·è¾¾çš„è·ç¦»ï¼‰æ‹‰æˆä¸€ä¸ªä¸€ç»´çš„æ•°ç»„ï¼Œå³<code>float32[] point_range</code>ã€‚ åŒæ—¶ï¼Œ<code>cloud_deskewed</code>é‡Œå­˜å‚¨çš„æ˜¯å»å®Œç•¸å˜åçš„ç‚¹äº‘ï¼Œé‡Œé¢ç‚¹çš„é¡ºåºä¸<code>point_range</code>çš„é¡ºåºæ˜¯ä¸€æ ·çš„ã€‚</p>
<p><code>cloud_corner</code>å’Œ<code>cloud_surface</code>ä¸¤ä¸ªå­—æ®µåœ¨<code>imageProjection</code>æ¨¡å—ä¸­æ²¡æœ‰è¢«æ”¾ç½®æ•°æ®ã€‚ç‰¹å¾æå–æ¨¡å—ä¼šå°†è¾¹ç¼˜ç‚¹ã€å¹³é¢ç‚¹æ”¾ç½®åœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­ï¼ŒåŒæ—¶å°†<code>cloud_deskewed</code>å­—æ®µæ¸…ç©ºã€‚</p>
<h2 id="åŠŸèƒ½è§£è¯»">åŠŸèƒ½è§£è¯»</h2>
<h3 id="imuåŠimué‡Œç¨‹è®¡å¤„ç†">IMUåŠIMUé‡Œç¨‹è®¡å¤„ç†</h3>
<p>ImageProjectionç›‘å¬IMUåŸå§‹æ•°æ®ä¸ä»<code>ImuPreintegration</code>ï¼ˆåé¢ä¼šè¯¦ç»†è®²è§£è¿™ä¸ªæ¨¡å—ï¼‰å‘å¸ƒå‡ºæ¥çš„IMUé‡Œç¨‹è®¡æ•°æ®ï¼Œåˆ†åˆ«ç”±ä¸¤ä¸ªå›è°ƒå‡½æ•°å¤„ç†ï¼Œå¯¹äºIMUåŸå§‹æ•°æ®ï¼Œåªæ˜¯ç®€å•åœ°å°†å…¶æ—‹è½¬åˆ°é›·è¾¾åæ ‡ç³»åå¡å…¥ç¼“å­˜é˜Ÿåˆ—ã€‚ å¯¹äºIMUå†ç¨‹è®¡ï¼Œåˆ™æ˜¯ç›´æ¥å¡å…¥ç¼“å­˜é˜Ÿåˆ—ã€‚</p>
<h3 id="å»ç•¸å˜æµç¨‹">å»ç•¸å˜æµç¨‹</h3>
<p>ä¸€å¥è¯è¯´æ˜ç‚¹äº‘è¿åŠ¨ç•¸å˜æ ¡æ­£ï¼šæ ¹æ®æ¯ä¸€å¸§ç‚¹äº‘ä¸­æ¯ä¸€ä¸ªç‚¹çš„æ—¶é—´æˆ³ï¼Œè®¡ç®—è¯¥ç‚¹åˆ°è¯¥å¸§ç‚¹äº‘èµ·å§‹ç‚¹çš„æ—‹è½¬å¹³ç§»å˜æ¢ï¼Œå°†æ¯ä¸€ä¸ªç‚¹å˜æ¢åˆ°èµ·å§‹ç‚¹çš„åæ ‡ç³»ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œç®—æ³•ä¸­å¯¹è¿åŠ¨ç•¸å˜æ ¡æ­£åªåšäº†æ—‹è½¬æ ¡æ­£ï¼Œæ²¡æœ‰åšå¹³ç§»æ ¡æ­£ã€‚</p>
<p>å»ç•¸å˜æµç¨‹å‘ç”Ÿåœ¨ç‚¹äº‘çš„å›è°ƒå‡½æ•°ä¸­</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imageProjection::cloudHandler</span></span><br><span class="line"><span class="comment">/** åŸå§‹é›·è¾¾ç‚¹äº‘è¯é¢˜çš„å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸ŠçœŸæ­£åšç‚¹äº‘å¤„ç†çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">    * å®é™…å¤„ç†æµç¨‹æ˜¯å•çº¿ç¨‹æµæ°´çº¿å¼å¤„ç†ï¼Œè¿™ä¸ªå‡½æ•°åé¢çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯ä¸ºè¿™ä¸ªå‡½æ•°æœåŠ¡ï¼Œå› æ­¤éœ€è¦äº†è§£</span></span><br><span class="line"><span class="comment">    * ç‚¹äº‘å»ç•¸å˜çš„æµç¨‹ã€‚</span></span><br><span class="line"><span class="comment">    * è®¢é˜…åŸå§‹lidaræ•°æ®</span></span><br><span class="line"><span class="comment">    * 1ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼ï¼Œæå–ç‚¹äº‘ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *   1ï¼‰æ·»åŠ ä¸€å¸§æ¿€å…‰ç‚¹äº‘åˆ°é˜Ÿåˆ—ï¼Œå–å‡ºæœ€æ—©ä¸€å¸§ä½œä¸ºå½“å‰å¸§</span></span><br><span class="line"><span class="comment">    *   2) è®¡ç®—èµ·æ­¢æ—¶é—´æˆ³ï¼Œæ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§</span></span><br><span class="line"><span class="comment">    * 2ã€ä»IMUæ•°æ®å’ŒIMUé‡Œç¨‹è®¡æ•°æ®ä¸­æå–å»ç•¸å˜ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *   imuæ•°æ®ï¼š</span></span><br><span class="line"><span class="comment">    *   1) éå†å½“å‰æ¿€å…‰å¸§èµ·æ­¢æ—¶åˆ»ä¹‹é—´çš„imuæ•°æ®ï¼Œåˆå§‹æ—¶åˆ»å¯¹åº”imuçš„å§¿æ€è§’RPYè®¾ä¸ºå½“å‰å¸§çš„åˆå§‹å§¿æ€è§’</span></span><br><span class="line"><span class="comment">    *   2) ç”¨è§’é€Ÿåº¦ã€æ—¶é—´ç§¯åˆ†ï¼Œè®¡ç®—æ¯ä¸€æ—¶åˆ»ç›¸å¯¹äºåˆå§‹æ—¶åˆ»çš„æ—‹è½¬é‡ï¼Œåˆå§‹æ—¶åˆ»æ—‹è½¬è®¾ä¸º0</span></span><br><span class="line"><span class="comment">    *   imué‡Œç¨‹è®¡æ•°æ®ï¼š</span></span><br><span class="line"><span class="comment">    *   1) éå†å½“å‰æ¿€å…‰å¸§èµ·æ­¢æ—¶åˆ»ä¹‹é—´çš„imué‡Œç¨‹è®¡æ•°æ®ï¼Œåˆå§‹æ—¶åˆ»å¯¹åº”imué‡Œç¨‹è®¡è®¾ä¸ºå½“å‰å¸§çš„åˆå§‹ä½å§¿</span></span><br><span class="line"><span class="comment">    *   2) ç”¨èµ·å§‹ã€ç»ˆæ­¢æ—¶åˆ»å¯¹åº”imué‡Œç¨‹è®¡ï¼Œè®¡ç®—ç›¸å¯¹ä½å§¿å˜æ¢ï¼Œä¿å­˜å¹³ç§»å¢é‡</span></span><br><span class="line"><span class="comment">    * 3ã€å½“å‰å¸§æ¿€å…‰ç‚¹äº‘è¿åŠ¨ç•¸å˜æ ¡æ­£</span></span><br><span class="line"><span class="comment">    *   1) æ£€æŸ¥æ¿€å…‰ç‚¹è·ç¦»ã€æ‰«æçº¿æ˜¯å¦åˆè§„</span></span><br><span class="line"><span class="comment">    *   2) æ¿€å…‰è¿åŠ¨ç•¸å˜æ ¡æ­£ï¼Œä¿å­˜æ¿€å…‰ç‚¹</span></span><br><span class="line"><span class="comment">    * 4ã€æå–æœ‰æ•ˆæ¿€å…‰ç‚¹ï¼Œé›†åˆä¿¡æ¯åˆ°å‡†å¤‡å‘å¸ƒçš„cloud_infoæ•°æ®åŒ…</span></span><br><span class="line"><span class="comment">    * 5ã€å‘å¸ƒå½“å‰å¸§æ ¡æ­£åç‚¹äº‘ï¼Œæœ‰æ•ˆç‚¹å’Œå…¶ä»–ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    * 6ã€é‡ç½®å‚æ•°ï¼Œæ¥æ”¶æ¯å¸§lidaræ•°æ®éƒ½è¦é‡ç½®è¿™äº›å‚æ•°</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cloudHandler</span><span class="params">(<span class="type">const</span> sensor_msgs::msg::PointCloud2::SharedPtr laserCloudMsg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€æå–ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">cachePointCloud</span>(laserCloudMsg))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ã€ä»IMUæ•°æ®å’ŒIMUé‡Œç¨‹è®¡æ•°æ®ä¸­æå–å»ç•¸å˜ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">deskewInfo</span>())</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3ã€å½“å‰å¸§æ¿€å…‰ç‚¹äº‘è¿åŠ¨ç•¸å˜æ ¡æ­£</span></span><br><span class="line">    <span class="built_in">projectPointCloud</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4ã€æå–æœ‰æ•ˆæ¿€å…‰ç‚¹ï¼Œé›†åˆä¿¡æ¯åˆ°å‡†å¤‡å‘å¸ƒçš„cloud_infoæ•°æ®åŒ…</span></span><br><span class="line">    <span class="built_in">cloudExtraction</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5ã€å‘å¸ƒå½“å‰å¸§æ ¡æ­£åç‚¹äº‘ï¼Œæœ‰æ•ˆç‚¹å’Œå…¶ä»–ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">publishClouds</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6ã€é‡ç½®å‚æ•°ï¼Œæ¥æ”¶æ¯å¸§lidaræ•°æ®éƒ½è¦é‡ç½®è¿™äº›å‚æ•°</span></span><br><span class="line">    <span class="built_in">resetParameters</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æå–ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼</li>
</ul>
<figure>
<img src="./imgs/Design-imageProjection-cachePointCloud.png" alt="" /><figcaption>æå–ã€è½¬æ¢ç‚¹äº‘ä¸ºç»Ÿä¸€æ ¼å¼</figcaption>
</figure>
<ul>
<li>æå–å»ç•¸å˜ä¿¡æ¯</li>
</ul>
<figure>
<img src="./imgs/Design-imageProjection-deskewInfo.png" alt="" /><figcaption>æå–å»ç•¸å˜ä¿¡æ¯</figcaption>
</figure>
<p>è¿™é‡Œæœ‰å‡ ç‚¹è¦æ³¨æ„</p>
<ol type="1">
<li><p>ä»IMUåŸå§‹æ•°æ®è®¡ç®—æ¯ä¸€æ—¶åˆ»çš„ä½å§¿å˜æ¢ç”¨çš„æ˜¯è¿‘ä¼¼ç®—æ³•ï¼ˆå› ä¸ºä¸€å¸§ç‚¹äº‘æˆåƒæ—¶é—´å¾ˆçŸ­ï¼Œä¸€èˆ¬å°äº100msï¼‰ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹è§’åº¦åšç§¯åˆ†</span></span><br><span class="line"><span class="comment">// å†æ¬¡å¼ºè°ƒï¼Œå¯¹è§’é€Ÿåº¦çš„ç§¯åˆ†ä¸æ˜¯ç®€å•çš„è§’é€Ÿåº¦ä¹˜ä»¥é—´éš”æ—¶é—´</span></span><br><span class="line"><span class="comment">// å…³äºè§’é€Ÿåº¦çš„ç§¯åˆ†å…¬å¼å¯ä»¥æŸ¥é˜…ï¼šhttps://zhuanlan.zhihu.com/p/591613108</span></span><br><span class="line"><span class="type">static</span> <span class="type">double</span> timeDiff;</span><br><span class="line">timeDiff = currentImuTime - imuTime[imuPointerCur<span class="number">-1</span>];</span><br><span class="line">imuRotX[imuPointerCur] = imuRotX[imuPointerCur<span class="number">-1</span>] + angular_x * timeDiff;</span><br><span class="line">imuRotY[imuPointerCur] = imuRotY[imuPointerCur<span class="number">-1</span>] + angular_y * timeDiff;</span><br><span class="line">imuRotZ[imuPointerCur] = imuRotZ[imuPointerCur<span class="number">-1</span>] + angular_z * timeDiff;</span><br><span class="line">imuTime[imuPointerCur] = currentImuTime;</span><br><span class="line">++imuPointerCur;</span><br></pre></td></tr></table></figure></p></li>
<li><p>å¯¹äºé€Ÿåº¦è¾ƒä½ï¼Œè§’åº¦å˜åŒ–ä¸é‚£ä¹ˆå‰§çƒˆçš„è¡Œé©¶ç³»ç»Ÿï¼Œå³ä½¿ä¸åšç‚¹äº‘ç•¸å˜æ ¡æ­£ä¹Ÿæ²¡æœ‰é—®é¢˜</p></li>
</ol>
<ul>
<li>å¯¹ç‚¹äº‘åšå»ç•¸å˜å¤„ç†</li>
</ul>
<figure>
<img src="./imgs/Design-imageProjection-projectPointCloud.png" alt="" /><figcaption>å¯¹ç‚¹äº‘åšå»ç•¸å˜å¤„ç†</figcaption>
</figure>
<ul>
<li>æå–æœ‰æ•ˆç‚¹äº‘å¹¶é›†åˆå…¶ä»–ä¿¡æ¯</li>
</ul>
<p>è¿™é‡Œä¸»è¦æ˜¯å°†ç»è¿‡å»ç•¸å˜å¤„ç†åè®°å½•ä¸‹æ¥çš„æœ‰æ•ˆç‚¹è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œå¹¶æŠŠå„ç§ä¿¡æ¯å¡«å…¥å‡†å¤‡å‘å¸ƒçš„<code>cloud_info</code>æ¶ˆæ¯ä¸­ã€‚</p>
<ul>
<li>å‘å¸ƒç‚¹äº‘</li>
</ul>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-22 11:18:09" itemprop="dateCreated datePublished" datetime="2023-03-22T11:18:09+08:00">2023-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-19 22:43:29" itemprop="dateModified" datetime="2023-04-19T22:43:29+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»" href="/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::6ed3eebc09d2237963daad43bab3bc96" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="utiliti.cppæ–‡ä»¶">utiliti.cppæ–‡ä»¶</h2>
<p>è¿™æ˜¯<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>é‡Œä¸€ä¸ªæœ€åŸºç¡€çš„æ–‡ä»¶ï¼Œä¸»è¦æœ‰å‡ ä¸ªé‡è¦åŠŸèƒ½ï¼š</p>
<ol type="1">
<li>ä½œä¸ºæ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„åŸºç±»ï¼Œæ”¾ç½®æ‰€æœ‰ä»é…ç½®æ–‡ä»¶è¯»å–çš„é…ç½®å­—</li>
<li>æä¾›ä¸€äº›å®ç”¨å‡½æ•°</li>
<li>é…ç½®<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html">QoS</a></li>
</ol>
<p>æœ¬æ–‡å¯¹è¿™ä¸ªæ–‡ä»¶çš„è¯¦ç»†å†…å®¹å’Œé‡ç‚¹è¯¦ç»†è§£è¯»ã€‚</p>
<h2 id="é…ç½®åŸºç±»">é…ç½®åŸºç±»</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸ºäº†æ–¹ä¾¿é…ç½®ï¼ŒæŠŠæ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®é¡¹éƒ½å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶<code>Simple-LIO-SAM/config/params.yaml</code>ï¼ŒåŒæ—¶æ„å»ºäº†ä¸€ä¸ªåŸºç±»<code>ParamServer</code>ç»Ÿä¸€è¯»å–è¯¥é…ç½®æ–‡ä»¶ï¼Œå…¶ä½™æ¨¡å—éƒ½ä»è¯¥åŸºç±»ç»§æ‰¿ã€‚</p>
<figure>
<img src="./imgs/Design-Class.png" alt="" /><figcaption>æºä»£ç ç±»å›¾</figcaption>
</figure>
<p>è¿™å¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„æ–¹å¼ï¼Œä¸è¿‡ä»å®ç°ä¸Šæ¥è¯´çš„ç¡®æ˜¯æœ€ç®€å•çš„ã€‚</p>
<p>æ¯ä¸ªæ¨¡å—çš„å…·ä½“é…ç½®é¡¹åé¢å…·ä½“è®²è§£åˆ°ä¼šé€ä¸€è§£é‡Šï¼Œç›®å‰åªéœ€è¦çŸ¥é“æ˜¯åœ¨å“ªé‡Œé…ç½®å°±è¡Œã€‚</p>
<details class="note info no-icon"><summary><p>é…ç½®éƒ¨åˆ†ä»£ç </p>
</summary>
<figure class="highlight plaintext">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre>
</td>
<td class="code">
<pre><span class="line">// Topics</span><br><span class="line">string pointCloudTopic;  // åŸå§‹ç‚¹äº‘æ•°æ®è¯é¢˜ï¼ˆ/points_rawï¼‰</span><br><span class="line">string imuTopic;         // åŸå§‹IMUæ•°æ®è¯é¢˜ï¼ˆ/imu_correctï¼‰</span><br><span class="line">string imuOdomTopic;     // IMUé‡Œç¨‹è®¡ï¼Œåœ¨imuPreintegrationä¸­å¯¹IMUåšé¢„ç§¯åˆ†å¾—åˆ°ï¼ˆ/lio_sam/imu/odometryï¼‰</span><br><span class="line">string lidarOdomTopic;   // é›·è¾¾é‡Œç¨‹è®¡ï¼Œåœ¨mapOptimizationä¸­å¾—åˆ°ï¼ˆ/lio_sam/mapping/odometryï¼‰</span><br><span class="line">string gpsTopic;         // åŸå§‹gpsç»è¿‡robot_localizationåŒ…è®¡ç®—å¾—åˆ°ï¼Œæš‚æœªä½¿ç”¨</span><br><span class="line"></span><br><span class="line">// Services</span><br><span class="line">string saveMapSrv;      // ä¿å­˜åœ°å›¾serviceåœ°å€</span><br><span class="line"></span><br><span class="line">// Frames</span><br><span class="line">string imuFrame;        // IMUæ•°æ®åæ ‡ç³»ï¼Œå¦‚æœIMUå’Œæ¿€å…‰é›·è¾¾åæ ‡ç³»ç¡¬ä»¶å¯¹é½ï¼Œå¯ä»¥è®¤ä¸ºIMUã€Lidarã€Chassisåæ ‡ç³»ç›¸åŒ</span><br><span class="line">string lidarFrame;      // æ¿€å…‰é›·è¾¾åæ ‡ç³»ï¼Œç‚¹äº‘æ•°æ®åæ ‡ç³»ï¼Œç”±æ¿€å…‰é›·è¾¾å‘å¸ƒçš„æ•°æ®æŒ‡å®šã€‚ä¸lidarFrameç›¸åŒï¼Œä½†æ˜¯ä¸åŒé›·è¾¾æœ‰ä¸åŒçš„åç§°</span><br><span class="line">string baseLinkFrame;   // è½¦è¾†åº•ç›˜åæ ‡ç³»</span><br><span class="line">string odomFrame;       // åœ°å›¾åæ ‡ç³»ï¼Œåœ¨SLAMä¸­ä¸€èˆ¬ä¹Ÿæ˜¯ä¸–ç•Œåæ ‡ç³»ï¼Œé€šå¸¸æ˜¯è½¦è¾†çš„èµ·å§‹åæ ‡ç³»</span><br><span class="line"></span><br><span class="line">// GPS Settings</span><br><span class="line">bool useImuHeadingInitialization;</span><br><span class="line">bool useGpsElevation;</span><br><span class="line">float gpsCovThreshold;</span><br><span class="line">float poseCovThreshold;</span><br><span class="line"></span><br><span class="line">// Save pcd</span><br><span class="line">bool savePCD;</span><br><span class="line">string savePCDDirectory;</span><br><span class="line"></span><br><span class="line">// Lidar Sensor Configuration</span><br><span class="line">SensorType sensor;</span><br><span class="line">int N_SCAN;</span><br><span class="line">int Horizon_SCAN;</span><br><span class="line">int downsampleRate;</span><br><span class="line">float lidarMinRange;</span><br><span class="line">float lidarMaxRange;</span><br><span class="line"></span><br><span class="line">// IMU</span><br><span class="line">float imuAccNoise;      // IMUåŠ é€Ÿåº¦å™ªå£°åæ–¹å·®ï¼Œå¯ä»¥ç”¨Allenæ–¹å·®æ ‡å®šï¼›è¿™é‡Œä¸‰ä¸ªè½´è®¾ä¸ºç›¸åŒçš„æ–¹å·®</span><br><span class="line">float imuGyrNoise;      // IMUè§’é€Ÿåº¦å™ªå£°åæ–¹å·®ï¼Œå¯ä»¥ç”¨Allenæ–¹å·®æ ‡å®šï¼›è¿™é‡Œä¸‰ä¸ªè½´è®¾ä¸ºç›¸åŒçš„æ–¹å·®</span><br><span class="line">float imuAccBiasN;      // IMUåŠ é€Ÿåº¦åå·®ï¼Œä¸‰è½´ç»Ÿä¸€</span><br><span class="line">float imuGyrBiasN;      // IMUè§’é€Ÿåº¦åå·®ï¼Œä¸‰è½´ç»Ÿä¸€</span><br><span class="line">float imuGravity;       // é‡åŠ›åŠ é€Ÿåº¦å€¼</span><br><span class="line">float imuRPYWeight;     // ç®—æ³•ä¸­ä½¿ç”¨IMUçš„rollã€pitchè§’å¯¹æ¿€å…‰é‡Œç¨‹è®¡çš„ç»“æœåŠ æƒèåˆ</span><br><span class="line">vector&lt;double&gt; extRotV;         // IMUåŠ é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">vector&lt;double&gt; extRPYV;         // IMUè§’é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">vector&lt;double&gt; extTransV;       // IMUå‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„å¹³ç§»ï¼šP_&#123;lidar&#125; = T * P_&#123;imu&#125;</span><br><span class="line">Eigen::Matrix3d extRot;         // IMUåŠ é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">Eigen::Matrix3d extRPY;         // IMUè§’é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬</span><br><span class="line">Eigen::Vector3d extTrans;       // IMUå‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„å¹³ç§»ï¼šP_&#123;lidar&#125; = T * P_&#123;imu&#125;</span><br><span class="line">Eigen::Quaterniond extQRPY;     // IMUè§’é€Ÿåº¦å‘é‡åˆ°é›·è¾¾åæ ‡ç³»çš„æ—‹è½¬ï¼ˆå››å…ƒæ•°å½¢å¼ï¼‰</span><br><span class="line"></span><br><span class="line">// LOAM</span><br><span class="line">float edgeThreshold;            // è¾¹ç¼˜ç‰¹å¾ç‚¹æå–é˜ˆå€¼</span><br><span class="line">float surfThreshold;            // å¹³é¢ç‰¹å¾ç‚¹æå–é˜ˆå€¼</span><br><span class="line">int edgeFeatureMinValidNum;     // è¾¹ç¼˜ç‰¹å¾ç‚¹æ•°é‡é˜ˆå€¼ï¼ˆdefault:10)</span><br><span class="line">int surfFeatureMinValidNum;     // å¹³é¢ç‰¹å¾ç‚¹æ•°é‡é˜ˆå€¼ï¼ˆdefault:100)</span><br><span class="line"></span><br><span class="line">// voxel filter paprams</span><br><span class="line">float odometrySurfLeafSize;</span><br><span class="line">float mappingCornerLeafSize;</span><br><span class="line">float mappingSurfLeafSize ;</span><br><span class="line"></span><br><span class="line">float z_tollerance;             // é™åˆ¶zè½´å¹³ç§»çš„å¤§å°</span><br><span class="line">float rotation_tollerance;      // é™åˆ¶rollã€pitchè§’çš„å¤§å°</span><br><span class="line"></span><br><span class="line">// CPU Params</span><br><span class="line">int numberOfCores;              // åœ¨ç‚¹äº‘åŒ¹é…ä¸­ä½¿ç”¨æŒ‡ä»¤é›†å¹¶è¡ŒåŠ é€Ÿï¼ˆdefault:4ï¼‰</span><br><span class="line">double mappingProcessInterval;  // ç‚¹äº‘å¸§å¤„ç†æ—¶é—´é—´éš”ï¼ˆdefault:0.15sï¼‰</span><br><span class="line"></span><br><span class="line">// Surrounding map</span><br><span class="line">float surroundingkeyframeAddingDistThreshold;   // å½“å‰å¸§éœ€è¦ä¸ä¸Šä¸€å¸§è·ç¦»å¤§äº1ç±³æˆ–è€…è§’åº¦å¤§äº0.2åº¦æ‰æœ‰å¯èƒ½é‡‡çº³ä¸ºå…³é”®å¸§</span><br><span class="line">float surroundingkeyframeAddingAngleThreshold;  // å½“å‰å¸§éœ€è¦ä¸ä¸Šä¸€å¸§è·ç¦»å¤§äº1ç±³æˆ–è€…è§’åº¦å¤§äº0.2åº¦æ‰æœ‰å¯èƒ½é‡‡çº³ä¸ºå…³é”®å¸§</span><br><span class="line">float surroundingKeyframeDensity;               // æ„å»ºå±€éƒ¨åœ°å›¾æ—¶å¯¹é‡‡ç”¨çš„å…³é”®å¸§æ•°é‡åšé™é‡‡æ ·</span><br><span class="line">float surroundingKeyframeSearchRadius;          // æ„å»ºå±€éƒ¨åœ°å›¾æ—¶å…³é”®å¸§çš„æ£€ç´¢åŠå¾„</span><br><span class="line"></span><br><span class="line">// Loop closure</span><br><span class="line">bool  loopClosureEnableFlag;</span><br><span class="line">float loopClosureFrequency;                     // å›ç¯æ£€æµ‹ç‹¬ç«‹çº¿ç¨‹çš„æ‰§è¡Œé¢‘ç‡</span><br><span class="line">int   surroundingKeyframeSize;                  // å›ç¯æ£€æµ‹æ„å»ºå±€éƒ¨åœ°å›¾çš„æœ€å¤§å…³é”®å¸§æ•°é‡</span><br><span class="line">float historyKeyframeSearchRadius;              // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶å…³é”®å¸§çš„æ£€ç´¢åŠå¾„</span><br><span class="line">float historyKeyframeSearchTimeDiff;            // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶å…³é”®å¸§çš„æ£€ç´¢æ—¶é—´èŒƒå›´</span><br><span class="line">int   historyKeyframeSearchNum;                 // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶èåˆå±€éƒ¨åœ°å›¾æ—¶å¯¹ç›®æ ‡å…³é”®å¸§æ‰§è¡Œ+-25å¸§çš„å…³é”®å¸§èåˆ</span><br><span class="line">float historyKeyframeFitnessScore;              // æ‰§è¡Œå›ç¯æ£€æµ‹æ—¶ä½¿ç”¨ICPåšç‚¹äº‘åŒ¹é…ï¼Œé˜ˆå€¼å¤§äº0.3è®¤ä¸ºåŒ¹é…å¤±è´¥ï¼Œä¸é‡‡çº³å½“å‰å›ç¯æ£€æµ‹</span><br><span class="line"></span><br><span class="line">// global map visualization radius</span><br><span class="line">float globalMapVisualizationSearchRadius;</span><br><span class="line">float globalMapVisualizationPoseDensity;</span><br><span class="line">float globalMapVisualizationLeafSize;</span><br></pre>
</td>
</tr>
</table>
</figure>

</details>
<h2 id="å®ç”¨å‡½æ•°">å®ç”¨å‡½æ•°</h2>
<p>è¿™é‡Œä¸»è¦è®²è§£å…¶ä¸­ä¸€ä¸ª<code>imuConverter</code>å‡½æ•°ã€‚è¯¥å‡½æ•°çš„åŠŸèƒ½ä¸»è¦æ˜¯å°†<code>IMU</code>çš„åŸå§‹æ•°æ®<strong>æ—‹è½¬åˆ°</strong><code>Lidar</code>åæ ‡ç³»ã€‚è¿™é‡Œè¦å…ˆçŸ¥é“ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ï¼Œ é»˜è®¤å°†é›·è¾¾åæ ‡ç³»å’Œå°è½¦çš„åæ ‡ç³»ç­‰åŒä¸ºåŒä¸€ä¸ªåæ ‡ç³»ï¼ŒåŒæ—¶ï¼Œè¿™é‡Œåªåšäº†<strong>æ—‹è½¬</strong>æ“ä½œï¼Œæ²¡æœ‰åšå¹³ç§»æ“ä½œã€‚ä»£ç ä¸­æœ‰å¾ˆå¤šå¤„ä½ç½®éƒ½ç”¨åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤éœ€è¦ç†è§£è¿™ä¸ªå‡½æ•°åˆ°åº•åšäº†ä»€ä¹ˆã€‚ ç®€å•æ¥è¯´è¿™ä¸ªå‡½æ•°å°±æ˜¯åšäº†ä¸€ä¸ª<strong>å‘é‡åæ ‡å˜æ¢</strong>ã€‚æ—‹è½¬çŸ©é˜µæ“ä½œç©ºé—´ä¸­ä¸€ä¸ªç‚¹æœ‰ä¸¤ç§æ„ä¹‰ï¼š1ï¼‰ä¸‰ç»´æ—‹è½¬ï¼›2ï¼‰åæ ‡å˜æ¢ã€‚è¿™ä¸¤ç§ä¸åŒçš„æ“ä½œåœ¨åšè¿ç»­çš„æ“ä½œæ—¶ï¼Œå¯¹åº”æ—‹è½¬çŸ©é˜µçš„å·¦ä¹˜å’Œå³ä¹˜ã€‚ ç”±äºç¬”è€…ä»¥å‰çš„ç ”ç©¶æ–¹å‘æ˜¯å…­è‡ªç”±åº¦å§¿æ€ä¼°è®¡ï¼Œç”¨ä¸‰ç»´æ—‹è½¬æ“ä½œæ¯”è¾ƒå¤šï¼Œä¸€å¼€å§‹è¢«è¿™é‡Œçš„<code>çŸ©é˜µå³ä¹˜</code>æè’™äº†ã€‚å…³äºæ—‹è½¬çŸ©é˜µçš„å·¦ä¹˜å’Œå³ä¹˜ï¼Œå¯ä»¥çœ‹è¿™ç¯‡<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45632220/article/details/117735223">åšå®¢</a></p>
<p>è¿™ä¸ªå‡½æ•°çš„ä»£ç å’Œè§£é‡Šå¦‚ä¸‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å°†åŸå§‹IMUæ•°æ®ï¼šä¸‰è½´åŠ é€Ÿåº¦ã€ä¸‰è½´è§’é€Ÿåº¦ã€ä¸‰è½´è§’åº¦ï¼Œä¸é›·è¾¾åæ ‡ç³»è¿›è¡Œæ—‹è½¬å¯¹é½</span></span><br><span class="line"><span class="comment">+ å¯¹é½ä¹‹åè¾“å‡ºçš„åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ã€è§’åº¦çš„xï¼Œyï¼Œzå°±å˜æˆé›·è¾¾åæ ‡ç³»çš„xï¼Œyï¼Œz</span></span><br><span class="line"><span class="comment">+ è¿™é‡Œçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå…è®¸IMUçš„åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ä¸è§’åº¦çš„è¾“å‡ºæ˜¯ä¸¤ä¸ªä¸åŒçš„åæ ‡ç³»ã€‚ä½†åœ¨ç®—æ³•ä¸­ï¼Œè§’åº¦çš„è¾“å‡ºé™¤äº†ç”¨æ¥åšç¬¬ä¸€å¸§çš„åˆå§‹åŒ–å’ŒåŠ æƒèåˆï¼Œä¼¼ä¹æ²¡æœ‰å…¶ä»–ä½œç”¨</span></span><br><span class="line"><span class="comment">+ è¿™é‡Œæ˜¯å°†IMUçš„ä¸‰ä¸ªè½´ä¸é›·è¾¾çš„ä¸‰ä¸ªè½´åœ¨æ—‹è½¬ä¸Šåšå¯¹é½ï¼Œä¸èƒ½åŠ ä¸Šå¹³ç§»</span></span><br><span class="line"><span class="comment">+ å¯¹å‘é‡åšåæ ‡ç³»å˜æ¢ï¼Œå¯¹å¤šä¸ªå˜æ¢çš„å¤åˆåº”è¯¥æ˜¯å³ä¹˜</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sensor_msgs::<span class="function">msg::Imu <span class="title">imuConverter</span><span class="params">(<span class="type">const</span> sensor_msgs::msg::Imu&amp; imu_in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    sensor_msgs::msg::Imu imu_out = imu_in;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹åŠ é€Ÿåº¦å‘é‡åšåæ ‡ç³»å˜æ¢ï¼Œæ³¨æ„è¿™é‡Œè¦ç†è§£æˆåæ ‡ç³»å˜æ¢ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªåŠ é€Ÿåº¦åœ¨IMUåæ ‡ç³»å’ŒLidaråæ ‡ç³»çš„ä¸åŒè¡¨è¾¾ã€‚ä¸èƒ½æƒ³è±¡æˆå¯¹åŠ é€Ÿåº¦åšæ—‹è½¬</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Eigen::Vector3d <span class="title">acc</span><span class="params">(imu_in.linear_acceleration.x, imu_in.linear_acceleration.y, imu_in.linear_acceleration.z)</span></span>;</span><br><span class="line">    acc = extRot * acc;</span><br><span class="line">    imu_out.linear_acceleration.x = acc.<span class="built_in">x</span>();</span><br><span class="line">    imu_out.linear_acceleration.y = acc.<span class="built_in">y</span>();</span><br><span class="line">    imu_out.linear_acceleration.z = acc.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹è§’é€Ÿåº¦åšåæ ‡ç³»å˜æ¢ã€‚å°†IMUåæ ‡ç³»ä¸‹çš„å‘é‡å˜æ¢åˆ°é›·è¾¾åæ ‡ç³»ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Eigen::Vector3d <span class="title">gyr</span><span class="params">(imu_in.angular_velocity.x, imu_in.angular_velocity.y, imu_in.angular_velocity.z)</span></span>;</span><br><span class="line">    gyr = extRot * gyr;</span><br><span class="line">    imu_out.angular_velocity.x = gyr.<span class="built_in">x</span>();</span><br><span class="line">    imu_out.angular_velocity.y = gyr.<span class="built_in">y</span>();</span><br><span class="line">    imu_out.angular_velocity.z = gyr.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹è§’åº¦åšåæ ‡ç³»å˜æ¢ã€‚</span></span><br><span class="line"><span class="comment">    + q_fromæ˜¯IMUåœ¨å…¨å±€åæ ‡ç³»ä¸‹çš„ä½å§¿ï¼Œq_from: transformation_from_map_to_imu</span></span><br><span class="line"><span class="comment">    + extQRPYå¦‚æœä¸extRotå¯¹åº”çš„è¯åº”è¯¥æ˜¯lidaråˆ°imuçš„å˜æ¢ï¼štransformation_from_lidar_to_imu</span></span><br><span class="line"><span class="comment">    + q_finalæ˜¯å°†é›·è¾¾ç‚¹äº‘ä»é›·è¾¾åæ ‡ç³»è½¬æ¢åˆ°mapåæ ‡ç³»çš„å˜æ¢ï¼Œä¹Ÿæ˜¯ï¼štransformation_from_map_to_lidar -&gt; pcd_in_map = q_final * pcd_in_lidar</span></span><br><span class="line"><span class="comment">    + è¿™é‡ŒåŸä»£ç æ˜¯q_final = q_from * extQRPYï¼›ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œè¿˜æ˜¯æŒ‰ç…§æˆ‘çš„æ¨å¯¼ä¿®æ”¹æˆq_final = q_from * extQRPT.inverse()ï¼›ç”±äºè¿™é‡Œçš„extQRPYæ˜¯</span></span><br><span class="line"><span class="comment">    + ç›´æ¥ä»é…ç½®æ–‡ä»¶é‡Œé¢è¯»å–çš„ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸åŠ é€†åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œæ”¹å°±è¡Œã€‚è®¤ä¸ºè¿™é‡Œæœ‰é—®é¢˜çš„å‡è®¾æ˜¯è®¤ä¸ºextQRPYå’ŒextRotçš„åæ ‡ç³»å…³ç³»çš„å®šä¹‰æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯</span></span><br><span class="line"><span class="comment">    + å°†imuåæ ‡ç³»ä¸‹çš„å‘é‡è½¬æ¢åˆ°é›·è¾¾åæ ‡ç³»ä¸‹ã€‚å¦‚æœä½œè€…å¯¹è¿™ä¸¤è€…çš„å®šä¹‰åˆšå¥½æ˜¯ç›¸åçš„ï¼Œé‚£è¿™é‡Œå°±æ²¡æœ‰é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Eigen::Quaterniond <span class="title">q_from</span><span class="params">(imu_in.orientation.w, imu_in.orientation.x, imu_in.orientation.y, imu_in.orientation.z)</span></span>;</span><br><span class="line">    Eigen::Quaterniond q_final = q_from * extQRPY.<span class="built_in">inverse</span>();</span><br><span class="line">    imu_out.orientation.x = q_final.<span class="built_in">x</span>();</span><br><span class="line">    imu_out.orientation.y = q_final.<span class="built_in">y</span>();</span><br><span class="line">    imu_out.orientation.z = q_final.<span class="built_in">z</span>();</span><br><span class="line">    imu_out.orientation.w = q_final.<span class="built_in">w</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sqrt</span>(q_final.<span class="built_in">x</span>()*q_final.<span class="built_in">x</span>() + q_final.<span class="built_in">y</span>()*q_final.<span class="built_in">y</span>() + q_final.<span class="built_in">z</span>()*q_final.<span class="built_in">z</span>() + q_final.<span class="built_in">w</span>()*q_final.<span class="built_in">w</span>()) &lt; <span class="number">0.1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Invalid quaternion, please use a 9-axis IMU!&quot;</span>);</span><br><span class="line">        rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> imu_out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="qosquality-of-service">QoS:Quality of Service</h2>
<p>å…³äºROS2ä¸­<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html">QoS</a>çš„åŸºæœ¬ä»‹ç»ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html">QoS</a>çš„è®¾ç½®ä¸­ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°æ˜¯æœ€é‡è¦çš„ã€‚ä¸€ä¸ªæ˜¯<code>depth</code>ï¼Œä¸€ä¸ªæ˜¯<code>RELIABILITY</code>ã€‚<code>depth</code>å¯ä»¥ç®€è¦ç†è§£æˆä¸­é—´ä»¶DDSä¸ºè¿™ä¸ªæ¶ˆæ¯é¢„ç•™çš„ç¼“å­˜é˜Ÿåˆ—é•¿åº¦ã€‚ <code>RELIABILITY</code>ä¸»è¦æœ‰ä¸¤ç§é€‰é¡¹<code>best_effort</code>å’Œ<code>reliable</code>ï¼Œå®ƒä»¬çš„å…³ç³»ç±»ä¼¼<code>TCP</code>,<code>UDP</code>ã€‚<code>best_effort</code>ä¸èƒ½ä¿è¯æ¯ä¸€ä¸ªæ¶ˆæ¯åˆ°åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œä½†å¯ä»¥ä¿æŒæœ€å¥½çš„å®æ—¶ä¿¡ã€‚<code>reliable</code>ä¿è¯æ¯ä¸€å¸§æ¶ˆæ¯ éƒ½åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œä½†æ˜¯æ— æ³•ä¿è¯å®æ—¶æ€§ã€‚ROS2ä¸­ä¸“é—¨ä¸ºä¼ æ„Ÿå™¨é¢„è®¾äº†ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://docs.ros2.org/foxy/api/rclcpp/classrclcpp_1_1SensorDataQoS.html">SensorDataQoS</a>ï¼Œé‡Œé¢é‡‡ç”¨çš„å°±æ˜¯<code>best_effort</code> çš„è®¾ç½®ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>è®¾ç½®äº†ä¸‰ç§<code>QoS</code>ï¼Œåˆ†åˆ«ä¸ºï¼šåŸå§‹IMUæ•°æ®ã€åŸå§‹é›·è¾¾æ•°æ®ã€æ¡†æ¶å†…éƒ¨ä¼ è¾“</p>
<ol type="1">
<li>åŸå§‹IMUæ•°æ®QoS</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief åŸå§‹IMUæ•°æ®çš„QOSï¼Œå› ä¸ºIMUæ•°æ®è¾ƒå°ï¼Œæ‰€ä»¥depthå¯ä»¥è®¾æˆè¾ƒå¤§</span></span><br><span class="line"><span class="type">rmw_qos_profile_t</span> qos_profile_imu&#123;</span><br><span class="line">  RMW_QOS_POLICY_HISTORY_KEEP_LAST,</span><br><span class="line">  <span class="number">2000</span>,</span><br><span class="line">  RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT,</span><br><span class="line">  RMW_QOS_POLICY_DURABILITY_VOLATILE,</span><br><span class="line">  RMW_QOS_DEADLINE_DEFAULT,</span><br><span class="line">  RMW_QOS_LIFESPAN_DEFAULT,</span><br><span class="line">  RMW_QOS_POLICY_LIVELINESS_SYSTEM_DEFAULT,</span><br><span class="line">  RMW_QOS_LIVELINESS_LEASE_DURATION_DEFAULT,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> qos_imu = rclcpp::<span class="built_in">QoS</span>(</span><br><span class="line">    rclcpp::<span class="built_in">QoSInitialization</span>(</span><br><span class="line">      qos_profile_imu.history,</span><br><span class="line">      qos_profile_imu.depth</span><br><span class="line">    ),</span><br><span class="line">    qos_profile_imu);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>åŸå§‹é›·è¾¾æ•°æ®QoS</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief åŸå§‹é›·è¾¾æ•°æ®topicçš„QOSï¼Œä¸»è¦æ˜¯best_effortå’Œdepthèµ·ä½œç”¨</span></span><br><span class="line"><span class="type">rmw_qos_profile_t</span> qos_profile_lidar&#123;</span><br><span class="line">  RMW_QOS_POLICY_HISTORY_KEEP_LAST,</span><br><span class="line">  <span class="number">5</span>,</span><br><span class="line">  RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT,</span><br><span class="line">  RMW_QOS_POLICY_DURABILITY_VOLATILE,</span><br><span class="line">  RMW_QOS_DEADLINE_DEFAULT,</span><br><span class="line">  RMW_QOS_LIFESPAN_DEFAULT,</span><br><span class="line">  RMW_QOS_POLICY_LIVELINESS_SYSTEM_DEFAULT,</span><br><span class="line">  RMW_QOS_LIVELINESS_LEASE_DURATION_DEFAULT,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> qos_lidar = rclcpp::<span class="built_in">QoS</span>(</span><br><span class="line">    rclcpp::<span class="built_in">QoSInitialization</span>(</span><br><span class="line">      qos_profile_lidar.history,</span><br><span class="line">      qos_profile_lidar.depth</span><br><span class="line">    ),</span><br><span class="line">    qos_profile_lidar);</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>ç®—æ³•æ¡†æ¶å†…éƒ¨ä¼ è¾“QoS</li>
</ol>
<p>ç®—æ³•æ¡†æ¶å†…éƒ¨è¦æ±‚æœ‰æœ€é«˜çš„å®æ—¶æ€§ï¼Œå¹¶ä¸”ç”±äºä¼ è¾“ä¸­æœ‰å¾ˆå¤šç‚¹äº‘ç±»å‹çš„æ•°æ®ï¼ˆè¾ƒå¤§ï¼‰ï¼Œå› æ­¤ä½œè€…æŠŠ<code>depth</code>è®¾ç½®ä¸º1 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief ç®—æ³•æ¡†æ¶ä¸­é»˜è®¤çš„QOSï¼Œä¸»è¦æ˜¯depth=1å’Œreliability=best_effortèµ·ä½œç”¨ã€‚å¯¹äºä¼ è¾“å®æ—¶æ€§æœ‰è¦æ±‚ï¼Œä¸è¦æ±‚æ¯ä¸ªæ•°æ®å¯æ¥æ”¶çš„æ¶ˆæ¯ï¼Œä¸€èˆ¬</span></span><br><span class="line"><span class="comment">/// è®¾æˆbest_effortã€‚åœ¨ROS2ä¸­å¯¹äºä¼ æ„Ÿå™¨æ•°æ®ï¼Œæœ‰ä¸€ä¸ªå†…ç½®çš„QOSå«rclcpp::SensorDataQoS()</span></span><br><span class="line"><span class="type">rmw_qos_profile_t</span> qos_profile&#123;</span><br><span class="line">  RMW_QOS_POLICY_HISTORY_KEEP_LAST,</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT,</span><br><span class="line">  RMW_QOS_POLICY_DURABILITY_VOLATILE,</span><br><span class="line">  RMW_QOS_DEADLINE_DEFAULT,</span><br><span class="line">  RMW_QOS_LIFESPAN_DEFAULT,</span><br><span class="line">  RMW_QOS_POLICY_LIVELINESS_SYSTEM_DEFAULT,</span><br><span class="line">  RMW_QOS_LIVELINESS_LEASE_DURATION_DEFAULT,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> qos = rclcpp::<span class="built_in">QoS</span>(</span><br><span class="line">    rclcpp::<span class="built_in">QoSInitialization</span>(</span><br><span class="line">      qos_profile.history,</span><br><span class="line">      qos_profile.depth</span><br><span class="line">    ),</span><br><span class="line">    qos_profile);</span><br></pre></td></tr></table></figure></p>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-16 19:38:59" itemprop="dateCreated datePublished" datetime="2023-03-16T19:38:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-19 22:37:19" itemprop="dateModified" datetime="2023-04-19T22:37:19+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†" href="/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::152660a48ad07f280a45860dc663a523" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="æ€»ä½“æµç¨‹">æ€»ä½“æµç¨‹</h2>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå¹²è´§ã€‚ä¸‹å›¾æ˜¯æ•´ç†å‡ºæ¥çš„<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ•´ä½“è¿è¡Œæµç¨‹</p>
<figure>
<img src="./imgs/Design-Pipelines.png" alt="" /><figcaption>Simple-LIO-SAMæ•´ä½“è¿è¡Œæµç¨‹å›¾</figcaption>
</figure>
<h2 id="æ•´ä½“è®¤è¯†">æ•´ä½“è®¤è¯†</h2>
<p>æ‰€è°“çš„ç´§è€¦åˆï¼Œç¬”è€…æ˜¯è¿™ä¹ˆç†è§£çš„ï¼šIMUæœ¬èº«å°±å¯ä»¥ç§¯åˆ†å‡ºæ¥ä¸€ä¸ªä½å§¿ï¼Œè¿ç»­å¸§çš„ç‚¹äº‘åŒ¹é…ä¹Ÿå¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªä½å§¿ï¼Œå¦‚æœä¸¤è€…åˆ†åˆ«è¿›è¡Œï¼Œç„¶åå†åšä¸€ä¸ªåŠ æƒèåˆï¼Œé‚£ä¹ˆå°±å±äºæ¾è€¦åˆã€‚è€Œä»ä¸Šé¢çš„æ¡†æ¶å›¾ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>çš„èåˆæ¡†æ¶æ•´ä½“å‘ˆç°ä¸€ä¸ª<code>åœˆ</code>ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½ä¸ºä¸‹ä¸€ä¸ªç¯èŠ‚æä¾›ä¿¡æ¯ï¼Œæœ€åä¸€ä¸ªç¯èŠ‚åˆä¸ºç¬¬ä¸€ä¸ªç¯èŠ‚æä¾›ä¿¡æ¯ã€‚åŒæ—¶ï¼Œè€¦åˆä¹‹å¤„è¿˜åœ¨äºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol type="1">
<li>é«˜é¢‘çš„IMUä¿¡æ¯å¯¹æ¿€å…‰é›·è¾¾ç‚¹äº‘åšäº†ç•¸å˜çŸ«æ­£ï¼Œåšäº†ç•¸å˜çŸ«æ­£åçš„ç‚¹äº‘è¢«ç”¨æ¥åšåŒ¹é…è®¡ç®—æ¿€å…‰é‡Œç¨‹è®¡</li>
<li>IMUçš„ç§¯åˆ†ç»“æœè¢«ç”¨æ¥å½“ä½œè¯¥å¸§ç‚¹äº‘çš„åˆå€¼ï¼Œä¸ºç‚¹äº‘åŒ¹é…æä¾›äº†è¾ƒå¥½çš„åˆå§‹ä¼°è®¡</li>
<li>é›·è¾¾é‡Œç¨‹è®¡çš„ç»“æœè¢«ç”¨æ¥è®¡ç®—IMUçš„åå·®ï¼ŒåŒæ—¶ä¹Ÿè¢«ç”¨æ¥æŒç»­çº æ­£IMUé‡Œç¨‹è®¡</li>
</ol>
<p>è™½ç„¶<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ¡†æ¶ä¸­è¿˜å¯ä»¥èåˆ<code>GPS</code>ä¿¡æ¯ï¼Œä½†æ˜¯ä¸»è¦è¿˜æ˜¯å¯¹é›·è¾¾ç‚¹äº‘å’ŒIMUä¿¡æ¯åšèåˆï¼Œå› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºè¾“å…¥æ˜¯ç‚¹äº‘å’ŒIMUæ•°æ®ï¼Œè¾“å‡ºæ˜¯å°è½¦å½“å‰æ—¶åˆ»çš„ä½å§¿ï¼Œä»¥åŠå¯¹å†å²æ—¶åˆ»ä½å§¿çš„å¹³æ»‘ã€‚</p>
<ul>
<li><p>æ¡†æ¶çš„å…¥å£æ˜¯ç‚¹äº‘å»ç•¸å˜æ¨¡å—ï¼Œä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å¯¹æ¿€å…‰é›·è¾¾è¿åŠ¨ç•¸å˜åšçŸ«æ­£ï¼Œç„¶åè¾“å‡ºå»å®Œç•¸å˜çš„ç‚¹äº‘ã€‚</p></li>
<li><p>å»å®Œç•¸å˜çš„ç‚¹äº‘ç»è¿‡ç‰¹å¾æå–æ¨¡å—ï¼Œæå–å‡ºè§’ç‰¹å¾ç‚¹å’Œå¹³é¢ç‰¹å¾ç‚¹ï¼Œè¢«å›¾ä¼˜åŒ–æ¨¡å—ä¸­çš„ç‚¹äº‘åŒ¹é…éƒ¨åˆ†ç”¨æ¥åšç‚¹äº‘åŒ¹é…ã€‚</p></li>
<li><p>å›¾ä¼˜åŒ–æ¨¡å—åˆ©ç”¨å»å®Œç•¸å˜åçš„ç‚¹äº‘ä¸å†å²å¸§æ„å»ºçš„å±€éƒ¨åœ°å›¾åšåŒ¹é…ï¼Œå¾—å‡ºè¾ƒå‡†ç¡®çš„é‡Œç¨‹è®¡ç»“æœã€‚åŒæ—¶åˆ©ç”¨å›¾ä¼˜åŒ–ï¼ŒåŠ å…¥å›ç¯æ£€æµ‹å› å­ï¼Œä½¿å¾—æ•´ä½“ä¼°è®¡æ›´ä¸ºå‡†ç¡®é¡ºæ»‘</p></li>
<li><p>IMUé¢„ç§¯åˆ†æ¨¡å—ä»IMUå’Œå›¾ä¼˜åŒ–æ¨¡å—æ¥æ”¶æ•°æ®ï¼Œå¯¹IMUçš„åŸå§‹æ•°æ®åšç§¯åˆ†ï¼Œå¾—å‡ºæ¯ä¸€å¸§ç‚¹äº‘çš„åˆå§‹ä½å§¿ï¼Œæä¾›ç»™å›¾ä¼˜åŒ–æ¨¡å—ä½œä¸ºä¼˜åŒ–åˆå§‹å€¼ã€‚åŒæ—¶åˆä»å›¾ä¼˜åŒ–æ¨¡å—æ‹¿å‡ºç»è¿‡ç‚¹äº‘ã€å›¾ä¼˜åŒ–æ ¡æ­£åçš„é‡Œç¨‹è®¡ç»“æœæ ¡æ­£æœ¬èº«çš„ç»“æœ</p></li>
<li><p>åæ ‡ç³»å‘å¸ƒä¸»è¦æ˜¯ä¸ºäº†<code>RIVZ</code>æ˜¾ç¤ºä¸­ç”¨çš„ï¼Œä¸»è¦å°±æ˜¯å°†å„ç§é‡Œç¨‹è®¡ç»“æœè½¬æ¢æˆ<code>TF</code>åæ ‡å…³ç³»å‘å¸ƒå‡ºå»ã€‚åœ¨åŸå§‹<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­æ˜¯ä¸<code>imuPreintegration</code>æ”¾ç½®åœ¨åŒä¸€ä¸ªæ–‡ä»¶</p></li>
</ul>
<h2 id="è¿åŠ¨ç•¸å˜çŸ«æ­£">è¿åŠ¨ç•¸å˜çŸ«æ­£</h2>
<p>å¯¹åº”åšæ–‡ï¼š<a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></p>
<ul>
<li>ä¸ºä»€ä¹ˆæ¿€å…‰é›·è¾¾æœ‰è¿åŠ¨ç•¸å˜ï¼Ÿ</li>
</ul>
<p>æ¿€å…‰é›·è¾¾é€šè¿‡å‘å°„é«˜èƒ½é‡æ¿€å…‰çº¿æŸï¼Œè®¡ç®—æ¿€å…‰çº¿æŸå¾€è¿”æ—¶é—´ï¼Œå¾—åˆ°è¯¥æ¿€å…‰çº¿æ‰“åˆ°çš„ç‰©ä½“çš„è·ç¦»ã€‚ä»¥æœºæ¢°å¼æ¿€å…‰é›·è¾¾ä¸ºä¾‹ï¼Œé›·è¾¾åœ¨ç»Ÿä¸€æ—¶åˆ»å¯ä»¥å‘é€å¤šæ¡æ¿€å…‰çº¿ï¼ˆ32ã€64ã€128ï¼‰ï¼Œè¿™å¤šæ¡æ¿€å…‰çº¿åœ¨å‚ç›´æ–¹å‘ä¸Šå¯ä»¥æ‰«åˆ°ä¸‰ç»´ç©ºé—´ä¸­å‚ç›´çš„ä¸€æ¡çº¿ï¼Œæ¿€å…‰é›·è¾¾é€šè¿‡ç¯ç»•ä¸€å‘¨çš„æ–¹å¼å¯ä»¥å¯¹360çš„ç©ºé—´åšä¸‰ç»´æˆåƒ</p>
<figure>
<img src="./imgs/lidar.webp" alt="" /><figcaption>æ¿€å…‰é›·è¾¾æˆåƒåŸç†å›¾</figcaption>
</figure>
<p>ç”±äºæ¿€å…‰é›·è¾¾æ˜¯é€šè¿‡æ¿€å…‰çº¿æŸç¯ç»•ä¸€å‘¨çš„æ–¹å¼æˆåƒä¸€å¸§çš„ç‚¹äº‘ï¼Œé‚£ä¹ˆè¿™ä¸€å¸§ç‚¹äº‘çš„ç‚¹å°±æ˜¯åœ¨ä¸åŒçš„æ—¶é—´æ¢æµ‹çš„ã€‚å¦‚æœæ¿€å…‰çº¿æŸåœ¨ç¯ç»•ä¸€å‘¨çš„è¿‡ç¨‹ä¸­ï¼Œæ¿€å…‰é›·è¾¾æ˜¯åœ¨è¿åŠ¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸€å¸§ç‚¹äº‘å°±ç”±äºæ¿€å…‰é›·è¾¾çš„è¿åŠ¨è€Œå˜å¾—ä¸å‡†ç¡®ï¼Œå› æ­¤éœ€è¦å¯¹å…¶åšè¿åŠ¨ç•¸å˜æ ¡æ­£ã€‚</p>
<figure>
<img src="./imgs/livox_lidar_distortion.png" alt="" /><figcaption>livox_lidar_distortion_removal</figcaption>
</figure>
<p>ï¼ˆä¸Šé¢è¿™å¹…å›¾ç‰‡å¼•ç”¨è‡ªlivoxå®˜ç½‘[Liovox_distortion_removal]ï¼‰</p>
<p>æ¿€å…‰é›·è¾¾è¾“å‡ºçš„æ¯ä¸€å¸§ç‚¹äº‘<span class="math inline">\(P\)</span>ï¼Œé‡Œé¢çš„æ¯ä¸€ä¸ªç‚¹<span class="math inline">\(p_i\)</span>ï¼Œéƒ½æœ‰ä¸€ä¸ªå±æ€§<span class="math inline">\(t_i\)</span>ï¼Œè®°å½•äº†è¯¥ç‚¹è·ç¦»è¯¥å¸§ç‚¹äº‘èµ·å§‹æ—¶åˆ»çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢ä»£ç æ®µé‡Œçš„<code>time</code>å­—æ®µã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imageProjection.cpp 49-60</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VelodynePointXYZIRT</span></span><br><span class="line">&#123;</span><br><span class="line">    PCL_ADD_POINT4D</span><br><span class="line">    PCL_ADD_INTENSITY;</span><br><span class="line">    <span class="type">uint16_t</span> ring;</span><br><span class="line">    <span class="type">float</span> time;</span><br><span class="line">    EIGEN_MAKE_ALIGNED_OPERATOR_NEW</span><br><span class="line">&#125; EIGEN_ALIGN16;</span><br><span class="line"><span class="built_in">POINT_CLOUD_REGISTER_POINT_STRUCT</span> (VelodynePointXYZIRT,</span><br><span class="line">    (<span class="type">float</span>, x, x) (<span class="type">float</span>, y, y) (<span class="type">float</span>, z, z) (<span class="type">float</span>, intensity, intensity)</span><br><span class="line">    (<span class="type">uint16_t</span>, ring, ring) (<span class="type">float</span>, time, time)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç”±äºIMUæ˜¯éå¸¸é«˜é¢‘çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºè¯¥å¸§ç‚¹äº‘æˆåƒæ—¶é—´æ®µå†…çš„æ¿€å…‰é›·è¾¾ä½ç§»å’Œæ—‹è½¬çš„å˜æ¢ï¼Œç„¶åé€šè¿‡æ¯ä¸€ä¸ªç‚¹çš„æ—¶é—´<span class="math inline">\(t_i\)</span>ï¼Œå¯ä»¥æ ¹æ®æ—¶é—´è¿›è¡Œæ’å€¼å¾—å‡ºæ¯ä¸€ä¸ªç‚¹ç›¸å¯¹äºèµ·å§‹ç‚¹çš„è½¬æ¢å…³ç³»<span class="math inline">\(T_i\)</span>ã€‚ï¼ˆæ³¨ï¼šLIOSAMé‡Œé¢æ˜¯ç›´æ¥é€šè¿‡æ—¶é—´æˆ³æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯è¿›è¡Œæ’å€¼ï¼‰ã€‚ä»è€Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ¯ä¸ªç‚¹éƒ½è½¬æ¢åˆ°èµ·å§‹ç‚¹çš„åæ ‡ç³» <span class="math display">\[
p_i^0 = T_ip_i
\]</span></p>
<h2 id="ç‚¹äº‘ç‰¹å¾æå–">ç‚¹äº‘ç‰¹å¾æå–</h2>
<p>å¯¹åº”åšæ–‡ï¼š<a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></p>
<p>æ¿€å…‰é‡Œç¨‹è®¡ä¸­ä¸€èˆ¬ä¼šæ¶‰åŠåˆ°ç‚¹äº‘åŒ¹é…ï¼Œå¦‚æœç”¨åŸå§‹ç‚¹äº‘è¿›è¡ŒåŒ¹é…ç”±äºç‚¹æ•°è¿‡å¤šçš„å…³ç³»ï¼Œä¼šå¯¼è‡´è€—æ—¶å¤ªé•¿ï¼Œå› æ­¤<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­ç”¨ç±»ä¼¼<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>çš„æ–¹æ³•è¿›è¡Œ<code>è¾¹ç¼˜ç‚¹</code>,<code>å¹³é¢ç‚¹</code>ä¸¤ç±»ç‰¹å¾ç‚¹çš„æå–ï¼Œåé¢ç‚¹äº‘åŒ¹é…éƒ¨åˆ†ä½¿ç”¨è¿™ä¸¤ç§ç‰¹å¾ç‚¹è¿›è¡Œ<code>é«˜æ–¯-ç‰›é¡¿æ³•</code>æ±‚è§£å‡ºåŒ¹é…å…³ç³»ã€‚</p>
<p>è¿™éƒ¨åˆ†çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œåé¢å…³äºè¿™ä¸ªæ¨¡å—çš„è¯¦ç»†å†…å®¹ä¼šä»‹ç»ï¼Œè¿™é‡Œå”¯ä¸€è¦æ¸…æ¥šçš„æ˜¯ï¼Œè¿™é‡Œçš„ç‚¹äº‘ç‰¹å¾ç‚¹æå–ç”¨çš„æ˜¯æ¯ä¸ªç‚¹çš„æ›²ç‡ï¼Œé€‰æ‹©æ›²ç‡å¤§çš„ç‚¹ä½œä¸ºè¾¹ç¼˜ç‚¹ï¼Œé€‰æ‹©æ›²ç‡å°çš„ç‚¹ä½œä¸ºå¹³é¢ç‚¹ã€‚ä½†æ˜¯æ›²ç‡çš„è®¡ç®—æ˜¯ç”¨æ¯ä¸ªç‚¹å‘¨å›´çš„ç‚¹åˆ°å…¶å¹³å‡è·ç¦»ä½œä¸ºè¿‘ä¼¼ã€‚</p>
<h2 id="imué¢„ç§¯åˆ†æ¨¡å—">IMUé¢„ç§¯åˆ†æ¨¡å—</h2>
<p>å¯¹åº”åšæ–‡ï¼š<a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></p>
<p>è¿™ä¸€ä¸ªæ¨¡å—è™½ç„¶ä»åŸç†å’Œå®ç°ä¸Šæ¥è¯´ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹å¤æ‚ï¼Œä½†æ˜¯ä»åŠŸèƒ½ä¸Šç®€å•æ¥è¯´åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å®æ—¶å¯¹<code>IMUåŸå§‹æ•°æ®</code>åšå¤„ç†ï¼ˆç§¯åˆ†ï¼‰ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªæ—¶åˆ»çš„IMUé‡Œç¨‹è®¡ï¼ˆä¹Ÿæ˜¯6è‡ªç”±åº¦ä½å§¿ï¼‰ï¼Œç„¶åè¯¥ä½å§¿è¢«ç”¨æ¥ä½œä¸ºè¯¥å¸§ç‚¹äº‘çš„åˆå§‹ä¼°è®¡ä½å§¿ï¼Œè¿™ä¸ªåˆå§‹ä¼°è®¡ä½å§¿ä¼šè¢«ç”¨æ¥ä½œä¸ºç‚¹äº‘åŒ¹é…çš„åˆå§‹ä¼°è®¡ã€‚</p>
<h2 id="ç‚¹äº‘åŒ¹é…åŠå›¾ä¼˜åŒ–">ç‚¹äº‘åŒ¹é…åŠå›¾ä¼˜åŒ–</h2>
<p>å¯¹åº”åšæ–‡ï¼š</p>
<p><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></p>
<p><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></p>
<p>è¿™æ˜¯æ•´ä¸ªæ¡†æ¶æœ€å¤æ‚çš„ä¸€ä¸ªæ¨¡å—ï¼ˆä¹Ÿè®¸æ˜¯æ²¡æœ‰å¾ˆå¥½è§£è€¦ï¼Ÿï¼‰ã€‚è¿™ä¸ªæ¨¡å—ä¸»è¦åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š</p>
<ol type="1">
<li>ç‚¹äº‘åŒ¹é…</li>
<li>å›ç¯æ£€æµ‹</li>
<li>å› å­å›¾æ„å»ºåŠä¼˜åŒ–</li>
<li>æ ¹æ®å…³é”®å¸§ä¿¡æ¯æ„å»ºå…¨å±€åœ°å›¾</li>
</ol>
<p>å…·ä½“å†…å®¹ä¼šåœ¨åé¢çš„ç« èŠ‚å±•å¼€ï¼Œè¿™é‡Œåº”è¯¥è¦æœ‰å‡ ä¸ªæ„Ÿæ€§è®¤è¯†ï¼š</p>
<ol type="1">
<li>ä¸€èˆ¬ç‚¹äº‘ç²¾ç»†åŒ¹é…ï¼ˆæ¯”å¦‚ICPç®—æ³•ï¼‰éœ€è¦æœ‰ä¸€ä¸ªè‰¯å¥½çš„åˆå§‹å€¼ï¼Œè¿™é‡Œçš„åˆå§‹å€¼å¯ä»¥ç†è§£æˆé‡‡ç”¨IMUé¢„ç§¯åˆ†æ¨¡å—çš„è¾“å‡ºã€‚</li>
<li>ç‚¹äº‘åŒ¹é…éƒ¨åˆ†ç”¨çš„æ˜¯æ²¿ç”¨è‡ªLOAM-&gt;LeGO-LOAMçš„ç‚¹äº‘åŒ¹é…ç®—æ³•ï¼Œä¸æ˜¯ä½¿ç”¨ICPã€‚<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>ä¹Ÿæ˜¯<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan">TixiaoShan</a>åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¹‹å‰çš„ä¸€ç¯‡ç›¸å…³è®ºæ–‡</li>
<li>å›ç¯æ£€æµ‹æ ¹æ®é‡Œç¨‹è®¡çš„x,y,zæ£€ç´¢ç´§é‚»å¸§ï¼Œç„¶åé€šè¿‡ICPç®—æ³•è®¡ç®—å½“å‰å¸§ä¸è¿‘é‚»å¸§çš„è½¬æ¢å…³ç³»</li>
<li>ç»è¿‡ç‚¹äº‘åŒ¹é…åçš„ä½å§¿ä¼šç»è¿‡å›¾ä¼˜åŒ–å¾—å‡ºæ›´å¹³æ»‘çš„ä½å§¿</li>
<li>åœ°å›¾å’Œå› å­å›¾çš„å› å­å®é™…ä¸Šæ˜¯ä»¥å…³é”®å¸§çš„å½¢æ€å­˜åœ¨åç«¯ä¼˜åŒ–éƒ¨åˆ†ï¼Œå…³é”®å¸§çš„é€‰å–ä¼šæ¯”è¾ƒç¨€ç–ï¼Œæ¯”å¦‚è·ç¦»å°ä¸1ç±³ä¸ä¼šé‡‡ç”¨ä¸ºå…³é”®å¸§ã€‚ä¸é‡‡ç”¨ä¸ºå…³é”®å¸§çš„ç‚¹äº‘ä¼šæ‰§è¡Œå®Œç‚¹äº‘åŒ¹é…åå°±ç›´æ¥è¾“å‡ºä½å§¿ã€‚</li>
<li>åœ¨æœ‰æ–°çš„å›ç¯å› å­åŠ å…¥å› å­å›¾åï¼Œä¼šè¿›è¡Œå¤šæ¬¡å› å­å›¾ä¼˜åŒ–å™¨çš„æ›´æ–°æ­¥éª¤ï¼Œç„¶åå°†æ‰€æœ‰å†å²å…³é”®å¸§çš„ä½å§¿éƒ½æ›´æ–°ä¸€é</li>
<li>è¿™ä¸ªéƒ¨åˆ†è¿˜æ”¯æŒ<code>GPSé‡Œç¨‹è®¡</code>çš„ç›‘å¬ï¼Œå¹¶å°†<code>GPSé‡Œç¨‹è®¡</code>ä¹ŸåŠ å…¥å› å­å›¾è¿›è¡Œä¼˜åŒ–</li>
</ol>
<h2 id="åæ ‡ç³»è§„å®š">åæ ‡ç³»è§„å®š</h2>
<h3 id="åæ ‡ç³»è§„å®š-1">åæ ‡ç³»è§„å®š</h3>
<p>åŸæœ‰çš„<code>urdf</code>æ–‡ä»¶åŠ å…¥äº†å¤ªå¤šé¢å¤–æ²¡å¿…è¦çš„å…³èŠ‚ï¼Œå¯¼è‡´<code>rviz</code>ä¸­<code>tf-tree</code>å…³ç³»å¤ªè¿‡å¤æ‚ã€‚ä¸ºäº†ç®€åŒ–åæ ‡ç³»å…³ç³»ï¼Œä½†åŒæ—¶åˆç»´æŒåæ ‡ç³»å…³ç³»æ ‡å‡†åŒ–å¹¶ä¸”ä¸<code>ROS</code>çš„è§„å®šç›¸åŒï¼ˆ<code>ROS</code>ä¸­å…³äºå§¿æ€ä¼°è®¡çš„åæ ‡ç³»å…³ç³»ä¸»è¦å‚è€ƒï¼š<a target="_blank" rel="noopener" href="http://docs.ros.org/en/melodic/api/robot_localization/html/preparing_sensor_data.html">robot_localization_coordinate_system</a>ï¼Œè¿™é‡Œå¯¹é¡¹ç›®ä¸­çš„åæ ‡ç³»å…³ç³»åšäº†ä¸€äº›ç®€åŒ–ä¿®æ”¹ã€‚ æ ¹æ®robot_localizationåŒ…çš„è§„å®šï¼Œæ‰€æœ‰å§¿æ€éƒ½è¦è½¬åˆ°ä¸–ç•Œåæ ‡ç³»ï¼Œé€šå¸¸æ˜¯<code>map</code>æˆ–è€…<code>odom</code>åæ ‡ç³»ã€‚æ‰€æœ‰çš„twistæ•°æ®ï¼Œéƒ½è¦è½¬åˆ°base_linkåæ ‡ç³»ä¸‹å¤„ç†ã€‚</p>
<h3 id="simple-lio-samåæ ‡ç³»è¯´æ˜">Simple-LIO-SAMåæ ‡ç³»è¯´æ˜</h3>
<ol type="1">
<li>æ ¹æ®REPèµ„æ–™ï¼Œä¸€èˆ¬æœ‰4ä¸ªåæ ‡ç³»<code>earth</code>,<code>map</code>,<code>odom</code>,<code>base_link</code>ã€‚ç”±äºåœ¨SLAMä¸­ä¸€èˆ¬æ²¡æœ‰å¼•å…¥åœ°çƒåæ ‡ç³»ã€‚æ‰€ä»¥åœ¨è¿™é‡Œåªæœ‰åä¸‰ä¸ªåæ ‡ç³»ã€‚ åŒæ—¶ï¼Œå¦‚æœæ˜¯ä»¥èµ·å§‹ç‚¹ä½œä¸ºåœ°å›¾åŸç‚¹ï¼Œ<code>map</code>,<code>odom</code>ä¸¤ä¸ªåæ ‡ç³»æ˜¯é‡åˆçš„å…³ç³»ã€‚</li>
<li>å¦å¤–ï¼Œä¸ºäº†å¯ä»¥åœ¨Rivzæ˜¾ç¤ºåŸå§‹ç‚¹äº‘ä¿¡æ¯ï¼Œåˆ™ä¹ŸåŠ å…¥ä¸€ä¸ªé›·è¾¾åæ ‡ç³»ã€‚</li>
<li>ä¸ºäº†è®©åæ ‡ç³»å®šä¹‰è‡ªæ´½ï¼Œè™½ç„¶åœ¨ç®—æ³•ä¸­æ²¡æœ‰ç›´æ¥ç”¨åˆ°ï¼Œä½†æ˜¯IMUåŠ é€Ÿåº¦é€Ÿåº¦å’Œè§’é€Ÿåº¦åº”è¯¥å®šä¹‰åœ¨IMUåæ ‡ç³»ï¼Œå› æ­¤å¼•å…¥IMUåæ ‡ç³»</li>
<li>ä¸ºäº†è®©å®šä¹‰æ›´ä¸ºæ ‡å‡†ï¼Œè¿™é‡Œä¿ç•™<code>map</code>åæ ‡ç³»ï¼Œè™½ç„¶åœ¨SLAMä¸­<code>map</code>,<code>odom</code>å¤§éƒ¨åˆ†æƒ…å†µæ˜¯é‡å çš„</li>
<li>å› æ­¤ï¼Œæ•´ä¸ªspl_lio_samæ¡†æ¶å¯ä»¥ç®€åŒ–æˆ5ä¸ªåæ ‡ç³»ï¼š<code>map</code>, <code>odom</code>,<code>base_link</code>,<code>lidar_link</code>,<code>imu_link</code>åæ ‡ç³»ã€‚å…¶ä¸­ï¼Œ <code>map</code>æ˜¯åœ°å›¾åŸç‚¹ï¼Œåœ¨å»ºå›¾æ—¶æ˜¯èµ·å§‹ç‚¹ï¼Œåœ¨é‡å®šä½æ¨¡å¼æ—¶ï¼Œæ˜¯åœ°å›¾åŸç‚¹ã€‚<code>odom</code>æ˜¯é‡Œç¨‹è®¡åæ ‡ç³»ï¼›<code>base_link</code>æ˜¯è½¦è¾†è‡ªèº«åæ ‡ç³»ã€‚<code>lidar_link</code>åæ ‡ç³»æ˜¯é›·è¾¾åæ ‡ç³»ï¼Œ åœ¨lio_samä¸­æ˜¯ä¸<code>base_link</code>åæ ‡ç³»å¯¹é½çš„ï¼Œä½†æ˜¯<code>lidar_link</code>å­—æ®µä¼šæ ¹æ®é›·è¾¾å‹å·ä¸åŒï¼Œè¢«ä¿®æ”¹ã€‚<code>imu_link</code>åæ ‡ç³»æ˜¯IMUåæ ‡ç³»ï¼Œé…ç½®æ–‡ä»¶ä¸­ æœ‰æŒ‡æ˜IMUåæ ‡ç³»åˆ°Lidaråæ ‡ç³»çš„è½¬æ¢å…³ç³»ã€‚</li>
</ol>
<h3 id="åæ ‡ç³»å…³ç³»çš„å…¶ä»–è¯´æ˜">åæ ‡ç³»å…³ç³»çš„å…¶ä»–è¯´æ˜</h3>
<ol type="1">
<li>ROSçš„Message Headeråªæœ‰ä¸€ä¸ªframe_idå­—æ®µï¼Œè¡¨æ˜è¿™ä¸ªæ•°æ®æ˜¯åœ¨å“ªä¸ªåæ ‡ç³»ä¸‹çš„ã€‚</li>
<li>nav_msgs/Odometryä¸­è¿˜æœ‰ä¸€ä¸ªchild_frame_idå­—æ®µï¼Œnav_msgs/Odometryä¸­çš„twistæ•°æ®åº”è¯¥æ˜¯åœ¨child_frame_idåæ ‡ç³»ä¸‹çš„æ•°æ® &gt; The twist in this message should be specified in the coordinate frame given by the child_frame_id</li>
</ol>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">è®°ä¸€æ¬¡è§£å†³rosbag2å†…å­˜é”™è¯¯é—®é¢˜è¿‡ç¨‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-15 18:28:01" itemprop="dateCreated datePublished" datetime="2023-03-15T18:28:01+08:00">2023-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-05-14 16:36:35" itemprop="dateModified" datetime="2023-05-14T16:36:35+08:00">2023-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
        </span>
    </span>

  
    <span id="/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="è®°ä¸€æ¬¡è§£å†³rosbag2å†…å­˜é”™è¯¯é—®é¢˜è¿‡ç¨‹" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="è®°ä¸€æ¬¡è§£å†³rosbag2å†…å­˜é”™è¯¯é—®é¢˜è¿‡ç¨‹" href="/2023/03/15/ros/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%A7%A3%E5%86%B3rosbag2%E5%86%85%E5%AD%98%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%BF%87%E7%A8%8B/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::73e4783c1a71c1ae17cdb35318885253" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/kai-shi-dong-liao-ge">Zeal's çŸ¥ä¹ä¸“æ </a></li>
</ul>
<h2 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h2>
<p>ç”±äºå·¥ä½œéœ€è¦ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªç¨‹åºï¼Œæ ¹æ®è®°å½•çš„ä¿¡æ¯ï¼Œä»<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>ä¿å­˜çš„æ•°æ®åŒ…æ ¹æ®æ‰“ç‚¹çš„æ—¶é—´æˆ³ï¼Œæå–å‡ºä¸€æ®µæ®µå•ç‹¬çš„æ•°æ®åŒ…ã€‚ ä¸ºäº†å­˜å‚¨ç©ºé—´è€ƒè™‘ï¼Œä¿å­˜æ—¶ä»¥åŠæå–æ—¶éƒ½æŒ‡å®šäº†ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble#recording-with-compression">å‹ç¼©çš„æ–¹å¼</a>è¿›è¡Œå­˜å‚¨ã€‚å‹ç¼©å™¨å’Œå‹ç¼©æ¨¡å¼å¦‚ä¸‹ï¼š <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line"><span class="attr">compression_mode:</span> <span class="string">message</span></span><br></pre></td></tr></table></figure></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>ä¸ä»…æœ‰å‘½ä»¤è¡Œå·¥å…·ï¼ŒåŒæ—¶è¿˜å¼€æ”¾APIç»™å¼€å‘è€…ä½¿ç”¨ã€‚<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>è¿˜æä¾›äº†<code>convert</code>åŠŸèƒ½ï¼Œå¯ä»¥å¯¹å½•ä¸‹æ¥çš„bagfileè¿›è¡Œ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble#converting-bags">äºŒæ¬¡æå–</a>ã€‚å› æ­¤å¼€å‘è¿™éƒ¨åˆ†åŠŸèƒ½å¯ä»¥å‚è€ƒæºç é‡Œé¢çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/humble/rosbag2_transport/src/rosbag2_transport/bag_rewrite.cpp">bag_rewriter.cpp</a></p>
<h2 id="å¼€å‘ç¯å¢ƒ">å¼€å‘ç¯å¢ƒ</h2>
<blockquote>
<p>ROS: ROS2-humble</p>
</blockquote>
<blockquote>
<p>OS: ubuntu 22.04</p>
</blockquote>
<blockquote>
<p>language: cpp17</p>
</blockquote>
<blockquote>
<p>rosbag2: 0.15.4-2jammy.20230118.031755</p>
</blockquote>
<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>å®Œæˆä¸Šè¿°æ•°æ®æå–åŠŸèƒ½åè¿›è¡Œæµ‹è¯•ï¼Œå‘ç°æå–çš„æ—¶å€™å¦‚æœåŒæ—¶æå–å¤šä¸ªç›®æ ‡ï¼ˆæ„å»ºå¤šä¸ªwriterï¼Œè¯»å–messageåè¿›è¡Œå†™æ“ä½œï¼Œ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_transport/src/rosbag2_transport/bag_rewrite.cpp#L135">rosbag2æºç å‚è€ƒéƒ¨åˆ†</a>ï¼Œå¹¶ä¸”éƒ½è¿›è¡Œå‹ç¼©çš„æ—¶å€™ï¼Œä¼šæœ‰<code>core dump</code>ï¼Œé”™è¯¯ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corrupted size vs. prev_size</span><br><span class="line">[ros2run]: Aborted</span><br></pre></td></tr></table></figure></p>
<p>ç„¶è€Œåœ¨å…¶ä»–æƒ…å†µï¼š1.åŒæ—¶æå–å¤šä¸ªç›®æ ‡ï¼Œä½†æ˜¯ä¸è¿›è¡Œå‹ç¼©ï¼›2.æå–ä¸€ä¸ªç›®æ ‡ï¼Œè¿›è¡Œå‹ç¼©ï¼›çš„æ—¶å€™ï¼Œç¨‹åºéƒ½å¯ä»¥æ­£å¸¸è¿è¡Œ</p>
<p>ä¸ºäº†ç¡®ä¿ä¸æ˜¯è‡ªå·±ç¼–å†™çš„ç¨‹åºå¯¼è‡´çš„é—®é¢˜ï¼Œåˆä½¿ç”¨<code>rosbag2 cli</code>è¿›è¡Œç±»ä¼¼çš„å°è¯•ã€‚æ ¹æ®<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble#converting-bags">converting-bags</a>çš„è¯´æ˜ï¼Œæˆ‘ä½¿ç”¨ä¸‹é¢çš„<code>output_options.yaml</code>è¿›è¡Œæ•°æ®è½¬æ¢ï¼š <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output_bags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag01</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag02</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br></pre></td></tr></table></figure></p>
<p>ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæå– <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag convert -i ./path/to/bag/file -o output_options.yaml</span><br></pre></td></tr></table></figure></p>
<p>æœä¸å…¶ç„¶ï¼Œç›´æ¥ä½¿ç”¨<code>rosbag2</code>çš„åŒ…ä¹Ÿä¼šæœ‰<code>core</code>é—®é¢˜ï¼Œä¸è¿‡æŠ¥çš„ä¿¡æ¯ä¼šæœ‰åŒºåˆ«ï¼Œä¸åŒæ¬¡è¿è¡ŒæŠ¥çš„ä¿¡æ¯è¿˜ä¸ä¸€æ ·ï¼Œä¸»è¦æ˜¯ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">malloc(): unsorted double linked list corrupted</span><br><span class="line">free(): corrupted unsorted chunks</span><br><span class="line">corrupted double-linked list</span><br></pre></td></tr></table></figure></p>
<h2 id="é—®é¢˜å¤ç°">é—®é¢˜å¤ç°</h2>
<p>ç®€å•èµ·è§å¯ä»¥ç›´æ¥ä½¿ç”¨<code>rosbag2 cli</code>å¤ç°è¿™ä¸ªé—®é¢˜ 1. å‡†å¤‡ä¸€ä¸ªros2çš„bagåŒ… 2. æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶å‘½åä¸ºï¼š<code>output_options.yaml</code>ï¼Œå¹¶å¡«å…¥ä¸‹é¢å†…å®¹ï¼š <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output_bags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag01</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uri:</span> <span class="string">out_bag02</span></span><br><span class="line">  <span class="attr">all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">compression_format:</span> <span class="string">zstd</span></span><br><span class="line">  <span class="attr">compression_mode:</span> <span class="string">message</span></span><br></pre></td></tr></table></figure> 3. æ‰§è¡Œæ•°æ®è½¬æ¢å‘½ä»¤ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /opt/ros/humble/setup.bash</span><br><span class="line">ros2 bag convert -i ./path/to/bag/file -o output_options.yaml</span><br></pre></td></tr></table></figure></p>
<h2 id="é—®é¢˜å®šä½">é—®é¢˜å®šä½</h2>
<h3 id="å¢åŠ æ—¥å¿—">å¢åŠ æ—¥å¿—</h3>
<p>ç”±äºå·²ç»ç¡®è®¤ä¸æ˜¯è‡ªå·±å†™çš„ç¨‹åºçš„é—®é¢˜ï¼Œæ‰€ä»¥å…¶å®å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥</p>
<h3 id="gdbæ£€æŸ¥">gdbæ£€æŸ¥</h3>
<p>cppç¨‹åºæ’æŸ¥è¿˜æ˜¯éœ€è¦ä¸Šgdbï¼Œä¸è¦è‡ªå·±çæŠ˜è…¾çæ”¹ä»£ç ã€‚<a href="#appendA">æ–‡æœ«è®°å½•</a>å¦‚ä½•åœ¨<code>ubuntu</code>ä¸Šç”Ÿæˆ<code>coreæ–‡ä»¶</code>ã€‚ è¿è¡Œä¸€æ¬¡ç¨‹åºï¼Œç”Ÿæˆ<code>coreæ–‡ä»¶</code>åä½¿ç”¨gdbæ£€æŸ¥é”™è¯¯å †æ ˆ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdb ros_ws/install/package/lib/package/excutable /path/to/corefile</span><br><span class="line"></span><br><span class="line">bt  <span class="comment"># gdbå‘½ä»¤ï¼Œæ‰“å°é”™è¯¯å †æ ˆ</span></span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯</p>
<figure>
<img src="./imgs/backtraces.png" alt="" /><figcaption>backtraces</figcaption>
</figure>
<p>è™½ç„¶æ˜¯åœ¨å­çº¿ç¨‹ä¸­å‡ºé”™ï¼Œä½†æ˜¯å¤§æ¦‚ä¹Ÿèƒ½çœ‹åˆ°æ˜¯åœ¨<code>rosbag2_compression::SequentialCompressonWriter::compression_thread_fn()</code>å‡½æ•°ä¸­å‡ºé”™ã€‚ è¿™ä¹Ÿç¬¦åˆäº†ç°è±¡ï¼Œåªåœ¨è¿›è¡Œå‹ç¼©çš„æ—¶å€™ä¼šå‡ºé”™ã€‚</p>
<p>åŒæ—¶ï¼Œä»é”™è¯¯å †æ ˆé‡Œå¯ä»¥çœ‹å‡ºåº”è¯¥æ˜¯<code>rosbag2_compression_zstd::ZstdCompressor</code>åœ¨è¿›è¡Œå‹ç¼©å¤„ç†çš„æ—¶å€™è°ƒç”¨<code>rcutils_uint8_array_resize</code>å‡½æ•°å‡ºé”™ã€‚</p>
<h3 id="å¯¹æ¯”ä¸åŒçš„writer">å¯¹æ¯”ä¸åŒçš„writer</h3>
<p>ç”±äºåœ¨è¿›è¡Œå¤šä¸ª<code>writers</code>å†™æ•°æ®ï¼Œä½†æ˜¯ä¸æ‰§è¡Œå‹ç¼©çš„æ—¶å€™å¹¶æ²¡æœ‰ç›¸å…³é—®é¢˜å‘ç”Ÿï¼Œæ‰€ä»¥å¯ä»¥å¯¹æ¯”ä¸€ä¸‹æ™®é€šçš„<code>writer</code>å’Œ<code>SequentialCompressonWriter</code>åœ¨å†™å‡½æ•°ä¸­çš„åŒºåˆ«</p>
<h4 id="æ™®é€šçš„writerå³rosbag2_cppsequentialwriter">æ™®é€šçš„writerï¼Œå³rosbag2_cpp::SequentialWriter</h4>
<p>æ™®é€šçš„<code>writer</code>ï¼Œå³<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/humble/rosbag2_cpp/src/rosbag2_cpp/writers/sequential_writer.cpp">rosbag2_cpp::SequentialWriter</a>ä¸­ï¼Œ<code>void SequentialWriter::write(std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; message)</code>å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_cpp/src/rosbag2_cpp/writers/sequential_writer.cpp#L328-L337">æ ¸å¿ƒä»£ç </a>æ˜¯è¿™å‡ è¡Œ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (storage_options_.max_cache_size == <span class="number">0u</span>) &#123;</span><br><span class="line"><span class="comment">// If cache size is set to zero, we write to storage directly</span></span><br><span class="line">storage_-&gt;<span class="built_in">write</span>(converted_msg);</span><br><span class="line">++topic_information-&gt;message_count;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// Otherwise, use cache buffer</span></span><br><span class="line">message_cache_-&gt;<span class="built_in">push</span>(converted_msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”±äº<code>bag_rewrite</code>åœ¨è°ƒç”¨<code>writer</code>çš„æ—¶å€™ï¼Œ<code>max_cache_size</code>å§‹ç»ˆ<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_transport/src/rosbag2_transport/bag_rewrite.cpp#L191">è®¾ç½®ä¸º0</a>ï¼Œå› æ­¤æ‰§è¡Œçš„æ˜¯<code>if</code>åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è°ƒç”¨åº•å±‚çš„æ•°æ®åº“å°è£…ç±»ç›´æ¥å†™å…¥ç¡¬ç›˜ã€‚</p>
<h4 id="å¸¦å‹ç¼©çš„writerå³rosbag2_compressionsequentialcompressionwriter">å¸¦å‹ç¼©çš„writerå³rosbag2_compression::SequentialCompressionWriter</h4>
<p>å¸¦å‹ç¼©åŠŸèƒ½çš„writerè¿™éƒ¨åˆ†çš„é€»è¾‘å¢åŠ äº†ä¸€ä¸ªå•ç‹¬çº¿ç¨‹åšå‹ç¼©å¤„ç†ï¼Œå‡½æ•°<code>void SequentialCompressionWriter::write(   std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; message)</code>çš„æ ¸å¿ƒéƒ¨åˆ†ä¸»è¦æ˜¯<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_compression/src/rosbag2_compression/sequential_compression_writer.cpp#L317-L321">è¿™å‡ è¡Œ</a> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(compressor_queue_mutex_)</span></span>;</span><br><span class="line"><span class="keyword">while</span> (compressor_message_queue_.<span class="built_in">size</span>() &gt; compression_options_.compression_queue_size) &#123;</span><br><span class="line">    compressor_message_queue_.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line">compressor_message_queue_.<span class="built_in">push</span>(message);</span><br><span class="line">compressor_condition_.<span class="built_in">notify_one</span>();</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­çš„<code>compressor_message_queue_</code>åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å‡½æ•°<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_compression/src/rosbag2_compression/sequential_compression_writer.cpp#L63">void SequentialCompressionWriter::compression_thread_fn()</a>è¢«å¤„ç†ã€‚ è¿™é‡Œé¢æœ‰ä¸€ä¸ªå¯¹ä¼ å…¥çš„<code>SerializedMessageSharedPtr</code>å¯¹è±¡ä¸­çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/blob/14bf3dcc2170ebe5bd73ed0cf83bb4077b3e36b4/rosbag2_compression/src/rosbag2_compression/sequential_compression_writer.cpp#L96">å†…å­˜ç›´æ¥è¿›è¡Œå¤„ç†</a></p>
<h4 id="é‡æ–°æŸ¥çœ‹è°ƒç”¨apiçš„ä»£ç ">é‡æ–°æŸ¥çœ‹è°ƒç”¨APIçš„ä»£ç </h4>
<p>è°ƒç”¨<code>rosbag2 API</code>è¿›è¡Œæ•°æ®å†™æ“ä½œçš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create rosbag2_storage::StorageOptions</span></span><br><span class="line">rosbag2_storage::StorageOptions storageOptions;</span><br><span class="line"><span class="comment">// create reader</span></span><br><span class="line"><span class="keyword">auto</span> inputReader = rosbag2_transport::ReaderWriterFactory::<span class="built_in">make_reader</span>(storageOptions);</span><br><span class="line"><span class="comment">// open file</span></span><br><span class="line">inputReader-&gt;<span class="built_in">open</span>(storageOptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create multiplt writers</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// perform write</span></span><br><span class="line"><span class="keyword">while</span> (inputReader-&gt;<span class="built_in">has_next</span>())</span><br><span class="line">&#123;</span><br><span class="line">    std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; nextMsg = <span class="literal">nullptr</span>;</span><br><span class="line">    nextMsg = inputReader-&gt;<span class="built_in">read_next</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp; writer : outputWriters):</span><br><span class="line">    &#123;</span><br><span class="line">        writer-&gt;<span class="built_in">write</span>(nextMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></p>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä»<code>reader</code>ä¸­æ‹¿åˆ°çš„<code>SerializedBagMessage</code>æ˜¯ä»¥å…±äº«æŒ‡é’ˆçš„å½¢å¼ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬æŠŠå…±äº«æŒ‡é’ˆä¼ ç»™ä¸åŒçš„<code>writer</code>æ—¶ï¼Œä¸åŒçš„<code>writer</code>å†…éƒ¨åŒæ—¶å¯¹åŒä¸€å—å†…å­˜è¿›è¡Œæ•°æ®å‹ç¼©å¤„ç†ï¼Œå› æ­¤ä¹Ÿå°±å¯¼è‡´äº†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€å—åœ°å€ç©ºé—´çš„é”™è¯¯ã€‚</strong></p>
<h2 id="ä¿®å¤">ä¿®å¤</h2>
<p>ç”±äºä¸æƒ³æ›´æ”¹<code>rosbag2</code>çš„ä»£ç ï¼Œå› æ­¤æƒ³åŠæ³•åœ¨è°ƒç”¨å±‚è§£å†³ã€‚æ—¢ç„¶é—®é¢˜å…±äº«æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜è¢«ä¸åŒçº¿ç¨‹åŒæ—¶å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨æ¯ä¸€æ¬¡è°ƒç”¨<code>writer-&gt;write(nextMsg)</code>çš„æ—¶å€™å¯¹<code>nextMsg</code>æ‰§è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œè®©ä¸åŒçš„<code>writer</code>æ“ä½œä¸åŒå†…å­˜å³å¯ã€‚ è¿™é‡Œæ¯”è¾ƒå¤æ‚çš„æ˜¯<code>SerializedBagMessage</code>ä¸­ä½¿ç”¨ä¸€ä¸ªæŒ‡å‘<code>rcutils_uint8_array_t</code>çš„æŒ‡é’ˆå¯¹å†…å­˜è¿›è¡Œç®¡ç†ã€‚è€Œ<code>rcutils_uint8_array_t</code>é‡Œé¢åˆä½¿ç”¨ä¸€ä¸ªè£¸<code>uint8_t*</code>æŒ‡é’ˆæŒ‡å‘ç®¡ç†çš„å†…å­˜ã€‚åŒæ—¶<code>rcutils</code>çš„æ–‡æ¡£ä¸å¤Ÿè¯¦ç»†ï¼Œä¹Ÿæ²¡æœ‰æä¾›å‡½æ•°å¯¹<code>rcutils_uint8_array_t</code>æ‰§è¡Œæ·±æ‹·è´æ“ä½œã€‚ä¸è¿‡åªè¦èƒ½å¤Ÿæ˜ç™½ä¸Šé¢çš„å†…å­˜ç®¡ç†å…³ç³»ï¼Œä¿®å¤èµ·æ¥ä¸å¤ªå›°éš¾ï¼Œå…³äº<code>rcutils_uint8_array_t</code>çš„æ“ä½œå¯ä»¥å‚è€ƒ<code>rosbag2</code>é‡Œé¢çš„ä»£ç ï¼Œæœ€ç»ˆä¿®å¤çš„ä»£ç å¦‚ä¸‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">...create reader &amp;&amp; writer</span><br><span class="line"><span class="comment">// perform write</span></span><br><span class="line"><span class="keyword">while</span> (inputReader-&gt;<span class="built_in">has_next</span>())</span><br><span class="line">&#123;</span><br><span class="line">    std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; nextMsg = <span class="literal">nullptr</span>;</span><br><span class="line">    nextMsg = inputReader-&gt;<span class="built_in">read_next</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp; writer : outputWriters):</span><br><span class="line">    &#123;</span><br><span class="line">        std::shared_ptr&lt;rosbag2_storage::SerializedBagMessage&gt; nextMsg_copy = std::<span class="built_in">make_shared</span>&lt;rosbag2_storage::SerializedBagMessage&gt;();</span><br><span class="line">        <span class="comment">// æ–°å»ºrcutils_uint8_array_téœ€è¦æŒ‰ç…§ä¸‹é¢è¿™æ ·çš„æ“ä½œ</span></span><br><span class="line">        nextMsg_copy-&gt;serialized_data = std::<span class="built_in">shared_ptr</span>&lt;<span class="type">rcutils_uint8_array_t</span>&gt;(</span><br><span class="line">        <span class="keyword">new</span> <span class="type">rcutils_uint8_array_t</span>,</span><br><span class="line">        [](<span class="type">rcutils_uint8_array_t</span> * msg) &#123;</span><br><span class="line">        <span class="keyword">auto</span> fini_return = <span class="built_in">rcutils_uint8_array_fini</span>(msg);</span><br><span class="line">        <span class="keyword">delete</span> msg;</span><br><span class="line">        <span class="keyword">if</span> (fini_return != RCUTILS_RET_OK) &#123;</span><br><span class="line">            <span class="built_in">RCLCPP_ERROR_STREAM</span>(</span><br><span class="line">            rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rosbag2_cpp&quot;</span>),</span><br><span class="line">            <span class="string">&quot;Failed to destroy serialized message: &quot;</span> &lt;&lt; <span class="built_in">rcutils_get_error_string</span>().str);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºåéœ€è¦æ‰§è¡Œå†…å­˜åˆå§‹åŒ–</span></span><br><span class="line">        <span class="type">rcutils_allocator_t</span> allocator = <span class="built_in">rcutils_get_default_allocator</span>();</span><br><span class="line">        <span class="keyword">auto</span> ret = <span class="built_in">rcutils_uint8_array_init</span>(</span><br><span class="line">            nextMsg_copy-&gt;serialized_data.<span class="built_in">get</span>(),</span><br><span class="line">            nextMsg-&gt;serialized_data-&gt;buffer_capacity,</span><br><span class="line">            &amp;allocator);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (ret != RCUTILS_RET_OK)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">RCLCPP_ERROR</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Init arrry failed with ret code = %d&quot;</span>, ret);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤åˆ¶å†…å®¹</span></span><br><span class="line">        nextMsg_copy-&gt;topic_name = nextMsg-&gt;topic_name;</span><br><span class="line">        nextMsg_copy-&gt;time_stamp = nextMsg-&gt;time_stamp;</span><br><span class="line">        nextMsg_copy-&gt;serialized_data-&gt;buffer_capacity = nextMsg-&gt;serialized_data-&gt;buffer_capacity;</span><br><span class="line">        nextMsg_copy-&gt;serialized_data-&gt;buffer_length = nextMsg-&gt;serialized_data-&gt;buffer_length;</span><br><span class="line">        <span class="comment">// å¤åˆ¶å†…å­˜</span></span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="type">void</span>*)nextMsg_copy-&gt;serialized_data-&gt;buffer,</span><br><span class="line">                (<span class="type">void</span>*)nextMsg-&gt;serialized_data-&gt;buffer, nextMsg-&gt;serialized_data-&gt;buffer_length);</span><br><span class="line">        writer-&gt;<span class="built_in">write</span>(nextMsg_copy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="issue-æäº¤åŠ-pr">Issue æäº¤åŠ PR</h2>
<p>è¿™ä¸ªbugåŒæ—¶æäº¤åˆ°<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/tree/humble" title="rosbag2 repo">rosbag2</a>ä»“åº“<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/issues/1262">issues1262ä¸­</a>ã€‚æ ¹æ®issueçš„åé¦ˆï¼Œè¿™ä¸ªbugåœ¨æœ€æ–°çš„rollingåˆ†æ”¯å·²ç»è¢«ä¿®å¤ã€‚ä¸è¿‡rollingåˆ†æ”¯çš„APIä¸humble çš„APIå·®åˆ«è¾ƒå¤§ï¼Œå› æ­¤æ²¡æ³•ç›´æ¥åˆå¹¶åˆ°humbleåˆ†æ”¯ä¸­ï¼Œå› æ­¤åœ¨humbleåˆ†æ”¯è¿™ä¸ªbugè¿˜æ²¡æœ‰è¢«ä¿®å¤ã€‚</p>
<h3 id="prè¿‡ç¨‹">PRè¿‡ç¨‹</h3>
<ol type="1">
<li>forkä»“åº“</li>
<li>å…‹éš†forkåçš„ä»“åº“åˆ°æœ¬åœ°</li>
<li>ä»humbleåˆ†æ”¯åˆ‡å‡ºbug_fixåˆ†æ”¯</li>
<li>å…ˆç”¨åŸå§‹ä»£ç ç¼–è¯‘å¹¶æ‰§è¡Œtest</li>
<li>å…ˆæ–°å¢ä¸€ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æ‰§è¡Œç¼–è¯‘æµ‹è¯•ï¼ŒåŸå§‹ä»£ç æ— æ³•åœ¨æ–°çš„å•å…ƒæµ‹è¯•ä¸‹é€šè¿‡</li>
<li>ä¿®å¤ä»£ç </li>
<li>ç¼–è¯‘å¹¶æµ‹è¯•ï¼Œé€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹</li>
</ol>
<p>PS:åœ¨ä¿®å¤è¿‡ç¨‹ä¸­ä¸€å¼€å§‹æ€»æ˜¯æ— æ³•é€šè¿‡æµ‹è¯•ç”¨ä¾‹ï¼Œæç¤ºæ— æ³•ç”Ÿæˆæµ‹è¯•ç»“æœæ–‡ä»¶ã€‚åé¢æŸ¥çœ‹å‘ç°è¿è¡Œè¿‡ç¨‹ä¸­ä¼š<code>core dump</code>ã€‚ç»è¿‡<code>gdb</code>è°ƒè¯•ï¼ˆä¸ºäº†è°ƒè¯•èƒ½å¤Ÿè¾“å‡ºæœ€å¤šçš„<code>core dump</code>ä¿¡æ¯ï¼Œéœ€è¦<code>colcon build --cmake-args -DCMAKE_BUILD_TYPE=Debug</code>ï¼‰åå‘ç°ï¼Œæ˜¯å› ä¸ºå£°æ˜äº†å…±äº«æŒ‡é’ˆä¹‹åæ²¡æœ‰å¯¹é½è¿›è¡Œåˆå§‹åŒ–ï¼Œåé¢åˆè°ƒç”¨äº†è¯¥æŒ‡é’ˆçš„æˆå‘˜å˜é‡ã€‚å“ï¼Œè¿˜æ˜¯å¤ªèœå‘€ï½</p>
<p>å…·ä½“çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2/pull/1331#issue-1708860338">PR</a></p>
<h2 id="é™„å½•aubuntu-coreæ–‡ä»¶ç”Ÿæˆ">é™„å½•Aï¼šubuntu coreæ–‡ä»¶ç”Ÿæˆ</h2>
<div id="appendA">

</div>
<ol type="1">
<li>ubuntuæœ‰ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯æœé›†ç³»ç»Ÿapportï¼Œå¿…é¡»è¦å…³æ‰ä¹‹åæ‰èƒ½ç”Ÿæˆcoreæ–‡ä»¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service apport status</span><br><span class="line">sudo service apport stop</span><br><span class="line">sudo systemctl apport disble  <span class="comment"># ä¼¼ä¹æ— æ³•å…³é—­å¼€æœºå¯åŠ¨ï¼Œæ¯æ¬¡éœ€è¦çš„æ—¶å€™éœ€è¦æ‰‹å·¥ç¡®è®¤æ˜¯å¦å…³é—­</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>è®¾ç½®coreæ–‡ä»¶å¤§å°ï¼Œé»˜è®¤æ˜¯0ï¼Œæ‰€ä»¥ä¸ä¼šç”Ÿæˆcoreæ–‡ä»¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c  <span class="comment"># è‹¥ç»“æœæ˜¯0ï¼Œåˆ™ä¸ä¼šç”Ÿæˆcoreæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited  <span class="comment"># ä¸é™åˆ¶coreæ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -c unlimited&quot;</span> &gt;&gt; ~/.bashrc  <span class="comment"># é€‰æ‹©å½“å‰ä½¿ç”¨çš„ç»ˆç«¯</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -c unlimited&quot;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>è®¾ç½®corefileè·¯å¾„ï¼ˆæ³¨æ„ï¼Œè·¯å¾„å¿…é¡»æ™®é€šç”¨æˆ·å¯è¯»ï¼ï¼‰</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /corefile</span><br><span class="line">sudo <span class="built_in">chmod</span> 777 /corefile</span><br><span class="line">sysctl -w kernel.core_pattern=/corefile/core-%e-%p-%t</span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li><code>CMakeLists.txtåŠ ä¸Š``Debugæ¨¡å¼</code>ä¸‹ä¸è¿›è¡Œç¼–è¯‘å™¨ä¼˜åŒ–</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In CMakeLists.txt</span></span><br><span class="line">SET(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot;<span class="variable">$ENV</span>&#123;CXXFLAGS&#125; -O0 -Wall -g -ggdb -Wno-unused-parameter&quot;</span>)  </span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åœ¨ç¼–è¯‘<code>ROS2</code>åŒ…çš„æ—¶å€™è¦æŒ‡æ˜<code>Debug</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --packages-select package_name --cmake-args -DCMAKE_BUILD_TYPE=Debug</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-14 19:49:06" itemprop="dateCreated datePublished" datetime="2023-03-14T19:49:06+08:00">2023-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-19 22:23:01" itemprop="dateModified" datetime="2023-04-19T22:23:01+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ" href="/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::b824fa070f036b85c958cacd75daa48f" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="è¿è¡Œç¯å¢ƒæ­å»º">è¿è¡Œç¯å¢ƒæ­å»º</h2>
<p>æœ¬é¡¹ç›®æä¾›åŸºäº<code>ROS2-humble</code>çš„é•œåƒï¼Œå¹¶æä¾›è„šæœ¬å¯ç›´æ¥åœ¨é•œåƒä¸­å¯åŠ¨å¯è§†åŒ–ç¨‹åºã€‚ dockeré•œåƒéƒ¨ç½²è§ä¸‹æ–‡ã€‚</p>
<h3 id="æ•°æ®">æ•°æ®</h3>
<p>æœ¬é¡¹ç›®åŒæ—¶æä¾›è½¬ä¸º<code>rosbag2</code>æ ¼å¼çš„æ•°æ®åŒ…ï¼Œ<a href="">ä¸‹è½½åœ°å€:æš‚æ—¶æœªä¸Šä¼ </a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DATA_DIR=/path/to/download/ros2bag/dir</span><br></pre></td></tr></table></figure>
<p>æœ¬é¡¹ç›®ä¸­é»˜è®¤çš„é…ç½®æ–‡ä»¶<code>params_default.yaml</code>å¯ä»¥ç›´æ¥è¿è¡Œä¸‹é¢çš„æ•°æ®ï¼š - park_dataset - walking_dataset - garden_dataset</p>
<h3 id="ç¯å¢ƒéƒ¨ç½²">ç¯å¢ƒéƒ¨ç½²</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:zeal-up/Simple-LIO-SAM.git</span><br><span class="line"><span class="built_in">cd</span> Simple-LIO-SAM</span><br><span class="line">./docker_run.sh -h  <span class="comment"># show help message</span></span><br><span class="line">./docker_run.sh -c /path/to/code/repo -d <span class="variable">$DATA_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ./docker_into.sh  # enter the container next time</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘">ç¼–è¯‘</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Simple-LIO-SAM</span><br><span class="line">./docker_into.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢å‘½ä»¤åœ¨é•œåƒä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">cd</span> ~/ros_ws/</span><br><span class="line"><span class="built_in">mkdir</span> src &amp;&amp; <span class="built_in">cd</span> src &amp;&amp;<span class="built_in">ln</span> -s /home/splsam/codes ./</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">source</span> /opt/ros/humble/setup.bash</span><br><span class="line">colcon build --packages-select spl_lio_sam</span><br></pre></td></tr></table></figure>
<h3 id="è¿è¡Œ">è¿è¡Œ</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dockeré•œåƒä¸‹è¿è¡Œ</span></span><br><span class="line"><span class="built_in">cd</span> ~/ros_ws</span><br><span class="line"><span class="built_in">source</span> ./install/setup.bash</span><br><span class="line">ros2 launch spl_lio_sam run.launch.py </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¼€ç»ˆç«¯</span></span><br><span class="line"><span class="built_in">cd</span> Simple-LIO-SAM</span><br><span class="line">./docker_into.sh</span><br><span class="line"><span class="built_in">cd</span> data/ros2/</span><br><span class="line">ros2 bag play ./park_dataset/ --topics /points_raw /imu_raw</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæ—¶ç”»é¢ï¼š</p>
<img src="./imgs/runtime.gif" title="fig:" alt="Simple-LIO-SAMè¿è¡Œæ—¶ç”»é¢" />
<center>
Simple-LIO-SAMè¿è¡Œæ—¶ç”»é¢
</center>
<h2 id="å¼€å‘ç¯å¢ƒæ­å»º">å¼€å‘ç¯å¢ƒæ­å»º</h2>
<p>ç”±äºæœ¬é¡¹ç›®ä½œè€…åœ¨ä½¿ç”¨<code>vscode</code>å¼€å‘<code>c++</code>æ—¶ç»å¸¸ä¼šé‡åˆ°æ— æ³•å¿«æ·è·³è½¬é—®é¢˜ï¼ˆå…¶å®ç¬”è€…å‘ç°æœ‰å¾ˆå¤šäººåœ¨ä½¿ç”¨vscodeå¼€å‘æ—¶éƒ½ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œ å› æ­¤ä¸€å¹¶æŠŠè§£å†³æ–¹æ¡ˆå†™å…¥é¡¹ç›®ä¸­ã€‚</p>
<h3 id="vscode-cppå‡½æ•°å¿«æ·è·³è½¬">vscode Cppå‡½æ•°å¿«æ·è·³è½¬</h3>
<ol type="1">
<li>å®‰è£…cppæ‰©å±• vscodeä¾§è¾¹æ è¿›å…¥æ‰©å±•é€‰é¡¹ï¼ˆctrl+shift+x)ï¼Œæœç´¢<code>c++</code>ï¼Œå®‰è£…<code>C/C++ Extension Pack</code></li>
<li>æ‰“å¼€é¡¹ç›® &gt; File-&gt;Open Folder</li>
<li>ä¿å­˜ä¸ºå·¥ä½œåŒº &gt; File-&gt;Save Workspace as é€‰æ‹©ç›®æ ‡ç›®å½•åŠæ–‡ä»¶ï¼ˆé»˜è®¤ä»¥<code>.code-workspace</code>ç»“å°¾ï¼‰</li>
<li>æ‰“å¼€åˆšæ‰ä¿å­˜çš„å·¥ä½œåŒºæ–‡ä»¶ &gt; File-&gt;Open File é€‰æ‹©åˆšæ‰æ‰“å¼€çš„å·¥ä½œåŒºæ–‡ä»¶</li>
<li>å¯¹å·¥ä½œåŒºæ·»åŠ <code>c++</code>åº“æ£€ç´¢è·¯å¾„ åœ¨åˆšæ‰æ‰“å¼€çš„å·¥ä½œåŒºæ–‡ä»¶ä¸­ï¼Œå‚è€ƒä»¥ä¸‹æ ¼å¼ç¼–è¾‘</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;folders&quot;:</span> [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;path&quot;:</span> <span class="string">&quot;../Simple-LIO-SAM&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">		<span class="attr">&quot;C_Cpp.default.includePath&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;$&#123;default&#125;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/usr/include/**&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/usr/include/c++/9/&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/usr/lib/gcc/x86_64-linux-gnu/8/include/&quot;</span>,</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/include/**&quot;</span>,</span><br><span class="line"></span><br><span class="line">			<span class="string">&quot;$&#123;workspaceFolder&#125;/include&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">//</span> <span class="string">é‡ç‚¹ï¼ï¼è¿™é‡Œçš„è·¯å¾„è¦è®¾ç½®ä¸ºros2å·¥ä½œç©ºé—´ä¸‹spl_lio_samç¼–è¯‘å‡ºæ¥çš„å¤´æ–‡ä»¶</span></span><br><span class="line">			<span class="string">&quot;/path/to/ros2_ws/install/spl_lio_sam/include/spl_lio_sam&quot;</span></span><br><span class="line"></span><br><span class="line">		],</span><br><span class="line">		<span class="attr">&quot;C_Cpp.files.exclude&quot;:</span> &#123;</span><br><span class="line">			<span class="string">&quot;**/.vscode&quot;</span><span class="string">:</span> <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;**/.vs&quot;</span><span class="string">:</span> <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;C_Cpp.default.cStandard&quot;:</span> <span class="string">&quot;c17&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;C_Cpp.default.cppStandard&quot;:</span> <span class="string">&quot;c++17&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;python.analysis.include&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span>,</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">&quot;python.autoComplete.extraPaths&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span>,</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">&quot;python.analysis.extraPaths&quot;:</span> [</span><br><span class="line">			<span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span>,</span><br><span class="line">		],</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¯¹å·¥ä½œåŒºæ–‡ä»¶çš„è§£é‡Š">å¯¹å·¥ä½œåŒºæ–‡ä»¶çš„è§£é‡Š</h3>
<p>å…¶å®ä¸»è¦èµ·ä½œç”¨çš„æ˜¯å·¥ä½œåŒºæ–‡ä»¶ä¸­<code>settings-&gt;C_Cpp.default.includePath</code>å­—æ®µå†…å®¹ï¼Œvscodeçš„cppæ‰©å±•ä¼šè¯»å–è¯¥å·¥ä½œç©ºé—´æ–‡ä»¶ä¸‹ çš„è¿™ä¸ªå­—æ®µï¼Œå¹¶å°†é‡Œé¢çš„è·¯å¾„è¿›è¡Œè§£æåŠ åˆ°å¤´æ–‡ä»¶è§£æè·¯å¾„ä¸­ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªè·¯å¾„è¦æ³¨æ„çš„</p>
<ol type="1">
<li><code>"$&#123;workspaceFolder&#125;/include"</code>ï¼Œä¹Ÿå°±æ˜¯Simple-LIO-SAMä»“åº“ä¸‹çš„includeè·¯å¾„</li>
<li><code>"/path/to/ros2_ws/install/spl_lio_sam/include/spl_lio_sam"</code>ï¼Œè¿™ä¸ªè¦è®¾ç½®æˆä½ çš„roså·¥ä½œç©ºé—´å¯¹åº”çš„è·¯å¾„</li>
</ol>
<p>å¦å¤–ï¼Œå¦‚æœå‘ç°è‡ªå·±è·¯å¾„è®¾ç½®å®Œæˆï¼Œä½†æ˜¯æœ‰äº›å‡½æ•°è¿˜æç¤ºä¸‹åˆ’çº¿ï¼Œè¦çœ‹çœ‹æ˜¯ä¸æ˜¯é‚£äº›å‡½æ•°æ˜¯<code>c++17</code>æˆ–è€…æ›´é«˜çš„æ ‡å‡†æ‰æ”¯æŒçš„ç‰¹æ€§ï¼Œåœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­ è®¾ç½®c++/cæ ‡å‡†ä¸º17</p>
<h3 id="å…¶ä½™æ³¨æ„">å…¶ä½™æ³¨æ„</h3>
<ol type="1">
<li>å°½é‡ä¸è¦ç”¨<code>/path/**</code>çš„æ ¼å¼æ·»åŠ includeè·¯å¾„ï¼Œè™½ç„¶çœ‹èµ·æ¥å¾ˆçœäº‹ï¼Œä½†ä¼šå½±å“æ£€ç´¢æ•ˆç‡</li>
<li>åˆšè®¾ç½®å®Œè·¯å¾„éœ€è¦ç­‰å¾…vscodeæ£€ç´¢æ„å»ºæ•°æ®åº“ï¼Œåœ¨vscodeå³ä¸‹æ–¹çŠ¶æ€æ¡ä¼šæç¤ºæ­£åœ¨è¿›è¡Œæ£€ç´¢</li>
<li>ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­<code>"python.analysis.extraPaths","python.autoComplete.extraPaths","python.analysis.include"</code>æ˜¯è®¾ç½®pythonè¯­æ³•æç¤ºå™¨çš„ åº“æ£€ç´¢è·¯å¾„ï¼Œä¸åŒçš„pythonæç¤ºå™¨æ’ä»¶ä¼šä½¿ç”¨ä¸åŒçš„è·¯å¾„ã€‚</li>
</ol>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIO-SAM</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2007.00258">LIO-SAM paper</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">This Project</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/chennuo0125-HIT/LIO-SAM-note">LIO-SAM-note</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/smilefacehh/LIO-SAM-DetailedNote">LIO-SAM-DetailedNote</a></li>
</ol>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/13/lio_sam/intro/" class="post-title-link" itemprop="url">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 19:45:58" itemprop="dateCreated datePublished" datetime="2023-03-13T19:45:58+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-18 22:29:16" itemprop="dateModified" datetime="2023-04-18T22:29:16+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/" itemprop="url" rel="index"><span itemprop="name">SLAM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/SLAM/LIOSAM/" itemprop="url" rel="index"><span itemprop="name">LIOSAM</span></a>
        </span>
    </span>

  
    <span id="/2023/03/13/lio_sam/intro/" class="post-meta-item leancloud_visitors" data-flag-title="Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹" href="/2023/03/13/lio_sam/intro/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d227db67a0df8ebb129db6bbfad2da40" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>â­ <a href="https://zeal-up.github.io/categories/">Zeal's Blog</a></li>
<li>ğŸ›  <a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1619085291536433152">çŸ¥ä¹ä¸“æ </a></li>
<li>ğŸŒ€ <a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">é¡¹ç›®ä»“åº“</a></li>
</ul>
<h2 id="liosamä»‹ç»">LIOSAMä»‹ç»</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ï¼ˆTightly-coupled Lidar Inertial Odometry via Smoothing and Mappingï¼‰ï¼Œç´§è€¦åˆæ¿€å…‰æƒ¯æ€§é‡Œç¨‹è®¡æ–¹æ³•ã€‚ ä½œè€…<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan">TixiaoShan</a>æ˜¯SLAMå±Šå¤§ç¥ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¹‹å‰å‘è¡¨è¿‡<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¹‹åå‘å¸ƒäº†<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2104.10831">LVI-SAM</a>â€”â€”åœ¨<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>åŸºç¡€ä¸ŠåˆåŠ å…¥äº†è¯­ä¹‰å®šä½å› å­ã€‚ ç½‘ä¸Šå…³äº<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>çš„è§£è¯»å·²ç»æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸ä¼šè¿›è¡Œå¤ªè¿‡è¯¦ç»†çš„å¤è¿°ï¼Œå…·ä½“çš„å†…å®¹è§£æä¼šæ”¾åœ¨åé¢ç³»åˆ—æ–‡ç« æ…¢æ…¢ä»”ç»†é˜è¿°ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ•´ä½“çš„æ¡†æ¶ä¸å…¶ä»–æ–¹æ³•åŒºåˆ«åœ¨ä¸ï¼š</p>
<ol type="1">
<li>ä½¿ç”¨å› å­å›¾ä½œä¸ºåç«¯ä¼˜åŒ–æ¡†æ¶ï¼Œå°†IMUé¢„ç§¯åˆ†ä¸é›·è¾¾ç‚¹äº‘åŒ¹é…åŠå›ç¯æ£€æµ‹ç­‰ç´§è€¦åˆ</li>
<li>ä½¿ç”¨å½“å‰å¸§-å±€éƒ¨åœ°å›¾åŒ¹é…è€Œä¸æ˜¯å¯¹å…¨å±€åœ°å›¾åŒ¹é…æ¥åŠ é€Ÿç‚¹äº‘åŒ¹é…é€Ÿåº¦</li>
<li>åŸºäºä½ç½®å…³ç³»é€‰æ‹©å›ç¯å¸§ï¼Œå¹¶ä½¿ç”¨ç‚¹äº‘åŒ¹é…è®¡ç®—å›ç¯å› å­</li>
<li>ä½¿ç”¨é«˜é¢‘IMUå¹¶è¿›è¡Œç®€å•ç§¯åˆ†å¯¹ç‚¹äº‘åšè¿åŠ¨ç•¸å˜æ ¡æ­£</li>
</ol>
<p>å¦å¤–ï¼ŒLIOSAMä½œè€…çš„å·¥ç¨‹åŠŸåº•å¾ˆå¥½ï¼ŒLIOSAMä»£ç åº“è¢«githubä¸Šå¾ˆå¤šSLAMå¼€æºé¡¹ç›®ä½œä¸ºcode base</p>
<h2 id="æœ¬é¡¹ç›®ç›®çš„">æœ¬é¡¹ç›®ç›®çš„</h2>
<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æºä»£ç è™½ç„¶ä¸èƒ½è¯´åºå¤§ï¼Œç”šè‡³å¯ä»¥è¯´ç®€å•ï¼Œå› ä¸ºæ•´ä¸ªä»£ç åº“ä¸»è¦åªè¦5ä¸ªæ–‡ä»¶ã€‚ <img src="./imgs/org_files.png" alt="LIOSAMåŸä»£ç srcç›®å½•" />
<center>
LIOSAMåŸä»£ç srcç›®å½•
</center>
<p>ä½†æ˜¯åŸä»£ç é‡Œé¢æ¯ä¸ªæ¨¡å—éƒ½é€šè¿‡ROSçš„topicä¸å…¶ä»–æ¨¡å—æœ‰ç´§å¯†çš„è”ç³»ï¼Œä¸”éå¸¸å¤šçš„å†—ä½™ä»£ç å’Œtopicï¼Œè¿™å¯¼è‡´äº† æ•´ä¸ªçš„æµç¨‹å¯¹æ–°æ‰‹ååˆ†ä¸å‹å¥½ï¼Œä¸‹å›¾æ˜¯LIOSAMåŸæœ¬è¿è¡Œæ—¶çš„<code>rqt_graph</code></p>
<img src="./imgs/org_rqtgraph.png" title="fig:" alt="åŸå§‹LIOSAMè¿è¡Œæ—¶rqt_graph" />
<center>
åŸå§‹LIOSAMè¿è¡Œæ—¶rqt_graph
</center>
<p>ç¬¬äºŒä¸ªå¤æ‚ä¹‹å¤„åœ¨äº<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ¡†æ¶æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹å’Œå·¥å…·è¾ƒå¤šï¼Œè‡³å°‘è¦ç†Ÿæ‚‰<code>ROS,gtsam,pcl</code>å‡ ä¸ªåº“ï¼Œç®—æ³•å±‚é¢éœ€è¦ç†Ÿæ‚‰<code>ç‚¹äº‘åŒ¹é…ã€IMUç§¯åˆ†ã€å› å­å›¾ã€ä¸‰ç»´è½¬æ¢</code>ç­‰ã€‚ å¯¹äºç†Ÿæ‚‰SLAMçš„äººæ¥è¯´å¯èƒ½è¾ƒä¸ºç®€å•ä¸Šæ‰‹ï¼Œä½†æ˜¯å¯¹äºæ–°å…¥é—¨çš„äººæ¥è¯´åˆ™ä¸€å¼€å§‹ä¼šä¸€å¤´é›¾æ°´ã€‚</p>
<p>åŸºäºä¸Šè¿°è¿™äº›åŸå› ï¼Œç¬”è€…åŸºäº<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ”¹è¿›ï¼Œå®Œæˆäº†<a href="Simple-LIO-SAM">SPL-LIO-SAM</a>é¡¹ç›®ï¼Œå¸Œæœ›èƒ½å¤Ÿä»¥æœ€å¤§å¹…åº¦å¸®åŠ©åˆå­¦è€…ç†è§£<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ¡†æ¶åŠé‡Œé¢çš„ç®—æ³•ç»†èŠ‚ã€‚</p>
<h2 id="é€‚ç”¨äººç¾¤">é€‚ç”¨äººç¾¤</h2>
<p>å¦‚æœä½ æ˜¯SLAMå¤§ç‰›ï¼Œé‚£æœ¬é¡¹ç›®å¯èƒ½å¯¹ä½ æ²¡æœ‰ç”¨å¤„ã€‚å¦‚æœä½ æ˜¯ä»¥ä¸‹äººç¾¤ä¹‹ä¸€ï¼Œç¬”è€…ç›¸ä¿¡æœ¬é¡¹ç›®å¯ä»¥è®©ä½ å—ç›ŠåŒªæµ…ã€‚</p>
<ol type="1">
<li>SLAMåˆå­¦è€…ã€‚æœ¬é¡¹ç›®å¯¹ä»£ç æ³¨é‡Šå’Œè®²è§£å¯ä»¥è¯´ç»†è‡´åˆ°ä»¤äººå‘æŒ‡ï¼Œå› æ­¤ååˆ†é€‚åˆåˆå­¦è€…å­¦ä¹ ã€‚</li>
<li>æ¥è§¦è¿‡SLAMï¼Œå¸Œæœ›å°†SLAMç®—æ³•å·¥ç¨‹åŒ–ï¼Œå¹¶åŠ ä»¥å®ç°ã€‚</li>
<li>SLAMå­¦ä¹ è€…æˆ–å·¥ç¨‹å¸ˆï¼Œä½†æ˜¯å¸Œæœ›å¯¹<a target="_blank" rel="noopener" href="http://www.roboticsproceedings.org/rss10/p07.pdf">LOAM</a>,<a target="_blank" rel="noopener" href="https://github.com/RobustFieldAutonomyLab/LeGO-LOAM">LeGO-LOAM</a>,<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2104.10831">LVI-SAM</a>,<a target="_blank" rel="noopener" href="https://github.com/laboshinl/loam_velodyne">loam_velodyne</a>å…¶ä¸­ä»»ä½•ä¸€ç§ç®—æ³•è¿›è¡Œç²¾ç»†å­¦ä¹ </li>
</ol>
<h2 id="simple-lio-samé¡¹ç›®ç‰¹ç‚¹ä¸liosamåŒºåˆ«">Simple-LIO-SAMé¡¹ç›®ç‰¹ç‚¹/ä¸LIOSAMåŒºåˆ«</h2>
<h3 id="åŸºäºæœ€æ–°çš„ros2å‘è¡Œç‰ˆhumbleå®ç°">åŸºäºæœ€æ–°çš„ROS2å‘è¡Œç‰ˆhumbleå®ç°</h3>
<p>è™½ç„¶<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æºç ä¸­æœ‰ä¸€ä¸ªros2åˆ†æ”¯ï¼Œä½†è¯¥åˆ†æ”¯çš„ç»´æŠ¤è€…å¹¶ä¸æ˜¯åŸä½œè€…ï¼Œè€Œä¸”å·²ç»é•¿æ—¶é—´æ²¡æœ‰äººç»´æŠ¤ï¼Œä¸”è¯¥åˆ†æ”¯å­˜åœ¨ä¸€äº›bugæ²¡æœ‰è¢«ä¿®å¤ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨è¿›è¡Œæœ¬é¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ä¸­ ç†Ÿæ‚‰æœ€æ–°çš„ROS2æ¡†æ¶ï¼Œç¬”è€…åœ¨LIOSAMçš„ros2åˆ†æ”¯åŸºç¡€ä¸Šï¼Œä¿®å¤äº†å­˜åœ¨çš„bugï¼ŒåŒæ—¶å°†åŠŸèƒ½è¾ƒä¸ºç‹¬ç«‹çš„<code>Transformfusion</code>ç±»æŠ½å–æˆç‹¬ç«‹çš„ç±»ã€‚</p>
<h3 id="å¼€ç®±å³ç”¨dockerå¼€å‘ç¯å¢ƒ">å¼€ç®±å³ç”¨dockerå¼€å‘ç¯å¢ƒ</h3>
<p>ä¸ºäº†ä¾¿äºä¸Šæ‰‹åŠéƒ¨ç½²ï¼Œç¬”è€…åŒæ—¶å‡†å¤‡äº†é€‚é…çš„dockeré•œåƒä¾›å­¦ä¹ è€…ä½¿ç”¨ã€‚</p>
<h3 id="ç®€åŒ–">ç®€åŒ–</h3>
<h4 id="è¯é¢˜å‘å¸ƒçš„ç®€åŒ–">è¯é¢˜å‘å¸ƒçš„ç®€åŒ–</h4>
<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>åŸå§‹ä»£ç ä¸­æœ‰å¾ˆå¤šä¸­é—´ç»“æœçš„å‘å¸ƒï¼Œè¿™äº›ä¸­é—´ç»“æœå¯ä»¥ç”¨æ¥å¯è§†åŒ–åŠè°ƒè¯•ç¨‹åºï¼Œä½†æ˜¯å¯¹äºå­¦ä¹ è€…å’Œå¼€å‘è€…è€Œè¨€ä¸ä»…æ„ä¹‰ä¸å¤§ï¼Œè€Œä¸”ä¼šåœ¨åˆå§‹å­¦ä¹ æºç é˜¶æ®µè¯¯å¯¼å­¦ä¹ è€…ã€‚ æœ¬é¡¹ç›®åœ¨è¯é¢˜å‘å¸ƒä¸Šè¿›è¡Œ<code>å¤§å¹…åº¦ç®€åŒ–</code>ï¼Œç®€åŒ–åçš„è®¾è®¡å¦‚ä¸‹ï¼š <img src="./imgs/Design-Node%26%26Topics.png" alt="Simple-LIO-SAMèŠ‚ç‚¹åŠè¯é¢˜è®¾è®¡" />
<center>
Simple-LIO-SAMèŠ‚ç‚¹åŠè¯é¢˜è®¾è®¡
</center>
ç®€åŒ–åè¿è¡Œæ—¶çš„<code>rqt_graph</code>: <img src="./imgs/spl_liosam_rosgraph.png" alt="Simple-LIO-SAMçš„rqt_grpah" />
<center>
Simple-LIO-SAMçš„rqt_grpah
</center>
<h4 id="åæ ‡ç³»ç®€åŒ–">åæ ‡ç³»ç®€åŒ–</h4>
<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ä¸­å®ç”¨çš„åæ ‡ç³»å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯ä½œè€…æä¾›çš„<code>urdf</code>åŒ…å«äº†å¤ªå¤šä¸ºäº†å…¼å®¹æ€§è€ƒè™‘çš„åæ ‡ç³»ï¼Œè¿™äº›åæ ‡ç³»å¯¹äºå®é™…è¿è¡Œå’Œç†è§£å¹¶æ²¡æœ‰ç”¨ã€‚å› æ­¤ï¼Œæœ¬é¡¹ç›®åŸºäºROSå¯¹åæ ‡ç³»çš„çº¦æŸï¼Œå°† åæ ‡ç³»å…³ç³»æ ‘ç®€åŒ–ä¸ºå¦‚ä¸‹ï¼š <img src="./imgs/Design-CoordinateSystem.png" alt="Simple-LIO-SAMçš„åæ ‡ç³»å…³ç³»" />
<center>
Simple-LIO-SAMçš„åæ ‡ç³»å…³ç³»
</center>
<h3 id="ä¿ç•™ç®—æ³•åŠå®šä¹‰å®Œæ•´æ€§">ä¿ç•™ç®—æ³•åŠå®šä¹‰å®Œæ•´æ€§</h3>
<p>è™½ç„¶æœ¬é¡¹ç›®å»é™¤äº†å¾ˆå¤šéå¿…è¦topicï¼ŒåŒæ—¶å¯¹äºä¸€äº›éå¿…è¦ä»£ç ä¹Ÿè¿›è¡Œäº†ç®€åŒ–ï¼Œä½†å¯¹ä¸€äº›å­¦ä¹ ç®—æ³•æœ‰å¸®åŠ©çš„ç»†èŠ‚ä¾æ—§ä¿ç•™ã€‚æ¯”å¦‚æ¿€å…‰é‡Œç¨‹è®¡åœ¨å‘å¸ƒçš„æ—¶å€™æœ‰<code>mapping/odometry</code>å’Œ<code>mapping/odometry_incremental</code>ä¸¤ä¸ªè¯é¢˜ï¼Œè¿™ä¸¤ä¸ªè¯é¢˜è™½ç„¶ç±»ä¼¼ä½†æ˜¯èƒŒåå´æœ‰å¾ˆä¸åŒçš„å«ä¹‰ï¼Œä½†åŒæ—¶ä¸¤è€…åˆä¸€åˆä¸å½±å“ç®—æ³•çš„è¿è¡Œã€‚å› æ­¤é‡‡å–çš„åšæ³•æ—¶åœ¨ä»£ç ä¸­ä¿ç•™è¿™éƒ¨åˆ†ä»£ç ï¼ŒåŒæ—¶åŠ ä»¥è§£é‡Šï¼Œä½†å‘å¸ƒæ—¶åªå‘å¸ƒå…¶ä¸­ä¸€ä¸ªè¯é¢˜ã€‚</p>
<h3 id="å®Œå–„çš„æ³¨é‡ŠåŠæµç¨‹å›¾">å®Œå–„çš„æ³¨é‡ŠåŠæµç¨‹å›¾</h3>
ç½‘ä¸Šå¯¹<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æºç çš„æ³¨é‡Šå…¶å®å¹¶ä¸å°‘ï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://github.com/chennuo0125-HIT/LIO-SAM-note">LIO-SAM-note</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/smilefacehh/LIO-SAM-DetailedNote">LIO-SAM-DetailedNote</a>ï¼Œè¿˜æœ‰ä¸€äº›blogä¹Ÿå¯¹æºç åšäº†è§£é‡Šï¼Œä½†æ˜¯éƒ½ä¸å¤ªå®Œç¾ï¼ŒåŒæ—¶ç¼ºå°‘é¡¹ç›®æ€§çš„ç»„ç»‡ã€‚æœ¬é¡¹ç›®å€Ÿé‰´äº†ä¸€äº›å¼€æºé¡¹ç›®çš„æ³¨é‡Šï¼Œå¹¶åŠ ä»¥å®Œå–„ï¼Œå¯ä»¥è¯´ï¼Œæœ¬é¡¹ç›®æ˜¯ç›®å‰å¯¹<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>æ³¨é‡Šæœ€å®Œå–„çš„å¼€æºé¡¹ç›®ã€‚<a target="_blank" rel="noopener" href="https://github.com/zeal-up/Simple-LIO-SAM">Simple-LIO-SAMä»£ç </a> <img src="./imgs/comments.png" alt="Simple-LIO-SAMéƒ¨åˆ†æ³¨é‡Šå›¾" />
<center>
Simple-LIO-SAMéƒ¨åˆ†æ³¨é‡Šå›¾
</center>
ä¸ºäº†æœ€ä¸ºæ¸…æ™°çš„å±•ç¤º<a target="_blank" rel="noopener" href="https://github.com/TixiaoShan/LIO-SAM">LIOSAM</a>ç®—æ³•ä¸åŒæ¨¡å—çš„æµç¨‹ï¼Œè¯¥é¡¹ç›®è¿˜å¯¹å„ä¸ªæ¨¡å—æµç¨‹è¿›è¡Œæ¢³ç†ï¼Œå»ºç«‹äº†å®Œå–„çš„æµç¨‹å›¾è®¾è®¡ <img src="./imgs/Design-Pipelines.png" alt="ç®—æ³•Pipelineæ¢³ç†" />
<center>
ç®—æ³•Pipelineæ¢³ç†
</center>
<img src="./imgs/Design-imageProjection_top0.png" title="fig:" alt="ç‚¹äº‘å»ç•¸å˜æµç¨‹å›¾-top" />
<center>
ç‚¹äº‘å»ç•¸å˜æµç¨‹å›¾-top
</center>
<img src="./imgs/Design-imageProjection_top1.png" title="fig:" alt="ç‚¹äº‘å»ç•¸å˜æµç¨‹å›¾-ç»†èŠ‚ç¤ºä¾‹1" />
<center>
ç‚¹äº‘å»ç•¸å˜æµç¨‹å›¾-ç»†èŠ‚ç¤ºä¾‹
</center>
<h2 id="æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚">æœ¬é¡¹ç›®æ‰€æœ‰ç« èŠ‚</h2>
<ol type="1">
<li><a href="https://zeal-up.github.io/2023/03/13/lio_sam/intro/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸€ï¼‰é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="https://zeal-up.github.io/2023/03/14/lio_sam/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C/">Simple-LIO-SAMâ€”â€”ï¼ˆäºŒï¼‰ç¯å¢ƒæ­å»ºä¸è¿è¡Œ</a></li>
<li><a href="https://zeal-up.github.io/2023/03/16/lio_sam/%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E8%AE%A4%E8%AF%86/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸‰ï¼‰æ€»ä½“æµç¨‹è®¤è¯†</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/utility%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">Simple-LIO-SAMâ€”â€”ï¼ˆå››ï¼‰utilityæ–‡ä»¶è§£è¯»</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/imageProjection-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆäº”ï¼‰ç‚¹äº‘å»ç•¸å˜æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/22/lio_sam/featureExtraction-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…­ï¼‰ç‰¹å¾æå–æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/03/27/lio_sam/gtsam-quickstart/">Simple-LIO-SAMâ€”â€”ï¼ˆä¸ƒï¼‰GTSAMå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://zeal-up.github.io/2023/03/30/lio_sam/imuPreintegration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆå…«ï¼‰IMUé¢„ç§¯åˆ†æ¨¡å—</a></li>
<li><a href="https://zeal-up.github.io/2023/04/06/lio_sam/pcdRegistration-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆä¹ï¼‰ç‚¹äº‘åŒ¹é…ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zeal-up.github.io/2023/04/11/lio_sam/mapOptimization-doc/">Simple-LIO-SAMâ€”â€”ï¼ˆåï¼‰åç«¯ä¼˜åŒ–æ¨¡å—è¯¦è§£</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">FastDDSå…³é”®æ¦‚å¿µ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 18:02:43" itemprop="dateCreated datePublished" datetime="2023-03-13T18:02:43+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/DDS/" itemprop="url" rel="index"><span itemprop="name">DDS</span></a>
        </span>
    </span>

  
    <span id="/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/" class="post-meta-item leancloud_visitors" data-flag-title="FastDDSå…³é”®æ¦‚å¿µ" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="FastDDSå…³é”®æ¦‚å¿µ" href="/2023/03/13/dds/FastDDS%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::73f7a0f706535d55ad531611b3af6c03" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="æ¶æ„">æ¶æ„</h1>
<p>æ¶æ„å›¾ <img src="./imgs/fast-dds-architecture.svg" alt="æ¶æ„å›¾" /></p>
<p>åŸŸï¼ˆDomainï¼‰çš„æ¦‚å¿µ <img src="imgs/domain_concept.jpg" alt="Domain" /> <img src="imgs/dds_domain.svg" alt="Domain" /></p>
<p>æ•°æ®ä¸­å¿ƒæ”¶å‘æ¨¡å‹ï¼ˆDCPS:Data Centric Publisher and Subscriber) <img src="imgs/DataCentricModel.png" alt="DCPS" /></p>
<h1 id="why-need-a-publisher-and-subscriber">Why need a publisher and subscriber</h1>
<blockquote>
<p>These publishers and subscribers donâ€™t need to know about each other ahead of time; they discover each other dynamically at runtime. The data they share is described by a â€œtopic,â€ and publishers and subscribers send and receive data only for the topics they are interested in. In this pattern, many publishers may publish the same topic, and many subscribers may subscribe to the same topic. Subscribers receive data from all of the publishers that they share a topic with. Publishers send data directly to subscribers, with no need for a broker or centralized application to mediate communications. (https://community.rti.com/static/documentation/connext-dds/6.0.1/doc/manuals/connext_dds/getting_started/cpp11/intro_pubsub_cpp.html)</p>
</blockquote>
<h1 id="notes">Notes</h1>
<p>Publisher å’Œ Subscriber è´Ÿè´£ç”ŸæˆDataWriter&amp;&amp;DataReaderï¼Œä¸€ä¸ªPublisher[Subscriber]å¯ä»¥ç»‘å®šå¤šä¸ªDataWriter[DataReader]ã€‚æ¯ä¸€ä¸ªDataWriter[DataReader]éƒ½ä¼šç»‘å®šåˆ°ä¸€ä¸ªtopicï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šå¯¹åº”çš„å›è°ƒå‡½æ•°DataWriterListener[DataReaderListener]</p>
<h1 id="æ•°æ®ç›‘æ§fastdds-monitor">æ•°æ®ç›‘æ§â€”â€”FastDDS Monitor</h1>
<p><a target="_blank" rel="noopener" href="https://fast-dds-monitor.readthedocs.io/en/latest/rst/getting_started/tutorial.html">FastDDS Monitor Tutorial</a> ## åŸç† FastDDSåº“æœ‰ä¸€ä¸ªå†…åµŒçš„Participantï¼Œå«åšStatistic Participantï¼ŒåŒ…å«åœ¨FastDDSçš„Statistic Moduleä¸­ã€‚è¯¥æ¨¡å—ä¸æ˜¯é»˜è®¤ç¼–è¯‘çš„ï¼Œå› æ­¤éœ€è¦åœ¨ç¼–è¯‘FastDDSçš„æ—¶å€™æŒ‡æ˜CMakeé€‰é¡¹ã€‚ å®é™…ä¸Šæ˜¯ç”¨æˆ·å¼€å‘åº”ç”¨æ—¶ï¼Œåœ¨æ„å»º<strong>DomainParticipants</strong>é˜¶æ®µï¼Œå¦‚æœé€šè¿‡æŸç§æ–¹å¼æŒ‡æ˜äº†è¦å°†æ•°æ®ç»Ÿè®¡ä¿¡æ¯å¾€å¤–å‘é€ï¼Œåˆ™Statistic Moduleæ¨¡å—å°±ä¼šè‡ªåŠ¨æ”¶é›†ä¿¡æ¯ï¼Œç„¶åå¾€å›ºå®šçš„topicå‘é€ç›‘æ§æ•°æ®ã€‚FastDDS Monitoré€šè¿‡è¿™äº›å†…åµŒçš„topicï¼Œå¯ä»¥ç›‘æ§æ•°æ®çš„æ”¶å‘æƒ…å†µã€‚</p>
<p><a target="_blank" rel="noopener" href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/statistics/statistics.html">å¦‚ä½•æ‰“å¼€Statistics DataWriters</a> <a target="_blank" rel="noopener" href="https://fast-dds-monitor.readthedocs.io/en/latest/rst/getting_started/tutorial.html">å¦‚ä½•ä½¿ç”¨FastDDS Monitor</a></p>
<p><strong>æ³¨æ„ï¼Œå¦‚æœç¼–è¯‘FastDDSçš„æ—¶å€™æ‰“å¼€Statistics Moduleæ¨¡å—ï¼Œç”±äºä¼šå‘é€é¢å¤–çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¼šæŸå¤±æ€§èƒ½</strong> &gt; Consequently, by default, Fast DDS does not compile this module because it may entail affecting the applicationâ€™s performance.(https://fast-dds.docs.eprosima.com/en/latest/fastdds/statistics/statistics.html)</p>
<figure>
<img src="imgs/monitor.jpg" alt="" /><figcaption>æ•°æ®ç›‘æ§çª—å£</figcaption>
</figure>
<h1 id="record-replay">Record &amp;&amp; Replay</h1>
<blockquote>
<p>rosbag2 is a ROS 2 application that can be used to capture DDS messages and store them on an SQLite database which allows inspecting and replaying said messages at a later time.</p>
</blockquote>
<ol type="1">
<li>rosbag2å¯ä»¥å°†åœ¨Topicä¸­ä¼ é€çš„æ•°æ®ä»¥SQLiteçš„å½¢å¼ä¿å­˜</li>
<li>FastDDSæ²¡æœ‰è‡ªå·±çš„æ•°æ®ä¿å­˜å’Œå›æ”¾å·¥å…·ï¼Œå®˜æ–¹è¯´æ˜ç”¨çš„æ˜¯ROS2çš„<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2">rosbag2</a>åŒ…ã€‚è¦ä½¿ç”¨è¯¥åŒ…æ¥è®°å½•å’Œå›æ”¾FastDDSçš„æ•°æ®éœ€è¦å®‰è£…ROS2ç¯å¢ƒå’Œrosbag2</li>
<li>ç”±äºrosbag2æ˜¯ç”¨æ¥ä¿å­˜ros2çš„messageçš„ï¼Œå¹¶ä¸æ˜¯FastDDSçš„å®˜æ–¹å·¥å…·ï¼Œå› æ­¤å¦‚æœè¦ç”¨rosbag2å›æ”¾ï¼Œéœ€è¦åšè¾ƒå¤šçš„é…ç½®</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/use_cases/rosbag_capture/rosbag_capture.html#rosbag-capture">ä½¿ç”¨rosbag-capture</a></p>
<h1 id="limitations">Limitations</h1>
<ol type="1">
<li>æ²¡æœ‰è¿›ç¨‹ç®¡ç†å’Œå¯åŠ¨å·¥å…·ã€‚ROS/Apollo/XPilotéƒ½æœ‰å±äºè‡ªå·±çš„è¿›ç¨‹è°ƒåº¦ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥æŒ‰æŒ‡å®šé¡ºåºå¯åŠ¨å¤šä¸ªè¿›ç¨‹å¹¶æ‰§è¡Œç›¸å…³è°ƒåº¦ã€‚</li>
<li>ä¼¼ä¹æ— æ³•å®ç°åƒROSçš„Serviceè¿™ç§ç±»ä¼¼RPCçš„åŠŸèƒ½</li>
</ol>
<h1 id="reference-resources-link">Reference &amp;&amp; Resources link</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://github.com/eProsima/Fast-DDS">FastDDS Github</a></li>
<li><a target="_blank" rel="noopener" href="https://fast-dds-monitor.readthedocs.io/en/latest/rst/installation/linux.html">FastDDS Monitor Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/use_cases/rosbag_capture/rosbag_capture.html#rosbag-capture">ä½¿ç”¨rosbag-capture</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/eProsima/Fast-DDS-python.git">Fast-DDS-Python</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zeal-up.github.io/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zeal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zeal's Blog">
      <meta itemprop="description" content="å­¦ä¹ è®°å½•åŠåˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zeal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/" class="post-title-link" itemprop="url">ç»ä¹…ä¸è¡°çš„å¡å°”æ›¼æ»¤æ³¢å™¨-åŸºç¡€çŸ¥è¯†åŠå…¬å¼æ¨å¯¼</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 17:59:59" itemprop="dateCreated datePublished" datetime="2023-03-13T17:59:59+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-16 18:07:59" itemprop="dateModified" datetime="2023-03-16T18:07:59+08:00">2023-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">æŠ€èƒ½</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/%E6%BB%A4%E6%B3%A2/" itemprop="url" rel="index"><span itemprop="name">æ»¤æ³¢</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E8%83%BD/%E6%BB%A4%E6%B3%A2/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/" itemprop="url" rel="index"><span itemprop="name">å¡å°”æ›¼æ»¤æ³¢</span></a>
        </span>
    </span>

  
    <span id="/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/" class="post-meta-item leancloud_visitors" data-flag-title="ç»ä¹…ä¸è¡°çš„å¡å°”æ›¼æ»¤æ³¢å™¨-åŸºç¡€çŸ¥è¯†åŠå…¬å¼æ¨å¯¼" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyanï¼š</span>
    
    <a title="ç»ä¹…ä¸è¡°çš„å¡å°”æ›¼æ»¤æ³¢å™¨-åŸºç¡€çŸ¥è¯†åŠå…¬å¼æ¨å¯¼" href="/2023/03/13/kalman_filter/%E7%BB%8F%E4%B9%85%E4%B8%8D%E8%A1%B0%E7%9A%84%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%99%A8-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::485da1f1f8066e1c77d786731c1e5117" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸€å¡å°”æ›¼æ»¤æ³¢å™¨çš„åº”ç”¨åœºæ™¯">ä¸€ã€å¡å°”æ›¼æ»¤æ³¢å™¨çš„åº”ç”¨åœºæ™¯</h1>
<p>å¡å°”æ›¼æ»¤æ³¢å™¨ä¹‹å‰è¢«å¹¿æ³›ç”¨æ¥åšåŠ¨æ€ç³»ç»Ÿçš„çŠ¶æ€ä¼°è®¡ã€é¢„æµ‹ã€‚ä¸»è¦çš„ç›®çš„å°±æ˜¯ç”¨æ¥ä»å¸¦å™ªå£°çš„è§‚æµ‹é‡ï¼Œæ¯”å¦‚å„ç§ä¼ æ„Ÿå™¨çš„è§‚æµ‹ï¼ˆIMUã€GPSã€é‡Œç¨‹è®¡ç­‰ï¼‰ä¼°è®¡å‡ºæœ€ä¼˜çš„ç³»ç»ŸçŠ¶æ€ï¼ˆstateï¼‰ã€‚ä¸è¿‡è¦æ˜ç¡®å¼ºè°ƒçš„æ˜¯ï¼Œç”±äºæµ‹é‡éƒ½å¸¦æœ‰å™ªå£°ï¼Œä¹Ÿå°±æ˜¯éšæœºæ€§ï¼Œæ‰€ä»¥çœŸæ­£å‡†ç¡®çš„çŠ¶æ€æ˜¯æ— æ³•è·çŸ¥çš„ã€‚</p>
<p>æœ€å°äºŒä¹˜æ³•å¯ä»¥ä»ä¸€é•¿ä¸²çš„æµ‹é‡å€¼å›å½’å‡ºä¸€ä¸ªæœ€ä¸ºåŒ¹é…çš„æ¨¡å‹ã€‚å¡å°”æ›¼æ»¤æ³¢ç›¸æ¯”äºæœ€å°äºŒä¹˜æ³•ï¼Œé‡‡ç”¨äº†ä¸€ç§é€’å½’çš„è®¡ç®—æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€æ—¶åˆ»åªéœ€è¦ä¿å­˜ä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚å› æ­¤å¯ä»¥è¢«ç”¨æ¥å¤„ç†å®æ—¶ä»»åŠ¡ã€‚</p>
<p>è™½ç„¶å¡å°”æ›¼æ»¤æ³¢å™¨ä»ç¾å›½é˜¿æ³¢ç½—ç™»æœˆè®¡åˆ’åˆ°å¦‚ä»Šå·²æœ‰å‡ åå¹´ï¼Œä¸”ç›®å‰æœ‰æ›´å…ˆè¿›çš„å› å­å›¾ï¼ˆFactor Graphï¼‰ç®—æ³•ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šé¢†åŸŸä¾æ—§å¯ä»¥çœ‹åˆ°å¡å°”æ›¼æ»¤æ³¢å™¨çš„èº«å½±ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨é©¾é©¶çš„å„ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ï¼šä»IMUçš„æ•°æ®ï¼ˆä¸‰è½´åŠ é€Ÿåº¦ï¼Œä¸‰è½´è§’é€Ÿåº¦ï¼‰è®¡ç®—å‡ºè¿åŠ¨ç‰©ä½“çš„å½“å‰ä½ç½®ã€‚</p>
<h1 id="äºŒå¡å°”æ›¼æ»¤æ³¢å™¨çš„ä¸¤ä¸ªæ­¥éª¤å®è§‚è®¤è¯†">äºŒã€å¡å°”æ›¼æ»¤æ³¢å™¨çš„ä¸¤ä¸ªæ­¥éª¤â€”â€”å®è§‚è®¤è¯†</h1>
<p>å¡å°”æ›¼æ»¤æ³¢åŒ…å«ä¸¤ä¸ªæ­¥éª¤</p>
<ol type="1">
<li>é¢„æµ‹ï¼ˆpredictionï¼‰â€”â€” Dynamic model</li>
<li>æ›´æ–°ï¼ˆcorrection/measurment updateï¼‰â€”â€” Observation model</li>
</ol>
<p>æ‰€è°“<strong>é¢„æµ‹</strong>ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ•°å­¦æ¨¡å‹ï¼Œæ ¹æ®å½“å‰çš„ä¼ æ„Ÿå™¨è¾“å…¥ï¼Œç›´æ¥è®¡ç®—æ­¤æ—¶ç³»ç»Ÿçš„çŠ¶æ€ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ–¹ç¨‹çš„è®¡ç®—å°±è¡Œã€‚</p>
<p>æ‰€è°“çš„<strong>æ›´æ–°</strong>ï¼Œå°±æ˜¯åœ¨æŸäº›æ—¶åˆ»æˆ–è€…æ¯ä¸€æ—¶åˆ»ï¼Œè·å–ä¸€äº›ç³»ç»Ÿçš„çŠ¶æ€è¾“å…¥ï¼ˆå¯ä»¥åŒæ ·æ˜¯ä¼ æ„Ÿå™¨çš„å€¼ï¼‰ï¼Œç”šè‡³æ˜¯<strong>é¢„æµ‹</strong>é˜¶æ®µä¸­åŒæ ·çš„ä¼ æ„Ÿå™¨çš„å€¼ï¼Œå°†å…¶å½“ä½œçœŸå€¼ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå€¼å«åš<strong>æµ‹é‡å€¼</strong>ã€‚æ¯”è¾ƒæ­¤åˆ»<strong>é¢„æµ‹</strong>çš„ç³»ç»ŸçŠ¶æ€å’Œ<strong>æµ‹é‡</strong>çš„ç³»ç»ŸçŠ¶æ€ï¼Œå¯¹<strong>é¢„æµ‹</strong>å‡ºçš„ç³»ç»ŸçŠ¶æ€è¿›è¡Œä¿®æ­£ï¼Œå› æ­¤ä¹Ÿå«<strong>æµ‹é‡æ›´æ–°</strong>ï¼ˆmeasurment updateï¼‰ã€‚</p>
<figure>
<img src="./imgs/framework.png" alt="" /><figcaption>framework</figcaption>
</figure>
<h1 id="ä¸‰å¡å°”æ›¼æ»¤æ³¢çš„å‡ å¤§æ¦‚å¿µ">ä¸‰ã€å¡å°”æ›¼æ»¤æ³¢çš„å‡ å¤§æ¦‚å¿µ</h1>
<h2 id="çŠ¶æ€å‘é‡state-vector">1ã€çŠ¶æ€å‘é‡State Vector</h2>
<p>ç³»ç»Ÿçš„çŠ¶æ€å‘é‡åŒ…å«äº†ç³»ç»Ÿä¸­æˆ‘ä»¬å…³å¿ƒçš„çŠ¶æ€å˜é‡ï¼Œæ¯”å¦‚é€Ÿåº¦<span class="math inline">\(\textbf{v}=[v_x, v_y,v_z]\)</span>ï¼Œè·ç¦»<span class="math inline">\(\textbf{d}=[d_x, d_y,d_z]\)</span>ï¼ŒåŠ é€Ÿåº¦<span class="math inline">\(\textbf{a}=[a_x,a_y,a_z]\)</span>ç­‰ã€‚æˆ‘ä»¬ç”¨<span class="math inline">\(\textbf{x}\)</span>è¡¨ç¤ºç³»ç»Ÿå‘é‡ <span class="math display">\[ \textbf{x} = \begin{bmatrix} \textbf{d}\\ \textbf{v}\\ \textbf{a} \end{bmatrix}\\\]</span></p>
<p>å› ä¸ºå¡å°”æ›¼æ»¤æ³¢æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å…ˆä»¥æ¯ä¸ªæ—¶åˆ»éƒ½è¿›è¡Œæµ‹é‡å’Œä¿®æ­£è¿™ä¸¤ä¸ªæ­¥éª¤ä½œä¸ºè®²è§£ã€‚é‚£ä¹ˆï¼Œæ¯ä¸€æ—¶åˆ»çš„ä¸¤ä¸ªæ­¥éª¤çš„è¾“å‡ºå¯¹åº”ä¸¤ä¸ªç³»ç»Ÿå‘é‡ï¼Œä¸€ä¸ªæ˜¯é¢„æµ‹çš„ç³»ç»Ÿå‘é‡<span class="math inline">\(\textbf{x}^-\)</span>ï¼Œä¸€ä¸ªæ˜¯ä¿®æ­£åçš„ç³»ç»Ÿå‘é‡<span class="math inline">\(\textbf{x}^+\)</span>ã€‚</p>
<p><strong><em><strong>ps</strong>:å¤§å†™å­—æ¯è¡¨ç¤ºçŸ©é˜µï¼›å°å†™åŠ ç²—å­—æ¯è¡¨ç¤ºå‘é‡ï¼›å°å†™å­—æ¯è¡¨ç¤ºå˜é‡</em></strong></p>
<h2 id="çŠ¶æ€æ–¹ç¨‹é¢„æµ‹æ–¹ç¨‹">2ã€çŠ¶æ€æ–¹ç¨‹&amp;&amp;é¢„æµ‹æ–¹ç¨‹</h2>
<h3 id="çŠ¶æ€æ–¹ç¨‹">çŠ¶æ€æ–¹ç¨‹</h3>
<p><strong>çŠ¶æ€æ–¹ç¨‹</strong>æè¿°äº†å°†ä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€å‘é‡<span class="math inline">\(\textbf{x}_{t-1}\)</span>æ˜ å°„åˆ°å½“å‰çš„ç³»ç»ŸçŠ¶æ€<span class="math inline">\(\textbf{x}_t\)</span> <span class="math display">\[ \textbf{x}_t = A_t\textbf{x}_{t-1}+ B_t\textbf{u}_t+\textbf{w}_t \tag{1}\]</span></p>
<p>å…¶ä¸­ï¼ŒçŸ©é˜µ<span class="math inline">\(A\)</span>ç§°ä¸ºè½¬æ¢çŸ©é˜µï¼ˆTransition Matrixï¼‰ï¼Œ<span class="math inline">\(\textbf{u}_t\)</span>æ˜¯å½“å‰æ—¶åˆ»çš„ç³»ç»Ÿè¾“å…¥ï¼ŒçŸ©é˜µ<span class="math inline">\(B\)</span>ç§°ä¸ºæ§åˆ¶çŸ©é˜µï¼ˆControl Matrixï¼‰åæ˜ äº†ç³»ç»Ÿè¾“å…¥åˆ°ç³»ç»ŸçŠ¶æ€çš„æ˜ å°„å…³ç³»ï¼Œ<span class="math inline">\(\textbf{w}_t\)</span>æ˜¯è¿‡ç¨‹å™ªå£°ï¼Œæˆ‘ä»¬å‡å®šå…¶ç¬¦åˆå‡å€¼ä¸º0ï¼Œåæ–¹å·®çŸ©é˜µä¸º<span class="math inline">\(Q_t\)</span>çš„é«˜æ–¯å™ªå£°ã€‚è¿™é‡Œè¦æ³¨æ„çš„æœ‰å‡ ç‚¹ï¼š</p>
<ol type="1">
<li>çŸ©é˜µ<span class="math inline">\(Aã€B\)</span>éƒ½éšç€æ—¶é—´æ¼”è¿›è¿›è¡Œæ›´æ–°</li>
<li>ä»å…¬å¼1çš„å½¢å¼å¯ä»¥çœ‹å‡ºï¼Œå¡å°”æ›¼æ»¤æ³¢çš„æ•°å­¦å»ºæ¨¡å½¢å¼æ˜¯çº¿æ€§æ–¹ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯å¡å°”æ›¼æ»¤æ³¢çš„é™åˆ¶ä¹‹ä¸€ã€‚æ‰©å±•å¡å°”æ›¼æ»¤æ³¢å™¨ï¼ˆExtended Kalman Filterï¼‰æ”¯æŒéçº¿æ€§æ¨¡å‹ã€‚</li>
<li>è¿™é‡Œçš„çŠ¶æ€æ–¹ç¨‹æ˜¯ä¸€ä¸ªâ€œå‡†ç¡®â€çš„è¡¨è¾¾ï¼Œå› ä¸ºä¸å‡†ç¡®çš„éƒ¨åˆ†å·²ç»æ”¾åœ¨å™ªå£°é¡¹ä¸­ï¼Œè¦è·Ÿä¸‹é¢çš„é¢„æµ‹æ–¹ç¨‹åŒºåˆ†å¼€æ¥ã€‚è¿™ä¸ªâ€œå‡†ç¡®â€çš„è¡¨è¾¾ç”±äºæœ‰å™ªå£°ï¼ˆéšæœºå‘é‡ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•ä½¿ç”¨å®ƒä½œä¸ºè¾“å‡ºï¼Œåªèƒ½ç”¨å®ƒæ¥åˆ†æã€æ¨å¯¼ã€‚</li>
</ol>
<h3 id="é¢„æµ‹æ–¹ç¨‹">é¢„æµ‹æ–¹ç¨‹</h3>
<p><strong>é¢„æµ‹æ–¹ç¨‹</strong>è·ŸçŠ¶æ€æ–¹ç¨‹åŸºæœ¬ä¸€æ ·ï¼Œè¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œå™ªå£°<span class="math inline">\(\textbf{w}_t\)</span>æ˜¯å‡å€¼ä¸º0çš„é«˜æ–¯å™ªå£°ï¼Œå› æ­¤æœ€å¤§æ¦‚ç‡å¯¹åº”çš„å€¼ä¸º0ï¼Œå› æ­¤æˆ‘ä»¬åœ¨é¢„æµ‹çŠ¶æ€å‘é‡çš„æ—¶å€™å…¶å®ä¸ç”¨ç®¡æœ€åä¸€é¡¹ <span class="math display">\[ \hat{\textbf{x}}^-_t = \textbf{A}_t\hat{\textbf{x}}^+_{t-1} + \textbf{B}_t\textbf{u}_t\tag{2}\]</span></p>
<p>è¿™é‡Œå¯¹ç³»ç»ŸçŠ¶æ€å‘é‡ä¸Šé¢åŠ ä¸Šä¸€ä¸ªå¸½å­è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¼°è®¡é‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å®é™…è¾“å‡ºçš„é‡ã€‚å…¶ä¸­<span class="math inline">\(\hat{\textbf{x}}^+ _{t-1}\)</span>è¡¨ç¤ºä¸Šä¸€æ—¶åˆ»æ‰§è¡Œå®Œæ­¥éª¤äºŒ<strong>æ›´æ–°</strong>åçš„çŠ¶æ€å‘é‡ï¼Œ<span class="math inline">\(\hat{\textbf{x}}^- _{t}\)</span>è¡¨ç¤ºå½“å‰æ—¶å€™åªæ‰§è¡Œäº†æ­¥éª¤1<strong>é¢„æµ‹</strong>çš„çŠ¶æ€å‘é‡ã€‚</p>
<h3 id="ç†è§£é¢„æµ‹æ–¹ç¨‹">ç†è§£é¢„æµ‹æ–¹ç¨‹</h3>
<p>é¢„æµ‹æ–¹ç¨‹ï¼ˆå…¬å¼2ï¼‰ä»å½¢å¼ä¸Šçœ‹åªæ˜¯æŠŠçŠ¶æ€æ–¹ç¨‹ï¼ˆå…¬å¼1ï¼‰å»æ‰äº†å™ªå£°é¡¹ï¼Œä½†å…¶ä¸­åŒ…å«äº†å¾ˆå¤šå«ä¹‰ã€‚å…¶ä¸­ï¼Œè¦æ—¶åˆ»è®°å¾—çš„æ˜¯æˆ‘ä»¬æŠŠç³»ç»ŸçŠ¶æ€å½“ä½œä¸€ä¸ªéšæœºå‘é‡å¤„ç†ï¼Œä¸¥æ ¼çš„è¡¨è¿°éœ€è¦å¼•å…¥éšæœºè¿‡ç¨‹çš„ç›¸å…³çŸ¥è¯†ï¼Œä½†å…¶å®æ²¡å¤ªå¤§å¿…è¦ã€‚ç”±äºå…¬å¼ï¼ˆ1ï¼‰ä¸­çŠ¶æ€å‘é‡æ˜¯ä¸€ä¸ªéšæœºå‘é‡ï¼Œä¸”å™ªå£°é¡¹æ˜¯å‡å€¼ä¸º0çš„é«˜æ–¯å™ªå£°ï¼Œé‚£ä¹ˆçŠ¶æ€å‘é‡<span class="math inline">\(\textbf{x}_t\)</span>ä¹Ÿæ»¡è¶³é«˜æ–¯åˆ†å¸ƒï¼Œå…¶æœ€å¤§æ¦‚ç‡çš„åœ°æ–¹å°±å¯¹åº”è¿™å™ªå£°ä¸º0çš„åœ°æ–¹ï¼Œå› æ­¤æˆ‘ä»¬æœ‰ç†ç”±å°†è¿™ä¸ªæ¦‚ç‡æœ€å¤§å¤„å¯¹åº”çš„å€¼å½“ä½œæˆ‘ä»¬çš„<strong>é¢„æµ‹</strong>ã€‚</p>
<figure>
<img src="./imgs/gaussian.png" alt="" /><figcaption>gaussian</figcaption>
</figure>
<h2 id="æµ‹é‡æ–¹ç¨‹æµ‹é‡ä¼°è®¡æ–¹ç¨‹">3ã€æµ‹é‡æ–¹ç¨‹&amp;&amp;æµ‹é‡ä¼°è®¡æ–¹ç¨‹</h2>
<h3 id="æµ‹é‡æ–¹ç¨‹">æµ‹é‡æ–¹ç¨‹</h3>
<p><strong>æµ‹é‡æ–¹ç¨‹</strong>åæ˜ äº†ç³»ç»Ÿçš„æµ‹é‡å€¼å’Œç³»ç»ŸçŠ¶æ€å‘é‡ä¹‹é—´çš„å…³ç³» <span class="math display">\[ \textbf{z}_t=H_t\textbf{x}_t+v_t\tag{3}\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(\textbf{z}_t\)</span>æ˜¯å½“å‰æ—¶åˆ»çš„æµ‹é‡å€¼ï¼Œ<span class="math inline">\(H_t\)</span>ç§°ä¸ºæµ‹é‡çŸ©é˜µï¼ˆMeasurement Matrixï¼‰ï¼Œæè¿°äº†ä»ç³»ç»ŸçŠ¶æ€åˆ°æµ‹é‡å€¼çš„è½¬æ¢å…³ç³»ï¼ˆä¸¾ä¸€ä¸ªæœ€ç®€å•çš„å…³ç³»ï¼Œç³»ç»ŸçŠ¶æ€æ˜¯ç‰©ä½“çš„ç›´çº¿è·ç¦»ï¼Œæµ‹é‡å€¼æ˜¯ä½¿ç”¨æ¿€å…‰ç¬”æµ‹å‡ºæ¥çš„å…‰ä»åŸç‚¹åˆ°ç‰©ä½“çš„æ—¶é—´ï¼Œé‚£ä¹ˆ<span class="math inline">\(H\)</span>å°±æ˜¯å…‰é€Ÿçš„å€’æ•°ï¼‰, <span class="math inline">\(\textbf{v}_t\)</span>æ˜¯æµ‹é‡å™ªå£°ï¼Œæˆ‘ä»¬å‡å®šå…¶ç¬¦åˆå‡å€¼ä¸º0ï¼Œåæ–¹å·®ä¸º<span class="math inline">\(R_t\)</span>çš„é«˜æ–¯å™ªå£°ã€‚æ³¨æ„è¿™é‡Œæ— è®ºæ˜¯çŠ¶æ€å‘é‡è¿˜æ˜¯æµ‹é‡å‘é‡éƒ½æ²¡æœ‰åŠ å¸½å­ï¼ˆ<span class="math inline">\(\hat{.}\)</span>ï¼‰ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸ª"å‡†ç¡®"çš„è¡¨è¾¾å¼ã€‚</p>
<h3 id="æµ‹é‡ä¼°è®¡æ–¹ç¨‹">æµ‹é‡ä¼°è®¡æ–¹ç¨‹</h3>
<p>åŒæ ·ï¼Œæˆ‘ä»¬å¦‚æœå¿½ç•¥å™ªå£°é¡¹ï¼Œå°±å˜æˆäº†å¯¹æ­¤æ—¶æµ‹é‡é‡çš„ä¼°è®¡ï¼ˆæ³¨æ„çŠ¶æ€å‘é‡çš„ä¸Šæ ‡å’Œè§’æ ‡ï¼‰ï¼š</p>
<p><span class="math display">\[ \hat{\textbf{z}}_t=H_t\hat{\textbf{x}}^-_t\tag{4}\]</span></p>
<h2 id="æµ‹é‡æ›´æ–°æ–¹ç¨‹">4ã€æµ‹é‡æ›´æ–°æ–¹ç¨‹</h2>
<p>ä¸Šé¢ç»™å‡ºäº†å¯¹æµ‹é‡é‡çš„ä¼°è®¡ï¼Œä½†æ˜¯ç°åœ¨çš„æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæµ‹é‡å€¼ï¼ˆé€šè¿‡æŸäº›æµ‹é‡æ–¹å¼æˆ–è€…ä¼ æ„Ÿå™¨æ•°æ®ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦è®¡ç®—å¾—åˆ°çš„é‡ï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨è¿™ä¸ªæµ‹é‡å¾—å‡ºçš„é‡æ¥æ›´æ–°æˆ‘ä»¬å¯¹çŠ¶æ€å‘é‡çš„ä¼°è®¡ï¼Ÿè¿™å°±æ¶‰åŠåˆ°æµ‹é‡æ›´æ–°æ–¹ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯å¡å°”æ›¼æ»¤æ³¢é‡Œæœ€éš¾çš„éƒ¨åˆ†ï¼Œè¿™é‡Œå…ˆç»™å‡ºæ›´æ–°æ–¹ç¨‹çš„å½¢å¼ã€‚</p>
<p><span class="math display">\[ \hat{\textbf{x}}^+_t=\hat{\textbf{x}}^-_t+K_t(z_t-H_t\hat{\textbf{x}}^-_t)\tag{5}\]</span> <span class="math display">\[ K_t=\frac{P^-_tH_t^T}{H_tP^-_tH_t^T+R_t}\tag{6}\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(K_t\)</span>å«åšå¡å°”æ›¼å¢ç›Šï¼›<span class="math inline">\(P^-_t\)</span>æ˜¯ç³»ç»Ÿæµ‹é‡å€¼<span class="math inline">\(\hat{\textbf{x}}^-_t\)</span>çš„è¯¯å·®åæ–¹å·®çŸ©é˜µã€‚</p>
<h1 id="å››è¯¯å·®å’Œåæ–¹å·®çŸ©é˜µ">å››ã€è¯¯å·®å’Œåæ–¹å·®çŸ©é˜µ</h1>
<p>æ ¹æ®å…¬å¼ï¼ˆ1ï¼‰å‡å»å…¬å¼ï¼ˆ2ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºè¯¯å·®çš„åæ–¹å·®çŸ©é˜µçš„è¡¨è¾¾å½¢å¼</p>
<p><span class="math display">\[ e^-_t \triangleq \textbf{x}_t - \hat{\textbf{x}}^-_t\\\]</span> <span class="math display">\[ P^-_t = \mathbb{E}[\textbf{e}^-_t {\textbf{e}^{-}_{t}}^T]\\\]</span></p>
<p>æŠŠå…¬å¼ï¼ˆ1ï¼‰å’Œï¼ˆ2ï¼‰å¸¦å…¥è¯¯å·®è¡¨è¾¾å¼ï¼Œå¯ä»¥æ¨å¯¼å‡ºç³»ç»ŸçŠ¶æ€çš„åæ–¹å·®çŸ©é˜µçš„é€’å½’è¡¨è¾¾å½¢å¼</p>
<p><span class="math display">\[
\begin{split}
P^-_t&amp;=\mathbb{E}[\big((A_tx_{t-1}+w_t)-A_tx_{t-1}^+\big)\big((A_tx_{t-1}+w_t)-A_tx_{t-1}^+\big)^T]\\&amp;=\mathbb{E}[\big(A_t(x_{t-1}-x_{t-1}^+)+w_t\big)\big(A_t(x_{t-1}-x_{t-1}^+)+w_t\big)^T]\\ &amp;=\mathbb{E}[A_t(x_{t-1}-x_{t-1}^+)(x_{t-1}-x_{t-1}^+)^TA_t^T]+\mathbb{E}[w_tw_t^T]\\ &amp;=A_tP_{t-1}^+A_t^T+Q_t
\end{split}\\\]</span></p>
<p>å…¶ä¸­ï¼Œä»ç¬¬äºŒä¸ªç­‰å·åˆ°ç¬¬ä¸‰ä¸ªç­‰å·åˆ©ç”¨äº†çŠ¶æ€å‘é‡å’Œéšæœºå™ªå£° çš„æ— å…³æ€§ï¼ˆåæ–¹å·®ä¸º0ï¼‰ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢çš„å…¬å¼ï¼ˆ7ï¼‰</p>
<p><span class="math display">\[P^-_t=A_tP^+_{t-1}A^T_t+Q_t\tag{7}\]</span></p>
<h1 id="äº”æ›´æ–°æ–¹ç¨‹çš„æ¨å¯¼">äº”ã€æ›´æ–°æ–¹ç¨‹çš„æ¨å¯¼</h1>
<p>ç°åœ¨æˆ‘ä»¬è¿›è¡Œåˆ°äº†è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„æµ‹æ–¹ç¨‹å…¬å¼ï¼ˆ2ï¼‰å¾—åˆ°äº†<span class="math inline">\(t\)</span>æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€é¢„æµ‹é‡<span class="math inline">\(\textbf{x}_t^-\)</span>ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ—¶åˆ»å¾—åˆ°äº†ä¸€ä¸ªæµ‹é‡å€¼ï¼Œä¸”æ ¹æ®æµ‹é‡æ–¹ç¨‹ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä¸æ­¤æ—¶çš„çŠ¶æ€å‘é‡æ»¡è¶³å…¬å¼ï¼ˆ3ï¼‰ï¼š<span class="math inline">\(\textbf{z}_t=H_t\textbf{x}_t+v_t\)</span> ã€‚é‚£ä¹ˆå…¶å®æˆ‘ä»¬å¯ä»¥ä»å…¬å¼ï¼ˆ3ï¼‰ä¹Ÿå¾—åˆ°æ­¤æ—¶ç³»ç»ŸçŠ¶æ€çš„å¦ä¸€ä¸ªä¼°è®¡ï¼Œç”±å…¬å¼ï¼ˆ3ï¼‰å°† ç§»åŠ¨åˆ°ç­‰å¼å·¦ä¾§ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p>
<p><span class="math display">\[\textbf{x}^2_t = \textbf{H}_t^{-1}\textbf{z}_t\\\]</span></p>
<p>è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰æŠŠå™ªå£°<span class="math inline">\(\textbf{v}_t\)</span>è¡¨ç¤ºå‡ºæ¥ï¼Œæ˜¯å› ä¸ºè¿™é‡Œå°† å½“ä½œä¸€ä¸ªéšæœºå‘é‡å¤„ç†ï¼Œå…¶å‡å€¼ä¸º<span class="math inline">\(\bar{z}_t\)</span>ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ—¶åˆ»æµ‹é‡å¾—å‡ºçš„é‡ï¼›å…¶æ–¹å·®ä¸º<span class="math inline">\(R_t\)</span>ï¼ˆåœ¨å…¬å¼3ä¸­ç»™å‡ºï¼‰</p>
<p>æˆ‘ä»¬çš„çŠ¶æ€æ–¹ç¨‹ä¹Ÿç»™å‡ºäº†çŠ¶æ€å‘é‡çš„ä¸€ä¸ªç­‰å¼ <span class="math display">\[ \textbf{x}^1_t = \textbf{A}_t\textbf{x}_{t-1}+ \textbf{B}_t\textbf{u}_t+w_t\]</span></p>
<p>è¿™é‡Œç”¨<strong>ä¸Šæ ‡1å’Œ2</strong>è¡¨ç¤ºçŠ¶æ€å‘é‡çš„ä¸¤ä¸ªæ¥æºã€‚è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªç­‰å¼é‡Œé¢éƒ½åŒ…å«äº†ä¸€ä¸ªéšæœºå™ªå£°ï¼Œå› æ­¤$^1_t ã€^2_t $éƒ½æ˜¯éšæœºå‘é‡ã€‚åŒæ—¶ï¼Œä»–ä»¬çš„åˆ†å¸ƒéƒ½ç¬¦åˆé«˜æ–¯åˆ†å¸ƒã€‚å®ƒä»¬çš„å‡å€¼å’Œæ–¹å·®åˆ†åˆ«æ˜¯ï¼š</p>
<p><span class="math display">\[
\begin{split} &amp;\mu_1=x_t^-\\ &amp;\sigma_1^2=P_t^-\\ &amp;\mu_2=H_t^{-1}\bar{z}_t\\ &amp;\sigma_2^2=H_t^{-1}R_t(H_t^{-1})^T\\  \end{split}\\\]</span></p>
<p>ç°åœ¨æœ‰äº†ä¸¤ä¸ªå…³äºçŠ¶æ€å‘é‡çš„æ¦‚ç‡åˆ†å¸ƒï¼Œé‚£æ¥ä¸‹æ¥çš„äº‹æƒ…å°±ç®€å•äº†ã€‚å› ä¸ºè¿™ä¸¤ä¸ªçŠ¶æ€å‘é‡çš„æ¥æºæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤ä»–ä»¬çš„è”åˆæ¦‚ç‡åˆ†å¸ƒæ˜¯å„è‡ªæ¦‚ç‡åˆ†å¸ƒçš„ä¹˜ç§¯ã€‚é‡ç‚¹æ˜¯ï¼Œé«˜æ–¯åˆ†å¸ƒçš„ä¹˜ç§¯ä¾æ—§æ˜¯é«˜æ–¯åˆ†å¸ƒï¼ï¼ï¼ï¼æ–°çš„é«˜æ–¯åˆ†å¸ƒçš„å‡å€¼å’Œæ–¹å·®æœ‰å¦‚ä¸‹è¡¨è¾¾å½¢å¼ï¼š</p>
<figure>
<img src="./imgs/joint_gaussian.png" alt="" /><figcaption>joint gaussian</figcaption>
</figure>
<p>ç”¨ä¸Šé¢çš„å¼å­ä»£å…¥ï¼Œå¯ä»¥å¾—åˆ°è”åˆæ¦‚ç‡åˆ†å¸ƒçš„å‡å€¼å’Œæ–¹å·®ï¼š <strong>å‡å€¼</strong> <span class="math display">\[ \begin{split} \mu_{fused}&amp;=\frac{\mu_1\sigma_2^2+\mu_2\sigma_1^2}{\sigma_1^2+\sigma_2^2}\\ &amp;=\mu_1+\frac{(\mu_2-\mu_1)\sigma_1^2}{\sigma_1^2+\sigma_2^2}\\ &amp;=x_t^-+\frac{(H_t^{-1}\bar{z}_t-x_t^-)P_t^-}{P_t^-+H_t^{-1}R_t(H_t^{-1})^T}\\ &amp;=x_t^-+\frac{P_t^-H_t^T}{H_tP_t^-H_t^T+R_t}(\bar{z}_t-H_tx_t^-)\\ &amp;=x_t^-+K_t(\bar{z}_t-H_tx_t^-) \end{split}\\\]</span></p>
<p><strong>æ–¹å·®</strong></p>
<p><span class="math display">\[
\begin{split} \sigma_{fused}^2 &amp;=\frac{\sigma_1^2\sigma_2^2}{\sigma_1^2+\sigma_2^2}\\ &amp;=\sigma_1^2-\frac{\sigma_1^4}{\sigma_1^2+\sigma_2^2}\\ &amp;=P_t^--\frac{P_t^-H_t^TH_tP_t^-}{H_tP_t^-H_t^T+R_t}\\ &amp;=P_t^--K_tH_tP_t^- \end{split}\\\]</span></p>
<p>è¿™ä¸ª<span class="math inline">\(\sigma_{fused}^2\)</span>å°±æ˜¯æ›´æ–°åçš„ç³»ç»ŸçŠ¶æ€è¯¯å·®çš„åæ–¹å·®çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ä¸‹é¢çš„å¼å­</p>
<p><span class="math display">\[ P^+_{t}=P^-_t-K_tH_tP^-_t\tag{8}\]</span></p>
<h1 id="å…­æ€»ç»“">å…­ã€æ€»ç»“</h1>
<p><strong>é¢„æµ‹æ–¹ç¨‹</strong> <span class="math display">\[ \hat{\textbf{x}}^-_t = \textbf{A}_t\hat{\textbf{x}}^+_{t-1} + \textbf{B}_t\textbf{u}(t)\tag{2}\]</span> <span class="math display">\[P^-_t=A_tP^+_{t-1}A^T_t+Q_t\tag{7}\]</span></p>
<p><strong>æ›´æ–°æ–¹ç¨‹</strong> <span class="math display">\[ \hat{\textbf{x}}^+_t=\hat{\textbf{x}}^-_t+K_t(z_t-H_t\hat{\textbf{x}}^-_t)\tag{5}\]</span> <span class="math display">\[ K_t=\frac{P^-_tH_t^T}{H_tP^-_tH_t^T+R_t}\tag{6} \]</span> <span class="math display">\[ P^+_{t}=P^-_t-K_tH_tP^-_t\tag{8} \]</span></p>
<hr />
<h1 id="è½¬è½½é¡»çŸ¥">è½¬è½½é¡»çŸ¥</h1>
<ol type="1">
<li>è¯·äºæ–‡ç« æ ‡é¢˜æ³¨æ˜è½¬è½½</li>
<li>è¯·äºæ–‡ç« èµ·å§‹ä½ç½®æ³¨æ˜åŸå§‹é“¾æ¥</li>
<li>è¯·åœ¨æ¨æ–‡æ–‡æœ«çš„ã€é˜…è¯»åŸæ–‡ã€‘é“¾æ¥ä¸ŠåŸå§‹é“¾æ¥</li>
<li>æ„Ÿè°¢~</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/archives/page/2/">2</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/archives/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zeal</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"covS4Q3Q0SaMRjqI2VomagVm-gzGzoHsz","app_key":"iK7kdlu4InjORoPr3oksi1IM","server_url":"https://covs4q3q.lc-cn-n1-shared.com","security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cywzGuJ0w","appkey":"7c4a236bb42c7db38424a76bf68ccf99","count":true}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
